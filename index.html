<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tattoo Veterinary Clinic</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <meta name="description" content="Tattoo Veterinary Clinic - Professional pet care services in Penablanca, Cagayan">
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="#" onclick="toggleSidebar();" class="dashboard-link">üè† Homepage</a>
    <a href="#services" onclick="scrollToSection('services'); toggleSidebar();">ü©∫ Services</a>
    <a href="#contact" onclick="scrollToSection('contact'); toggleSidebar();">üìû Contact Us</a>
    <a href="#store" onclick="scrollToSection('store'); toggleSidebar();">üõí Store</a>
    <a href="#" onclick="handleLogout(); toggleSidebar();" class="logout-sidebar-btn">üö™ Logout</a>
  </div>


  <!-- Fixed Header Bar -->
  <header class="header-bar">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn">&#9776;</button>
      <div class="logo">
        <img src="assets/images/logoo.jpg" alt="Tattoo Veterinary Clinic Logo">
        <span class="clinic-name">TATTOO<br>VETERINARY CLINIC</span>
      </div>
    </div>
    <div class="header-right">
      <img src="assets/images/logoo.jpg" alt="Profile" class="profile-pic" id="headerProfilePic" style="display: none;">
      <div class="auth-links" id="authLinks">
        <a href="#" onclick="showLoginModal()" class="auth-btn">üîê LOG-IN</a>
        <a href="#" onclick="showRegisterModal()" class="auth-btn">üìù SIGN-UP</a>
      </div>
    </div>
  </header>


  <!-- Hero Section -->
  <section class="hero" style="margin-top: 0; padding-top: 20px;">
    <img src="assets/images/dogandcat.png" alt="Dog and Cat" class="hero-pets">
    <div class="hero-text">
      <img src="assets/images/textdogandcat.png" alt="Book a check up for your fur baby today!">
    </div>
    <div class="btn-wrapper">
      <button class="booking-btn" onclick="showBookingModal()">
        <i class="icon">üóìÔ∏è</i> BOOK APPOINTMENT
      </button>
    </div>
  </section>

  <!-- Services Section -->
  <section class="services" id="services">
    <h2>OUR SERVICES</h2>
    <div class="services-container">
      <div class="services-img">
        <img src="assets/images/catsolohehe.png" alt="Cat">
      </div>
      <div class="service-list">
        <span><i class="service-icon">üêï</i> BASIC OBEDIENCE TRAINING</span>
        <span><i class="service-icon">üêç</i> DEWORMING</span>
        <span><i class="service-icon">üì∂</i> MICROCHIP IMPLANTING</span>
        <span><i class="service-icon">üíâ</i> VACCINATION</span>
        <span><i class="service-icon">üè†</i> PET BOARDING</span>
        <span><i class="service-icon">ü¶á</i> EXTERNAL PARASITE PREVENTION</span>
        <span><i class="service-icon">üïäÔ∏è</i> EUTHANASIA</span>
        <span><i class="service-icon">üöë</i> COMPREHENSIVE GENERAL CHECK UP</span>
        <span><i class="service-icon">‚úÇÔ∏è</i> GROOMING</span>
        <span><i class="service-icon">ü¶∑</i> DENTAL SURGERY</span>
        <span><i class="service-icon">üè•</i> SURGERY</span>
        <span><i class="service-icon">üè°</i> HOME SERVICE BY APPOINTMENT</span>
      </div>
    </div>
          </section>

  <!-- Contact Section -->
  <section class="contact" id="contact">
    <h2>CONTACT US</h2>
    <div class="contact-info">
      <div class="contact-details">
        <div class="contact-item"><div class="icon">üìß</div><p>tattaoveterinaryclinic@gmail.com</p></div>
        <div class="contact-item"><div class="icon facebook"><strong>f</strong></div><p>Tattao Veterinary Clinic</p></div>
        <div class="contact-item"><div class="icon">üìû</div><p>0917 519 4639</p></div>
        <div class="contact-item"><div class="icon">üìû</div><p>0975 339 7908</p></div>
        <div class="contact-item"><div class="icon">üìç</div><p>ZONE 2 NATIONAL HIGHWAY, ALIMANAO,<br>PENABLANCA, CAGAYAN</p></div>
      </div>

      <div class="contact-right">
        <div class="map-container">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3802.1335095384566!2d121.75943667463251!3d17.643834595367945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x338585bde16554ff%3A0xb5df81d15287ff9a!2sTattao%20Veterinary%20Clinic!5e0!3m2!1sen!2sph!4v1757403955285!5m2!1sen!2sph" 
            width="100%" 
            height="100%" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            title="Tattao Veterinary Clinic Location Map"
            aria-label="Google Maps showing the location of Tattao Veterinary Clinic">
          </iframe>
        </div>
      </div>
    </div>
          </section>

  <!-- Schedule Section -->
  <section class="schedule">
    <div class="hours">
      <div class="day-box">MONDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box">TUESDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box">WEDNESDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box">THURSDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box">FRIDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box">SATURDAY<br><span>9:00 AM TO 6:00 PM</span></div>
      <div class="day-box closed">SUNDAY<br><span>CLOSED</span></div>
    </div>

    <div class="schedule-container">
      <div class="schedule-left">
        <img src="assets/images/logoo.jpg" alt="Clinic Logo">
        <p>At Tattao Veterinary Clinic, we offer the <strong>best care</strong> for your fur babies. 
        Promoting <strong>Responsible Pet Ownership</strong> by providing your pet care needs at a reasonable price.</p>
        
        <div class="footer-social">
          <a href="https://www.facebook.com/share/16H1LSHgNL/" target="_blank" rel="noopener noreferrer" title="Visit our Facebook page">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
          <a href="mailto:tattaoveterinaryclinic@gmail.com" title="Send us an email">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
          </a>
        </div>
      </div>
      
    </div>
     </div>
   </section>

  <!-- Store Section -->
  <section class="store-section" id="store">
    <h2>STORE</h2>
    <p>THE TATTAO VETERINARY CLINIC OFFERS</p>

    <div class="categories">
      <!-- Food -->
      <div class="category">
        <img src="assets/images/food.png" alt="Food for Pets">
        <h3>FOOD FOR<br>YOUR PETS</h3>
      </div>

      <!-- Grooming -->
      <div class="category">
        <img src="assets/images/grooming.png" alt="Grooming Supplies">
        <h3>GROOMING<br>SUPPLIES</h3>
      </div>

      <!-- Accessories -->
      <div class="category">
        <img src="assets/images/collar.png" alt="Collars and Accessories">
        <h3>AND<br>ACCESSORIES</h3>
      </div>
    </div>
      </div>
    </section>

    <!-- Footer -->
    <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <img src="assets/images/logoo.jpg" alt="Logo">
        <span>Tattoo Veterinary Clinic</span>
      </div>
      <span class="footer-tagline">We offer the best care for your fur babies</span>
      <span class="footer-bottom">2024 ¬© Robinsons Galleria, Ampatuan, Cotabato, Clayton | Accent Log In | OPAC GUI Portal | OAI-PMH Service</span>
    </div>
  </footer>

  <!-- Modal Dialogs -->
  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('loginModal')">&times;</span>
      <h2><i class="modal-icon">üîê</i> Login to Your Account</h2>
      <form id="loginForm">
        <label for="login_email" class="sr-only">Email Address</label>
        <input type="email" id="login_email" name="email" placeholder="‚úâÔ∏è Email" title="Enter your email address" required>

        <div class="password-container">
          <label for="login_password" class="sr-only">Password</label>
          <input type="password" id="login_password" name="password" placeholder="üîí Password" title="Enter your password" required>
          <span class="password-toggle" onclick="togglePasswordVisibility('loginForm')" title="Toggle password visibility" aria-label="Show/hide password">üëÅÔ∏è</span>
        </div>
        <button type="submit"><i class="btn-icon">üîì</i> LOGIN</button>
      </form>
      <p>Don't have an account? <a href="#" onclick="showRegisterModal()">Register here</a></p>
      <p><a href="#" onclick="showForgotPasswordModal()" style="color: #3498db; text-decoration: none;">Forgot your password?</a></p>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('registerModal')">&times;</span>
      <h2 id="registerTitle"><i class="modal-icon">üìù</i> Create Your Account</h2>
      <form id="registerForm">
        
        <label for="register_first_name" class="sr-only">First Name</label>
        <input type="text" id="register_first_name" name="first_name" placeholder="üë§ First Name" title="Enter your first name" required>
        
        <label for="register_last_name" class="sr-only">Last Name</label>
        <input type="text" id="register_last_name" name="last_name" placeholder="üë• Last Name" title="Enter your last name" required>
        
        <label for="register_email" class="sr-only">Email Address</label>
        <input type="email" id="register_email" name="email" placeholder="‚úâÔ∏è Email" title="Enter your email address" required>
        
        <label for="register_phone" class="sr-only">Phone Number</label>
        <input type="tel" id="register_phone" name="phone" placeholder="üì± Phone Number" title="Enter your phone number" required>
        
        <div class="password-container">
          <label for="register_password" class="sr-only">Password</label>
          <input type="password" id="register_password" name="password" placeholder="üîí Password (min 8 chars)" title="Enter a password with at least 8 characters" required minlength="8">
          <span class="password-toggle" onclick="togglePasswordVisibility('registerForm')" title="Toggle password visibility" aria-label="Show/hide password">üëÅÔ∏è</span>
        </div>
        
        <div class="password-strength">
          <div class="pw-strength-bar" id="registerPwBar"></div>
          <div class="pw-strength-text" id="registerPwText">Password strength: -</div>
          <div class="pw-requirements" id="registerPwReq"></div>
        </div>
        
        <label for="register_address" class="sr-only">Address (Optional)</label>
        <input type="text" id="register_address" name="address" placeholder="üè† Address (optional)" title="Enter your address (optional)">

        <button type="submit" id="registerBtn">‚úÖ CREATE ACCOUNT</button>
      </form>
      <p>Already have an account? <a href="#" onclick="showLoginModal()">Login here</a></p>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgotPasswordModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('forgotPasswordModal')">&times;</span>
      <h2><i class="modal-icon">üîë</i> Reset Your Password</h2>
      <form id="forgotPasswordForm">
        <p style="text-align: center; margin-bottom: 20px; color: #666;">
          Enter your email address and we'll send you a link to reset your password.
        </p>
        <label for="forgot_email" class="sr-only">Email Address</label>
        <input type="email" id="forgot_email" name="email" placeholder="‚úâÔ∏è Email Address" title="Enter your email address to reset password" required>
        <button type="submit"><i class="btn-icon">üìß</i> SEND RESET LINK</button>
      </form>
      <p style="text-align: center; margin-top: 20px;">
        Remember your password? <a href="#" onclick="showLoginModal(); closeModal('forgotPasswordModal');">Login here</a>
      </p>
    </div>
  </div>

  <!-- Booking Modal -->
  <div id="bookingModal" class="modal" style="display: none;">
    <div class="modal-content booking-modal">
      <span class="close" onclick="closeModal('bookingModal')">&times;</span>
      <h2 id="bookingModalTitle"><i class="modal-icon">üìÖ</i> Book an Appointment</h2>
      
      <!-- Login Required Message -->
      <div id="loginRequiredMessage" style="display: none; text-align: center; padding: 30px; background: linear-gradient(135deg, rgba(255,153,0,0.15), rgba(255,215,0,0.15)); border: 2px solid rgba(255,153,0,0.3); border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <div style="font-size: 60px; margin-bottom: 15px;">üîê</div>
        <h2 style="color: #e67e22; margin-bottom: 15px; font-size: 24px;">Login Required</h2>
        <p style="color: #8b5a00; font-size: 16px; margin-bottom: 25px; line-height: 1.5;">You need to log in to your account to book an appointment for your pet.</p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button onclick="showLoginModal(); closeModal('bookingModal');" style="background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#2980b9'" onmouseout="this.style.background='#3498db'"><i class="btn-icon">üîê</i> Login Now</button>
          <button onclick="showRegisterModal(); closeModal('bookingModal');" style="background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#219a52'" onmouseout="this.style.background='#27ae60'"><i class="btn-icon">üìù</i> Register Now</button>
        </div>
        <p style="color: #95a5a6; font-size: 14px; margin-top: 20px; margin-bottom: 0;">Don't have an account? Registration is quick and easy!</p>
      </div>
      
      <!-- Booking Form -->
      <form id="bookingForm" style="display: none;">
        <div class="form-group">
          <label for="booking_service"><i class="form-icon">üè•</i> Select Service:</label>
          <select id="booking_service" name="service_id" title="Select a veterinary service" aria-label="Select a veterinary service" required>
            <option value="">Loading services...</option>
          </select>
          <button type="button" onclick="refreshServices()" title="Refresh services" style="background: #f39c12; color: white; border: none; padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 12px;">üîÑ</button>
        </div>
        
        <div class="form-group">
          <label for="booking_pet"><i class="form-icon">üê∂</i> Select Pet:</label>
          <select id="booking_pet" name="pet_id" title="Select your pet" aria-label="Select your pet" required>
            <option value="">Loading pets...</option>
          </select>
          <button type="button" onclick="showAddPetForm()" title="Add a new pet" style="background: #4169e1; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-left: 10px;"><i class="btn-icon">üê∂</i> Add New Pet</button>
        </div>
        
        <div class="form-group">
          <label for="booking_date"><i class="form-icon">üìÖ</i> Appointment Date:</label>
          <input type="date" id="booking_date" name="appointment_date" title="Select appointment date" required min="" />
        </div>
        
        <div class="form-group">
          <label for="booking_time"><i class="form-icon">‚è∞</i> Appointment Time:</label>
          <select id="booking_time" name="appointment_time" title="Select appointment time" aria-label="Select appointment time" required>
            <option value="">Select date first</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="booking_notes"><i class="form-icon">üìù</i> Notes (Optional):</label>
          <textarea id="booking_notes" name="notes" rows="3" placeholder="üí¨ Any special instructions or concerns..." title="Enter any special instructions or concerns"></textarea>
        </div>
        
        <button type="submit"><i class="btn-icon">üóìÔ∏è</i> Book Appointment</button>
      </form>
      
      <!-- Add Pet Form (Hidden) -->
      <div id="addPetForm" style="display: none; border-top: 1px solid rgba(255,215,0,0.3); padding-top: 20px; margin-top: 20px;">
        <h3 style="color: #ffd700;"><i class="form-icon">üêæ</i> Add New Pet</h3>
        <div class="form-row">
          <label for="petName" class="sr-only">Pet Name</label>
          <input type="text" id="petName" placeholder="üè∑Ô∏è Pet Name" title="Enter your pet's name" required />
          
          <label for="petSpecies" class="sr-only">Pet Species</label>
          <select id="petSpecies" title="Select your pet's species" aria-label="Select pet species" required>
            <option value="">üêæ Select Species</option>
            <option value="Dog">üê∂ Dog</option>
            <option value="Cat">üê± Cat</option>
            <option value="Bird">üê¶ Bird</option>
            <option value="Rabbit">üê∞ Rabbit</option>
            <option value="Other">üêæ Other</option>
          </select>
        </div>
        <div class="form-row">
          <label for="petBreed" class="sr-only">Pet Breed (Optional)</label>
          <input type="text" id="petBreed" placeholder="üß¨ Breed (Optional)" title="Enter your pet's breed (optional)" />

          <label for="petBirthdate" class="sr-only">Pet Birthdate</label>
          <input type="date" id="petBirthdate" placeholder="üéÇ Birthdate" title="Select your pet's birthdate" max="" />
        </div>
        <div class="form-row">
          <label for="petGender" class="sr-only">Pet Gender</label>
          <select id="petGender" title="Select your pet's gender" aria-label="Select pet gender" required>
            <option value="">‚öîÔ∏è Select Gender</option>
            <option value="Male">‚ôÇÔ∏è Male</option>
            <option value="Female">‚ôÄÔ∏è Female</option>
          </select>
          
          <label for="petWeight" class="sr-only">Pet Weight</label>
          <input type="number" id="petWeight" placeholder="‚öñÔ∏è Weight (kg)" title="Enter your pet's weight in kilograms" step="0.1" min="0" />
        </div>
        
        <label for="petColor" class="sr-only">Pet Color (Optional)</label>
        <input type="text" id="petColor" placeholder="üé® Color (Optional)" title="Enter your pet's color (optional)" />
        <div style="margin-top: 15px;">
          <button type="button" onclick="addPet()"><i class="btn-icon">‚ûï</i> Add Pet</button>
          <button type="button" onclick="hideAddPetForm()" style="background: #666;"><i class="btn-icon">‚ùå</i> Cancel</button>
        </div>
      </div>
      
      <!-- Staff Dashboard (Hidden by default) -->
      <div id="staffDashboard" style="display: none;">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
          <h3 style="color: #ffd700; margin: 0;">üìã Appointment Management Dashboard</h3>
          <div>
            <button onclick="loadAllAppointments()" style="background: #4169e1; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px;"><i class="btn-icon">üîÑ</i> Refresh</button>
            <select id="statusFilter" onchange="filterAppointments()" style="padding: 8px; border-radius: 5px;">
              <option value="">All Appointments</option>
              <option value="Pending">Pending</option>
              <option value="Confirmed">Confirmed</option>
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
        </div>
        
        <div id="appointmentsList" style="max-height: 400px; overflow-y: auto; border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; padding: 15px;">
          <p style="text-align: center; color: #666;">Loading appointments...</p>
        </div>
        
        <div style="margin-top: 15px; text-align: center;">
          <p style="color: #888; font-size: 14px;">üí° Click on appointments to update their status</p>
        </div>
      </div>
    </div>
  </div>


  <!-- Notification Toast -->
  <div id="toast" class="toast"></div>

  <style>
    /* Red Header Bar and Sidebar Styles */
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #f5f5f5;
    }



    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 70px; /* Account for fixed header */
      left: -250px;
      width: 250px;
      height: calc(100vh - 70px); /* Full height minus header */
      background-color: #1e40af; /* Blue theme sidebar */
      color: white;
      transition: 0.3s ease;
      z-index: 999;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    /* Fixed Header Bar */
    .header-bar {
      background-color: #b91c1c; /* Red header bar */
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 70px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .menu-btn {
      font-size: 22px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
      padding: 8px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .menu-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid white;
      object-fit: cover;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .profile-pic:hover {
      transform: scale(1.1);
    }

    /* Auth Buttons */
    .auth-links {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .auth-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Logo in header */
    .header-left .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-left .logo img {
      height: 40px;
      width: auto;
    }

    .header-left .clinic-name {
      font-size: 14px;
      font-weight: bold;
      line-height: 1.2;
      color: white;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: 0.2s;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      padding-left: 30px;
    }

    .logout-sidebar-btn {
      background-color: rgba(59, 130, 246, 0.2);
      color: #60a5fa !important;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 10px;
      font-weight: 600;
      display: none !important;
    }

    .logout-sidebar-btn:hover {
      background-color: rgba(59, 130, 246, 0.3) !important;
      color: #3b82f6 !important;
      padding-left: 30px;
    }

    .logout-sidebar-btn.visible {
      display: block !important;
    }

    /* Hide logout button when not logged in */
    body:not(.logged-in) .logout-sidebar-btn {
      display: none !important;
    }

    /* Show logout button only when logged in */
    body.logged-in .logout-sidebar-btn.visible {
      display: block !important;
    }

    /* Main Content - Account for fixed header */
    .content, .hero, .services, .contact, .schedule, .store-section {
      margin-top: 70px; /* Account for fixed header */
      padding-top: 20px;
    }

    /* Close sidebar when clicking outside on mobile */
    .sidebar.active::before {
      content: '';
      position: fixed;
      top: 70px;
      left: 250px;
      width: calc(100vw - 250px);
      height: calc(100vh - 70px);
      background: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }

    /* Screen reader only labels */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Password visibility toggle styles */
    .password-container {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .password-container input[type="password"],
    .password-container input[type="text"] {
      width: 100%;
      padding-right: 45px; /* Make room for the eye icon */
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      cursor: pointer;
      user-select: none;
      font-size: 18px;
      color: #666;
      transition: color 0.3s ease;
      z-index: 10;
    }
    
    .password-toggle:hover {
      color: #4169e1;
    }
    
    .password-toggle.visible {
      color: #4169e1;
    }
    
    /* Universal Icon Styles */
    .icon, .service-icon, .modal-icon, .btn-icon, .form-icon, .social-icon, .signup-icon {
      display: inline-block;
      margin-right: 8px;
      font-style: normal;
      font-size: 1.2em;
      vertical-align: middle;
      transition: all 0.3s ease;
    }
    
    /* Navigation Icons */
    nav a .icon {
      font-size: 1.1em;
      margin-right: 6px;
    }
    
    /* Service Icons */
    .service-icon {
      font-size: 1.3em;
      margin-right: 10px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    
    .service-list span:hover .service-icon {
      transform: scale(1.2);
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }
    
    /* Modal Icons */
    .modal-icon {
      font-size: 1.4em;
      margin-right: 10px;
      color: #ffd700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Button Icons */
    .btn-icon {
      font-size: 1.1em;
      margin-right: 6px;
      vertical-align: middle;
    }
    
    /* Form Icons */
    .form-icon {
      font-size: 1.1em;
      margin-right: 6px;
      color: #4169e1;
    }
    
    /* Social Icons */
    .social-icon {
      font-size: 1.2em;
      margin-right: 6px;
    }
    
    /* Signup Section Icon */
    .signup-icon {
      font-size: 1.3em;
      margin-right: 8px;
      color: #ffd700;
    }
    
    /* Contact Icons Enhancement */
    .contact-item .icon {
      font-size: 1.4em;
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      min-height: 40px;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    /* Hero Button Icon */
    .booking-btn .icon {
      font-size: 1.2em;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* Auth Links Icons */
    .auth-links a .icon {
      font-size: 1em;
      margin-right: 5px;
    }
    
    /* Responsive Icon Adjustments */
    @media (max-width: 768px) {
      .icon, .service-icon, .modal-icon, .btn-icon, .form-icon {
        font-size: 1em;
        margin-right: 6px;
      }
      
      .service-icon {
        font-size: 1.1em;
      }
      
      .modal-icon {
        font-size: 1.2em;
      }
      
      .contact-item .icon {
        font-size: 1.2em;
        min-width: 35px;
        min-height: 35px;
      }
    }

    /* Password strength meter */
    .password-strength { margin-top: 6px; }
    .pw-strength-bar { height: 8px; border-radius: 6px; background: #eee; position: relative; overflow: hidden; }
    .pw-strength-bar::after { content: ''; display: block; height: 100%; width: 0%; background: #e74c3c; transition: width 0.3s ease, background 0.3s ease; }
    .pw-strength-text { font-size: 12px; color: #666; margin-top: 6px; }
    .pw-requirements { font-size: 12px; color: #8b5a00; margin-top: 4px; }
    .pw-ok { color: #27ae60; }
    .pw-bad { color: #e74c3c; }

    /* Store Section Styles */
    .store-section {
      text-align: center;
      padding: 40px 20px;
      background: #27406b;
    }

    .store-section h2 {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
      color: white;
    }

    .store-section p {
      font-size: 14px;
      margin-bottom: 30px;
      color: #d1d5db;
    }

    .categories {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .category {
      background: #3a588c;
      border-radius: 12px;
      padding: 20px;
      width: 250px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .category:hover {
      transform: translateY(-8px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    }

    .category img {
      max-width: 100%;
      height: 150px;
      object-fit: contain;
      margin-bottom: 15px;
    }

    .category h3 {
      font-size: 18px;
      font-weight: bold;
      color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .categories {
        flex-direction: column;
        align-items: center;
      }

      /* Mobile header adjustments */
      .header-bar {
        padding: 10px 15px;
      }

      .header-left .clinic-name {
        font-size: 12px;
      }

      .auth-btn {
        padding: 6px 12px;
        font-size: 11px;
      }
    }

  </style>

  <script>
    // Global variables
    let csrfToken = '';
    let currentUser = null;
    let currentUserType = null;
    const API_BASE_URL = 'api/vet_api.php';

    // Profile Picture Management System
    class ProfilePictureManager {
      constructor() {
        this.defaultProfilePic = 'assets/images/logoo.jpg';
        this.profilePicElement = null;
        this.initialized = false;
      }

      // Initialize the profile picture system
      init() {
        this.profilePicElement = document.getElementById('headerProfilePic');
        if (this.profilePicElement) {
          this.initialized = true;
          console.log('ProfilePictureManager initialized successfully');
        } else {
          console.warn('ProfilePictureManager: Could not find headerProfilePic element');
        }
      }

      // Get the correct profile picture path
      getProfilePicturePath(user) {
        if (!user) return this.defaultProfilePic;

        // If user has a profile picture, use it
        if (user.profile_picture && user.profile_picture.trim() !== '' && user.profile_picture !== 'null') {
          // Handle different profile picture path formats
          let profilePicPath = user.profile_picture;

          // If path doesn't start with assets/, add it
          if (!profilePicPath.startsWith('assets/')) {
            profilePicPath = 'assets/images/profiles/' + profilePicPath;
          }

          return profilePicPath;
        }

        // Otherwise use default
        return this.defaultProfilePic;
      }

      // Update profile picture with error handling
      updateProfilePicture(user) {
        // Re-initialize to get the current profile picture element
        this.init();

        if (!this.initialized || !this.profilePicElement) {
          console.warn('ProfilePictureManager not initialized or profile element not found');
          return;
        }

        const profilePicPath = this.getProfilePicturePath(user);
        console.log('ProfilePictureManager updating to:', profilePicPath);
        console.log('User profile_picture value:', user?.profile_picture);

        // Add timestamp to prevent caching
        const timestamp = Date.now();
        const finalPath = profilePicPath + '?t=' + timestamp;

        console.log('Setting profile picture element src to:', finalPath);

        // Create new image to test loading
        const img = new Image();
        img.onload = () => {
          this.profilePicElement.src = finalPath;
          console.log('ProfilePictureManager: Profile picture loaded successfully');
        };

        img.onerror = () => {
          console.warn('ProfilePictureManager: Profile picture failed to load, using default');
          console.log('Failed path:', finalPath);
          this.profilePicElement.src = this.defaultProfilePic;
        };

        img.src = finalPath;
      }

      // Get user display name
      getUserDisplayName(user) {
        if (!user) return 'User';
        return user.name || user.first_name || 'User';
      }

      // Update entire header profile section
      updateHeaderProfile(user, userType) {
        const profileSection = document.querySelector('.profile-section');
        if (!profileSection) {
          console.warn('Profile section not found');
          return;
        }

        const userName = this.getUserDisplayName(user);
        const profilePicPath = this.getProfilePicturePath(user);

        console.log('Updating header profile:', {
          userName: userName,
          userType: userType,
          profilePicPath: profilePicPath,
          fullUserData: user
        });

        // Update the existing profile picture element instead of recreating
        const existingProfilePic = document.getElementById('headerProfilePic');
        if (existingProfilePic) {
          existingProfilePic.src = profilePicPath;
          existingProfilePic.alt = `${userName}'s profile picture`;
          existingProfilePic.onclick = () => window.location.href = `public/${userType}.html`;
        }

        // Update the profile picture with the new element
        this.init();
        if (user) {
          this.updateProfilePicture(user);
        }
      }
    }

    // Create global profile picture manager instance
    window.profileManager = new ProfilePictureManager();

    // Modern JavaScript with reduced redundancy
    document.addEventListener('DOMContentLoaded', async function () {
      // Initialize profile picture manager
      if (window.profileManager) {
        profileManager.init();
      }

      // Initialize CSRF token and check login status
      try {
        await getCSRFToken();
        await checkLoginStatusOnLoad();
      } catch (error) {
        console.error('Initialization error:', error);
        // Continue without initialization, will retry as needed
      }
      
      // Smooth scrolling for nav links
      document.querySelectorAll('nav a[href^="#"]').forEach(link => {
        link.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href && href.startsWith('#') && href.length > 1) {
            e.preventDefault();
            const targetSection = document.querySelector(href);
            if (targetSection) {
              targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        });
      });
      
      // Get CSRF token
      async function getCSRFToken() {
        try {
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'get_csrf_token' })
          });

          const result = await response.json();
          if (result.success) {
            csrfToken = result.csrf_token || result.data?.csrf_token;
            if (!csrfToken) {
              console.error('CSRF token not found in response:', result);
            }
          } else {
            console.error('Failed to get CSRF token:', result.message);
          }
        } catch (error) {
          console.error('Error getting CSRF token:', error);
          // Continue without CSRF token, server will handle it
        }
      }

      // Helper function for API calls with CSRF token
      async function apiCall(payload) {
        try {
          // Add CSRF token to payload for state-changing actions
          const csrfActions = ['register', 'login', 'logout', 'book_appointment', 'add_pet', 'update_appointment_status', 'add_to_cart', 'place_order', 'update_staff_profile', 'change_staff_password'];
          if (csrfActions.includes(payload.action)) {
            payload.csrf_token = csrfToken;
          }

        try {
            console.log('Making API call:', payload);
            const response = await fetch('api/vet_api.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            // Log response status
            console.log('API response status:', response.status);
            
            // Handle non-200 responses
            if (!response.ok) {
                let errorText = await response.text();
                console.error('API error response:', errorText);
                try {
                    // Try to parse error as JSON
                    const errorJson = JSON.parse(errorText);
                    return { success: false, message: errorJson.message || 'API request failed' };
                } catch (e) {
                    // If not JSON, return text
                    return { success: false, message: 'API error: ' + errorText };
                }
            }

            // Parse JSON response
            const result = await response.json();
            console.log('API response:', result);
            return result;
        } catch (err) {
            console.error('API call error:', err);
            return { success: false, message: 'Connection error: ' + err.message };
        }
      } catch (error) {
        console.error('API call failed:', error);
        throw error;
      }
      }

      // Check login status on page load and update UI accordingly
      async function checkLoginStatusOnLoad() {
        try {
          const result = await apiCall({ action: 'get_user_info' });

          if (result.success && result.data.logged_in) {
            // User is logged in, update UI
            const user = result.data.user;
            const userType = result.data.user_type;

            console.log('User logged in:', user);
            console.log('Profile picture path:', user.profile_picture);

            updateUIForLoggedInUser(user, userType);

            // Update booking buttons text for staff users
            if (userType === 'staff') {
              updateBookingButtonsForStaff();
            }
          } else {
            console.log('User not logged in or API error:', result);
            // Ensure proper logged out state
            resetToLoggedOutState();
          }
        } catch (error) {
          console.error('Error checking login status on load:', error);
          // Ensure proper logged out state on error
          resetToLoggedOutState();
        }
      }

      // Update booking buttons for staff users
      function updateBookingButtonsForStaff() {
        const bookingBtns = document.querySelectorAll('.booking-btn, nav a[onclick*="showBookingModal"]');
        bookingBtns.forEach(btn => {
          if (btn.tagName === 'A') {
            btn.innerHTML = '<i class="icon">üìä</i> DASHBOARD';
          } else {
            btn.innerHTML = '<i class="icon">üìä</i> STAFF DASHBOARD';
          }
        });
      }

      // Reset all elements to logged out state
      function resetToLoggedOutState() {
        document.body.classList.remove('logged-in');
        const logoutSidebarBtn = document.querySelector('.logout-sidebar-btn');
        const dashboardLink = document.querySelector('.dashboard-link');

        if (logoutSidebarBtn) {
          logoutSidebarBtn.classList.remove('visible');
        }

        if (dashboardLink) {
          dashboardLink.href = "#";
          dashboardLink.innerHTML = 'üè† Homepage';
        }

        // Reset all booking buttons to default text
        resetBookingButtonsToDefault();
      }

      // Reset booking buttons to default logged-out text
      function resetBookingButtonsToDefault() {
        const bookingBtns = document.querySelectorAll('.booking-btn, nav a[onclick*="showBookingModal"]');
        bookingBtns.forEach(btn => {
          if (btn.tagName === 'A') {
            btn.innerHTML = '<i class="icon"></i> BOOKING';
          } else {
            btn.innerHTML = '<i class="icon">üóìÔ∏è</i> BOOK APPOINTMENT';
          }
        });
      }

      // Global modal functions
      window.showLoginModal = () => openModal('loginModal');
      window.showRegisterModal = () => openModal('registerModal');
      window.showForgotPasswordModal = () => openModal('forgotPasswordModal');
      window.showBookingModal = () => {
        // Always open the booking modal, let initializeBookingModal handle login checking
        openModal('bookingModal');
        initializeBookingModal();
      };
      window.closeModal = (id) => {
        const modal = document.getElementById(id);
        if (modal) {
          modal.style.display = 'none';
        }
      };

      function openModal(id) {
        document.getElementById(id)?.style.setProperty('display', 'flex');
      }

      // Enhanced toast notification system with icons
      window.toast = function(message, type = 'success') {
        const el = document.getElementById('toast');
        if (!el) return;
        
        // Add appropriate icons based on type
        const icons = {
          success: '‚úÖ',
          error: '‚ùå', 
          warning: '‚ö†Ô∏è',
          info: '‚ÑπÔ∏è'
        };
        
        const icon = icons[type] || icons.info;
        el.innerHTML = `<span style="margin-right: 8px; font-size: 18px;">${icon}</span>${message}`;
        
        // Apply classes and show
        el.className = `toast show ${type}`;
        
        // Auto-hide after 4 seconds with smooth animation
        setTimeout(() => { 
          el.classList.remove('show');
          // Reset after animation completes
          setTimeout(() => {
            el.className = 'toast';
            el.innerHTML = '';
          }, 400);
        }, 4000);
      };

      // Password visibility toggle function
      window.togglePasswordVisibility = (formId) => {
        const form = document.getElementById(formId);
        if (!form) return;
        
        const passwordInput = form.querySelector('input[name="password"]');
        const toggleButton = form.querySelector('.password-toggle');
        
        if (!passwordInput || !toggleButton) return;
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleButton.innerHTML = 'üôà'; // See-no-evil monkey (hidden state)
          toggleButton.classList.add('visible');
        } else {
          passwordInput.type = 'password';
          toggleButton.innerHTML = 'üëÅÔ∏è'; // Eye (visible state)
          toggleButton.classList.remove('visible');
        }
      };

      // Update Register Form UI (now always client)
      window.updateRegisterForm = () => {
        const title = document.getElementById('registerTitle');
        const btn = document.getElementById('registerBtn');
        title.innerHTML = '<i class="modal-icon">üê∂</i> Create Your Account';
        btn.innerHTML = '<i class="btn-icon">‚úÖ</i> CREATE ACCOUNT';
      };

      // Initialize register form state
      updateRegisterForm();
      
      // Set minimum date to today
      const dateInput = document.querySelector('input[name="appointment_date"]');
      if (dateInput) {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        dateInput.min = tomorrow.toISOString().split('T')[0];
        
        // Add event listener for date changes
        dateInput.addEventListener('change', loadAvailableTimeSlots);
      }
      
      // Add booking form handler
      document.getElementById('bookingForm').addEventListener('submit', handleBooking);
      
      // Initialize booking modal
      async function initializeBookingModal() {
        console.log('Initializing booking modal...');

        // Check if user is logged in
        try {
          const result = await apiCall({ action: 'get_user_info' });
          console.log('User info check result:', result);

          if (result.success && result.data.logged_in) {
            const userType = result.data.user_type;
            console.log('User logged in as:', userType);

            // Hide login required message
            document.getElementById('loginRequiredMessage').style.display = 'none';

            if (userType === 'staff') {
              console.log('Showing staff dashboard');
              // Show staff dashboard
              document.getElementById('bookingForm').style.display = 'none';
              document.getElementById('addPetForm').style.display = 'none';
              showStaffDashboard();
            } else {
              console.log('Showing client booking form');
              // Show client booking form
              document.getElementById('bookingForm').style.display = 'block';
              hideStaffDashboard();

              // Load services and pets for clients
              console.log('Loading services and pets for client...');
              await loadServices();
              await loadUserPets();
            }
          } else {
            console.log('User not logged in, showing login required message');
            // User not logged in
            document.getElementById('loginRequiredMessage').style.display = 'block';
            document.getElementById('bookingForm').style.display = 'none';
            hideStaffDashboard();
          }
        } catch (error) {
          console.error('Error checking login status:', error);
          document.getElementById('loginRequiredMessage').style.display = 'block';
          document.getElementById('bookingForm').style.display = 'none';
          hideStaffDashboard();
        }
      }

      // Manual service refresh function
      window.refreshServices = async () => {
        console.log('Manual service refresh requested');
        await loadServices();
        toast('Services refreshed!', 'success');
      };
      
      // Load services
      async function loadServices() {
        try {
          console.log('Loading services...');
          const result = await apiCall({ action: 'get_services' });
          const serviceSelect = document.querySelector('select[name="service_id"]');

          console.log('Services API response:', result);

          if (result.success && result.data) {
            console.log('Services data received:', result.data.length, 'services');

            serviceSelect.innerHTML = '<option value="">Select a service</option>';

            result.data.forEach((service, index) => {
              console.log(`Service ${index + 1}:`, service);

              const option = document.createElement('option');
              option.value = service.service_id;

              // Show service name and description if available
              const description = service.description ? ` - ${service.description}` : '';
              const serviceText = `${service.service_name}${description}`;

              option.textContent = serviceText;
              option.title = serviceText; // Add tooltip for long service names

              serviceSelect.appendChild(option);
            });

            console.log('Services loaded successfully into dropdown');
          } else {
            console.error('Failed to load services:', result);
            serviceSelect.innerHTML = '<option value="">No services available</option>';
            toast('Failed to load services. Please refresh and try again.', 'error');
          }
        } catch (error) {
          console.error('Error loading services:', error);
          const serviceSelect = document.querySelector('select[name="service_id"]');
          serviceSelect.innerHTML = '<option value="">Error loading services</option>';
          toast('Connection error while loading services.', 'error');
        }
      }
      
      // Load user pets
      async function loadUserPets() {
        try {
          const result = await apiCall({ action: 'get_client_pets' });
          const petSelect = document.querySelector('select[name="pet_id"]');
          
          if (result.success && result.data && result.data.length > 0) {
            petSelect.innerHTML = '<option value="">Select a pet</option>';
            result.data.forEach(pet => {
              const option = document.createElement('option');
              option.value = pet.pet_id;
              option.textContent = `${pet.pet_name} (${pet.species})`;
              petSelect.appendChild(option);
            });
            
            // Hide the "no pets" message if it exists
            const noPetsMsg = document.getElementById('noPetsMessage');
            if (noPetsMsg) noPetsMsg.style.display = 'none';
          } else {
            petSelect.innerHTML = '<option value="">No pets registered</option>';
            
            // Show helpful message about adding pets
            showNoPetsMessage();
          }
        } catch (error) {
          console.error('Error loading pets:', error);
          const petSelect = document.querySelector('select[name="pet_id"]');
          petSelect.innerHTML = '<option value="">Error loading pets</option>';
          toast('Failed to load your pets. Please refresh and try again.', 'error');
        }
      }
      
      // Show message when user has no pets
      function showNoPetsMessage() {
        let noPetsMsg = document.getElementById('noPetsMessage');
        if (!noPetsMsg) {
          noPetsMsg = document.createElement('div');
          noPetsMsg.id = 'noPetsMessage';
          noPetsMsg.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin: 15px 0;';
          noPetsMsg.innerHTML = `
            <h4 style="margin: 0 0 10px 0; color: #856404;">üêæ No Pets Registered</h4>
            <p style="margin: 0 0 10px 0;">You need to add at least one pet before booking an appointment.</p>
          `;
          
          // Insert after the pet selection field
          const petSelect = document.querySelector('select[name="pet_id"]');
          petSelect.parentNode.insertBefore(noPetsMsg, petSelect.nextSibling);
        }
        noPetsMsg.style.display = 'block';
      }
      
      // Load available time slots for selected date
      async function loadAvailableTimeSlots() {
        const dateInput = document.querySelector('input[name="appointment_date"]');
        const timeSelect = document.querySelector('select[name="appointment_time"]');
        const selectedDate = dateInput.value;
        
        if (!selectedDate) {
          timeSelect.innerHTML = '<option value="">Select date first</option>';
          return;
        }
        
        try {
          const result = await apiCall({
            action: 'get_available_times',
            date: selectedDate
          });
          
          if (result.success && result.data && result.data.length > 0) {
            timeSelect.innerHTML = '<option value="">Select a time</option>';
            result.data.forEach(time => {
              const option = document.createElement('option');
              option.value = time;
              option.textContent = formatTime(time);
              timeSelect.appendChild(option);
            });
          } else {
            timeSelect.innerHTML = '<option value="">No available time slots</option>';
          }
        } catch (error) {
          console.error('Error loading time slots:', error);
          timeSelect.innerHTML = '<option value="">Error loading times</option>';
        }
      }
      
      // Format time for display (12-hour format)
      function formatTime(time) {
        const [hours, minutes] = time.split(':');
        const hour12 = hours % 12 || 12;
        const ampm = hours >= 12 ? 'PM' : 'AM';
        return `${hour12}:${minutes} ${ampm}`;
      }
      
      // Handle booking form submission
      async function handleBooking(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        const bookingData = {
          action: 'book_appointment',
          service_id: formData.get('service_id'),
          pet_id: formData.get('pet_id'),
          appointment_date: formData.get('appointment_date'),
          appointment_time: formData.get('appointment_time'),
          notes: formData.get('notes') || ''
        };

        // Enhanced booking validation with debugging
        console.log('=== BOOKING FORM SUBMISSION ===');
        console.log('Form data received:');
        console.log('service_id (raw):', formData.get('service_id'));
        console.log('pet_id (raw):', formData.get('pet_id'));
        console.log('appointment_date (raw):', formData.get('appointment_date'));
        console.log('appointment_time (raw):', formData.get('appointment_time'));

        console.log('Processed booking data:');
        console.log('service_id:', JSON.stringify(bookingData.service_id));
        console.log('pet_id:', JSON.stringify(bookingData.pet_id));
        console.log('appointment_date:', JSON.stringify(bookingData.appointment_date));
        console.log('appointment_time:', JSON.stringify(bookingData.appointment_time));

        // Check service selection
        const serviceSelect = document.querySelector('select[name="service_id"]');
        const selectedServiceOption = serviceSelect.options[serviceSelect.selectedIndex];
        console.log('Selected service option:', {
          value: selectedServiceOption?.value,
          text: selectedServiceOption?.textContent,
          index: serviceSelect.selectedIndex
        });

        // Check pet selection
        const petSelect = document.querySelector('select[name="pet_id"]');
        const selectedPetOption = petSelect.options[petSelect.selectedIndex];
        console.log('Selected pet option:', {
          value: selectedPetOption?.value,
          text: selectedPetOption?.textContent,
          index: petSelect.selectedIndex
        });

        const missingBookingFields = [];
        if (!bookingData.service_id) missingBookingFields.push('Service');
        if (!bookingData.pet_id) missingBookingFields.push('Pet');
        if (!bookingData.appointment_date) missingBookingFields.push('Date');
        if (!bookingData.appointment_time) missingBookingFields.push('Time');

        if (missingBookingFields.length > 0) {
          const errorMsg = `Please fill in all required fields. Missing: ${missingBookingFields.join(', ')}`;
          console.log('Booking validation failed:', errorMsg);
          toast(errorMsg, 'error');
          return;
        }

        // Check if service selection is valid (not the placeholder option)
        if (!selectedServiceOption || selectedServiceOption.textContent.includes('Loading services') ||
            selectedServiceOption.textContent.includes('No services available') ||
            selectedServiceOption.textContent.includes('Error loading services')) {
          toast('Please select a valid service from the dropdown.', 'error');
          return;
        }

        // Check if pet selection is valid (not the placeholder option)
        if (!selectedPetOption || selectedPetOption.textContent.includes('Loading pets') ||
            selectedPetOption.textContent.includes('No pets registered') ||
            selectedPetOption.textContent.includes('Error loading pets')) {
          toast('Please select a valid pet or add a new pet first.', 'error');
          showAddPetForm();
          return;
        }

        console.log('All validations passed, submitting booking...');

        try {
          console.log('Sending booking data to API:', bookingData);
          const result = await apiCall(bookingData);
          console.log('Booking API response:', result);

          if (result.success) {
            toast('Appointment booked successfully!', 'success');
            closeModal('bookingModal');
            form.reset();
            console.log('Booking form reset and modal closed');
          } else {
            console.error('Booking failed:', result);
            // Handle specific error messages
            if (result.message && result.message.includes('Invalid pet selection')) {
              toast('The selected pet is not valid for your account. Please select a different pet or add a new one.', 'error');
              // Reload pets to refresh the list
              await loadUserPets();
              showAddPetForm();
            } else if (result.message && result.message.includes('Invalid service')) {
              toast('The selected service is not valid. Please select a different service.', 'error');
              // Reload services to refresh the list
              await loadServices();
            } else {
              toast(result.message || 'Failed to book appointment.', 'error');
            }
          }
        } catch (error) {
          console.error('Booking error:', error);
          toast('Connection error. Please try again.', 'error');
        }
      }
      
      // Show add pet form with enhanced UX
      window.showAddPetForm = () => {
        const addPetForm = document.getElementById('addPetForm');
        
        // Show the form
        addPetForm.style.display = 'block';
        
        // Add a subtle animation
        addPetForm.style.opacity = '0';
        addPetForm.style.transform = 'translateY(-10px)';
        addPetForm.style.transition = 'all 0.3s ease';
        
        // Trigger the animation
        setTimeout(() => {
          addPetForm.style.opacity = '1';
          addPetForm.style.transform = 'translateY(0)';
        }, 10);
        
        // Smooth scroll to the add pet form
        setTimeout(() => {
          addPetForm.scrollIntoView({
            behavior: 'smooth',
            block: 'start',
            inline: 'nearest'
          });
          
          // Focus on the first input field for better UX
          const firstInput = document.getElementById('petName');
          if (firstInput) {
            firstInput.focus();
          }
        }, 100);
      };
      
      // Hide add pet form with smooth animation
      window.hideAddPetForm = () => {
        const addPetForm = document.getElementById('addPetForm');
        
        // Add hide animation
        addPetForm.style.opacity = '0';
        addPetForm.style.transform = 'translateY(-10px)';
        
        // Hide the form after animation
        setTimeout(() => {
          addPetForm.style.display = 'none';
          
          // Clear form fields
          document.getElementById('petName').value = '';
          document.getElementById('petSpecies').value = '';
          document.getElementById('petBreed').value = '';
          document.getElementById('petBirthdate').value = '';
          document.getElementById('petGender').value = '';
          document.getElementById('petWeight').value = '';
          document.getElementById('petColor').value = '';
          
          // Reset styles for next show
          addPetForm.style.opacity = '';
          addPetForm.style.transform = '';
          addPetForm.style.transition = '';
        }, 300);
      };
      
      // Add new pet
      window.addPet = async () => {
        const petData = {
          action: 'add_pet',
          pet_name: document.getElementById('petName').value.trim(),
          species: document.getElementById('petSpecies').value,
          breed: document.getElementById('petBreed').value.trim(),
          birthdate: document.getElementById('petBirthdate').value,
          gender: document.getElementById('petGender').value,
          weight: parseFloat(document.getElementById('petWeight').value) || null,
          color: document.getElementById('petColor').value.trim()
        };

        // Validation
        if (!petData.pet_name || !petData.species || !petData.gender) {
          toast('Please fill in pet name, species, and gender.', 'error');
          return;
        }

        try {
          const result = await apiCall(petData);

          if (result.success) {
            toast('Pet added successfully!', 'success');
            hideAddPetForm();
            // Reload pets in the select dropdown
            await loadUserPets();
          } else {
            toast(result.message || 'Failed to add pet.', 'error');
          }
        } catch (error) {
          console.error('Add pet error:', error);
          toast('Connection error. Please try again.', 'error');
        }
      };

      // Email validation function
      window.validateEmail = (email) => {
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return emailRegex.test(email);
      };

      // Real-time email validation for all email inputs
      document.querySelectorAll('input[type="email"]').forEach(emailInput => {
        // Skip if feedback already exists
        if (emailInput.nextSibling && emailInput.nextSibling.classList && emailInput.nextSibling.classList.contains('email-feedback')) {
          return;
        }
        
        const feedback = document.createElement('div');
        feedback.className = 'email-feedback';
        feedback.style.cssText = 'font-size: 12px; margin-top: 5px; transition: all 0.3s ease;';
        emailInput.parentNode.insertBefore(feedback, emailInput.nextSibling);

        emailInput.addEventListener('input', function() {
          const email = this.value.trim();
          const isValid = validateEmail(email);
          
          if (email === '') {
            feedback.textContent = '';
            feedback.style.color = '';
            this.style.borderColor = '';
          } else if (isValid) {
            feedback.textContent = '‚úì Valid email format';
            feedback.style.color = '#4CAF50';
            this.style.borderColor = '#4CAF50';
          } else {
            feedback.textContent = '‚úó Please enter a valid email address';
            feedback.style.color = '#f44336';
            this.style.borderColor = '#f44336';
          }
        });

        // Validate on blur (when user leaves the field)
        emailInput.addEventListener('blur', function() {
          const email = this.value.trim();
          if (email !== '' && !validateEmail(email)) {
            toast('Please enter a valid email address', 'error');
          }
        });
      });

      // Password strength utilities
      function evaluatePasswordStrength(pwd) {
        const length = pwd.length;
        const hasUpper = /[A-Z]/.test(pwd);
        const hasLower = /[a-z]/.test(pwd);
        const hasDigit = /\d/.test(pwd);
        const hasSymbol = /[^A-Za-z0-9]/.test(pwd);

        let score = 0;
        if (length >= 8) score++;
        if (length >= 12) score++;
        if (hasUpper && hasLower) score++;
        if (hasDigit) score++;
        if (hasSymbol) score++;
        if (score > 4) score = 4;

        let label = 'Weak', color = '#e74c3c', width = '25%';
        if (score === 2) { label = 'Fair'; color = '#f39c12'; width = '50%'; }
        else if (score === 3) { label = 'Good'; color = '#3498db'; width = '75%'; }
        else if (score === 4) { label = 'Strong'; color = '#27ae60'; width = '100%'; }

        const missing = [];
        if (length < 8) missing.push('at least 8 characters');
        if (!hasUpper) missing.push('an uppercase letter');
        if (!hasLower) missing.push('a lowercase letter');
        if (!hasDigit) missing.push('a number');
        if (!hasSymbol) missing.push('a symbol');

        return { score, label, color, width, missing };
      }

      function updateStrengthUI(prefix, result) {
        const bar = document.getElementById(prefix + 'PwBar');
        const text = document.getElementById(prefix + 'PwText');
        const req = document.getElementById(prefix + 'PwReq');
        if (bar) bar.style.setProperty('--pw-color', result.color);
        if (bar) bar.style.setProperty('--pw-width', result.width);
        if (bar) bar.style.background = '#eee';
        if (bar) bar.style.position = 'relative';
        if (bar) {
          // Simulate ::after effect by inner div to avoid CSS pseudo limitation from JS
          if (!bar.firstChild) {
            const inner = document.createElement('div');
            inner.style.height = '100%';
            inner.style.width = result.width;
            inner.style.background = result.color;
            inner.style.transition = 'width 0.3s ease, background 0.3s ease';
            bar.appendChild(inner);
          } else {
            bar.firstChild.style.width = result.width;
            bar.firstChild.style.background = result.color;
          }
        }
        if (text) text.textContent = 'Password strength: ' + result.label;
        if (req) {
          if (result.missing.length === 0) {
            req.textContent = 'Looks good: meets all requirements.';
            req.className = 'pw-requirements pw-ok';
          } else {
            req.textContent = 'Needs: ' + result.missing.join(', ');
            req.className = 'pw-requirements pw-bad';
          }
        }
      }

      function wirePasswordStrength(formId, prefix) {
        const form = document.getElementById(formId);
        if (!form) return;
        const pwd = form.querySelector('input[name="password"]');
        if (!pwd) return;
        const update = () => updateStrengthUI(prefix, evaluatePasswordStrength(pwd.value));
        pwd.addEventListener('input', update);
        // Initialize on load
        update();
      }

      // Wire up strength meters
      wirePasswordStrength('registerForm', 'register');
      wirePasswordStrength('signupForm', 'signup');

      // Form handlers with PHP API integration
      const loginForm = document.getElementById('loginForm');
      if (loginForm) loginForm.addEventListener('submit', handleLogin);

      const registerForm = document.getElementById('registerForm');
      if (registerForm) registerForm.addEventListener('submit', handleRegister);

      const signupForm = document.getElementById('signupForm');
      if (signupForm) signupForm.addEventListener('submit', handleRegister); // Footer signup

      const forgotPasswordForm = document.getElementById('forgotPasswordForm');
      if (forgotPasswordForm) forgotPasswordForm.addEventListener('submit', handleForgotPassword);

      const bookingForm = document.getElementById('bookingForm');
      if (bookingForm) bookingForm.addEventListener('submit', handleBooking);
      
      // Add change listener for date input to load available times
      document.querySelector('input[name="appointment_date"]')?.addEventListener('change', loadAvailableTimeSlots);
      
      async function handleLogin(e) {
        e.preventDefault();
        
        const form = e.target;
        const email = form.email.value.trim();
        const password = form.password.value;
        
        if (!validateEmail(email)) {
          toast('Please enter a valid email address.', 'error');
          return;
        }
        
        if (!password) {
          toast('Please enter your password.', 'error');
          return;
        }
        
        try {
          const result = await apiCall({
            action: 'login',
            email: email,
            password: password
          });
          
          if (result.success) {
            toast('Login successful! Redirecting...', 'success');

            // Determine redirect path based on user type
            let redirectPath = '';
            if (result.user && result.user.type) {
              if (result.user.type === 'staff') {
                redirectPath = 'public/staff.html';
              } else if (result.user.type === 'client') {
                redirectPath = 'public/client.html';
              }
            }

            if (redirectPath) {
              setTimeout(() => {
                console.log('Redirecting to:', redirectPath);
                window.location.href = redirectPath;
              }, 1500);
            } else {
              console.log('No redirect path determined, staying on homepage');
              closeModal('loginModal');
              updateUIForLoggedInUser(result.user, result.user.type);

              // Update booking buttons text for staff users
              if (result.user.type === 'staff') {
                updateBookingButtonsForStaff();
              }
            }
          }
        } catch (error) {
          console.error('Login error:', error);
          toast('Connection error. Please check your server.', 'error');
        }
      }
      
      async function handleRegister(e) {
        e.preventDefault();
        
        const form = e.target;
        const firstName = form.first_name.value.trim();
        const lastName = form.last_name.value.trim();
        const email = form.email.value.trim();
        const phone = form.phone.value.trim();
        const password = form.password.value;
        const address = form.address?.value.trim() || '';
        const userType = 'client'; // Always register as client
        
        const missingFields = [];
        if (!firstName) missingFields.push('First Name');
        if (!lastName) missingFields.push('Last Name');
        if (!email) missingFields.push('Email');
        if (!phone) missingFields.push('Phone');
        if (!password) missingFields.push('Password');
        
        if (missingFields.length > 0) {
          const errorMsg = `Please fill in all required fields. Missing: ${missingFields.join(', ')}`;
          toast(errorMsg, 'error');
          return;
        }
        
        if (!validateEmail(email)) {
          toast('Please enter a valid email address.', 'error');
          return;
        }
        
        if (password.length < 8) {
          toast('Password must be at least 8 characters long.', 'error');
          return;
        }
        const hasUpper = /[A-Z]/.test(password);
        const hasLower = /[a-z]/.test(password);
        const hasDigit = /\d/.test(password);
        const hasSymbol = /[^A-Za-z0-9]/.test(password);
        if (!(hasUpper && hasLower && hasDigit && hasSymbol)) {
          toast('Password must include uppercase, lowercase, number, and symbol.', 'error');
          return;
        }
        
        try {
          const payload = {
            action: 'register',
            first_name: firstName,
            last_name: lastName,
            email: email,
            phone: phone,
            password: password,
            address: address,
            user_type: userType
          };
          
          const result = await apiCall(payload);
          
          if (result.success) {
            const welcomeMsg = `Registration successful! Welcome ${firstName}! You can now log in with your account.`;

            toast(welcomeMsg, 'success');
            closeModal('registerModal');
            form.reset();

            // Reset form state
            updateRegisterForm();

            // Handle auto-login and redirect to client dashboard
            if (result.client) {
              // Redirect to client dashboard
              setTimeout(() => {
                window.location.href = 'public/client.html';
              }, 1500);

              updateUIForLoggedInUser(result.client, 'client');
            }
          } else {
            toast(result.message || 'Registration failed. Please try again.', 'error');
          }
      } catch (error) {
          console.error('Registration error:', error);
          toast('Connection error. Please check your server.', 'error');
      }
    }

    async function handleForgotPassword(e) {
      e.preventDefault();

      const form = e.target;
      const email = form.email.value.trim();

      if (!email) {
          toast('Please enter your email address.', 'error');
          return;
      }

      try {
          const response = await fetch('api/vet_api.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                  action: 'request_password_reset',
                  email: email
              })
          });

          const result = await response.json();

          if (result.success) {
              toast('Password reset link sent! Please check your email.', 'success');
              closeModal('forgotPasswordModal');
              form.reset();
          } else {
              toast(result.message || 'Failed to send reset link.', 'error');
          }
      } catch (error) {
          console.error('Forgot password error:', error);
          toast('Connection error. Please try again.', 'error');
      }
    }
      
      // Update UI when user logs in
      function updateUIForLoggedInUser(user, userType) {
        const userName = user.name || user.first_name || 'User';

        // Determine profile picture path
        let profilePicPath = 'assets/images/logoo.jpg'; // default
        if (user.profile_picture && user.profile_picture.trim() !== '' && user.profile_picture !== 'null') {
          // Handle different profile picture path formats
          if (!user.profile_picture.startsWith('assets/')) {
            profilePicPath = 'assets/images/profiles/' + user.profile_picture;
          } else {
            profilePicPath = user.profile_picture;
          }
        }

        console.log('Updating for user:', userName);
        console.log('Profile picture path:', profilePicPath);

        // Add logged-in class to body
        document.body.classList.add('logged-in');

        // Show profile picture and hide auth links
        const profilePic = document.getElementById('headerProfilePic');
        const authLinks = document.getElementById('authLinks');

        if (profilePic) {
          console.log('Setting profile picture to:', profilePicPath);
          profilePic.src = profilePicPath;
          profilePic.style.display = 'block';

          // Add error handling for profile picture loading
          profilePic.onerror = () => {
            console.warn('Profile picture failed to load, using default');
            profilePic.src = this.defaultProfilePic;
          };
        }

        if (authLinks) {
          authLinks.style.display = 'none';
        }

        // Update sidebar elements for logged in user
        const logoutSidebarBtn = document.querySelector('.logout-sidebar-btn');
        const dashboardLink = document.querySelector('.dashboard-link');

        if (logoutSidebarBtn) {
          logoutSidebarBtn.classList.add('visible');
        }

        // Update dashboard link to point to user dashboard
        if (dashboardLink) {
          dashboardLink.href = `public/${userType}.html`;
          dashboardLink.innerHTML = 'üìä Dashboard';
        }

        console.log('UI updated successfully for user:', userName);
      }
      
      // Logout function
      window.handleLogout = async () => {
        try {
          const result = await apiCall({ action: 'logout' });

          if (result.success) {
            toast('Logged out successfully.', 'success');
            // Reset UI to show login/signup
            resetHeaderToLoginState();
          }
        } catch (error) {
          console.error('Logout error:', error);
          toast('Logout failed.', 'error');
        }
      };

      // Reset header to login state
      function resetHeaderToLoginState() {
        // Remove logged-in class from body
        document.body.classList.remove('logged-in');

        // Hide profile picture and show auth links
        const profilePic = document.getElementById('headerProfilePic');
        const authLinks = document.getElementById('authLinks');

        if (profilePic) {
          profilePic.style.display = 'none';
        }

        if (authLinks) {
          authLinks.style.display = 'flex';
        }

        console.log('Header reset to login state');

        // Use centralized logged out state management
        resetToLoggedOutState();
      }

      // Staff Dashboard Functions
      window.showStaffDashboard = () => {
        document.getElementById('bookingModalTitle').innerHTML = '<i class="modal-icon">üìä</i> Staff Dashboard - Appointment Management';
        document.getElementById('staffDashboard').style.display = 'block';
        loadAllAppointments();
      };
      
      window.hideStaffDashboard = () => {
        document.getElementById('bookingModalTitle').innerHTML = '<i class="modal-icon">üìÖ</i> Book an Appointment';
        document.getElementById('staffDashboard').style.display = 'none';
      };
      
      window.loadAllAppointments = async () => {
        try {
          const response = await fetch('/vetfinal/api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'get_all_appointments', limit: 50 })
          });
          
          const result = await response.json();
          const appointmentsList = document.getElementById('appointmentsList');
          
          if (result.success && result.data && result.data.length > 0) {
            appointmentsList.innerHTML = '';
            result.data.forEach(appointment => {
              const appointmentDiv = createAppointmentCard(appointment);
              appointmentsList.appendChild(appointmentDiv);
            });
          } else {
            appointmentsList.innerHTML = '<p style="text-align: center; color: #666;">No appointments found.</p>';
          }
        } catch (error) {
          console.error('Error loading appointments:', error);
          document.getElementById('appointmentsList').innerHTML = '<p style="text-align: center; color: #f44336;">Error loading appointments.</p>';
        }
      };
      
      window.filterAppointments = async () => {
        const status = document.getElementById('statusFilter').value;
        try {
          const payload = { action: 'get_all_appointments', limit: 50 };
          if (status) payload.status = status;
          
          const response = await fetch('/vetfinal/api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          const result = await response.json();
          const appointmentsList = document.getElementById('appointmentsList');
          
          if (result.success && result.data && result.data.length > 0) {
            appointmentsList.innerHTML = '';
            result.data.forEach(appointment => {
              const appointmentDiv = createAppointmentCard(appointment);
              appointmentsList.appendChild(appointmentDiv);
            });
          } else {
            appointmentsList.innerHTML = '<p style="text-align: center; color: #666;">No appointments found.</p>';
          }
        } catch (error) {
          console.error('Error filtering appointments:', error);
        }
      };
      
      function createAppointmentCard(appointment) {
        const div = document.createElement('div');
        div.style.cssText = 'border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: white; cursor: pointer; transition: all 0.3s ease;';
        div.onmouseover = () => div.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        div.onmouseout = () => div.style.boxShadow = 'none';
        
        const statusColor = {
          'Pending': '#ff9900',
          'Confirmed': '#4CAF50', 
          'In Progress': '#2196F3',
          'Completed': '#9E9E9E',
          'Cancelled': '#f44336',
          'No Show': '#ff5722'
        }[appointment.status] || '#666';
        
        div.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="flex: 1;">
              <h4 style="margin: 0 0 5px 0; color: #333;">${appointment.client_first_name} ${appointment.client_last_name}</h4>
              <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">üêï ${appointment.pet_name} (${appointment.species})</p>
              <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">üë©‚Äç‚öïÔ∏è ${appointment.service_name}</p>
              <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">üìÖ ${appointment.appointment_date} at ${formatTime(appointment.appointment_time)}</p>
              ${appointment.notes ? `<p style="margin: 5px 0; color: #666; font-size: 12px; font-style: italic;">üìù ${appointment.notes}</p>` : ''}
            </div>
            <div style="text-align: right;">
              <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">${appointment.status}</span>
              <div style="margin-top: 10px;">
                <select onchange="updateAppointmentStatus(${appointment.appointment_id}, this.value)" style="font-size: 12px; padding: 2px;">
                  <option value="">Change Status</option>
                  <option value="Confirmed" ${appointment.status === 'Confirmed' ? 'selected' : ''}>Confirm</option>
                  <option value="In Progress" ${appointment.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                  <option value="Completed" ${appointment.status === 'Completed' ? 'selected' : ''}>Complete</option>
                  <option value="Cancelled" ${appointment.status === 'Cancelled' ? 'selected' : ''}>Cancel</option>
                  <option value="No Show" ${appointment.status === 'No Show' ? 'selected' : ''}>No Show</option>
                </select>
              </div>
            </div>
          </div>
        `;
        
        return div;
      }
      
      window.updateAppointmentStatus = async (appointmentId, newStatus) => {
        if (!newStatus) return;
        
        try {
          const response = await fetch('/vetfinal/api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'update_appointment_status',
              appointment_id: appointmentId,
              status: newStatus
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            toast(`Appointment status updated to ${newStatus}`, 'success');
            loadAllAppointments(); // Refresh the list
          } else {
            toast(result.message || 'Failed to update status', 'error');
          }
        } catch (error) {
          console.error('Error updating status:', error);
          toast('Connection error. Please try again.', 'error');
        }
      };
      
      // Click outside modal to close & close mobile nav when clicking outside
      document.addEventListener('click', function(e) {
        // Close modals when clicking outside
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
    });

    // Simple store functionality
  window.filterCategory = function(category) {
    // Simple toast notification for category selection
    toast(`You selected: ${category.toUpperCase()} category`, 'info');

    // Here you could add logic to:
    // - Navigate to a dedicated store page
    // - Filter products
    // - Open a modal with category products
    // - etc.
  };

  // Ensure all modals exist before adding event listeners
  function initializeModalHandlers() {
    // List of required modal IDs
    const modalIds = ['loginModal', 'registerModal', 'forgotPasswordModal', 'bookingModal'];
    
    // Check if all modals exist
    const missingModals = modalIds.filter(id => !document.getElementById(id));
    if (missingModals.length > 0) {
      console.warn('Missing modals:', missingModals);
      return;
    }

    // Add click handlers only if all modals exist
    document.addEventListener('click', function(e) {
      // Close modals when clicking outside
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (e.target === modal) {
          closeModal(modal.id);
        }
      });
    });
  }

  // Call initialization after DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeModalHandlers);
  } else {
    initializeModalHandlers();
  }

  // Sidebar Toggle Functionality with Hamburger Menu Button
  const sidebar = document.getElementById('sidebar');
  const menuBtn = document.getElementById('menuBtn');

  // Hamburger menu button functionality
  if (menuBtn) {
    menuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      sidebar.classList.toggle('active');
    });
  }

  // Close sidebar when clicking outside
  document.addEventListener('click', (e) => {
    if (sidebar.classList.contains('active') && !sidebar.contains(e.target) && e.target !== menuBtn) {
      sidebar.classList.remove('active');
    }
  });

  // Allow sidebar to be toggled programmatically
  window.toggleSidebar = () => {
    if (sidebar) {
      sidebar.classList.toggle('active');
    }
  };

  // Scroll to section function for homepage navigation
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  </script>
</body>
</html>
