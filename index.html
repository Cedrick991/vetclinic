<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tattao Veterinary Clinic</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <meta name="description" content="Tattao Veterinary Clinic - Professional pet care services in Penablanca, Cagayan">
  <!-- SMTPJS for email sending -->
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  
  <!-- OTP Email Service -->
  <script src="assets/js/otp-email-service.js"></script>
</head>
<body>
  <!-- Anchor point for smooth scrolling to top -->
  <div id="top"></div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="#top" onclick="scrollToSection('top');" class="dashboard-link">üè† Homepage</a>
    <a href="#services" onclick="scrollToSection('services');" class="nav-link">ü©∫ Services</a>
    <a href="#store" onclick="scrollToSection('store');" class="nav-link">üõí Store</a>
    <a href="#about" onclick="scrollToSection('about');" class="nav-link">‚ÑπÔ∏è About Us</a>
    <a href="#contact" onclick="scrollToSection('contact');" class="nav-link">üìû Contact Us</a>
    <a href="#logout" onclick="showLogoutModal();" class="logout-sidebar-btn">üö™ Logout</a>
  </div>

  <!-- Sidebar Overlay (for closing sidebar when clicking outside) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()" style="display: none;"></div>


  <!-- Fixed Header Bar -->
  <header class="header-bar">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn">&#9776;</button>
      <div class="logo">
        <img src="assets/images/logoo.jpg" alt="Tattao Veterinary Clinic Logo">
        <span class="clinic-name">TATTAO<br>VETERINARY CLINIC</span>
      </div>
    </div>
    <div class="header-right">
      <img src="assets/images/logoo.jpg" alt="Profile" class="profile-pic" id="headerProfilePic" style="display: none;">
      <div class="auth-links" id="authLinks">
        <a href="#" onclick="showLoginModal()" class="auth-btn">üîê LOG-IN</a>
        <a href="#" onclick="showRegisterModal()" class="auth-btn">üìù SIGN-UP</a>
      </div>
    </div>
  </header>


  <!-- Hero Section -->
  <section class="hero" style="margin-top: 0; padding-top: 20px;">
    <img src="assets/images/dogandcat.png" alt="Dog and Cat" class="hero-pets">
    <div class="hero-text">
      <img src="assets/images/textdogandcat.png" alt="Book a check up for your fur baby today!">
    </div>
    <div class="btn-wrapper">
      <button class="booking-btn" onclick="showBookingModal()">
        <i class="icon">üóìÔ∏è</i> BOOK APPOINTMENT
      </button>
    </div>
  </section>

  <!-- Services Section -->
  <section class="services" id="services">
    <h2>OUR SERVICES</h2>
    <div class="services-container">
      <div class="services-img">
        <img src="assets/images/catsolohehe.png" alt="Cat">
      </div>
      <div class="service-list">
        <div class="service-item" onclick="showServiceDetails('basic-obedience-training')" data-service-id="basic-obedience-training">
          <i class="service-icon">üêç</i>
          <span class="service-name">BASIC OBEDIENCE TRAINING</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('deworming')" data-service-id="deworming">
          <i class="service-icon">üì∂</i>
          <span class="service-name">DEWORMING</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('microchip')" data-service-id="microchip">
          <i class="service-icon">üíâ</i>
          <span class="service-name">MICROCHIP IMPLANTING</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('vaccination')" data-service-id="vaccination">
          <i class="service-icon">üè†</i>
          <span class="service-name">VACCINATION</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('pet-boarding')" data-service-id="pet-boarding">
          <i class="service-icon">ü¶á</i>
          <span class="service-name">PET BOARDING</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('parasite-prevention')" data-service-id="parasite-prevention">
          <i class="service-icon">üïäÔ∏è</i>
          <span class="service-name">EXTERNAL PARASITE PREVENTION</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('euthanasia')" data-service-id="euthanasia">
          <i class="service-icon">üöë</i>
          <span class="service-name">EUTHANASIA</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('general-checkup')" data-service-id="general-checkup">
          <i class="service-icon">‚úÇÔ∏è</i>
          <span class="service-name">COMPREHENSIVE GENERAL CHECK UP</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('grooming')" data-service-id="grooming">
          <i class="service-icon">ü¶∑</i>
          <span class="service-name">GROOMING</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('dental-surgery')" data-service-id="dental-surgery">
          <i class="service-icon">üè•</i>
          <span class="service-name">DENTAL SURGERY</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('surgery')" data-service-id="surgery">
          <i class="service-icon">üè°</i>
          <span class="service-name">SURGERY</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
        <div class="service-item" onclick="showServiceDetails('home-service')" data-service-id="home-service">
          <i class="service-icon">üè†</i>
          <span class="service-name">HOME SERVICE BY APPOINTMENT</span>
          <i class="fas fa-chevron-right service-arrow"></i>
        </div>
      </div>
    </div>
          </section>

  <!-- Contact Section -->
  <section class="contact" id="contact">
    <h2>CONTACT US</h2>
    <div class="contact-info">
      <div class="contact-details">
        <a href="mailto:tattaoveterinaryclinic@gmail.com" style="text-decoration: none; color: inherit;">
          <div class="contact-item">
            <div class="icon">üìß</div>
            <p>tattaoveterinaryclinic@gmail.com</p>
          </div>
        </a>
        <a href="https://www.facebook.com/share/16H1LSHgNL/" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
          <div class="contact-item">
            <div class="icon facebook"><strong>f</strong></div>
            <p>Tattao Veterinary Clinic</p>
          </div>
        </a>
        <div class="contact-item"><div class="icon">üìû</div><p>0917 519 4639</p></div>
        <div class="contact-item"><div class="icon">üìû</div><p>0975 339 7908</p></div>
        <div class="contact-item"><div class="icon">üìç</div><p>ZONE 2 NATIONAL HIGHWAY, ALIMANAO,<br>PENABLANCA, CAGAYAN</p></div>
      </div>

      <div class="contact-right">
        <div class="map-container">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3802.1335095384566!2d121.75943667463251!3d17.643834595367945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x338585bde16554ff%3A0xb5df81d15287ff9a!2sTattao%20Veterinary%20Clinic!5e0!3m2!1sen!2sph!4v1757403955285!5m2!1sen!2sph" 
            width="100%" 
            height="100%" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            title="Tattao Veterinary Clinic Location Map"
            aria-label="Google Maps showing the location of Tattao Veterinary Clinic">
          </iframe>
        </div>
      </div>
    </div>
          </section>


  <!-- Store Section -->
  <section class="store-section" id="store">
    <h2 style="cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.color='#ffd700'; this.style.transform='scale(1.05)'" onmouseout="this.style.color='white'; this.style.transform='scale(1)'" onclick="document.querySelectorAll('.category')[0]?.click()">
      üõí STORE
    </h2>
    <p>THE TATTAO VETERINARY CLINIC OFFERS</p>

    <div class="categories">
      <!-- Food -->
      <div class="category">
        <img src="assets/images/food.png" alt="Food for Pets">
        <h3>FOOD FOR<br>YOUR PETS</h3>
      </div>

      <!-- Grooming -->
      <div class="category">
        <img src="assets/images/grooming.png" alt="Grooming Supplies">
        <h3>GROOMING<br>SUPPLIES</h3>
      </div>

      <!-- Accessories -->
      <div class="category">
        <img src="assets/images/collar.png" alt="Collars and Accessories">
        <h3>AND<br>ACCESSORIES</h3>
      </div>
    </div>
      </div>
    </section>

    <!-- About Us Section -->
    <section class="about-section" id="about">
      <div class="container">
        <div class="about-grid">
          <!-- Left Image -->
          <div class="image-wrapper">
            <div class="image-border">
              <img src="https://images.unsplash.com/photo-1581888227599-779811939961?w=600&h=700&fit=crop"
                   alt="Veterinarian with pet owner"
                   class="main-image">
            </div>
          </div>

          <!-- Right Content -->
          <div class="content-wrapper">
            <div class="title-wrapper">
              <h1 class="main-title">ABOUT US</h1>
            </div>
            <p class="description">
              <strong>Tattao Veterinary Clinic</strong> is committed to delivering high-quality veterinary care through professional expertise and modern medical practices. We provide a full range of services including preventive care, diagnostics, treatment, and wellness programs to ensure the optimal health of animals. With a focus on excellence, integrity, and compassion, our clinic upholds the highest standards in veterinary medicine to serve both pets and their owners with trust and reliability.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Schedule Section -->
    <section class="schedule">
      <h2>CLINIC HOURS</h2>
      <div class="hours">
        <div class="day-box">MONDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box">TUESDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box">WEDNESDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box">THURSDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box">FRIDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box">SATURDAY<br><span>9:00 AM TO 6:00 PM</span></div>
        <div class="day-box closed">SUNDAY<br><span>CLOSED</span></div>
      </div>
    </section>

    <!-- Separator Line -->
    <div class="section-separator"></div>

    <!-- Meet the Vets Section -->
    <section class="vets-section">
      <div class="container">
        <div class="vets-header">
          <h2 class="section-title">MEET THE VETS</h2>
        </div>

        <div class="vets-grid">
          <!-- Dr. Sheryl Mangulad -->
          <div class="vet-card">
            <div class="vet-image-border">
              <img src="https://images.unsplash.com/photo-1594824476967-48c8b964273f?w=300&h=300&fit=crop&crop=faces"
                   alt="Dr. Sheryl Mangulad"
                   class="vet-image">
            </div>
            <h3 class="vet-name">Dr. Sheryl Mangulad</h3>
            <p class="vet-bio">
              Clinic Veterinarian
            </p>
          </div>

          <!-- Dr. Judith Tattao -->
          <div class="vet-card">
            <div class="vet-image-border">
              <img src="https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=300&h=300&fit=crop&crop=faces"
                   alt="Dr. Judith Tattao"
                   class="vet-image">
            </div>
            <h3 class="vet-name">Dr. Judith Tattao</h3>
            <p class="vet-bio">
              Clinic Veterinarian
            </p>
          </div>
        </div>
      </div>
    </section>


    <!-- Footer -->
    <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <img src="assets/images/logoo.jpg" alt="Logo">
        <span>Tattao Veterinary Clinic</span>
      </div>
      <span class="footer-tagline">We offer the best care for your fur babies</span>
      <span class="footer-bottom">2024 ¬© Robinsons Galleria, Ampatuan, Cotabato, Clayton | Accent Log In | OPAC GUI Portal | OAI-PMH Service</span>
    </div>
  </footer>

  <!-- Modal Dialogs -->
  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('loginModal')">&times;</span>
      <h2><i class="modal-icon">üîê</i> Login to Your Account</h2>
      <form id="loginForm">
        <label for="login_email" class="sr-only">Email Address</label>
        <input type="email" id="login_email" name="email" placeholder="‚úâÔ∏è Email" title="Enter your email address" required>

        <div class="password-container">
          <label for="login_password" class="sr-only">Password</label>
          <input type="password" id="login_password" name="password" placeholder="üîí Password" title="Enter your password" required>
          <span class="password-toggle" onclick="togglePasswordVisibility('loginForm')" title="Toggle password visibility" aria-label="Show/hide password">üëÅÔ∏è</span>
        </div>
        <button type="submit"><i class="btn-icon">üîì</i> LOGIN</button>
      </form>
      <p>Don't have an account? <a href="#" onclick="showRegisterModal()">Register here</a></p>
      <p><a href="#" id="forgotPasswordLink" onclick="showForgotPasswordModal()" style="color: #3498db; text-decoration: none; display: none;">Forgot your password?</a></p>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('registerModal')">&times;</span>
      <h2 id="registerTitle"><i class="modal-icon">üìù</i> Create Your Account</h2>
      <form id="registerForm">
        
        <label for="register_first_name" class="sr-only">First Name</label>
        <input type="text" id="register_first_name" name="first_name" placeholder="üë§ First Name" title="Enter your first name" required>
        
        <label for="register_last_name" class="sr-only">Last Name</label>
        <input type="text" id="register_last_name" name="last_name" placeholder="üë• Last Name" title="Enter your last name" required>
        
        <label for="register_email" class="sr-only">Email Address</label>
        <input type="email" id="register_email" name="email" placeholder="‚úâÔ∏è Email" title="Enter your email address" required>
        
        <label for="register_phone" class="sr-only">Phone Number</label>
        <input type="tel" id="register_phone" name="phone" placeholder="üì± Phone Number" title="Enter your phone number" required>
        
        <div class="password-container">
          <label for="register_password" class="sr-only">Password</label>
          <input type="password" id="register_password" name="password" placeholder="üîí Password (min 8 chars)" title="Enter a password with at least 8 characters" required minlength="8">
          <span class="password-toggle" onclick="togglePasswordVisibility('registerForm')" title="Toggle password visibility" aria-label="Show/hide password">üëÅÔ∏è</span>
        </div>
        
        <div class="password-strength">
          <div class="pw-strength-bar" id="registerPwBar"></div>
          <div class="pw-strength-text" id="registerPwText">Password strength: -</div>
          <div class="pw-requirements" id="registerPwReq"></div>
        </div>
        
        <label for="register_address" class="sr-only">Address (Optional)</label>
        <input type="text" id="register_address" name="address" placeholder="üè† Address (optional)" title="Enter your address (optional)">

        <button type="submit" id="registerBtn">‚úÖ CREATE ACCOUNT</button>
      </form>
      <p>Already have an account? <a href="#" onclick="showLoginModal()">Login here</a></p>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgotPasswordModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('forgotPasswordModal')">&times;</span>
      <h2><i class="modal-icon">üîë</i> Reset Your Password</h2>
      <form id="forgotPasswordForm">
        <p style="text-align: center; margin-bottom: 20px; color: #666;">
          Enter your email address and we'll send you a link to reset your password.
        </p>
        <label for="forgot_email" class="sr-only">Email Address</label>
        <input type="email" id="forgot_email" name="email" placeholder="‚úâÔ∏è Email Address" title="Enter your email address to reset password" required>
        <button type="submit"><i class="btn-icon">üìß</i> SEND RESET LINK</button>
      </form>
    </div>
  </div>

  <!-- Resend Verification Modal -->
  <div id="resendVerificationModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('resendVerificationModal')">&times;</span>
      <h2><i class="modal-icon">üìß</i> Resend Verification Email</h2>
      <form id="resendVerificationForm">
        <p style="text-align: center; margin-bottom: 20px; color: #666;">
          Enter your email address and we'll send you a new verification email.
        </p>
        <label for="resend_email" class="sr-only">Email Address</label>
        <input type="email" id="resend_email" name="email" placeholder="‚úâÔ∏è Email Address" title="Enter your email address to resend verification" required>
        <button type="submit"><i class="btn-icon">üìß</i> RESEND VERIFICATION EMAIL</button>
      </form>
      <p style="text-align: center; margin-top: 20px;">
        Already verified? <a href="#" onclick="showLoginModal(); closeModal('resendVerificationModal');">Login here</a>
      </p>
    </div>
  </div>

  <!-- Booking Modal -->
  <div id="bookingModal" class="modal" style="display: none;">
    <div class="modal-content booking-modal">
      <span class="close" onclick="closeModal('bookingModal')">&times;</span>
      <h2><i class="modal-icon">üóìÔ∏è</i> Book an Appointment</h2>

      <!-- Login Required Message (shown when not logged in) -->
      <div id="loginRequiredMessage" class="login-required-message" style="display: none;">
        <div class="login-prompt">
          <div class="login-icon">üìÖ</div>
          <h3>Ready to Book an Appointment?</h3>
          <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 20px;">
            To book an appointment for your pet, you'll need to create an account first. It's quick and easy!
          </p>

          <div style="background: rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 25px; border-left: 4px solid #ffd700;">
            <h4 style="color: #ffd700; margin: 0 0 10px 0; font-size: 16px;">
              <i class="fas fa-star"></i> Why Create an Account?
            </h4>
            <ul style="color: rgba(255, 255, 255, 0.9); margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6;">
              <li>Book and manage appointments online</li>
              <li>Keep track of your pet's medical history</li>
              <li>Receive appointment reminders</li>
              <li>Access your pet's vaccination records</li>
              <li>Order pet supplies and medications</li>
            </ul>
          </div>

          <div class="login-prompt-actions">
            <button class="btn-primary" onclick="closeModal('bookingModal'); setTimeout(() => showRegisterModal(), 100);" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);">
              <i class="fas fa-user-plus"></i> Create Account & Book
            </button>
            <button class="btn-secondary" onclick="closeModal('bookingModal'); setTimeout(() => showLoginModal(), 100);" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); padding: 15px 30px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px;">
              <i class="fas fa-sign-in-alt"></i> Already have an account?
            </button>
          </div>

          <div style="text-align: center; margin-top: 20px;">
            <button onclick="closeModal('bookingModal')" style="background: none; color: rgba(255, 255, 255, 0.7); border: none; padding: 8px 16px; font-size: 14px; cursor: pointer; text-decoration: underline;">
              Maybe later
            </button>
          </div>
        </div>
      </div>

      <!-- Booking Form (shown when logged in) -->
      <form id="bookingForm" class="booking-form" style="display: none;">
        <div class="form-section">
          <h3><i class="fas fa-paw"></i> Pet Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="pet_id">Select Your Pet *</label>
              <select id="pet_id" name="pet_id" required>
                <option value="">Choose your pet...</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-stethoscope"></i> Service Selection</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="service_id">Select Service *</label>
              <select id="service_id" name="service_id" required>
                <option value="">Choose a service...</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-calendar-alt"></i> Appointment Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="appointment_date">Preferred Date *</label>
              <input type="date" id="appointment_date" name="appointment_date" required min="">
            </div>
            <div class="form-group">
              <label for="appointment_time">Preferred Time *</label>
              <select id="appointment_time" name="appointment_time" required>
                <option value="">Select time...</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-sticky-note"></i> Additional Information</h3>
          <div class="form-group">
            <label for="notes">Special Requests or Notes</label>
            <textarea id="notes" name="notes" rows="4" placeholder="Please describe your pet's condition, special requirements, or any questions you have..."></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeModal('bookingModal')">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="submit" class="btn-primary">
            <i class="fas fa-calendar-check"></i> Book Appointment
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Service Details Modal -->
  <div id="serviceDetailsModal" class="modal" style="display: none;">
    <div class="modal-content service-modal">
      <span class="close" onclick="closeModal('serviceDetailsModal')">&times;</span>
      <div class="service-modal-header">
        <div class="service-icon-large" id="serviceIconLarge">üè•</div>
        <h2 id="serviceTitle">Service Details</h2>
      </div>

      <div class="service-modal-body">
        <div class="service-description" id="serviceDescription">
          <p>Loading service information...</p>
        </div>

        <div class="service-features" id="serviceFeatures">
          <h4><i class="fas fa-star"></i> Service Features</h4>
          <ul id="serviceFeaturesList">
            <li>Loading features...</li>
          </ul>
        </div>

        <div class="service-process" id="serviceProcess">
          <h4><i class="fas fa-clipboard-list"></i> What to Expect</h4>
          <div class="process-steps" id="processSteps">
            <p>Loading process information...</p>
          </div>
        </div>
      </div>

    </div>
  </div>



  <!-- 2FA OTP Modal -->
  <div id="twoFAModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('twoFAModal')">&times;</span>
      <h2><i class="modal-icon">üîê</i> Two-Factor Authentication</h2>
      <form id="twoFAForm">
        <p style="text-align: center; margin-bottom: 20px; color: #666;">
          Please enter the 6-digit verification code sent to your email address.
        </p>
        <label for="twofa_otp" class="sr-only">OTP Code</label>
        <input type="text" id="twofa_otp" name="otp_code" placeholder="üî¢ Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" title="Enter the 6-digit verification code" required>
        <button type="submit"><i class="btn-icon">‚úÖ</i> VERIFY & LOGIN</button>
      </form>
      <p style="text-align: center; font-size: 12px; color: #999; margin-top: 15px;">
        Didn't receive the code? <a href="#" onclick="resend2FAOTP()" style="color: #3498db;">Resend Code</a>
      </p>
    </div>
  </div>

  <!-- Password Reset OTP Modal -->
  <div id="passwordResetOTPModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('passwordResetOTPModal')">&times;</span>
      <h2><i class="modal-icon">üîë</i> Reset Your Password</h2>
      <form id="passwordResetOTPForm">
        <p style="text-align: center; margin-bottom: 20px; color: #666;">
          Enter the 6-digit code sent to your email and your new password.
        </p>
        <label for="reset_email" class="sr-only">Email Address</label>
        <input type="email" id="reset_email" name="email" placeholder="‚úâÔ∏è Email Address" readonly style="background-color: #f5f5f5;">
        
        <label for="reset_otp" class="sr-only">OTP Code</label>
        <input type="text" id="reset_otp" name="otp_code" placeholder="üî¢ Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" title="Enter the 6-digit verification code" required>
        
        <div class="password-container">
          <label for="reset_new_password" class="sr-only">New Password</label>
          <input type="password" id="reset_new_password" name="new_password" placeholder="üîí New Password (min 8 chars)" title="Enter a new password with at least 8 characters" required minlength="8">
          <span class="password-toggle" onclick="togglePasswordVisibility('passwordResetOTPForm')" title="Toggle password visibility" aria-label="Show/hide password">üëÅÔ∏è</span>
        </div>
        
        <div class="password-strength">
          <div class="pw-strength-bar" id="resetOTPPwBar"></div>
          <div class="pw-strength-text" id="resetOTPPwText">Password strength: -</div>
          <div class="pw-requirements" id="resetOTPPwReq"></div>
        </div>
        
        <button type="submit"><i class="btn-icon">üîÑ</i> RESET PASSWORD</button>
      </form>
      <p style="text-align: center; font-size: 12px; color: #999; margin-top: 15px;">
        Didn't receive the code? <a href="#" id="resendCodeLink" onclick="resendPasswordResetOTP()" style="color: #3498db;">Resend Code</a>
      </p>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('logoutModal')">&times;</span>
      <h2><i class="modal-icon">üö™</i> Confirm Logout</h2>
      <p style="text-align: center; margin-bottom: 20px; color: #666;">
        Are you sure you want to log out? You will need to log in again to access your account.
      </p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button onclick="handleLogout(); closeModal('logoutModal');" style="background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
          <i class="fas fa-sign-out-alt"></i> Yes, Logout
        </button>
        <button onclick="closeModal('logoutModal')" style="background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 12px 25px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div id="toast" class="toast"></div>

  <style>
    /* Red Header Bar and Sidebar Styles */
    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #f5f5f5;
    }



    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 70px; /* Account for fixed header */
      left: -250px;
      width: 250px;
      height: calc(100vh - 70px); /* Full height minus header */
      background-color: #1e40af; /* Blue theme sidebar */
      color: white;
      transition: 0.3s ease;
      z-index: 999;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    /* Fixed Header Bar */
    .header-bar {
      background-color: #b91c1c; /* Red header bar */
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 70px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .menu-btn {
      font-size: 22px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
      padding: 8px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .menu-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid white;
      object-fit: cover;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .profile-pic:hover {
      transform: scale(1.1);
    }

    /* Auth Buttons */
    .auth-links {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .auth-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Logo in header */
    .header-left .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-left .logo img {
      height: 40px;
      width: auto;
    }

    .header-left .clinic-name {
      font-size: 14px;
      font-weight: bold;
      line-height: 1.2;
      color: white;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: 0.2s;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      padding-left: 30px;
    }

    .logout-sidebar-btn {
      background-color: rgba(59, 130, 246, 0.2);
      color: #60a5fa !important;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 10px;
      font-weight: 600;
      display: none !important;
    }

    .logout-sidebar-btn:hover {
      background-color: rgba(59, 130, 246, 0.3) !important;
      color: #3b82f6 !important;
      padding-left: 30px;
    }

    .logout-sidebar-btn.visible {
      display: block !important;
    }

    /* Hide logout button when not logged in */
    body:not(.logged-in) .logout-sidebar-btn {
      display: none !important;
    }

    /* Show logout button only when logged in */
    body.logged-in .logout-sidebar-btn.visible {
      display: block !important;
    }

    /* Main Content - Account for fixed header */
    .content, .hero, .services, .contact, .schedule, .store-section, .about-section, .vets-section {
      margin-top: 70px; /* Account for fixed header */
      padding-top: 20px;
    }

    /* Additional padding for services section to prevent header overlap */
    .services {
      padding-top: 40px;
    }

    /* Smooth transitions for homepage sections */
    .hero, .services, .contact, .schedule, .store-section, .about-section, .vets-section {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .hero.hidden, .services.hidden, .contact.hidden, .schedule.hidden, .store-section.hidden, .about-section.hidden, .vets-section.hidden {
      opacity: 0;
      transform: translateY(30px);
      display: none;
    }

    /* Enhanced navigation link animations */
    .sidebar a {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sidebar a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }

    .sidebar a:hover::before {
      left: 100%;
    }

    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.15);
      padding-left: 30px;
    }

    /* Sidebar Overlay for closing when clicking outside */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      cursor: pointer;
      display: none;
    }

    .sidebar-overlay.active {
      display: block;
    }

    /* Ensure sidebar is above overlay */
    .sidebar.active {
      z-index: 999;
    }

    /* Hide overlay on desktop, show only on mobile */
    @media (min-width: 769px) {
      .sidebar-overlay {
        display: none !important;
      }
    }

    /* Screen reader only labels */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Password visibility toggle styles */
    .password-container {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .password-container input[type="password"],
    .password-container input[type="text"] {
      width: 100%;
      padding-right: 45px; /* Make room for the eye icon */
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      cursor: pointer;
      user-select: none;
      font-size: 18px;
      color: #666;
      transition: color 0.3s ease;
      z-index: 10;
    }
    
    .password-toggle:hover {
      color: #4169e1;
    }
    
    .password-toggle.visible {
      color: #4169e1;
    }
    
    /* Universal Icon Styles */
    .icon, .service-icon, .modal-icon, .btn-icon, .form-icon, .social-icon, .signup-icon {
      display: inline-block;
      margin-right: 8px;
      font-style: normal;
      font-size: 1.2em;
      vertical-align: middle;
      transition: all 0.3s ease;
    }
    
    /* Navigation Icons */
    nav a .icon {
      font-size: 1.1em;
      margin-right: 6px;
    }
    
    /* Service Items */
    .service-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }

    .service-item:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(3px);
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
    }

    .service-item .service-icon {
      font-size: 1.4em;
      margin-right: 15px;
      min-width: 30px;
      text-align: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .service-item .service-name {
      flex: 1;
      font-weight: 500;
      font-size: 13px;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .service-item .service-arrow {
      color: rgba(255, 255, 255, 0.7);
      font-size: 11px;
      transition: all 0.3s ease;
    }

    .service-item:hover .service-arrow {
      color: white;
      transform: translateX(2px);
    }

    /* Services section title */
    .services h2 {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Schedule section title */
    .schedule h2 {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      text-align: center;
    }

    /* Toast notification positioning */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #2E5BAA, #1E3F7A);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      z-index: 10001;
      font-size: 14px;
      font-weight: 500;
      max-width: calc(100vw - 40px);
      word-wrap: break-word;
      display: none;
      animation: slideUp 0.4s ease-out;
      align-items: center;
      gap: 10px;
    }

    .toast.show {
      display: flex;
    }

    .toast.success {
      background: linear-gradient(135deg, #28a745, #20c997);
    }

    .toast.error {
      background: linear-gradient(135deg, #dc3545, #c82333);
    }

    .toast.warning {
      background: linear-gradient(135deg, #ffc107, #fd7e14);
    }

    .toast.info {
      background: linear-gradient(135deg, #17a2b8, #138496);
    }

    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    /* Mobile toast adjustments */
    @media (max-width: 768px) {
      .toast {
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        max-width: calc(100vw - 30px);
        padding: 12px 20px;
        font-size: 13px;
        gap: 8px;
      }
    }

    @media (max-width: 480px) {
      .toast {
        bottom: 10px;
        padding: 10px 15px;
        font-size: 12px;
        max-width: calc(100vw - 20px);
        gap: 6px;
      }
    }
    
    /* Modal Icons */
    .modal-icon {
      font-size: 1.4em;
      margin-right: 10px;
      color: #ffd700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Button Icons */
    .btn-icon {
      font-size: 1.1em;
      margin-right: 6px;
      vertical-align: middle;
    }
    
    /* Form Icons */
    .form-icon {
      font-size: 1.1em;
      margin-right: 6px;
      color: #4169e1;
    }
    
    /* Social Icons */
    .social-icon {
      font-size: 1.2em;
      margin-right: 6px;
    }
    
    /* Signup Section Icon */
    .signup-icon {
      font-size: 1.3em;
      margin-right: 8px;
      color: #ffd700;
    }
    
    /* Contact Icons Enhancement */
    .contact-item .icon {
      font-size: 1.4em;
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      min-height: 40px;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    /* Hero Button Icon */
    .booking-btn .icon {
      font-size: 1.2em;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* Auth Links Icons */
    .auth-links a .icon {
      font-size: 1em;
      margin-right: 5px;
    }
    
    /* Responsive Icon Adjustments */
    @media (max-width: 768px) {
      .icon, .service-icon, .modal-icon, .btn-icon, .form-icon {
        font-size: 1em;
        margin-right: 6px;
      }
      
      .service-icon {
        font-size: 1.1em;
      }
      
      .modal-icon {
        font-size: 1.2em;
      }
      
      .contact-item .icon {
        font-size: 1.2em;
        min-width: 35px;
        min-height: 35px;
      }
    }

    /* Password strength meter */
    .password-strength { margin-top: 6px; }
    .pw-strength-bar { height: 8px; border-radius: 6px; background: #eee; position: relative; overflow: hidden; }
    .pw-strength-bar::after { content: ''; display: block; height: 100%; width: 0%; background: #e74c3c; transition: width 0.3s ease, background 0.3s ease; }
    .pw-strength-text { font-size: 12px; color: #666; margin-top: 6px; }
    .pw-requirements { font-size: 12px; color: #8b5a00; margin-top: 4px; }
    .pw-ok { color: #27ae60; }
    .pw-bad { color: #e74c3c; }

    /* Store Section Styles */
    .store-section {
      text-align: center;
      padding: 30px 20px;
      background: #27406b;
    }

    .store-section h2 {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
      color: white;
    }

    .store-section p {
      font-size: 13px;
      margin-bottom: 25px;
      color: #d1d5db;
    }

    .categories {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .category {
      background: linear-gradient(135deg, #3a588c 0%, #2c4a73 100%);
      border-radius: 12px;
      padding: 15px;
      width: 220px;
      text-align: center;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      cursor: pointer;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .category::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .category:hover::before {
      left: 100%;
    }

    .category:hover {
      transform: translateY(-12px) scale(1.02);
      box-shadow: 0 12px 25px rgba(0,0,0,0.4);
      border-color: #ffd700;
      background: linear-gradient(135deg, #4a6ba5 0%, #3c5a83 100%);
    }

    .category:active {
      transform: translateY(-8px) scale(0.98);
    }

    .category h3 {
      position: relative;
      z-index: 2;
    }

    .category img {
      position: relative;
      z-index: 2;
      transition: transform 0.3s ease;
    }

    .category:hover img {
      transform: scale(1.1) rotate(2deg);
    }

    .category img {
      max-width: 100%;
      height: 120px;
      object-fit: contain;
      margin-bottom: 12px;
    }

    .category h3 {
      font-size: 16px;
      font-weight: bold;
      color: white;
      position: relative;
      z-index: 2;
    }

    .category::after {
      content: 'üõí';
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 20px;
      opacity: 0.3;
      transition: all 0.3s ease;
      z-index: 2;
    }

    .category:hover::after {
      opacity: 0.8;
      transform: translateY(-2px);
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, hsl(230, 55%, 45%) 0%, hsl(250, 50%, 55%) 100%);
      color: white;
      min-height: 100vh;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1rem;
      position: relative;
    }

    /* About Section */
    .about-section {
      padding: 2rem 0;
    }

    .about-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      align-items: center;
    }

    @media (min-width: 768px) {
      .about-grid {
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
      }
    }

    /* Image Wrapper */
    .image-wrapper {
      position: relative;
    }

    .image-border {
      border: 12px solid hsl(180, 85%, 60%);
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .main-image {
      width: 100%;
      height: 350px;
      object-fit: cover;
      display: block;
    }


    /* Content Wrapper */
    .content-wrapper {
      padding: 0.5rem;
    }

    .title-wrapper {
      margin-bottom: 1rem;
    }


    .main-title {
      font-size: 3rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 1rem;
    }

    @media (min-width: 768px) {
      .main-title {
        font-size: 3.5rem;
      }
    }

    .description {
      font-size: 1rem;
      line-height: 1.75;
    }

    @media (min-width: 768px) {
      .description {
        font-size: 1.125rem;
      }
    }

    /* Section Separator */
    .section-separator {
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, hsl(180, 85%, 60%), transparent);
      margin: 1rem 0;
      position: relative;
    }


    /* Vets Section */
    .vets-section {
      padding: 1.5rem 0;
    }

    .vets-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }


    .section-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 0.5rem 0;
    }

    @media (min-width: 768px) {
      .section-title {
        font-size: 3rem;
      }
    }

    /* Vets Grid */
    .vets-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      max-width: 1024px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .vets-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .vet-card {
      text-align: center;
    }

    .vet-image-border {
      display: inline-block;
      border: 8px solid hsl(180, 85%, 60%);
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      margin-bottom: 1rem;
    }

    .vet-image {
      width: 192px;
      height: 192px;
      object-fit: cover;
      display: block;
    }

    .vet-name {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 1rem 0;
    }

    .vet-bio {
      font-size: 0.875rem;
      line-height: 1.75;
      padding: 0 1rem;
    }

    @media (min-width: 768px) {
      .vet-bio {
        font-size: 1rem;
      }
    }


    /* Service Modal Styles */
    .service-modal {
      max-width: 700px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .service-modal-header {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
      margin-bottom: 30px;
    }

    .service-icon-large {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }

    .service-modal-body {
      flex: 1;
      padding: 0 10px;
    }

    .service-description {
      background: rgba(255, 215, 0, 0.1);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border-left: 5px solid #ffd700;
      line-height: 1.6;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.9);
    }

    .service-features, .service-pricing, .service-process {
      margin-bottom: 25px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .service-features h4, .service-pricing h4, .service-process h4 {
      color: #ffd700;
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .service-features ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .service-features li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.5;
    }

    .service-features li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #4CAF50;
      font-weight: bold;
      font-size: 16px;
    }

    .pricing-info {
      background: rgba(76, 175, 80, 0.1);
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }

    .process-steps {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
    }


    /* Modal animations */
    .modal.show {
      animation: modalFadeIn 0.3s ease-out;
    }

    .modal.hide {
      animation: modalFadeOut 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    @keyframes modalFadeOut {
      from {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      to {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
    }

    /* Booking Modal Styles */
    .booking-modal {
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      animation: modalSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
        filter: blur(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    .login-required-message {
      text-align: center;
      padding: 20px;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-prompt {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 40px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }

    .login-icon {
      font-size: 64px;
      margin-bottom: 20px;
      display: block;
      animation: pulse 2s ease-in-out infinite;
    }

    .login-prompt h3 {
      color: white;
      font-size: 24px;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .login-prompt p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 25px;
    }

    .login-prompt-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 25px;
    }

    .login-benefits {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      font-size: 14px;
      line-height: 1.5;
      color: rgba(255, 255, 255, 0.8);
      border-left: 4px solid #ffd700;
    }

    .login-benefits strong {
      color: #ffd700;
    }

    /* Booking Form Styles */
    .booking-form .form-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideInFromLeft 0.6s ease-out;
    }

    .booking-form .form-section:nth-child(2) {
      animation-delay: 0.1s;
    }

    .booking-form .form-section:nth-child(3) {
      animation-delay: 0.2s;
    }

    .booking-form .form-section:nth-child(4) {
      animation-delay: 0.3s;
    }

    @keyframes slideInFromLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .form-section h3 {
      color: white;
      font-size: 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-section h3 i {
      color: #ffd700;
      font-size: 20px;
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-group {
      flex: 1;
    }

    .form-group label {
      display: block;
      color: white;
      font-weight: 500;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.9);
      color: #1e3a8a;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #ffd700;
      background: white;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
      transform: translateY(-2px);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      margin-top: 20px;
    }

    .btn-primary, .btn-secondary {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #1e3a8a;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    /* Responsive Booking Modal */
    @media (max-width: 768px) {
      .booking-modal {
        max-width: 95vw;
        max-height: 95vh;
        margin: 2.5vh 2.5vw;
      }

      .login-prompt {
        padding: 30px 20px;
      }

      .login-prompt-actions {
        flex-direction: column;
        gap: 10px;
      }

      .btn-primary, .btn-secondary {
        width: 100%;
        justify-content: center;
      }

      .booking-form .form-section {
        padding: 20px 15px;
      }

      .form-row {
        flex-direction: column;
        gap: 10px;
      }

      .form-actions {
        flex-direction: column;
        gap: 10px;
      }
    }

    @media (max-width: 480px) {
      .login-icon {
        font-size: 48px;
      }

      .login-prompt h3 {
        font-size: 20px;
      }

      .login-prompt p {
        font-size: 14px;
      }

      .booking-modal {
        padding: 15px;
      }

      .form-section h3 {
        font-size: 16px;
      }
    }

    /* Enhanced service modal styles */
    .service-modal .modal-content {
      animation: modalContentSlideIn 0.3s ease-out;
    }

    @keyframes modalContentSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Service modal enhancements */
    .service-modal-header {
      position: relative;
      margin-bottom: 30px;
    }

    .service-modal-header::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, #ffd700, #ffed4e);
      border-radius: 2px;
    }

    .service-features li:hover,
    .service-pricing div:hover,
    .service-process p:hover {
      background: rgba(255, 215, 0, 0.05);
      padding: 8px 12px;
      border-radius: 8px;
      margin: 2px 0;
      transition: all 0.3s ease;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .categories {
        flex-direction: column;
        align-items: center;
      }

      /* Mobile header adjustments */
      .header-bar {
        padding: 10px 15px;
      }

      .header-left .clinic-name {
        font-size: 12px;
      }

      .auth-btn {
        padding: 6px 12px;
        font-size: 11px;
      }

      .service-modal {
        max-width: 95vw;
        max-height: 90vh;
        margin: 5vh 2.5vw;
      }


      .service-modal-header::after {
        width: 40px;
        height: 2px;
      }
    }

  </style>

  <script>
    // Global variables
    let csrfToken = '';
    let currentUser = null;
    let currentUserType = null;
    const API_BASE_URL = 'api/vet_api.php';

    // Resend cooldown variables
    let resendCooldown = false;
    let resendTimer = 0;
    let resendInterval = null;

    // Helper function for API calls with CSRF token - global scope
    async function apiCall(payload) {
      try {
        // Add CSRF token to payload for state-changing actions
        const csrfActions = ['register', 'login', 'logout', 'book_appointment', 'add_pet', 'update_appointment_status', 'add_to_cart', 'place_order', 'update_staff_profile', 'change_staff_password'];
        if (csrfActions.includes(payload.action)) {
          payload.csrf_token = csrfToken;
        }

        try {
          console.log('Making API call:', payload);
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          // Log response status
          console.log('API response status:', response.status);

          // Handle non-200 responses
          if (!response.ok) {
            let errorText = await response.text();
            console.error('API error response:', errorText);
            try {
              // Try to parse error as JSON
              const errorJson = JSON.parse(errorText);
              return { success: false, message: errorJson.message || 'API request failed' };
            } catch (e) {
              // If not JSON, return text
              return { success: false, message: 'API error: ' + errorText };
            }
          }

          // Parse JSON response
          const result = await response.json();
          console.log('API response:', result);
          return result;
        } catch (err) {
          console.error('API call error:', err);
          return { success: false, message: 'Connection error: ' + err.message };
        }
      } catch (error) {
        console.error('API call failed:', error);
        throw error;
      }
    }

    // Logout function - global scope, without confirm since modal handles it
    window.handleLogout = async () => {
      try {
        const result = await apiCall({ action: 'logout' });

        if (result.success) {
          toast('Logged out successfully.', 'success');
          // Reset UI to show login/signup
          resetHeaderToLoginState();
        } else {
          toast('Logout failed. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Logout error:', error);
        toast('Logout failed. Please try again.', 'error');
      }
    };

    // Profile Picture Management System
    class ProfilePictureManager {
      constructor() {
        this.defaultProfilePic = 'assets/images/logoo.jpg';
        this.profilePicElement = null;
        this.initialized = false;
      }

      // Initialize the profile picture system
      init() {
        this.profilePicElement = document.getElementById('headerProfilePic');
        if (this.profilePicElement) {
          this.initialized = true;
          console.log('ProfilePictureManager initialized successfully');
        } else {
          console.warn('ProfilePictureManager: Could not find headerProfilePic element');
        }
      }

      // Get the correct profile picture path
      getProfilePicturePath(user) {
        if (!user) return this.defaultProfilePic;

        // If user has a profile picture, use it
        if (user.profile_picture && user.profile_picture.trim() !== '' && user.profile_picture !== 'null') {
          // Handle different profile picture path formats
          let profilePicPath = user.profile_picture;

          // If path doesn't start with assets/, add it
          if (!profilePicPath.startsWith('assets/')) {
            profilePicPath = 'assets/images/profiles/' + profilePicPath;
          }

          return profilePicPath;
        }

        // Otherwise use default
        return this.defaultProfilePic;
      }

      // Update profile picture with error handling
      updateProfilePicture(user) {
        // Re-initialize to get the current profile picture element
        this.init();

        if (!this.initialized || !this.profilePicElement) {
          console.warn('ProfilePictureManager not initialized or profile element not found');
          return;
        }

        const profilePicPath = this.getProfilePicturePath(user);
        console.log('ProfilePictureManager updating to:', profilePicPath);
        console.log('User profile_picture value:', user?.profile_picture);

        // Add timestamp to prevent caching
        const timestamp = Date.now();
        const finalPath = profilePicPath + '?t=' + timestamp;

        console.log('Setting profile picture element src to:', finalPath);

        // Create new image to test loading
        const img = new Image();
        img.onload = () => {
          this.profilePicElement.src = finalPath;
          console.log('ProfilePictureManager: Profile picture loaded successfully');
        };

        img.onerror = () => {
          console.warn('ProfilePictureManager: Profile picture failed to load, using default');
          console.log('Failed path:', finalPath);
          this.profilePicElement.src = this.defaultProfilePic;
        };

        img.src = finalPath;
      }

      // Get user display name
      getUserDisplayName(user) {
        if (!user) return 'User';
        return user.name || user.first_name || 'User';
      }

      // Update entire header profile section
      updateHeaderProfile(user, userType) {
        const profileSection = document.querySelector('.profile-section');
        if (!profileSection) {
          console.warn('Profile section not found');
          return;
        }

        const userName = this.getUserDisplayName(user);
        const profilePicPath = this.getProfilePicturePath(user);

        console.log('Updating header profile:', {
          userName: userName,
          userType: userType,
          profilePicPath: profilePicPath,
          fullUserData: user
        });

        // Update the existing profile picture element instead of recreating
        const existingProfilePic = document.getElementById('headerProfilePic');
        if (existingProfilePic) {
          existingProfilePic.src = profilePicPath;
          existingProfilePic.alt = `${userName}'s profile picture`;
          existingProfilePic.onclick = () => window.location.href = `public/${userType}.html`;
        }

        // Update the profile picture with the new element
        this.init();
        if (user) {
          this.updateProfilePicture(user);
        }
      }
    }

    // Create global profile picture manager instance
    window.profileManager = new ProfilePictureManager();

    // Global modal functions - defined early so they're available for onclick handlers
    window.showLoginModal = () => {
      openModal('loginModal');
      updateLoginModalWithAttempts(); // Show attempt status when modal opens
    };
    window.showRegisterModal = () => openModal('registerModal');
    window.showForgotPasswordModal = () => openModal('forgotPasswordModal');
    window.showResendVerificationModal = () => openModal('resendVerificationModal');
    window.showLogoutModal = () => openModal('logoutModal');
    window.showBookingModal = async function() {
      console.log('üóìÔ∏è Booking modal triggered');

      try {
        // Check if user is logged in
        const response = await fetch('api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();
        console.log('üìä Login check result:', result);

        if (result.success && result.data && result.data.logged_in) {
          // User is logged in
          const userType = result.data.user_type;
          console.log('‚úÖ User logged in as:', userType);

          if (userType === 'staff') {
            // Redirect staff to their dashboard
            console.log('üîÑ Redirecting staff to dashboard');
            window.location.href = 'public/staff.html';
            return;
          } else if (userType === 'client') {
            // Redirect client to their dashboard appointments section
            console.log('üîÑ Redirecting client to dashboard appointments');
            window.location.href = 'public/client.html#appointments';
            return;
          }
        }

        // User is not logged in or login check failed
        console.log('‚ùå User not logged in, showing signup prompt');

        const modal = document.getElementById('bookingModal');
        if (modal) {
          modal.style.display = 'flex';

          // Show login required message and hide booking form
          const loginRequiredMsg = document.getElementById('loginRequiredMessage');
          const bookingForm = document.getElementById('bookingForm');

          if (loginRequiredMsg) {
            loginRequiredMsg.style.display = 'block';
          }
          if (bookingForm) {
            bookingForm.style.display = 'none';
          }

          // Add animation
          setTimeout(() => {
            modal.classList.add('show');
          }, 10);

          console.log('‚úÖ Booking modal shown with signup prompt');
        } else {
          console.error('‚ùå Booking modal not found');
        }

      } catch (error) {
        console.error('‚ùå Error in booking modal:', error);

        // On error, show signup prompt as fallback
        const modal = document.getElementById('bookingModal');
        if (modal) {
          modal.style.display = 'flex';
          document.getElementById('loginRequiredMessage').style.display = 'block';
          document.getElementById('bookingForm').style.display = 'none';
        }
      }
    };
    window.closeModal = (id) => {
      const modal = document.getElementById(id);
      if (modal) {
        modal.style.display = 'none';
      }
    };

    function openModal(id) {
      document.getElementById(id)?.style.setProperty('display', 'flex');
    }

    // 2FA and OTP Functions - defined early for global access
    function show2FAModal(email) {
      closeModal('loginModal');
      openModal('twoFAModal');
      // Store email for verification
      window.currentOTPEmail = email;
    }

    function showPasswordResetOTPModal(email) {
      // Clear any existing interval and reset link
      if (resendInterval) {
        clearInterval(resendInterval);
        resendInterval = null;
      }
      resendCooldown = false;
      resendTimer = 0;
      const link = document.getElementById('resendCodeLink');
      if (link) {
        link.textContent = 'Resend Code';
        link.style.pointerEvents = 'auto';
        link.style.color = '#3498db';
      }

      openModal('passwordResetOTPModal');
      document.getElementById('reset_email').value = email;
      window.currentResetEmail = email;
    }

    async function resend2FAOTP() {
      if (!window.currentOTPEmail) {
        toast('Session expired. Please login again.', 'error');
        closeModal('twoFAModal');
        showLoginModal();
        return;
      }

      try {
        // Re-trigger login to get new OTP
        const result = await apiCall({
          action: 'login',
          email: window.currentOTPEmail,
          password: window.currentOTPPassword // This won't work, user needs to re-enter
        });

        // Instead, let's use a direct OTP generation
        toast('Please login again to receive a new code.', 'info');
        closeModal('twoFAModal');
        showLoginModal();

      } catch (error) {
        console.error('Resend 2FA OTP error:', error);
        toast('Please login again to receive a new code.', 'info');
        closeModal('twoFAModal');
        showLoginModal();
      }
    }

    async function resendPasswordResetOTP() {
      // Clear any existing interval
      if (resendInterval) {
        clearInterval(resendInterval);
        resendInterval = null;
      }

      if (resendCooldown) {
        return;
      }

      if (!window.currentResetEmail) {
        toast('Session expired. Please try again.', 'error');
        closeModal('passwordResetOTPModal');
        return;
      }

      // Start cooldown
      resendCooldown = true;
      resendTimer = 60;
      const link = document.getElementById('resendCodeLink');
      if (link) {
        link.textContent = `Resend Code (${resendTimer}s)`;
        link.style.pointerEvents = 'none';
        link.style.color = '#999';
      }

      // Start countdown
      resendInterval = setInterval(() => {
        resendTimer--;
        if (link) {
          link.textContent = `Resend Code (${resendTimer}s)`;
        }
        if (resendTimer <= 0) {
          clearInterval(resendInterval);
          resendInterval = null;
          resendCooldown = false;
          if (link) {
            link.textContent = 'Resend Code';
            link.style.pointerEvents = 'auto';
            link.style.color = '#3498db';
          }
        }
      }, 1000);

      try {
        const result = await apiCall({
          action: 'forgot_password_otp',
          email: window.currentResetEmail
        });

        if (result.success) {
          // Send new OTP email
          if (window.otpEmailService && result.otp_code) {
            try {
              const emailResult = await window.otpEmailService.sendPasswordResetOTP(
                result.user_email,
                result.user_name,
                result.otp_code
              );

              if (emailResult.success) {
                toast('New verification code sent to your email!', 'success');
              } else {
                if (emailResult.mock) {
                  // Development mode - show different message
                  toast('New verification code generated! Check console for mock email details.', 'info');
                } else {
                  // Real email failed
                  toast('New verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
                }
              }
            } catch (emailError) {
              console.error('Email error:', emailError);
              toast('New verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
            }
          } else {
            console.warn('‚ö†Ô∏è Password reset email service not available');
            toast('New verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
          }
        } else {
          toast(result.message || 'Failed to send new code', 'error');
        }
      } catch (error) {
        console.error('Resend password reset OTP error:', error);
        toast('Connection error. Please try again.', 'error');
      }
    }

    // Assign to window object for global access
    window.show2FAModal = show2FAModal;
    window.showPasswordResetOTPModal = showPasswordResetOTPModal;
    window.resend2FAOTP = resend2FAOTP;
    window.resendPasswordResetOTP = resendPasswordResetOTP;

    // Form handlers - defined early for global access
    async function handle2FAVerification(e) {
      e.preventDefault();

      const form = e.target;
      const otpCode = form.otp_code.value.trim();

      if (!otpCode) {
        toast('Please enter the verification code.', 'error');
        return;
      }

      if (otpCode.length !== 6) {
        toast('Verification code must be 6 digits.', 'error');
        return;
      }

      try {
        const result = await apiCall({
          action: 'verify_otp',
          otp_code: otpCode
        });

        if (result.success) {
          toast('Login successful! Redirecting...', 'success');
          closeModal('twoFAModal');
          form.reset();

          // Redirect based on user type
          setTimeout(() => {
            if (result.user && result.user.type === 'staff') {
              window.location.href = 'public/staff.html';
            } else {
              window.location.href = 'public/client.html';
            }
          }, 1500);
        } else {
          toast(result.message || '2FA verification failed', 'error');
        }
      } catch (error) {
        console.error('2FA verification error:', error);
        toast('Connection error. Please try again.', 'error');
      }
    }

    async function handlePasswordResetOTP(e) {
      e.preventDefault();

      const form = e.target;
      const email = form.email.value.trim();
      const otpCode = form.otp_code.value.trim();
      const newPassword = form.new_password.value;

      if (!otpCode) {
        toast('Please enter the verification code.', 'error');
        return;
      }

      if (otpCode.length !== 6) {
        toast('Verification code must be 6 digits.', 'error');
        return;
      }

      if (!newPassword) {
        toast('Please enter your new password.', 'error');
        return;
      }

      if (newPassword.length < 8) {
        toast('Password must be at least 8 characters long.', 'error');
        return;
      }

      // Check password strength requirements
      const hasUpper = /[A-Z]/.test(newPassword);
      const hasLower = /[a-z]/.test(newPassword);
      const hasDigit = /\d/.test(newPassword);
      const hasSymbol = /[^A-Za-z0-9]/.test(newPassword);

      if (!(hasUpper && hasLower && hasDigit && hasSymbol)) {
        toast('Password must include uppercase, lowercase, number, and symbol.', 'error');
        return;
      }

      try {
        const result = await apiCall({
          action: 'reset_password_with_otp',
          email: email,
          otp_code: otpCode,
          new_password: newPassword
        });

        if (result.success) {
          toast('Password reset successfully! You can now login with your new password.', 'success');
          closeModal('passwordResetOTPModal');
          form.reset();

          // Show login modal after short delay
          setTimeout(() => {
            showLoginModal();
          }, 2000);
        } else {
          toast(result.message || 'Password reset failed', 'error');
        }
      } catch (error) {
        console.error('Password reset error:', error);
        toast('Connection error. Please try again.', 'error');
      }
    }

    // Assign form handlers to window for global access
    window.handle2FAVerification = handle2FAVerification;
    window.handlePasswordResetOTP = handlePasswordResetOTP;


    // Modern JavaScript with reduced redundancy
    document.addEventListener('DOMContentLoaded', async function () {
      // Log email service status for debugging
      if (window.otpEmailService) {
        const status = window.otpEmailService.getStatus();
        console.log('üìß Email Service Status:', status);
        if (status.ready) {
          console.log('‚úÖ Email service is ready!');
        } else if (status.mock) {
          console.log('üöÄ Email service in development mode - using mock emails');
        } else {
          console.log('‚ö†Ô∏è Email service not configured - check otp-email-service.js');
        }
      }

      // Initialize profile picture manager
      if (window.profileManager) {
        profileManager.init();
      }

      // Initialize CSRF token and check login status
      try {
        await getCSRFToken();
        await checkLoginStatusOnLoad();
      } catch (error) {
        console.error('Initialization error:', error);
        // Continue without initialization, will retry as needed
      }
      
      // Smooth scrolling for nav links
      document.querySelectorAll('nav a[href^="#"]').forEach(link => {
        link.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href && href.startsWith('#') && href.length > 1) {
            e.preventDefault();
            const targetSection = document.querySelector(href);
            if (targetSection) {
              targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        });
      });
      
      // Get CSRF token
      async function getCSRFToken() {
        try {
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'get_csrf_token' })
          });

          const result = await response.json();
          if (result.success) {
            csrfToken = result.csrf_token || result.data?.csrf_token;
            if (!csrfToken) {
              console.error('CSRF token not found in response:', result);
            }
          } else {
            console.error('Failed to get CSRF token:', result.message);
          }
        } catch (error) {
          console.error('Error getting CSRF token:', error);
          // Continue without CSRF token, server will handle it
        }
      }


      // Check login status on page load and update UI accordingly
      async function checkLoginStatusOnLoad() {
        try {
          // Add retry mechanism for session verification
          let retries = 3;
          let result = null;

          while (retries > 0) {
            result = await apiCall({ action: 'get_user_info' });

            if (result.success && result.data.logged_in) {
              // User is logged in, update UI
              const user = result.data.user;
              const userType = result.data.user_type;

              console.log('User logged in:', user);
              console.log('Profile picture path:', user.profile_picture);

              updateUIForLoggedInUser(user, userType);

              // Update booking buttons text for staff users
              if (userType === 'staff') {
                updateBookingButtonsForStaff();
              }
              return; // Success, exit retry loop
            }

            retries--;
            if (retries > 0) {
              console.log(`Session check failed, retrying... (${retries} attempts left)`);
              await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second before retry
            }
          }

          console.log('User not logged in after retries or API error:', result);
          // Ensure proper logged out state
          resetToLoggedOutState();
        } catch (error) {
          console.error('Error checking login status on load:', error);
          // Ensure proper logged out state on error
          resetToLoggedOutState();
        }
      }

      // Update booking buttons for staff users
      function updateBookingButtonsForStaff() {
        const bookingBtns = document.querySelectorAll('.booking-btn, nav a[onclick*="showBookingModal"]');
        bookingBtns.forEach(btn => {
          if (btn.tagName === 'A') {
            btn.innerHTML = '<i class="icon">üìä</i> DASHBOARD';
          } else {
            btn.innerHTML = '<i class="icon">üìä</i> STAFF DASHBOARD';
          }
        });
      }

      // Reset all elements to logged out state
      function resetToLoggedOutState() {
        document.body.classList.remove('logged-in');
        const logoutSidebarBtn = document.querySelector('.logout-sidebar-btn');
        const dashboardLink = document.querySelector('.dashboard-link');

        if (logoutSidebarBtn) {
          logoutSidebarBtn.classList.remove('visible');
        }

        if (dashboardLink) {
          dashboardLink.href = "#";
          dashboardLink.innerHTML = 'üè† Homepage';
        }

        // Reset all booking buttons to default text
        resetBookingButtonsToDefault();
      }

      // Make function globally accessible
      window.resetToLoggedOutState = resetToLoggedOutState;

      // Reset booking buttons to default logged-out text
      function resetBookingButtonsToDefault() {
        const bookingBtns = document.querySelectorAll('.booking-btn, nav a[onclick*="showBookingModal"]');
        bookingBtns.forEach(btn => {
          if (btn.tagName === 'A') {
            btn.innerHTML = '<i class="icon"></i> BOOKING';
          } else {
            btn.innerHTML = '<i class="icon">üóìÔ∏è</i> BOOK APPOINTMENT';
          }
        });
      }


      // Enhanced toast notification system with icons
      window.toast = function(message, type = 'success') {
        const el = document.getElementById('toast');
        if (!el) return;
        
        // Add appropriate icons based on type
        const icons = {
          success: '‚úÖ',
          error: '‚ùå', 
          warning: '‚ö†Ô∏è',
          info: '‚ÑπÔ∏è'
        };
        
        const icon = icons[type] || icons.info;
        el.innerHTML = `<span style="margin-right: 8px; font-size: 18px;">${icon}</span>${message}`;
        
        // Apply classes and show
        el.className = `toast show ${type}`;
        
        // Auto-hide after 4 seconds with smooth animation
        setTimeout(() => { 
          el.classList.remove('show');
          // Reset after animation completes
          setTimeout(() => {
            el.className = 'toast';
            el.innerHTML = '';
          }, 400);
        }, 4000);
      };

      // Password visibility toggle function
      window.togglePasswordVisibility = (formId) => {
        const form = document.getElementById(formId);
        if (!form) return;
        
        const passwordInput = form.querySelector('input[name="password"]');
        const toggleButton = form.querySelector('.password-toggle');
        
        if (!passwordInput || !toggleButton) return;
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleButton.innerHTML = 'üôà'; // See-no-evil monkey (hidden state)
          toggleButton.classList.add('visible');
        } else {
          passwordInput.type = 'password';
          toggleButton.innerHTML = 'üëÅÔ∏è'; // Eye (visible state)
          toggleButton.classList.remove('visible');
        }
      };

      // Update Register Form UI (now always client)
      window.updateRegisterForm = () => {
        const title = document.getElementById('registerTitle');
        const btn = document.getElementById('registerBtn');
        title.innerHTML = '<i class="modal-icon">üê∂</i> Create Your Account';
        btn.innerHTML = '<i class="btn-icon">‚úÖ</i> CREATE ACCOUNT';
      };

      // Initialize register form state
      updateRegisterForm();
      
      // Helper function to check user login status
      async function checkUserLogin() {
        try {
          // First check sessionStorage
          const userSession = sessionStorage.getItem('user_session');
          if (userSession) {
            const sessionData = JSON.parse(userSession);
            if (sessionData && sessionData.user_id) {
              return true;
            }
          }

          // If no session, check with server
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'check_session' })
          });

          const result = await response.json();
          return result.success && result.logged_in;
        } catch (error) {
          console.error('Error checking login status:', error);
          return false;
        }
      }

      // Load user's pets for booking form
      async function loadUserPets() {
        try {
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'get_user_pets' })
          });

          const result = await response.json();
          const petSelect = document.getElementById('pet_id');

          if (result.success && result.data && petSelect) {
            petSelect.innerHTML = '<option value="">Choose your pet...</option>';

            if (result.data.length > 0) {
              result.data.forEach(pet => {
                const option = document.createElement('option');
                option.value = pet.pet_id;
                option.textContent = `${pet.name} (${pet.species})`;
                petSelect.appendChild(option);
              });
            } else {
              petSelect.innerHTML = '<option value="">No pets registered. Please add a pet first.</option>';
            }
          }
        } catch (error) {
          console.error('Error loading pets:', error);
          toast('Error loading pets. Please try again.', 'error');
        }
      }

      // Load available services for booking form
      async function loadServices() {
        try {
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'get_services' })
          });

          const result = await response.json();
          const serviceSelect = document.getElementById('service_id');
          const timeSelect = document.getElementById('appointment_time');

          if (result.success && result.data && serviceSelect) {
            serviceSelect.innerHTML = '<option value="">Choose a service...</option>';

            if (result.data.length > 0) {
              result.data.forEach(service => {
                const option = document.createElement('option');
                option.value = service.service_id;
                option.textContent = `${service.name} - ‚Ç±${service.price}`;
                serviceSelect.appendChild(option);
              });
            }
          }

          // Set available time slots
          if (timeSelect) {
            timeSelect.innerHTML = '<option value="">Select time...</option>';
            const timeSlots = [
              '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM', '11:00 AM',
              '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM', '5:00 PM'
            ];

            timeSlots.forEach(time => {
              const option = document.createElement('option');
              option.value = time;
              option.textContent = time;
              timeSelect.appendChild(option);
            });
          }

          // Set minimum date to today
          const dateInput = document.getElementById('appointment_date');
          if (dateInput) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
          }
        } catch (error) {
          console.error('Error loading services:', error);
          toast('Error loading services. Please try again.', 'error');
        }
      }

      // Handle booking form submission
      async function handleBooking(e) {
        e.preventDefault();

        if (!checkUserLogin()) {
          toast('Please login to book an appointment', 'warning');
          showLoginModal();
          return;
        }

        const form = e.target;
        const formData = new FormData(form);

        try {
          const response = await fetch('api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'create_appointment',
              service_id: formData.get('service_id'),
              pet_id: formData.get('pet_id'),
              appointment_date: formData.get('appointment_date'),
              appointment_time: formData.get('appointment_time'),
              notes: formData.get('notes')
            })
          });

          const result = await response.json();

          if (result.success) {
            toast('Appointment booked successfully!', 'success');
            closeModal('bookingModal');
            form.reset();

            // Redirect to client dashboard to view appointment
            setTimeout(() => {
              window.location.href = 'public/client.html#appointments';
            }, 1500);
          } else {
            toast(result.message || 'Booking failed', 'error');
          }
        } catch (error) {
          console.error('Booking error:', error);
          toast('An error occurred while booking', 'error');
        }
      }
      
      // Booking functionality now handled by client dashboard

      // Email validation function
      window.validateEmail = (email) => {
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return emailRegex.test(email);
      };

      // Real-time email validation for all email inputs
      document.querySelectorAll('input[type="email"]').forEach(emailInput => {
        // Skip if feedback already exists
        if (emailInput.nextSibling && emailInput.nextSibling.classList && emailInput.nextSibling.classList.contains('email-feedback')) {
          return;
        }
        
        const feedback = document.createElement('div');
        feedback.className = 'email-feedback';
        feedback.style.cssText = 'font-size: 12px; margin-top: 5px; transition: all 0.3s ease;';
        emailInput.parentNode.insertBefore(feedback, emailInput.nextSibling);

        emailInput.addEventListener('input', function() {
          const email = this.value.trim();
          const isValid = validateEmail(email);
          
          if (email === '') {
            feedback.textContent = '';
            feedback.style.color = '';
            this.style.borderColor = '';
          } else if (isValid) {
            feedback.textContent = '‚úì Valid email format';
            feedback.style.color = '#4CAF50';
            this.style.borderColor = '#4CAF50';
          } else {
            feedback.textContent = '‚úó Please enter a valid email address';
            feedback.style.color = '#f44336';
            this.style.borderColor = '#f44336';
          }
        });

        // Validate on blur (when user leaves the field)
        emailInput.addEventListener('blur', function() {
          const email = this.value.trim();
          if (email !== '' && !validateEmail(email)) {
            toast('Please enter a valid email address', 'error');
          }
        });
      });

      // Password strength utilities
      function evaluatePasswordStrength(pwd) {
        const length = pwd.length;
        const hasUpper = /[A-Z]/.test(pwd);
        const hasLower = /[a-z]/.test(pwd);
        const hasDigit = /\d/.test(pwd);
        const hasSymbol = /[^A-Za-z0-9]/.test(pwd);

        let score = 0;
        if (length >= 8) score++;
        if (length >= 12) score++;
        if (hasUpper && hasLower) score++;
        if (hasDigit) score++;
        if (hasSymbol) score++;
        if (score > 4) score = 4;

        let label = 'Weak', color = '#e74c3c', width = '25%';
        if (score === 2) { label = 'Fair'; color = '#f39c12'; width = '50%'; }
        else if (score === 3) { label = 'Good'; color = '#3498db'; width = '75%'; }
        else if (score === 4) { label = 'Strong'; color = '#27ae60'; width = '100%'; }

        const missing = [];
        if (length < 8) missing.push('at least 8 characters');
        if (!hasUpper) missing.push('an uppercase letter');
        if (!hasLower) missing.push('a lowercase letter');
        if (!hasDigit) missing.push('a number');
        if (!hasSymbol) missing.push('a symbol');

        return { score, label, color, width, missing };
      }

      function updateStrengthUI(prefix, result) {
        const bar = document.getElementById(prefix + 'PwBar');
        const text = document.getElementById(prefix + 'PwText');
        const req = document.getElementById(prefix + 'PwReq');
        if (bar) bar.style.setProperty('--pw-color', result.color);
        if (bar) bar.style.setProperty('--pw-width', result.width);
        if (bar) bar.style.background = '#eee';
        if (bar) bar.style.position = 'relative';
        if (bar) {
          // Simulate ::after effect by inner div to avoid CSS pseudo limitation from JS
          if (!bar.firstChild) {
            const inner = document.createElement('div');
            inner.style.height = '100%';
            inner.style.width = result.width;
            inner.style.background = result.color;
            inner.style.transition = 'width 0.3s ease, background 0.3s ease';
            bar.appendChild(inner);
          } else {
            bar.firstChild.style.width = result.width;
            bar.firstChild.style.background = result.color;
          }
        }
        if (text) text.textContent = 'Password strength: ' + result.label;
        if (req) {
          if (result.missing.length === 0) {
            req.textContent = 'Looks good: meets all requirements.';
            req.className = 'pw-requirements pw-ok';
          } else {
            req.textContent = 'Needs: ' + result.missing.join(', ');
            req.className = 'pw-requirements pw-bad';
          }
        }
      }

      function wirePasswordStrength(formId, prefix) {
        const form = document.getElementById(formId);
        if (!form) return;
        const pwd = form.querySelector('input[name="password"]');
        if (!pwd) return;
        const update = () => updateStrengthUI(prefix, evaluatePasswordStrength(pwd.value));
        pwd.addEventListener('input', update);
        // Initialize on load
        update();
      }

      // Wire up strength meters
      wirePasswordStrength('registerForm', 'register');
      wirePasswordStrength('signupForm', 'signup');
      wirePasswordStrength('passwordResetOTPForm', 'resetOTP');

      // Form handlers with PHP API integration
      const loginForm = document.getElementById('loginForm');
      if (loginForm) loginForm.addEventListener('submit', handleLogin);

      const registerForm = document.getElementById('registerForm');
      if (registerForm) registerForm.addEventListener('submit', handleRegister);

      const signupForm = document.getElementById('signupForm');
      if (signupForm) signupForm.addEventListener('submit', handleRegister); // Footer signup

      const forgotPasswordForm = document.getElementById('forgotPasswordForm');
      if (forgotPasswordForm) forgotPasswordForm.addEventListener('submit', handleForgotPassword);

      const resendVerificationForm = document.getElementById('resendVerificationForm');
      if (resendVerificationForm) resendVerificationForm.addEventListener('submit', handleResendVerification);

      const bookingForm = document.getElementById('bookingForm');
      if (bookingForm) bookingForm.addEventListener('submit', handleBooking);
      

      
      // Booking functionality now handled by client dashboard
      
      // Login attempt tracking functions
      function getLoginAttempts() {
        const attempts = localStorage.getItem('login_attempts');
        return attempts ? JSON.parse(attempts) : { count: 0, lastAttempt: null, lockoutUntil: null };
      }

      function setLoginAttempts(attempts) {
        localStorage.setItem('login_attempts', JSON.stringify(attempts));
      }

      function resetLoginAttempts() {
        localStorage.removeItem('login_attempts');
      }

      function isLockedOut() {
        const attempts = getLoginAttempts();
        if (attempts.lockoutUntil) {
          const now = new Date().getTime();
          const lockoutTime = new Date(attempts.lockoutUntil).getTime();
          if (now < lockoutTime) {
            return {
              locked: true,
              remainingTime: Math.ceil((lockoutTime - now) / 1000 / 60) // minutes
            };
          } else {
            // Lockout expired, reset attempts
            resetLoginAttempts();
            return { locked: false };
          }
        }
        return { locked: false };
      }

      function incrementLoginAttempts() {
        const attempts = getLoginAttempts();
        attempts.count++;
        attempts.lastAttempt = new Date().toISOString();

        // Lock out after 5 failed attempts
        if (attempts.count >= 5) {
          attempts.lockoutUntil = new Date(Date.now() + 15 * 60 * 1000).toISOString(); // 15 minutes
        }

        setLoginAttempts(attempts);
        return attempts;
      }

      function updateLoginModalWithAttempts() {
        const attempts = getLoginAttempts();
        const lockout = isLockedOut();

        // Remove existing status messages
        const existingStatus = document.querySelector('.login-attempt-status');
        if (existingStatus) {
          existingStatus.remove();
        }

        // Create status message element
        const statusDiv = document.createElement('div');
        statusDiv.className = 'login-attempt-status';

        if (lockout.locked) {
          statusDiv.style.cssText = 'background: #ffebee; border: 1px solid #f44336; color: #c62828; padding: 12px; border-radius: 8px; margin: 15px 0; text-align: center;';
          statusDiv.innerHTML = `
            <div style="font-size: 48px; margin-bottom: 8px;">üîí</div>
            <div style="font-weight: bold; margin-bottom: 8px;">Account Temporarily Locked</div>
            <div style="font-size: 14px;">Too many failed login attempts. Please wait ${lockout.remainingTime} minute(s) before trying again.</div>
            <div style="font-size: 14px; margin-top: 8px; color: #1565c0;"><strong>For immediate assistance, contact admin at 09286077247</strong></div>
          `;
        } else if (attempts.count > 0) {
          const remainingAttempts = 5 - attempts.count;
          statusDiv.style.cssText = 'background: #fff3e0; border: 1px solid #ff9800; color: #e65100; padding: 12px; border-radius: 8px; margin: 15px 0; text-align: center;';
          statusDiv.innerHTML = `
            <div style="font-size: 48px; margin-bottom: 8px;">‚ö†Ô∏è</div>
            <div style="font-weight: bold; margin-bottom: 8px;">Login Attempts Warning</div>
            <div style="font-size: 14px;">${attempts.count} failed attempt(s). ${remainingAttempts} attempt(s) remaining before temporary lockout.</div>
          `;
        }

        // Insert status message after the password field
        const passwordField = document.querySelector('#loginModal .password-container');
        if (passwordField && statusDiv.innerHTML) {
          passwordField.parentNode.insertBefore(statusDiv, passwordField.nextSibling);
        }

        // Control forgot password link visibility based on attempts
        const forgotLink = document.getElementById('forgotPasswordLink');
        if (forgotLink) {
          if (attempts.count >= 1) {
            forgotLink.style.display = 'block';
          } else {
            forgotLink.style.display = 'none';
          }
        }

        // Add event listeners to clear status when user starts typing
        const emailInput = document.getElementById('login_email');
        const passwordInput = document.getElementById('login_password');

        if (emailInput) {
          emailInput.addEventListener('focus', clearLoginModalStatus);
        }
        if (passwordInput) {
          passwordInput.addEventListener('focus', clearLoginModalStatus);
        }
      }

      function clearLoginModalStatus() {
        const statusDiv = document.querySelector('.login-attempt-status');
        if (statusDiv) {
          statusDiv.remove();
        }
      }

      async function handleLogin(e) {
        e.preventDefault();

        const form = e.target;
        const email = form.email.value.trim();
        const password = form.password.value;

        // Check if account is locked out (client-side check)
        const lockout = isLockedOut();
        if (lockout.locked) {
          toast(`Account locked. Please wait ${lockout.remainingTime} minute(s) before trying again. For immediate assistance, contact admin at 09286077247.`, 'error');
          updateLoginModalWithAttempts();
          return;
        }

        if (!validateEmail(email)) {
          toast('Please enter a valid email address.', 'error');
          return;
        }

        if (!password) {
          toast('Please enter your password.', 'error');
          return;
        }

        try {
          const result = await apiCall({
            action: 'login',
            email: email,
            password: password
          });

          if (result.success) {
            // Check if 2FA is required
            if (result.requires_2fa) {
              console.log('üîê 2FA required, showing OTP input');
              
              // Send OTP email
              if (window.otpEmailService && result.otp_code) {
                try {
                  const emailResult = await window.otpEmailService.send2FAOTP(
                    result.email,
                    result.email.split('@')[0], // Use email prefix as name fallback
                    result.otp_code
                  );

                  if (emailResult.success) {
                    console.log('‚úÖ 2FA OTP email sent successfully');
                  } else {
                    console.warn('‚ö†Ô∏è 2FA OTP email failed:', emailResult.message);
                    if (emailResult.mock) {
                      // Development mode - show different message
                      toast('Verification code generated! Check console for mock email details.', 'info');
                    } else {
                      // Real email failed
                      toast('Verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
                    }
                  }
                } catch (emailError) {
                  console.error('‚ùå 2FA OTP email error:', emailError);
                  // Still show success message since OTP was generated, just email failed
                  toast('Verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
                }
              } else {
                console.warn('‚ö†Ô∏è OTP email service not available');
                toast('Verification code generated. Please check your email or contact support if you don\'t receive it.', 'info');
              }
              
              // Show OTP verification modal
              show2FAModal(result.email);
              toast('Please check your email for the 6-digit verification code', 'info');
              return;
            }
            
            // Regular login success without 2FA
            // Reset login attempts on successful login
            resetLoginAttempts();
            clearLoginModalStatus();

            toast('Login successful! Redirecting...', 'success');

            // Determine redirect path based on user type
            let redirectPath = '';
            if (result.user && result.user.type) {
              if (result.user.type === 'staff') {
                redirectPath = 'public/staff.html';
              } else if (result.user.type === 'client') {
                redirectPath = 'public/client.html';
              }
            }

            if (redirectPath) {
              setTimeout(() => {
                console.log('Redirecting to:', redirectPath);
                window.location.href = redirectPath;
              }, 1500);
            } else {
              console.log('No redirect path determined, staying on homepage');
              closeModal('loginModal');
              updateUIForLoggedInUser(result.user, result.user.type);

              // Update booking buttons text for staff users
              if (result.user.type === 'staff') {
                updateBookingButtonsForStaff();
              }

              // If user logged in from booking modal, redirect to appointments
              if (document.getElementById('bookingModal').style.display === 'flex') {
                setTimeout(() => {
                  window.location.href = 'public/client.html#appointments';
                }, 500);
              }
            }
          } else {
            // Increment failed attempts on login failure
            const attempts = incrementLoginAttempts();
            updateLoginModalWithAttempts();

            // No toast notifications for login errors, as the modal already displays the status
          }
        } catch (error) {
          console.error('Login error:', error);
          toast('Connection error. Please check your server.', 'error');
        }
      }
      
      async function handleRegister(e) {
        e.preventDefault();
        
        const form = e.target;
        const firstName = form.first_name.value.trim();
        const lastName = form.last_name.value.trim();
        const email = form.email.value.trim();
        const phone = form.phone.value.trim();
        const password = form.password.value;
        const address = form.address?.value.trim() || '';
        const userType = 'client'; // Always register as client
        
        const missingFields = [];
        if (!firstName) missingFields.push('First Name');
        if (!lastName) missingFields.push('Last Name');
        if (!email) missingFields.push('Email');
        if (!phone) missingFields.push('Phone');
        if (!password) missingFields.push('Password');
        
        if (missingFields.length > 0) {
          const errorMsg = `Please fill in all required fields. Missing: ${missingFields.join(', ')}`;
          toast(errorMsg, 'error');
          return;
        }
        
        if (!validateEmail(email)) {
          toast('Please enter a valid email address.', 'error');
          return;
        }
        
        if (password.length < 8) {
          toast('Password must be at least 8 characters long.', 'error');
          return;
        }
        const hasUpper = /[A-Z]/.test(password);
        const hasLower = /[a-z]/.test(password);
        const hasDigit = /\d/.test(password);
        const hasSymbol = /[^A-Za-z0-9]/.test(password);
        if (!(hasUpper && hasLower && hasDigit && hasSymbol)) {
          toast('Password must include uppercase, lowercase, number, and symbol.', 'error');
          return;
        }
        
        try {
          const payload = {
            action: 'register',
            first_name: firstName,
            last_name: lastName,
            email: email,
            phone: phone,
            password: password,
            address: address,
            user_type: userType
          };
          
          const result = await apiCall(payload);
          
          if (result.success) {
            let welcomeMsg = result.auto_login ? 
              `Registration successful! Welcome ${firstName}! You are now logged in.` : 
              `Registration successful! Welcome ${firstName}! You can now log in with your account.`;

            closeModal('registerModal');
            form.reset();
            updateRegisterForm();

            // Show success message
            toast(welcomeMsg, 'success');

            // If auto-login is enabled, update UI and redirect
            if (result.auto_login && result.user) {
              // Update the UI to show logged-in state
              updateUIForLoggedInUser(result.user, result.user.type);
              
              // Show additional success message for auto-login
              setTimeout(() => {
                toast('Redirecting to your dashboard...', 'success');
              }, 1000);

              // Add longer delay to allow session to be properly established
              setTimeout(() => {
                console.log('‚úÖ Session should be established, redirecting to dashboard...');
                // Store user info in sessionStorage as backup
                sessionStorage.setItem('registration_user', JSON.stringify({
                  id: result.user.id,
                  name: result.user.name,
                  email: result.user.email,
                  type: result.user.type,
                  auto_logged_in: true,
                  timestamp: Date.now()
                }));
                
                if (result.user.type === 'staff') {
                  window.location.href = 'public/staff.html';
                } else if (result.user.type === 'client') {
                  window.location.href = 'public/client.html';
                }
              }, 3000); // Increased delay to 3 seconds
            }

            // Send verification email using SMTPJS (optional, doesn't affect user experience)
            if (typeof emailService !== 'undefined' && result.verification_token) {
              emailService.sendVerificationEmail(email, firstName, result.verification_token)
                .then(emailResult => {
                  if (emailResult.success) {
                    console.log('Verification email sent successfully');
                  }
                })
                .catch(emailError => {
                  console.error('Email sending error:', emailError);
                });
            }
          } else {
            toast(result.message || 'Registration failed. Please try again.', 'error');
          }
      } catch (error) {
          console.error('Registration error:', error);
          toast('Connection error. Please check your server.', 'error');
      }
    }

      async function handleForgotPassword(e) {
        e.preventDefault();

        const form = e.target;
        const email = form.email.value.trim();

        if (!email) {
          toast('Please enter your email address.', 'error');
          return;
        }

        if (!validateEmail(email)) {
          toast('Please enter a valid email address.', 'error');
          return;
        }

        try {
          const result = await apiCall({
            action: 'forgot_password_otp',
            email: email
          });

          if (result.success) {
            // Send OTP email using SMTPJS
            if (window.otpEmailService && result.otp_code) {
              try {
                const emailResult = await window.otpEmailService.sendPasswordResetOTP(
                  result.user_email,
                  result.user_name,
                  result.otp_code
                );

                if (emailResult.success) {
                  console.log('‚úÖ Password reset OTP email sent successfully');
                  toast('Password reset code sent to your email!', 'success');
                } else {
                  console.warn('‚ö†Ô∏è Password reset OTP email failed:', emailResult.message);
                  if (emailResult.mock) {
                    // Development mode - show different message
                    toast('Reset code generated! Check console for mock email details.', 'info');
                  } else {
                    // Real email failed
                    toast('Reset code generated. Please check your email or contact support if you don\'t receive it.', 'info');
                  }
                }
              } catch (emailError) {
                console.error('‚ùå Password reset OTP email error:', emailError);
                toast('Reset code generated. Please check your email or contact support if you don\'t receive it.', 'info');
              }
            } else {
              console.warn('‚ö†Ô∏è Password reset email service not available');
              toast('Reset code generated. Please check your email or contact support if you don\'t receive it.', 'info');
            }
            
            closeModal('forgotPasswordModal');
            form.reset();
            
            // Show password reset OTP modal
            showPasswordResetOTPModal(email);
            
          } else {
            toast(result.message || 'Failed to generate reset code.', 'error');
          }
        } catch (error) {
          console.error('Forgot password error:', error);
          toast('Connection error. Please try again.', 'error');
        }
      }

    async function handleResendVerification(e) {
      e.preventDefault();

      const form = e.target;
      const email = form.email.value.trim();

      if (!email) {
        toast('Please enter your email address.', 'error');
        return;
      }

      if (!validateEmail(email)) {
        toast('Please enter a valid email address.', 'error');
        return;
      }

      try {
        const result = await apiCall({
          action: 'resend_verification',
          email: email
        });

        if (result.success) {
          // Send the actual email using SMTPJS
          const email = form.email.value.trim();
          const firstName = 'Valued Customer'; // We don't have the first name here, use generic

          if (typeof emailService !== 'undefined') {
            emailService.sendVerificationEmail(email, firstName, 'resend_token')
              .then(emailResult => {
                if (emailResult.success) {
                  toast('Verification email sent successfully! Please check your inbox.', 'success');
                } else {
                  toast('Email configuration may need setup, but verification request was processed.', 'warning');
                }
                closeModal('resendVerificationModal');
                form.reset();
              })
              .catch(emailError => {
                console.error('Email sending error:', emailError);
                toast('Verification request processed. Please check your email.', 'success');
                closeModal('resendVerificationModal');
                form.reset();
              });
          } else {
            toast(result.message, 'success');
            closeModal('resendVerificationModal');
            form.reset();
          }
        } else {
          toast(result.message || 'Failed to resend verification email.', 'error');
        }
      } catch (error) {
        console.error('Resend verification error:', error);
        toast('Connection error. Please try again.', 'error');
      }
    }
      
      // Update UI when user logs in
      function updateUIForLoggedInUser(user, userType) {
        const userName = user.name || user.first_name || 'User';

        // Determine profile picture path
        let profilePicPath = 'assets/images/logoo.jpg'; // default
        if (user.profile_picture && user.profile_picture.trim() !== '' && user.profile_picture !== 'null') {
          // Handle different profile picture path formats
          if (!user.profile_picture.startsWith('assets/')) {
            profilePicPath = 'assets/images/profiles/' + user.profile_picture;
          } else {
            profilePicPath = user.profile_picture;
          }
        }

        console.log('Updating for user:', userName);
        console.log('Profile picture path:', profilePicPath);

        // Add logged-in class to body
        document.body.classList.add('logged-in');

        // Show profile picture and hide auth links
        const profilePic = document.getElementById('headerProfilePic');
        const authLinks = document.getElementById('authLinks');

        if (profilePic) {
          console.log('Setting profile picture to:', profilePicPath);
          profilePic.src = profilePicPath;
          profilePic.style.display = 'block';

          // Add error handling for profile picture loading
          profilePic.onerror = () => {
            console.warn('Profile picture failed to load, using default');
            profilePic.src = this.defaultProfilePic;
          };
        }

        if (authLinks) {
          authLinks.style.display = 'none';
        }

        // Update sidebar elements for logged in user
        const logoutSidebarBtn = document.querySelector('.logout-sidebar-btn');
        const dashboardLink = document.querySelector('.dashboard-link');

        if (logoutSidebarBtn) {
          logoutSidebarBtn.classList.add('visible');
        }

        // Update dashboard link to point to user dashboard
        if (dashboardLink) {
          dashboardLink.href = `public/${userType}.html`;
          dashboardLink.innerHTML = 'üìä Dashboard';
        }

        console.log('UI updated successfully for user:', userName);
      }
      

      // Reset header to login state
      function resetHeaderToLoginState() {
        // Remove logged-in class from body
        document.body.classList.remove('logged-in');

        // Hide profile picture and show auth links
        const profilePic = document.getElementById('headerProfilePic');
        const authLinks = document.getElementById('authLinks');

        if (profilePic) {
          profilePic.style.display = 'none';
        }

        if (authLinks) {
          authLinks.style.display = 'flex';
        }

        console.log('Header reset to login state');

        // Use centralized logged out state management
        resetToLoggedOutState();
      }

      // Make function globally accessible
      window.resetHeaderToLoginState = resetHeaderToLoginState;

      // Booking functionality now handled by client dashboard
      
      // Booking functionality now handled by client dashboard
      
      // Booking functionality now handled by client dashboard
      
      // Booking functionality now handled by client dashboard
      
      // Booking functionality now handled by client dashboard
      
      // Click outside modal to close & close mobile nav when clicking outside
      document.addEventListener('click', function(e) {
        // Close modals when clicking outside
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
    });

    // Store category click functionality
    window.filterCategory = function(category) {
      console.log('üè™ Filtering category:', category);
 
      // Check if user is logged in first
      fetch('api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_user_info' })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success && result.data && result.data.logged_in) {
          // User is logged in, redirect to actual store page
          console.log('‚úÖ User logged in, redirecting to store page');
          window.location.href = `public/store.html?category=${encodeURIComponent(category)}`;
        } else {
          // User not logged in, redirect to public store page
          console.log('‚ùå User not logged in, redirecting to public store');
          window.location.href = `public/store.html?category=${encodeURIComponent(category)}`;
        }
      })
      .catch(error => {
        console.error('‚ùå Error checking login status:', error);
        // Fallback to public store
        window.location.href = `public/store.html?category=${encodeURIComponent(category)}`;
      });
    };
 
    // Add click handlers to store categories when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      const categories = document.querySelectorAll('.category');
      console.log('üè™ Found', categories.length, 'store categories');
 
      categories.forEach((category, index) => {
        console.log('üè™ Setting up category', index + 1, ':', category.querySelector('h3')?.textContent);
 
        // Make sure it's clickable
        category.style.cursor = 'pointer';
        category.style.userSelect = 'none';
 
        // Remove existing click listeners to prevent duplicates
        category.replaceWith(category.cloneNode(true));
 
        // Get fresh reference after cloning
        const freshCategory = document.querySelectorAll('.category')[index];
        if (freshCategory) {
          freshCategory.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
 
            const categoryText = this.querySelector('h3').textContent.trim();
            console.log('üè™ Category clicked:', categoryText);
 
            let categoryKey = '';
 
            // Map display text to category keys
            if (categoryText.includes('FOOD FOR')) {
              categoryKey = 'food';
            } else if (categoryText.includes('GROOMING')) {
              categoryKey = 'grooming';
            } else if (categoryText.includes('ACCESSORIES')) {
              categoryKey = 'accessories';
            }
 
            console.log('üè™ Mapped to category key:', categoryKey);
 
            if (categoryKey) {
              // Show loading toast
              toast(`Loading ${categoryText.toLowerCase()}...`, 'info');
              filterCategory(categoryKey);
            } else {
              console.warn('üè™ Could not map category:', categoryText);
              // Default to store page if mapping fails
              toast('Loading store...', 'info');
              window.location.href = 'public/store.html';
            }
          });
 
          // Add enhanced hover effects for better UX
          freshCategory.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-12px) scale(1.02)';
            this.style.boxShadow = '0 12px 25px rgba(0,0,0,0.4)';
            this.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
          });
 
          freshCategory.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(-8px) scale(1)';
            this.style.boxShadow = '0 6px 15px rgba(0,0,0,0.3)';
          });
 
          // Add keyboard support
          freshCategory.setAttribute('tabindex', '0');
          freshCategory.setAttribute('role', 'button');
          freshCategory.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.click();
            }
          });
 
          // Add touch support for mobile devices
          freshCategory.addEventListener('touchstart', function(e) {
            e.preventDefault();
            // Add visual feedback for touch
            this.style.transform = 'translateY(-10px) scale(0.98)';
          });
 
          freshCategory.addEventListener('touchend', function(e) {
            e.preventDefault();
            // Restore normal state and trigger click
            this.style.transform = 'translateY(-8px) scale(1)';
            this.click();
          });
        }
      });
 
      console.log('‚úÖ Store categories setup complete');
    });

  // Ensure all modals exist before adding event listeners
  function initializeModalHandlers() {
    // List of required modal IDs (removed bookingModal since it redirects to client dashboard)
    const modalIds = ['loginModal', 'registerModal', 'forgotPasswordModal', 'logoutModal'];

    // Check if all modals exist
    const missingModals = modalIds.filter(id => !document.getElementById(id));
    if (missingModals.length > 0) {
      console.warn('Missing modals:', missingModals);
      return;
    }

    // Add click handlers only if all modals exist
    document.addEventListener('click', function(e) {
      // Close modals when clicking outside
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (e.target === modal) {
          closeModal(modal.id);
        }
      });
    });
  }

  // Call initialization after DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeModalHandlers);
  } else {
    initializeModalHandlers();
  }

  // Sidebar Toggle Functionality with Hamburger Menu Button
  const sidebar = document.getElementById('sidebar');
  const menuBtn = document.getElementById('menuBtn');

  // Get sidebar overlay element
  const sidebarOverlay = document.getElementById('sidebarOverlay');

  // Hamburger menu button functionality
  if (menuBtn) {
    menuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleSidebar();
    });
  }

  // Function to toggle sidebar with overlay
  function toggleSidebar() {
    if (sidebar) {
      const isActive = sidebar.classList.contains('active');
      if (isActive) {
        closeSidebar();
      } else {
        openSidebar();
      }
    }
  }

  // Function to open sidebar
  function openSidebar() {
    if (sidebar) {
      sidebar.classList.add('active');
      if (sidebarOverlay) {
        sidebarOverlay.classList.add('active');
      }
    }
  }

  // Function to close sidebar
  function closeSidebar() {
    if (sidebar) {
      sidebar.classList.remove('active');
    }
    if (sidebarOverlay) {
      sidebarOverlay.classList.remove('active');
    }
  }

  // Close sidebar when clicking on overlay
  if (sidebarOverlay) {
    sidebarOverlay.addEventListener('click', closeSidebar);
  }

  // Close sidebar when clicking outside (fallback)
  document.addEventListener('click', (e) => {
    if (sidebar && sidebar.classList.contains('active')) {
      // Check if click is outside sidebar and not on menu button
      if (!sidebar.contains(e.target) && e.target !== menuBtn && e.target !== sidebarOverlay) {
        closeSidebar();
      }
    }
  });

  // Prevent event propagation on sidebar clicks to avoid immediate closing
  if (sidebar) {
    sidebar.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }

  // Close sidebar on Escape key press
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && sidebar && sidebar.classList.contains('active')) {
      closeSidebar();
    }
  });

  // Handle mobile touch events for better mobile experience
  if (sidebarOverlay) {
    // Prevent scrolling when overlay is active on mobile
    sidebarOverlay.addEventListener('touchmove', (e) => {
      e.preventDefault();
    }, { passive: false });
  }

  // Allow sidebar functions to be called globally
  window.toggleSidebar = toggleSidebar;
  window.closeSidebar = closeSidebar;

  // Enhanced scroll to section function with smooth animation
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      // Add offset for fixed header
      const headerHeight = 70; // Height of fixed header
      const sectionPosition = section.offsetTop - headerHeight;

      // Smooth scroll to the calculated position
      window.scrollTo({
        top: sectionPosition,
        behavior: 'smooth'
      });

      // Close sidebar after navigation
      setTimeout(() => {
        closeSidebar();
      }, 300);
    }
  }

  // Enhanced smooth scroll for any element
  function smoothScrollToElement(elementId, offset = 70) {
    const element = document.getElementById(elementId) || document.querySelector(elementId);
    if (element) {
      const elementPosition = element.offsetTop - offset;
      window.scrollTo({
        top: elementPosition,
        behavior: 'smooth'
      });
    }
  }

  // Enhanced navigation with smooth scrolling for anchor links
  document.addEventListener('click', function(e) {
    const target = e.target.closest('a[href^="#"]');
    if (target && target.getAttribute('href').length > 1) {
      e.preventDefault();
      const sectionId = target.getAttribute('href').substring(1);
      scrollToSection(sectionId);
    }
  });

  // Service details data mapping
  const serviceDetailsData = {
    'basic-obedience-training': {
      name: 'Basic Obedience Training',
      icon: 'üêï',
      description: 'Comprehensive basic obedience training for your dog to learn essential commands and behaviors. Our professional trainers use positive reinforcement techniques to help your pet become well-mannered and responsive.',
      features: [
        'Sit, stay, and come commands',
        'Leash walking without pulling',
        'Basic house manners',
        'Socialization skills',
        'Positive reinforcement methods',
        'One-on-one training sessions'
      ],
      pricing: {},
      process: [
        'Initial consultation and assessment',
        'Customized training plan development',
        'Hands-on training sessions',
        'Progress evaluation and adjustments',
        'Home practice guidance and support'
      ],
      duration: '45-60 minutes per session',
      requirements: 'Dogs aged 4 months and above, current on vaccinations'
    },
    'deworming': {
      name: 'Deworming Service',
      icon: 'üêç',
      description: 'Professional deworming treatment to protect your pet from internal parasites. Regular deworming is essential for maintaining your pet\'s health and preventing the spread of parasites to other pets and family members.',
      features: [
        'Safe and effective deworming medication',
        'Internal parasite prevention',
        'Consultation on parasite prevention',
        'Follow-up recommendations',
        'Pet-safe environment guidance'
      ],
      pricing: {},
      process: [
        'Pet health assessment',
        'Weight-based medication calculation',
        'Safe administration of dewormer',
        'Post-treatment monitoring',
        'Prevention schedule planning'
      ],
      duration: '15-20 minutes',
      requirements: 'No food restriction required, bring vaccination records'
    },
    'microchip': {
      name: 'Microchip Implanting',
      icon: 'üì∂',
      description: 'Permanent identification microchip implantation for your pet. Microchipping is the most reliable way to ensure your pet can be identified and returned to you if they ever get lost.',
      features: [
        'ISO standard microchip',
        'Lifetime identification',
        'Registered in national database',
        'Quick and painless procedure',
        'Transferable ownership records',
        'International travel compatibility'
      ],
      pricing: {},
      process: [
        'Pre-implantation health check',
        'Sterile microchip insertion',
        'Registration in database',
        'Ownership verification setup',
        'ID card and certificate provided'
      ],
      duration: '10-15 minutes',
      requirements: 'Pets must be at least 8 weeks old, no sedation required'
    },
    'vaccination': {
      name: 'Vaccination Service',
      icon: 'üíâ',
      description: 'Comprehensive vaccination program to protect your pet from common and serious diseases. Our vaccination schedules are tailored to your pet\'s age, lifestyle, and local disease risks.',
      features: [
        'Core vaccine administration',
        'Vaccination schedule planning',
        'Vaccine reaction monitoring',
        'Vaccination record keeping',
        'Booster shot reminders',
        'Health certificate issuance'
      ],
      pricing: {},
      process: [
        'Health examination before vaccination',
        'Appropriate vaccine selection',
        'Safe vaccine administration',
        'Post-vaccination monitoring',
        'Vaccination certificate provided'
      ],
      duration: '15-20 minutes',
      requirements: 'Pets must be healthy, current on deworming'
    },
    'pet-boarding': {
      name: 'Pet Boarding',
      icon: 'üè†',
      description: 'Safe and comfortable boarding facility for your pets when you\'re away. Our boarding service provides a home-like environment with 24/7 supervision and personalized care.',
      features: [
        'Climate-controlled environment',
        'Individual sleeping quarters',
        'Daily exercise and playtime',
        'Medication administration',
        'Regular updates to owners',
        'Emergency veterinary access'
      ],
      pricing: {},
      process: [
        'Pre-boarding health assessment',
        'Familiarization with environment',
        'Daily care routine establishment',
        'Regular photo/video updates',
        'Smooth transition home'
      ],
      duration: 'Flexible (daily rates)',
      requirements: 'Current vaccinations, reservation required, meet & greet recommended'
    },
    'parasite-prevention': {
      name: 'External Parasite Prevention',
      icon: 'ü¶á',
      description: 'Comprehensive external parasite prevention program including fleas, ticks, and mites. We offer various prevention methods tailored to your pet\'s lifestyle and environment.',
      features: [
        'Flea and tick prevention',
        'Topical treatments available',
        'Oral medications options',
        'Environmental control advice',
        'Regular prevention schedules',
        'Treatment effectiveness monitoring'
      ],
      pricing: {},
      process: [
        'Pet lifestyle assessment',
        'Appropriate product selection',
        'Safe application demonstration',
        'Effectiveness monitoring',
        'Reapplication schedule planning'
      ],
      duration: '20-25 minutes',
      requirements: 'Pets must be healthy, discuss current medications'
    },
    'euthanasia': {
      name: 'Euthanasia Service',
      icon: 'üïäÔ∏è',
      description: 'Compassionate end-of-life care when your pet is suffering from untreatable conditions. We provide gentle, painless euthanasia services with emotional support for pet owners.',
      features: [
        'Compassionate consultation',
        'Painless procedure',
        'Cremation arrangements',
        'Grief support resources',
        'Memorial options available',
        'Private consultation room'
      ],
      pricing: {},
      process: [
        'Compassionate consultation',
        'Decision-making support',
        'Gentle procedure explanation',
        'Peaceful farewell process',
        'Aftercare arrangements'
      ],
      duration: '30-45 minutes',
      requirements: 'Prior consultation required, bring medical records'
    },
    'general-checkup': {
      name: 'Comprehensive General Check-up',
      icon: 'üöë',
      description: 'Thorough physical examination and health assessment for your pet. Our comprehensive check-ups help detect potential health issues early and maintain your pet\'s optimal wellness.',
      features: [
        'Complete physical examination',
        'Weight and body condition assessment',
        'Dental health evaluation',
        'Parasite screening',
        'Vaccination status review',
        'Nutritional counseling'
      ],
      pricing: {},
      process: [
        'Detailed health history review',
        'Comprehensive physical exam',
        'Diagnostic recommendations',
        'Treatment plan development',
        'Preventive care planning'
      ],
      duration: '30-45 minutes',
      requirements: 'No preparation needed, bring medical history'
    },
    'grooming': {
      name: 'Professional Grooming',
      icon: '‚úÇÔ∏è',
      description: 'Full-service grooming to keep your pet looking and feeling their best. Our experienced groomers provide breed-specific styling and gentle handling for all pets.',
      features: [
        'Bath and blow dry',
        'Nail trimming and filing',
        'Ear cleaning',
        'Teeth brushing',
        'Breed-specific styling',
        'Gland expression (dogs)'
      ],
      pricing: {},
      process: [
        'Pre-grooming assessment',
        'Gentle bathing and conditioning',
        'Professional styling',
        'Nail and ear care',
        'Final inspection and photos'
      ],
      duration: '1-2 hours',
      requirements: 'Current vaccinations, no food 2 hours before'
    },
    'dental-surgery': {
      name: 'Dental Surgery',
      icon: 'ü¶∑',
      description: 'Advanced dental procedures including tooth extractions, oral surgery, and periodontal treatments. Our veterinary dentists provide specialized dental care for complex cases.',
      features: [
        'Dental X-rays available',
        'Tooth extraction procedures',
        'Periodontal surgery',
        'Oral tumor removal',
        'Fracture repair',
        'Post-operative care'
      ],
      pricing: {},
      process: [
        'Dental examination and X-rays',
        'Treatment plan development',
        'Pre-surgical preparation',
        'Surgical procedure',
        'Post-operative care instructions'
      ],
      duration: '1-3 hours',
      requirements: 'Pre-surgical blood work, fasting required'
    },
    'surgery': {
      name: 'General Surgery',
      icon: 'üè•',
      description: 'Comprehensive surgical services including spay/neuter, mass removals, and emergency procedures. Our surgical team provides safe, modern veterinary surgery with advanced monitoring.',
      features: [
        'Spay and neuter procedures',
        'Mass and tumor removal',
        'Abdominal surgery',
        'Orthopedic procedures',
        'Emergency surgery',
        'Advanced monitoring equipment'
      ],
      pricing: {},
      process: [
        'Pre-surgical consultation',
        'Pre-operative blood work',
        'Surgical procedure',
        'Recovery monitoring',
        'Post-operative care instructions'
      ],
      duration: '2-4 hours',
      requirements: 'Pre-surgical examination, fasting 12 hours'
    },
    'home-service': {
      name: 'Home Service by Appointment',
      icon: 'üè°',
      description: 'Convenient veterinary care in the comfort of your home. Our mobile veterinary service brings professional care directly to you, reducing stress for your pets.',
      features: [
        'Vaccinations at home',
        'Health examinations',
        'Minor procedures',
        'Euthanasia services',
        'Geriatric pet care',
        'Multiple pet discounts'
      ],
      pricing: {},
      process: [
        'Appointment scheduling',
        'Veterinarian home visit',
        'Complete service delivery',
        'Treatment documentation',
        'Follow-up care planning'
      ],
      duration: '45-90 minutes',
      requirements: 'Safe access to property, advance booking required'
    }
  };

  // Show service details function
  window.showServiceDetails = function(serviceId) {
    console.log('Showing service details for:', serviceId);

    // Get service data from our mapping
    const serviceData = serviceDetailsData[serviceId];

    if (!serviceData) {
      console.error('Service not found:', serviceId);
      toast('Service information not available.', 'error');
      return;
    }

    // Get modal elements
    const modal = document.getElementById('serviceDetailsModal');
    const iconElement = document.getElementById('serviceIconLarge');
    const titleElement = document.getElementById('serviceTitle');
    const descriptionElement = document.getElementById('serviceDescription');
    const featuresElement = document.getElementById('serviceFeaturesList');
    const pricingElement = document.getElementById('pricingInfo');
    const processElement = document.getElementById('processSteps');

    if (!modal || !iconElement || !titleElement) {
      console.error('Service modal elements not found');
      toast('Unable to display service details.', 'error');
      return;
    }

    // Populate modal content
    iconElement.textContent = serviceData.icon;
    titleElement.textContent = serviceData.name;

    // Set description
    descriptionElement.innerHTML = `<p>${serviceData.description}</p>`;

    // Set features list
    if (serviceData.features && featuresElement) {
      featuresElement.innerHTML = serviceData.features.map(feature =>
        `<li>${feature}</li>`
      ).join('');
    }


    // Set process information
    if (serviceData.process && processElement) {
      processElement.innerHTML = serviceData.process.map((step, index) =>
        `<p><strong>${index + 1}.</strong> ${step}</p>`
      ).join('');
    }

    // Show modal
    modal.style.display = 'flex';

    // Add smooth animation
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);

    console.log('Service details modal displayed successfully');
  };

  // Enhanced modal close function for service details
  window.closeModal = function(id) {
    const modal = document.getElementById(id);
    if (modal) {
      modal.classList.remove('show');
      modal.classList.add('hide');
      setTimeout(() => {
        modal.style.display = 'none';
        modal.classList.remove('hide');
      }, 300); // Match CSS transition time
    }
  };


  </script>
</body>
</html>
