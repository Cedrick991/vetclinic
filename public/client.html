<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard - Tattao Veterinary Clinic</title>
  <link rel="stylesheet" href="../assets/css/enhanced-style.css">
  <link rel="stylesheet" href="../assets/css/modern-dashboard.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <!-- SMTPJS for email sending -->
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="description" content="Client Dashboard - Tattao Veterinary Clinic Management System">
  <style>
    /* Global smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Product card styles */
    .product-card {
      background: linear-gradient(135deg, #2E5BAA 0%, #2E5BAA 100%);
      border: 2px solid #2E5BAA;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(46, 91, 170, 0.15);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(46, 91, 170, 0.25);
      border-color: #1E3F7A;
    }

    .product-card.in-stock {
      border-color: #4caf50;
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15);
    }

    .product-card.in-stock:hover {
      box-shadow: 0 12px 35px rgba(76, 175, 80, 0.25);
    }

    /* Product info styles */
    .product-info {
      text-align: center;
    }

    .product-name {
      font-size: 18px;
      font-weight: 700;
      color: #1976d2;
      margin-bottom: 8px;
      text-shadow: 0 1px 2px rgba(25, 118, 210, 0.1);
    }

    .product-category {
      font-size: 14px;
      color: #42a5f5;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .product-description {
      font-size: 13px;
      color: #546e7a;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .product-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px 0;
      border-top: 1px solid #e3f2fd;
    }

    .product-price {
      font-size: 24px;
      font-weight: 800;
      color: #2e7d32;
      text-shadow: 0 1px 2px rgba(46, 125, 50, 0.2);
    }

    .product-stock {
      text-align: right;
    }

    /* Stock badge styles */
    .stock-badge {
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stock-good {
      background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
      color: white;
    }

    .stock-low {
      background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
      color: white;
    }

    .stock-out {
      background: linear-gradient(135deg, #f44336 0%, #ef5350 100%);
      color: white;
    }

    /* Product actions */
    .product-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .action-btn {
      background: linear-gradient(135deg, #2196f3 0%, #42a5f5 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
      min-width: 120px;
      justify-content: center;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%);
    }

    .add-to-cart-btn {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      min-width: 140px;
      justify-content: center;
    }

    .add-to-cart-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
      background: linear-gradient(135deg, #45a049 0%, #4caf50 100%);
    }

    .add-to-cart-btn:disabled {
      background: linear-gradient(135deg, #90a4ae 0%, #b0bec5 100%);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .add-to-cart-btn i {
      font-size: 14px;
    }

    .action-btn:disabled {
      background: linear-gradient(135deg, #90a4ae 0%, #b0bec5 100%);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .action-btn.buy-now {
      background: linear-gradient(135deg, #ff5722 0%, #ff7043 100%);
      box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
    }

    .action-btn.buy-now:hover {
      background: linear-gradient(135deg, #e64a19 0%, #ff5722 100%);
      box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
    }

    .buy-now-btn {
      background: linear-gradient(135deg, #ff5722 0%, #ff7043 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
      min-width: 120px;
      justify-content: center;
    }

    .buy-now-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
      background: linear-gradient(135deg, #e64a19 0%, #ff5722 100%);
    }

    /* Enhanced pet card action button styling */
    .pet-card .action-btn {
      background: transparent;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      font-weight: 500;
      pointer-events: auto;
      z-index: 10;
      position: relative;
    }

    .pet-card .action-btn.edit {
      background: #3498db;
      color: white;
    }

    .pet-card .action-btn.delete {
      background: #e74c3c;
      color: white;
    }

    .pet-card .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Modal enhancements */
    .modal-content {
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      max-height: calc(90vh - 120px);
    }

    /* Custom scrollbar for webkit browsers */
    .modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }

    .modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Cart item animation */
    .cart-item {
      transition: all 0.3s ease;
    }

    /* Staff Management Styles */
    .staff-panel {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);
    }

    .staff-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .staff-header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .staff-header-right {
      display: flex;
      gap: 15px;
    }

    .home-btn-small {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .home-btn-small:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .add-product-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .add-product-btn:hover {
      background: #059669;
    }

    .manage-orders-btn {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .manage-orders-btn:hover {
      background: #6d28d9;
    }

    /* My Orders Modal Styles */
    .order-status-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .order-status-modal.show {
      display: flex !important;
    }

    .order-status-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .order-status-header {
      background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
      color: white;
      padding: 20px 25px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .order-status-header h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-order-status-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .close-order-status-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .order-status-body {
      padding: 25px;
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .order-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .order-card:hover {
      box-shadow: 0 5px 15px rgba(30, 64, 175, 0.1);
      transform: translateY(-2px);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }

    .order-info h4 {
      margin: 0 0 5px 0;
      color: #1e40af;
      font-size: 16px;
    }

    .order-info p {
      margin: 0;
      color: #64748b;
      font-size: 14px;
    }

    .order-status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending { background: #dbeafe; color: #1d4ed8; }
    .status-processing { background: #bfdbfe; color: #1e40af; }
    .status-shipped { background: #93c5fd; color: #1d4ed8; }
    .status-delivered { background: #60a5fa; color: #1e3a8a; }
    .status-cancelled { background: #fee2e2; color: #dc2626; }

    .order-items {
      margin-bottom: 15px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .item-name {
      font-weight: 500;
      color: #1e293b;
    }

    .item-quantity {
      color: #64748b;
      font-size: 14px;
    }

    .order-total {
      background: #1e40af;
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }

    .no-orders {
      text-align: center;
      padding: 40px 20px;
      color: #64748b;
    }

    .no-orders i {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
      color: #cbd5e1;
    }

    .no-orders p {
      margin: 0 0 5px 0;
      font-size: 16px;
    }

    .no-orders small {
      color: #94a3b8;
      font-size: 12px;
    }

    /* Floating Order Management Window Styles */
    .floating-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .floating-backdrop.show {
      display: block;
      opacity: 1;
    }

    .floating-order-window {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 900px;
      height: 80vh;
      max-height: 700px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      overflow: hidden;
    }

    .floating-order-window.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .floating-order-header {
      background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
      color: white;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 15px 15px 0 0;
    }

    .floating-header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .floating-order-count {
      font-size: 14px;
      opacity: 0.9;
    }

    .floating-close-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .floating-close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .floating-order-body {
      padding: 25px;
      height: calc(100% - 70px);
      overflow-y: auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .floating-orders-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: 100%;
      justify-content: center;
      align-items: center;
    }

    .view-orders-btn {
      background: #1e40af;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
      display: block;
      margin: 20px auto;
    }

    .view-orders-btn:hover {
      background: #1d4ed8;
    }

    /* Store Management Styles */
    .store-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .overview-card {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      border-radius: 15px;
      padding: 25px;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);
      transition: all 0.3s ease;
    }

    .overview-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(30, 64, 175, 0.4);
    }

    .overview-card .card-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .overview-card .card-label {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Staff Clickable Image Container */
    .product-image-container.staff-clickable {
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
    }

    .product-image-container.staff-clickable:hover {
      border: 3px solid #ffc107;
      background: rgba(255, 193, 7, 0.1);
    }

    .image-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
      padding: 8px;
      font-size: 12px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .product-image-container.staff-clickable:hover .image-overlay {
      opacity: 1;
    }

    .image-overlay i {
      margin-right: 5px;
    }

    /* Staff Product Management Buttons */
    .edit-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .edit-btn:hover {
      background: #2980b9;
    }

    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .delete-btn:hover {
      background: #c0392b;
    }

    /* Store Section Styles - Blue Theme */
    .cart-count {
      background: #ef4444;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 10px;
      margin-left: 8px;
      min-width: 18px;
      min-height: 18px;
      text-align: center;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
    }

    /* Cart Dropdown */
    .cart-dropdown {
      position: fixed;
      top: 70px;
      right: 20px;
      width: 350px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      border: 1px solid #e2e8f0;
    }

    .cart-dropdown-content {
      padding: 0;
    }

    .cart-dropdown-header {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      padding: 15px 20px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-dropdown-header h3 {
      margin: 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .close-cart-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .close-cart-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .cart-dropdown-items {
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
    }

    .empty-cart-message {
      text-align: center;
      padding: 30px 15px;
      color: #64748b;
    }

    .empty-cart-message i {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
      color: #cbd5e1;
    }

    .empty-cart-message p {
      margin: 0 0 5px 0;
      font-size: 16px;
    }

    .empty-cart-message small {
      color: #94a3b8;
      font-size: 12px;
    }

    .cart-items-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .cart-item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .item-details h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      color: #1e3a8a;
    }

    .item-details p {
      margin: 0;
      font-size: 12px;
      color: #1e40af;
    }

    .item-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      background: #3b82f6;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .qty-btn:hover {
      background: #1e40af;
    }

    .quantity {
      min-width: 20px;
      text-align: center;
      font-weight: bold;
      color: #1e40af;
    }

    .remove-btn {
      background: #ef4444;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .remove-btn:hover {
      background: #dc2626;
    }

    .cart-dropdown-footer {
      padding: 15px;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
      border-radius: 0 0 12px 12px;
    }

    .cart-total {
      text-align: center;
      margin-bottom: 15px;
    }

    .cart-total span {
      font-size: 18px;
      font-weight: bold;
      color: #1e40af;
    }

    .cart-actions {
      display: flex;
      gap: 10px;
    }

    .continue-shopping-btn {
      background: #6b7280;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .continue-shopping-btn:hover {
      background: #4b5563;
    }

    .checkout-btn {
      background: #1e40af;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .checkout-btn:hover {
      background: #1d4ed8;
    }

    /* Login Required Styles */
    .login-required {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(135deg, #fef7ff 0%, #f0f4ff 100%);
      border-radius: 15px;
      margin: 40px auto;
      max-width: 600px;
      border: 2px solid #e2e8f0;
      box-shadow: 0 10px 30px rgba(30, 64, 175, 0.1);
    }

    .login-icon {
      font-size: 48px;
      margin-bottom: 20px;
      display: block;
    }

    .login-prompt h3 {
      color: #1e40af;
      margin-bottom: 15px;
      font-size: 24px;
    }

    .login-prompt p {
      color: #64748b;
      margin-bottom: 15px;
      line-height: 1.6;
    }

    .login-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .login-btn {
      background: #1e40af;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }

    .login-btn:hover {
      background: #1d4ed8;
    }

    .back-btn {
      background: #6b7280;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: #4b5563;
    }

    /* Category Tabs */
    .category-tabs {
      background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 100%);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(30, 64, 175, 0.2);
      display: flex;
      gap: 15px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .category-tab {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      border: 2px solid rgba(30, 64, 175, 0.3);
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .category-tab:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .category-tab.active {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
    }

    /* Products Section */
    .products-section {
      background: transparent;
      padding: 60px 20px;
    }

    .products-section h2 {
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 40px;
      position: relative;
    }

    .products-section h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 100%);
      border-radius: 2px;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .product-card {
      background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 100%);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.1);
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(30, 64, 175, 0.2);
      border-color: #3b82f6;
    }

    .product-image-container {
      height: 200px;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0;
    }

    .product-image-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #3b82f6;
      position: absolute;
      top: 0;
      left: 0;
    }

    .product-info {
      padding: 20px;
    }

    .product-name {
      font-size: 18px;
      font-weight: 600;
      color: #1e3a8a;
      margin-bottom: 8px;
    }

    .product-category {
      color: #3b82f6;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .product-description {
      color: #1e3a8a;
      font-size: 13px;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .product-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .product-price {
      font-size: 20px;
      font-weight: 700;
      color: #10b981;
    }

    .product-stock {
      font-size: 12px;
      color: #1e3a8a;
    }

    .stock-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .stock-good {
      background: #d1fae5;
      color: #059669;
    }

    .stock-low {
      background: #fef3c7;
      color: #d97706;
    }

    .stock-out {
      background: #fee2e2;
      color: #dc2626;
    }

    .product-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .add-to-cart-btn {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-to-cart-btn:hover {
      background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
    }

    .add-to-cart-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    /* Staff Management Styles */
    .staff-panel {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);
    }

    .staff-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .staff-header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .staff-header-right {
      display: flex;
      gap: 15px;
    }

    .home-btn-small {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .home-btn-small:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .add-product-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .add-product-btn:hover {
      background: #059669;
    }

    .manage-orders-btn {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .manage-orders-btn:hover {
      background: #6d28d9;
    }

    /* Store Overview */
    .store-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .overview-card {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      border-radius: 15px;
      padding: 25px;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);
      transition: all 0.3s ease;
    }

    .overview-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(30, 64, 175, 0.4);
    }

    .overview-card .card-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .overview-card .card-label {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Staff Clickable Image Container */
    .product-image-container.staff-clickable {
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
    }

    .product-image-container.staff-clickable:hover {
      border: 3px solid #ffc107;
      background: rgba(255, 193, 7, 0.1);
    }

    .image-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
      padding: 8px;
      font-size: 12px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .product-image-container.staff-clickable:hover .image-overlay {
      opacity: 1;
    }

    .image-overlay i {
      margin-right: 5px;
    }

    /* Staff Product Management Buttons */
    .edit-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .edit-btn:hover {
      background: #2980b9;
    }

    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .delete-btn:hover {
      background: #c0392b;
    }

    /* My Orders Modal */
    .order-status-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .order-status-modal.show {
      display: flex;
    }

    .order-status-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .order-status-header {
      background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
      color: white;
      padding: 20px 25px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .order-status-header h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-order-status-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .close-order-status-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .order-status-body {
      padding: 25px;
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .order-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .order-card:hover {
      box-shadow: 0 5px 15px rgba(30, 64, 175, 0.1);
      transform: translateY(-2px);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }

    .order-info h4 {
      margin: 0 0 5px 0;
      color: #1e40af;
      font-size: 16px;
    }

    .order-info p {
      margin: 0;
      color: #64748b;
      font-size: 14px;
    }

    .order-status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending { background: #dbeafe; color: #1d4ed8; }
    .status-processing { background: #bfdbfe; color: #1e40af; }
    .status-shipped { background: #93c5fd; color: #1d4ed8; }
    .status-delivered { background: #60a5fa; color: #1e3a8a; }
    .status-cancelled { background: #fee2e2; color: #dc2626; }

    .order-items {
      margin-bottom: 15px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .item-name {
      font-weight: 500;
      color: #1e293b;
    }

    .item-quantity {
      color: #64748b;
      font-size: 14px;
    }

    .order-total {
      background: #1e40af;
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }

    .no-orders {
      text-align: center;
      padding: 40px 20px;
      color: #64748b;
    }

    .no-orders i {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
      color: #cbd5e1;
    }

    .no-orders p {
      margin: 0 0 5px 0;
      font-size: 16px;
    }

    .no-orders small {
      color: #94a3b8;
      font-size: 12px;
    }

    /* Login Prompt Modal */
    .login-prompt-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .login-prompt-modal.show {
      display: flex;
    }

    .login-prompt-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
      position: relative;
    }

    .login-prompt-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 24px;
      color: #6b7280;
      cursor: pointer;
      background: none;
      border: none;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .login-prompt-close:hover {
      background: #f3f4f6;
      color: #374151;
    }

    .login-prompt-content h3 {
      color: #1e40af;
      margin: 0 0 15px 0;
      font-size: 20px;
    }

    .login-prompt-content p {
      color: #64748b;
      margin: 0 0 25px 0;
      line-height: 1.5;
    }

    .login-prompt-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .login-prompt-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .login-prompt-btn-primary {
      background: #1e40af;
      color: white;
    }

    .login-prompt-btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }

    .login-prompt-btn-secondary {
      background: #6b7280;
      color: white;
    }

    .login-prompt-btn-secondary:hover {
      background: #4b5563;
    }

    /* Buy Now Modal */
    .buy-now-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .buy-now-modal.show {
      display: flex;
    }

    .buy-now-modal .buy-now-content {
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .buy-now-modal .modal-header {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 20px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .buy-now-modal .modal-header h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .buy-now-modal .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 25px;
    }

    .buy-now-modal .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
      border-radius: 0 0 12px 12px;
      display: flex;
      justify-content: flex-end;
      gap: 15px;
    }

    .order-summary {
      background: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      border: 1px solid #e2e8f0;
    }

    .order-summary h4 {
      color: #1e40af;
      margin: 0 0 15px 0;
      font-size: 16px;
    }

    .summary-items {
      margin-bottom: 15px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .summary-item:last-child {
      border-bottom: none;
    }

    .item-info h5 {
      margin: 0 0 4px 0;
      color: #1e293b;
      font-size: 14px;
    }

    .item-info p {
      margin: 0;
      color: #64748b;
      font-size: 12px;
    }

    .item-subtotal {
      font-weight: bold;
      color: #1e40af;
    }

    .summary-total {
      border-top: 2px solid #e2e8f0;
      padding-top: 15px;
      margin-top: 15px;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .final-total {
      font-size: 18px;
      color: #1e40af;
    }

    .payment-section {
      background: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      border: 1px solid #e2e8f0;
    }

    .payment-section h4 {
      color: #1e40af;
      margin: 0 0 15px 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .payment-option {
      display: flex;
      align-items: center;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }

    .payment-option:hover {
      border-color: #3b82f6;
      background: #f0f4ff;
    }

    .payment-option:has(input:checked) {
      border-color: #3b82f6;
      background: #f0f4ff;
    }

    .payment-option input[type="radio"] {
      margin-right: 12px;
      width: 16px;
      height: 16px;
    }

    .payment-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .payment-info i {
      font-size: 20px;
      color: #3b82f6;
      width: 30px;
      text-align: center;
    }

    .payment-name {
      font-weight: bold;
      color: #1e293b;
      font-size: 14px;
    }

    .payment-desc {
      color: #64748b;
      font-size: 12px;
    }

    .order-notes {
      background: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }

    .order-notes h4 {
      color: #1e40af;
      margin: 0 0 15px 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .order-notes textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .order-notes textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Toast notification mobile positioning */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #2E5BAA, #1E3F7A);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      font-size: 14px;
      font-weight: 500;
      max-width: calc(100vw - 40px);
      word-wrap: break-word;
      display: none;
      animation: slideUp 0.4s ease-out;
    }

    .toast.show {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast.success {
      background: linear-gradient(135deg, #28a745, #20c997);
    }

    .toast.error {
      background: linear-gradient(135deg, #dc3545, #c82333);
    }

    .toast.warning {
      background: linear-gradient(135deg, #ffc107, #fd7e14);
    }

    .toast.info {
      background: linear-gradient(135deg, #17a2b8, #138496);
    }

    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    /* Mobile toast adjustments */
    @media (max-width: 768px) {
      .toast {
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        max-width: calc(100vw - 30px);
        padding: 12px 20px;
        font-size: 13px;
        border-radius: 10px;
      }

      .toast.show {
        display: flex;
        align-items: center;
        gap: 8px;
      }
    }

    @media (max-width: 480px) {
      .toast {
        bottom: 10px;
        padding: 10px 15px;
        font-size: 12px;
        max-width: calc(100vw - 20px);
      }

      .toast.show {
        gap: 6px;
      }
    }

    /* Mobile responsive modal */
    @media (max-width: 768px) {
      .modal-content {
        max-height: 95vh;
        margin: 2.5vh 10px;
        border-radius: 12px;
      }

      .modal-body {
        max-height: calc(95vh - 140px);
        padding: 16px;
      }

      .form-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }

    /* Ensure pet cards are properly interactive */
    .pet-card {
      pointer-events: auto;
      position: relative;
      z-index: 1;
    }

    .pet-card * {
      pointer-events: auto;
    }

    .pet-card .pet-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 16px;
      pointer-events: auto;
    }

    .pet-card .pet-actions .action-btn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #ffffff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      font-weight: 500;
      min-width: 60px;
      justify-content: center;
    }

    .pet-card .pet-actions .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    .pet-card .pet-actions .action-btn.edit {
      background: rgba(52, 152, 219, 0.2);
      border-color: #3498db;
    }

    .pet-card .pet-actions .action-btn.edit:hover {
      background: rgba(52, 152, 219, 0.3);
    }

    .pet-card .pet-actions .action-btn.delete {
      background: rgba(231, 76, 60, 0.2);
      border-color: #e74c3c;
    }

    .pet-card .pet-actions .action-btn.delete:hover {
      background: rgba(231, 76, 60, 0.3);
    }

    /* Notification Badge for Mobile Menu Toggle */
    .mobile-menu-toggle {
      position: relative;
    }

    .mobile-menu-toggle .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      animation: pulse 2s infinite;
      z-index: 10;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
    }

    /* Pulse animation for Book New button highlight */
    @keyframes highlightPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        transform: scale(1.05);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }

    /* Pulse animation for Book New button highlight */
    @keyframes highlightPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        transform: scale(1.05);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }

    /* Product image container styles */
    .product-image {
      position: relative;
      width: 100%;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid #2196f3;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
      display: block;
      border-radius: 10px;
    }

    .product-image-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      color: #1976d2;
      font-size: 48px;
      z-index: 1;
      border-radius: 10px;
    }

    /* Category tab hover effects */
    .category-tab:hover {
      background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%) !important;
      color: white !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3) !important;
    }

    .category-tab.active:hover {
      background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%) !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4) !important;
    }

    /* Products grid container */
    .products-grid {
      padding: 10px;
      background: linear-gradient(135deg, #300d89 0%, #300d89 100%);
      border-radius: 15px;
      border: 1px solid rgba(33, 150, 243, 0.1);
    }

    /* Loading spinner animation */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Overview card hover effects */
    .overview-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .overview-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    /* Status badge styling for client appointments */
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending {
      background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      color: white;
    }

    .status-confirmed {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .status-in-progress {
      background: linear-gradient(135deg, #17a2b8 0%, #007bff 100%);
      color: white;
    }

    .status-completed {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .status-cancelled {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
    }

    .status-requested {
      background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
      color: white;
    }

    .status-text {
      color: #6c757d;
      font-size: 12px;
      font-style: italic;
    }

    /* Medical Report Styles */
    .medical-report-container {
      max-width: 100%;
    }

    .report-section {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #667eea;
    }

    .report-section h3 {
      color: #333;
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .report-section h3 i {
      color: #667eea;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .info-item {
      display: flex;
      gap: 8px;
      padding: 8px 0;
    }

    .info-item .label {
      font-weight: 600;
      color: #555;
      min-width: 80px;
    }

    .info-item .value {
      color: #333;
    }

    .medical-record {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border: 2px solid #667eea;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .record-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(102, 126, 234, 0.2);
    }

    .record-header h4 {
      margin: 0 0 8px 0;
      color: #667eea;
      font-size: 16px;
    }

    .record-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #666;
    }

    .record-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .record-details {
      display: grid;
      gap: 12px;
    }

    .detail-item {
      background: #ffffff;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }

    .detail-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .detail-content {
      color: #555;
      line-height: 1.4;
    }

    .records-count {
      text-align: center;
      margin-bottom: 20px;
    }

    .badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border: 2px dashed rgba(102, 126, 234, 0.3);
    }

    .empty-state i {
      font-size: 48px;
      color: rgba(102, 126, 234, 0.3);
      margin-bottom: 16px;
    }

    .empty-state h4 {
      margin: 0 0 8px 0;
      color: #667eea;
      font-size: 18px;
    }

    .empty-state p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    .no-history {
      border-left-color: #ffc107;
    }

    .no-history h3 i {
      color: #ffc107;
    }

    /* Smooth transitions for content sections */
    .content-section {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .content-section.hidden {
      opacity: 0;
      transform: translateY(20px);
      display: none;
    }

    /* Enhanced navigation link styling */
    .nav-item {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .nav-item:hover::before {
      left: 100%;
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      border-left: 3px solid #ffd700;
      animation: activeNavPulse 0.6s ease;
    }

    @keyframes activeNavPulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
      70% { box-shadow: 0 0 0 8px rgba(255, 215, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }

    /* Settings Tabbed Interface Styling */
    .settings-tabs {
      background: transparent;
      border-radius: 12px 12px 0 0;
      padding: 0;
      margin-bottom: 0;
      display: flex;
      overflow: visible;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
    }

    .settings-tab {
      background: #08355f;
      color: #ffffff;
      border: none;
      padding: 15px 25px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 0;
      margin: 0;
      flex: 1;
      min-width: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
    }

    .settings-tab:first-child {
      border-radius: 12px 0 0 0;
    }

    .settings-tab:last-child {
      border-radius: 0 12px 0 0;
    }

    .settings-tab:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .settings-tab.active {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
      border-radius: 12px 12px 0 0;
    }



    .settings-content-container {
      background: #08355f;
      border-radius: 0 0 12px 12px;
      padding: 0;
      min-height: 400px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .settings-content {
      padding: 30px;
      display: none;
    }

    .settings-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .settings-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 100%;
    }

    .settings-card .card-header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .settings-card .card-header h3 {
      color: #ffffff;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Enhanced responsive design for client dashboard with multiple breakpoints */
    /* Large tablets and small desktops */
    @media (max-width: 1024px) and (min-width: 769px) {
      .header-bar {
        padding: 12px 20px;
        height: 65px;
      }

      .header-title h1 {
        font-size: 17px;
      }

      .search-container input {
        width: 250px;
        padding: 8px 12px;
      }

      .left-group {
        gap: 15px;
      }

      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 18px;
      }
    }

    /* Tablets */
    @media (max-width: 900px) and (min-width: 769px) {
      .header-content {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }

      .left-group {
        width: 100%;
        justify-content: space-between;
      }

      .search-container input {
        width: 200px;
      }

      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
    }

    /* Mobile and small tablets */
    @media (max-width: 768px) {
      /* Client container adjustments */
      .client-container {
        display: flex;
        flex-direction: column;
      }

      /* Sidebar mobile behavior */
      .sidebar {
        position: fixed;
        top: 130px;
        left: -280px;
        width: 280px;
        height: calc(100vh - 130px);
        z-index: 1000;
        transition: left 0.3s ease;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      }

      .sidebar.mobile-open {
        left: 0;
      }

      /* Main content full width on mobile */
      .main-content {
        width: 100%;
        margin-left: 0;
        padding: 130px 0 0 0;
      }

      /* Header adjustments for mobile */
      .header-bar {
        padding: 10px 15px;
        height: auto;
        min-height: 60px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
      }

      .header-content {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
        width: 100%;
      }

      .left-group {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
        width: 100%;
      }

      .header-title {
        order: 1;
        text-align: center;
      }

      .header-title h1 {
        font-size: 16px;
        text-align: center;
        margin: 0;
      }

      .search-container {
        order: 2;
        width: 100%;
        position: static;
        margin: 0;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 0;
        display: flex;
        align-items: center;
      }

      .search-container i {
        position: static;
        padding: 0 10px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 16px;
        transform: none;
      }

      .search-container input {
        flex: 1;
        padding: 10px 15px 10px 0;
        font-size: 14px;
        background: transparent;
        border: none;
        color: #ffffff;
        outline: none;
      }

      .search-container input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .home-btn {
        order: 3;
        width: 100% !important;
        display: flex !important;
        padding: 10px 16px;
        font-size: 14px;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #ffffff;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .home-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Mobile menu toggle button */
      .mobile-menu-toggle {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
      }

      .mobile-menu-toggle:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Dashboard content padding */
      .dashboard-content {
        padding: 15px;
      }

      /* Section headers mobile */
      .section-header {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
      }

      .section-header .header-btn {
        width: 100%;
        justify-content: center;
      }

      /* Cards and grids mobile */
      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .dashboard-card {
        padding: 20px;
      }

      /* Tables mobile responsive */
      .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .data-table {
        min-width: 600px;
      }

      .data-table th,
      .data-table td {
        padding: 12px 8px;
        font-size: 14px;
      }

      /* Navigation items mobile */
      .nav-item {
        padding: 15px 20px;
        font-size: 14px;
      }

      .nav-item i {
        margin-right: 10px;
        width: 20px;
      }

      /* Overlay for mobile menu */
      .mobile-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }

      .mobile-overlay.active {
        display: block;
      }

      /* Ensure content doesn't scroll when sidebar is open */
      body.sidebar-open {
        overflow: hidden;
      }

      /* Button adjustments */
      .btn-primary, .btn-secondary, .header-btn {
        padding: 12px 20px;
        font-size: 14px;
      }

      /* Settings tabs mobile */
      .settings-tabs {
        flex-direction: column;
        border-radius: 12px;
      }

      .settings-tab {
        border-radius: 0;
        margin: 0;
        padding: 12px 20px;
      }

      .settings-tab:first-child {
        border-radius: 12px 12px 0 0;
      }

      .settings-tab:last-child {
        border-radius: 0 0 12px 12px;
      }

      .settings-content-container {
        border-radius: 12px;
        margin-top: 10px;
      }

      .settings-content {
        padding: 20px;
      }
    }

    /* Small tablets */
    @media (max-width: 640px) and (min-width: 481px) {
      .header-bar {
        padding: 8px 12px;
        height: 55px;
      }

      .header-title h1 {
        font-size: 15px;
      }

      .search-container input {
        padding: 6px 10px;
        font-size: 13px;
      }

      .home-btn {
        padding: 6px 12px;
        font-size: 11px;
      }

      .dashboard-content {
        padding: 12px;
      }

      .dashboard-grid {
        gap: 12px;
      }

      .dashboard-card {
        padding: 18px;
      }
    }

    /* Extra small screens */
    @media (max-width: 480px) {
      .dashboard-content {
        padding: 10px;
      }

      .section-header h2 {
        font-size: 18px;
      }

      .dashboard-card {
        padding: 15px;
      }

      .card-value {
        font-size: 24px;
      }

      .card-subtitle {
        font-size: 12px;
      }

      .data-table th,
      .data-table td {
        padding: 8px 6px;
        font-size: 12px;
      }

      .nav-item {
        padding: 12px 15px;
        font-size: 13px;
      }

      .sidebar {
        top: 90px;
        width: 100vw;
        left: -100vw;
      }

      .sidebar.mobile-open {
        left: 0;
      }

      .mobile-menu-toggle {
        width: 35px;
        height: 35px;
        font-size: 16px;
      }

      .header-bar {
        padding: 8px 12px;
        min-height: 55px;
      }

      .main-content {
        padding: 90px 0 0 0;
      }

      .header-title h1 {
        font-size: 14px;
      }

      .search-container {
        border-radius: 6px;
      }

      .search-container i {
        padding: 0 8px;
        font-size: 14px;
      }

      .search-container input {
        padding: 8px 12px 8px 0;
        font-size: 13px;
      }

      .home-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
   </head>
<body>
  <!-- Client Dashboard Container -->
  <div class="client-container">
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="profile-picture-container">
          <img src="../assets/images/logoo.jpg" alt="Profile" id="clientAvatar">
          <div class="profile-picture-overlay">
            <i class="fas fa-camera"></i>
            <input type="file" id="sidebarProfileInput" accept="image/*" style="display: none;">
          </div>
        </div>
        <h3 id="clientName">John Cedrick Unida</h3>
        <p id="clientEmail">Loading...</p>
      </div>
      
      <div class="sidebar-nav">
        <a href="#dashboard" class="nav-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
        </a>
        <a href="#appointments" class="nav-item" data-section="appointments">
          <i class="fas fa-calendar-alt"></i> <span>My Appointments</span>
        </a>
        <a href="#pets" class="nav-item" data-section="pets">
          <i class="fas fa-paw"></i> <span>My Pets</span>
        </a>
        <a href="#store" class="nav-item" data-section="store">
          <i class="fas fa-store"></i> <span>Pet Store</span>
        </a>
        <a href="#reports" class="nav-item" data-section="reports">
          <i class="fas fa-file-pdf"></i> <span>Pet Reports</span>
        </a>
        <a href="#settings" class="nav-item" data-section="settings">
          <i class="fas fa-cog"></i> <span>Settings</span>
        </a>
        <a href="#" class="nav-item" data-section="logout" onclick="handleLogout()">
          <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
        </a>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">

      <!-- Header Bar -->
      <header class="header-bar">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="clientMobileMenuToggle" onclick="toggleClientMobileSidebar()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="header-content" style="display: flex; justify-content: flex-start; align-items: center; width: 100%;">

          <!-- Left Group with Title, Search, Cart, and Back Button -->
          <div class="left-group" style="display: flex; align-items: center; gap: 20px;">
            <!-- Title -->
            <div class="header-title">
              <h1 id="pageTitle" style="color: #ffffff; font-size: 18px; margin: 0; font-weight: 600;"><i class="fas fa-paw" style="color: #ffffff; margin-right: 8px;"></i> Welcome to Your Dashboard</h1>
            </div>

            <!-- Search Container -->
            <div class="search-container">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Search for pet products, services..." />
            </div>


            <!-- Back to Home Button -->
            <button class="home-btn" onclick="window.location.href='../index.html'" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 8px 16px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px;">
              <i class="fas fa-home"></i> Back to Home
            </button>
          </div>
        </div>
     </header>

      <!-- Dashboard Content -->
      <div class="dashboard-content">
        
        <!-- Welcome Section -->
        <div class="welcome-section">
          <h2 class="welcome-title">
            <i class="fas fa-paw"></i> Welcome to Your Dashboard
          </h2>
          <p class="welcome-subtitle">Manage your pets, appointments, and more from one place</p>

        <!-- Dashboard Section -->
        <section id="dashboardSection" class="content-section" style="display: block;">
          <div class="section-header" style="margin-bottom: 20px;">
            <h2 class="section-title" style="color: #ffffff; font-size: 20px; margin: 0; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-tachometer-alt" style="color: #ffffff;"></i> Dashboard Overview
            </h2>
          </div>

          <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div class="dashboard-card" id="upcomingAppointments" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-calendar-alt" style="color: #ffffff; font-size: 16px;"></i> Upcoming Appointments
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="upcomingAppointmentsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Scheduled appointments</div>
            </div>

            <div class="dashboard-card" id="clientPets" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-paw" style="color: #ffffff; font-size: 16px;"></i> My Pets
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="clientPetsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Registered pets</div>
            </div>

            <div class="dashboard-card" id="cartItems" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-shopping-cart" style="color: #ffffff; font-size: 16px;"></i> Cart Items
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="cartItemsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Items in cart</div>
            </div>

            <div class="dashboard-card" id="completedVisits" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-check-circle" style="color: #ffffff; font-size: 16px;"></i> Completed Visits
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="completedVisitsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Total completed</div>
            </div>
          </div>
        </section>
        
        <!-- Appointments Section -->
        <section id="appointmentsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-calendar-alt"></i> My Appointments
            </h2>
            <button class="header-btn" onclick="clientDashboard.showBookingModal()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
              <i class="fas fa-plus"></i> Book New
            </button>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Pet</th>
                  <th>Service</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="appointmentsTableBody">
                <tr>
                  <td colspan="6" class="loading">
                    <div class="spinner"></div>
                    Loading appointments...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section id="petsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-paw"></i> My Pets
            </h2>
            <button class="header-btn" onclick="showAddPetModal()">
              <i class="fas fa-plus"></i> Add Pet
            </button>
          </div>
          <div id="petsGrid" class="pets-grid">
            <div class="loading">
              <div class="spinner"></div>
              Loading pets...
            </div>
          </div>
        </section>


        <!-- Add Pet Modal for Client - Simplified -->
        <div id="clientAddPetModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <h3 style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-paw" style="color: #9BA9FF; font-size: 1.5rem;"></i>
                Add New Pet
              </h3>
              <span class="close" onclick="closeClientAddPetModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
              <form id="clientAddPetForm">
                <!-- Pet Name and Species Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
                    <input type="text" id="clientAddPetName" name="pet_name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter pet name">
                  </div>
                  <div class="form-group">
                    <label for="clientPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
                    <select id="clientAddPetSpecies" name="species" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Species</option>
                      <option value="Dog"> Dog</option>
                      <option value="Cat"> Cat</option>
                      <option value="Bird"> Bird</option>
                      <option value="Rabbit"> Rabbit</option>
                      <option value="Other"> Other</option>
                    </select>
                  </div>
                </div>

                <!-- Breed and Birthdate Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
                    <input type="text" id="clientAddPetBreed" name="breed" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter breed (optional)">
                  </div>
                  <div class="form-group">
                    <label for="clientAddPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
                    <input type="date" id="clientAddPetBirthdate" name="birthdate" max="${new Date().toISOString().split('T')[0]}" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>

                <!-- Gender and Weight Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
                    <select id="clientAddPetGender" name="gender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Gender</option>
                      <option value="Male"> Male</option>
                      <option value="Female"> Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="clientAddPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
                    <input type="number" id="clientAddPetWeight" name="weight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>

                <!-- Color and Profile Image Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
                    <input type="text" id="clientAddPetColor" name="color" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter color (optional)">
                  </div>
                  <div class="form-group">
                    <label for="clientAddPetImage" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Profile Picture</label>
                    <input type="file" id="clientAddPetImage" name="profile_image" accept="image/*" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
                  <button type="button" class="btn-secondary" onclick="closeClientAddPetModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">CANCEL</button>
                  <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                    <i class="fas fa-plus" style="margin-right: 8px;"></i> ADD PET
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>




        <!-- Store Section -->
        <section id="storeSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title" style="color: #ffffff; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-store" style="color: #ffffff;"></i> Pet Store
            </h2>
            <div style="display: flex; gap: 10px;">
              <button class="header-btn" onclick="toggleCartDropdown()" style="background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onmouseover="this.style.background='linear-gradient(135deg, #1d4ed8, #1e40af)'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='linear-gradient(135deg, #2563eb, #1d4ed8)'; this.style.transform='translateY(0)'">
                <i class="fas fa-shopping-cart"></i> Cart <span id="cartCount" class="cart-count">0</span>
              </button>
              <button class="header-btn" onclick="loadProducts()" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onmouseover="this.style.background='linear-gradient(135deg, #2563eb, #1d4ed8)'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='linear-gradient(135deg, #3b82f6, #2563eb)'; this.style.transform='translateY(0)'">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="header-btn" onclick="console.log('Button clicked!'); showOrderStatus()" title="View My Orders" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onmouseover="this.style.background='linear-gradient(135deg, #764ba2, #667eea)'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='linear-gradient(135deg, #667eea, #764ba2)'; this.style.transform='translateY(0)'">
                <i class="fas fa-shopping-bag"></i> My Orders <span id="orderStatusCount" class="cart-count">0</span>
              </button>
            </div>
          </div>

          <!-- Cart Dropdown -->
          <div id="cartDropdown" class="cart-dropdown" style="display: none; position: absolute; top: 70px; right: 20px; width: 350px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); z-index: 1000; border: 1px solid #e2e8f0;">
            <div class="cart-dropdown-content">
              <div class="cart-dropdown-header" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 15px 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 16px; display: flex; align-items: center; gap: 8px;"><i class="fas fa-shopping-cart"></i> Shopping Cart</h3>
                <button onclick="closeCartDropdown()" class="close-cart-btn" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; transition: background 0.3s;"></button>
              </div>
              <div id="cartDropdownItems" class="cart-dropdown-items" style="padding: 15px; max-height: 300px; overflow-y: auto;">
                <div class="empty-cart-message" style="text-align: center; padding: 30px 15px; color: #64748b;">
                  <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px; display: block; color: #cbd5e1;"></i>
                  <p style="margin: 0 0 5px 0; font-size: 16px;">Your cart is empty</p>
                  <small style="color: #94a3b8; font-size: 12px;">Add some products to your cart to see them here!</small>
                </div>
              </div>
              <div id="cartDropdownFooter" class="cart-dropdown-footer" style="display: none; padding: 15px; border-top: 1px solid #e2e8f0; background: #f8fafc; border-radius: 0 0 12px 12px;">
                <div class="cart-total" style="text-align: center; margin-bottom: 15px;">
                  <span style="font-size: 18px; font-weight: bold; color: #1e40af;">Total: <span id="cartDropdownTotal">0.00</span></span>
                </div>
                <div class="cart-actions" style="display: flex; gap: 10px;">
                  <button onclick="closeCartDropdown()" class="continue-shopping-btn" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: background 0.3s;">Continue Shopping</button>
                  <button onclick="proceedToCheckout()" class="checkout-btn" style="background: #1e40af; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; transition: background 0.3s;">Checkout</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Login Required Message -->
          <div id="loginRequired" class="login-required" style="display: none; text-align: center; padding: 60px 20px; background: linear-gradient(135deg, #fef7ff 0%, #f0f4ff 100%); border-radius: 15px; margin: 40px auto; max-width: 600px; border: 2px solid #e2e8f0; box-shadow: 0 10px 30px rgba(30, 64, 175, 0.1);">
            <div class="login-icon" style="font-size: 48px; margin-bottom: 20px; display: block;"></div>
            <h3 style="color: #1e40af; margin-bottom: 15px; font-size: 24px;">Login Required</h3>
            <p style="color: #64748b; margin-bottom: 15px; line-height: 1.6;">You need to be logged in to browse and purchase our products.</p>
            <p style="color: #64748b; margin-bottom: 25px; line-height: 1.6;">Login as a client to start shopping, or as staff to manage products.</p>
            <div class="login-actions" style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
              <button onclick="redirectToLogin()" class="login-btn" style="background: #1e40af; color: white; border: none; padding: 12px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background 0.3s;">Login to Shop</button>
              <button onclick="goBackToHomepage()" class="back-btn" style="background: #6b7280; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: background 0.3s;">Back to Homepage</button>
            </div>
          </div>

          <!-- Category Filter Tabs -->
          <div id="categoryTabs" class="category-tabs" style="display: none; background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 100%); border-radius: 15px; padding: 20px; margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(30, 64, 175, 0.2); display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;">
            <button class="category-tab active" onclick="filterCategory('all')" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: 2px solid rgba(30, 64, 175, 0.3); padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
              <i class="fas fa-th-large"></i> All Products
            </button>
            <button class="category-tab" onclick="filterCategory('food')" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: 2px solid rgba(30, 64, 175, 0.3); padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
              <i class="fas fa-utensils"></i> Food
            </button>
            <button class="category-tab" onclick="filterCategory('grooming')" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: 2px solid rgba(30, 64, 175, 0.3); padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
              <i class="fas fa-bath"></i> Grooming
            </button>
            <button class="category-tab" onclick="filterCategory('accessories')" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: 2px solid rgba(30, 64, 175, 0.3); padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
              <i class="fas fa-paw"></i> Accessories
            </button>
          </div>

          <!-- Products Section -->
          <div class="products-section" style="background: transparent; padding: 60px 20px;">
            <h2 style="color: white; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); text-align: center; font-size: 2.5rem; margin-bottom: 40px; position: relative;">Our Products</h2>
            <div id="productsContainer" class="products-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
              <!-- Products will be loaded here by JavaScript -->
            </div>
            <div id="loading" class="loading" style="text-align: center; padding: 60px 20px; color: white;">Loading products...</div>
            <div id="error" class="error" style="display: none; text-align: center; padding: 40px 20px; color: #ef4444; background: rgba(255, 255, 255, 0.1); border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); margin: 40px auto; max-width: 600px; border: 1px solid rgba(255, 255, 255, 0.2); position: relative; backdrop-filter: blur(10px);"></div>
            <div id="noProducts" class="no-products" style="display: none; text-align: center; padding: 80px 20px; font-size: 1.2rem; color: white; background: rgba(255, 255, 255, 0.1); border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); margin: 40px auto; max-width: 600px; border: 1px solid rgba(255, 255, 255, 0.2); position: relative; backdrop-filter: blur(10px);">
              <i class="fas fa-store" style="font-size: 64px; margin-bottom: 20px; display: block; color: white;"></i>
              <p style="margin: 0 0 10px 0; font-size: 18px; color: white; font-weight: bold;">No products found in this category</p>
              <small style="color: rgba(255, 255, 255, 0.8); font-size: 14px; line-height: 1.5;">Add some products to get started with store management.</small>
            </div>
          </div>
        </section>

        <!-- My Orders Modal -->
        <div id="orderStatusModal" class="order-status-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
          <div class="order-status-content" style="background: white; border-radius: 15px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease-out;">
            <div class="order-status-header" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); color: white; padding: 20px 25px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
              <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;"><i class="fas fa-shopping-bag"></i> <span id="orderModalTitle">My Orders</span></h3>
              <button onclick="closeOrderStatusModal()" class="close-order-status-btn" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: background 0.3s;"></button>
            </div>
            <div class="order-status-body" style="padding: 25px;">
              <div id="ordersList" class="orders-list" style="display: flex; flex-direction: column; gap: 20px;">
                <div class="no-orders" style="text-align: center; padding: 40px 20px; color: #64748b;">
                  <i class="fas fa-shopping-bag" style="font-size: 48px; margin-bottom: 15px; display: block; color: #cbd5e1;"></i>
                  <p style="margin: 0 0 5px 0; font-size: 16px;">No orders found</p>
                  <small style="color: #94a3b8; font-size: 12px;">You haven't placed any orders yet.</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Login Prompt Modal -->
        <div id="loginPromptModal" class="login-prompt-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 10000; align-items: center; justify-content: center;">
          <div class="login-prompt-content" style="background: white; border-radius: 15px; padding: 30px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease-out; position: relative;">
            <span class="login-prompt-close" onclick="closeLoginPromptModal()" style="position: absolute; top: 15px; right: 20px; font-size: 24px; color: #6b7280; cursor: pointer; background: none; border: none; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;">&times;</span>
            <h3 style="color: #1e40af; margin: 0 0 15px 0; font-size: 20px;"><i class="fas fa-user-lock"></i> Login Required</h3>
            <p style="color: #64748b; margin: 0 0 25px 0; line-height: 1.5;">Please login to add items to your cart and complete your purchase.</p>
            <div class="login-prompt-actions" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
              <button onclick="redirectToLogin()" class="login-prompt-btn login-prompt-btn-primary" style="padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s ease; background: #1e40af; color: white;">Login Now</button>
              <button onclick="closeLoginPromptModal()" class="login-prompt-btn login-prompt-btn-secondary" style="padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s ease; background: #6b7280; color: white;">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Buy Now Modal -->
        <div id="buyNowModal" class="buy-now-modal modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
          <div class="buy-now-content modal-content" style="background: white; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease-out; display: flex; flex-direction: column;">
            <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
              <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;"><i class="fas fa-credit-card"></i> Complete Your Purchase</h3>
              <span class="close" onclick="closeBuyNowModal()" style="color: white; font-size: 28px; cursor: pointer; background: none; border: none; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.3s;">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 25px;">
              <div class="order-summary" style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                <h4 style="color: #1e40af; margin: 0 0 15px 0; font-size: 16px;">Order Summary</h4>
                <div class="summary-items" style="margin-bottom: 15px;">
                  <!-- Items will be populated by JavaScript -->
                </div>
                <div class="summary-total" style="border-top: 2px solid #e2e8f0; padding-top: 15px; margin-top: 15px;">
                  <div class="total-row" style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 18px; color: #1e40af;"><strong>Total:</strong></span>
                    <span class="final-total" style="font-size: 18px; color: #1e40af;"><strong>0.00</strong></span>
                  </div>
                </div>
              </div>

              <div class="payment-section" style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                <h4 style="color: #1e40af; margin: 0 0 15px 0; font-size: 16px; display: flex; align-items: center; gap: 8px;"><i class="fas fa-money-bill-wave"></i> Payment Method</h4>
                <div class="payment-options" style="display: flex; flex-direction: column; gap: 12px;">
                  <label class="payment-option" style="display: flex; align-items: center; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white;">
                    <input type="radio" name="payment_method" value="gcash" checked style="margin-right: 12px; width: 16px; height: 16px;">
                    <div class="payment-info" style="display: flex; align-items: center; gap: 12px; flex: 1;">
                      <i class="fab fa-google-wallet" style="font-size: 20px; color: #3b82f6; width: 30px; text-align: center;"></i>
                      <div>
                        <div class="payment-name" style="font-weight: bold; color: #1e293b; font-size: 14px;">GCash</div>
                        <div class="payment-desc" style="color: #64748b; font-size: 12px;">Pay using GCash e-wallet</div>
                      </div>
                    </div>
                  </label>

                  <label class="payment-option" style="display: flex; align-items: center; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white;">
                    <input type="radio" name="payment_method" value="bank" style="margin-right: 12px; width: 16px; height: 16px;">
                    <div class="payment-info" style="display: flex; align-items: center; gap: 12px; flex: 1;">
                      <i class="fas fa-university" style="font-size: 20px; color: #3b82f6; width: 30px; text-align: center;"></i>
                      <div>
                        <div class="payment-name" style="font-weight: bold; color: #1e293b; font-size: 14px;">Bank Transfer</div>
                        <div class="payment-desc" style="color: #64748b; font-size: 12px;">Direct bank transfer</div>
                      </div>
                    </div>
                  </label>

                  <label class="payment-option" style="display: flex; align-items: center; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white;">
                    <input type="radio" name="payment_method" value="cash_on_visit" style="margin-right: 12px; width: 16px; height: 16px;">
                    <div class="payment-info" style="display: flex; align-items: center; gap: 12px; flex: 1;">
                      <i class="fas fa-money-bill-alt" style="font-size: 20px; color: #3b82f6; width: 30px; text-align: center;"></i>
                      <div>
                        <div class="payment-name" style="font-weight: bold; color: #1e293b; font-size: 14px;">Cash on Visit</div>
                        <div class="payment-desc" style="color: #64748b; font-size: 12px;">Pay cash when picking up</div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <div class="order-notes" style="background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0;">
                <h4 style="color: #1e40af; margin: 0 0 15px 0; font-size: 16px; display: flex; align-items: center; gap: 8px;"><i class="fas fa-sticky-note"></i> Order Notes (Optional)</h4>
                <textarea id="orderNotes" placeholder="Any special instructions or delivery notes..." rows="3" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical; min-height: 80px; font-family: inherit;"></textarea>
              </div>
            </div>
            <div class="modal-footer" style="padding: 20px; border-top: 1px solid #e2e8f0; background: #f8fafc; border-radius: 0 0 12px 12px; display: flex; justify-content: flex-end; gap: 15px;">
              <button onclick="closeBuyNowModal()" class="btn-secondary" style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: background 0.3s;">Cancel</button>
              <button onclick="processPayment()" class="btn-primary" style="background: #1e40af; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: background 0.3s;">
                <i class="fas fa-check"></i> Complete Purchase
              </button>
            </div>
          </div>
        </div>

        <!-- Staff Management Panel (only visible to staff) -->
        <div id="staffPanel" class="staff-panel" style="display: none; background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);">
          <div class="staff-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
            <div class="staff-header-left" style="display: flex; align-items: center; gap: 15px;">
              <button onclick="goBackToHomepage()" class="home-btn-small" title="Back to Homepage" style="background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;">Home</button>
              <h3 style="color: white; margin: 0; font-size: 18px;">Staff Product Management</h3>
            </div>
            <div class="staff-header-right" style="display: flex; gap: 15px;">
              <button onclick="showAddProductModal()" class="add-product-btn" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: background 0.3s;">Add New Product</button>
              <button onclick="showStaffOrderManagement()" class="manage-orders-btn" style="background: #7c3aed; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: background 0.3s;">
                <i class="fas fa-window-maximize"></i> Manage Orders
              </button>
            </div>
          </div>

          <!-- Store Overview (only visible to staff) -->
          <div id="storeOverview" class="store-overview" style="display: none; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div class="overview-card" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 15px; padding: 25px; color: white; text-align: center; box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3); transition: all 0.3s ease;">
              <div class="card-value" style="font-size: 24px; font-weight: 800; margin-bottom: 5px;" id="totalProducts">0</div>
              <div class="card-label" style="font-size: 14px; opacity: 0.9;">Total Products</div>
            </div>
            <div class="overview-card" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 15px; padding: 25px; color: white; text-align: center; box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3); transition: all 0.3s ease;">
              <div class="card-value" style="font-size: 24px; font-weight: 800; margin-bottom: 5px;" id="totalValue">0.00</div>
              <div class="card-label" style="font-size: 14px; opacity: 0.9;">Total Inventory Value</div>
            </div>
            <div class="overview-card" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 15px; padding: 25px; color: white; text-align: center; box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3); transition: all 0.3s ease;">
              <div class="card-value" style="font-size: 24px; font-weight: 800; margin-bottom: 5px;" id="lowStockItems">0</div>
              <div class="card-label" style="font-size: 14px; opacity: 0.9;">Low Stock Items</div>
            </div>
            <div class="overview-card" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 15px; padding: 25px; color: white; text-align: center; box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3); transition: all 0.3s ease;">
              <div class="card-value" style="font-size: 24px; font-weight: 800; margin-bottom: 5px;" id="outOfStockItems">0</div>
              <div class="card-label" style="font-size: 14px; opacity: 0.9;">Out of Stock</div>
            </div>
          </div>

          <!-- Add Product Modal -->
          <div id="addProductModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
            <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 10px; position: relative;">
              <span class="close" onclick="closeAddProductModal()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; position: absolute; top: 10px; right: 20px; cursor: pointer;">&times;</span>
              <h3>Add New Product</h3>
              <form id="addProductForm">
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productName" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Product Name:</label>
                  <input type="text" id="productName" name="name" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productDescription" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Description:</label>
                  <textarea id="productDescription" name="description" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;"></textarea>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productCategory" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Category:</label>
                  <select id="productCategory" name="category" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                    <option value="">Select Category</option>
                    <option value="food">Food for your pets</option>
                    <option value="grooming">Grooming supplies</option>
                    <option value="accessories">Accessories</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productPrice" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Price:</label>
                  <input type="number" id="productPrice" name="price" step="0.01" min="0" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productStock" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Stock:</label>
                  <input type="number" id="productStock" name="stock" min="0" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="productImage" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Product Image:</label>
                  <input type="file" id="productImage" name="image" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                  <button type="button" onclick="closeAddProductModal()" class="cancel-btn" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
                  <button type="submit" class="submit-btn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Add Product</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Edit Product Modal -->
          <div id="editProductModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
            <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 10px; position: relative;">
              <span class="close" onclick="closeEditProductModal()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; position: absolute; top: 10px; right: 20px; cursor: pointer;">&times;</span>
              <h3>Edit Product</h3>
              <form id="editProductForm">
                <input type="hidden" id="editProductId" name="product_id">
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductName" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Product Name:</label>
                  <input type="text" id="editProductName" name="name" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductDescription" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Description:</label>
                  <textarea id="editProductDescription" name="description" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;"></textarea>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductCategory" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Category:</label>
                  <select id="editProductCategory" name="category" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                    <option value="">Select Category</option>
                    <option value="food">Food for your pets</option>
                    <option value="grooming">Grooming supplies</option>
                    <option value="accessories">Accessories</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductPrice" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Price:</label>
                  <input type="number" id="editProductPrice" name="price" step="0.01" min="0" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductStock" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Stock:</label>
                  <input type="number" id="editProductStock" name="stock" min="0" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                  <label for="editProductImage" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Product Image:</label>
                  <input type="file" id="editProductImage" name="image" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                  <small style="color: #666; font-size: 12px;">Leave empty to keep current image</small>
                </div>
                <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                  <button type="button" onclick="closeEditProductModal()" class="cancel-btn" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
                  <button type="submit" class="submit-btn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Update Product</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- My Orders Modal -->
        <div id="orderStatusModal" class="order-status-modal">
          <div class="order-status-content">
            <div class="order-status-header">
              <h3><i class="fas fa-receipt"></i> <span id="orderModalTitle">Order Status</span></h3>
              <button onclick="closeOrderStatusModal()" class="close-order-status-btn"></button>
            </div>
            <div class="order-status-body">
              <div id="ordersList" class="orders-list">
                <div class="no-orders">
                  <i class="fas fa-receipt"></i>
                  <p>No orders found</p>
                  <small>You haven't placed any orders yet.</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Floating Order Management Window -->
        <div id="floatingBackdrop" class="floating-backdrop" onclick="closeFloatingOrderWindow()"></div>
        <div id="floatingOrderWindow" class="floating-order-window">
          <div class="floating-order-header">
            <h3><i class="fas fa-shopping-cart"></i> Order Management</h3>
            <div class="floating-header-actions">
              <span id="floatingOrderCount" class="floating-order-count">0 Orders</span>
              <button onclick="closeFloatingOrderWindow()" class="floating-close-btn"></button>
            </div>
          </div>
          <div class="floating-order-body">
            <div id="floatingOrdersContainer" class="floating-orders-container">
              <button id="viewOrdersBtn" class="view-orders-btn">View Orders</button>
            </div>
          </div>
        </div>


        <!-- Reports Section -->
        <section id="reportsSection" class="content-section" style="display: none;">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-file-pdf"></i> Pet Medical Reports
              </h2>
            </div>

            <!-- Pet Reports Interface -->
            <div class="pet-reports-container" style="max-width: 800px; margin: 0 auto; padding: 40px 20px;">
              <!-- Select Pet Section -->
              <div class="pet-select-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; transform: translate(30px, -30px);"></div>
                <div style="position: absolute; bottom: 0; left: 0; width: 150px; height: 150px; background: rgba(255, 255, 255, 0.05); border-radius: 50%; transform: translate(-50px, 50px);"></div>

                <div class="section-title" style="color: #ffffff; font-size: 24px; font-weight: 700; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; position: relative; z-index: 2;">
                  <i class="fas fa-stethoscope" style="color: #ffffff; font-size: 28px;"></i>
                  Select Pet for Medical Report
                </div>

                <div class="form-group" style="margin-bottom: 25px; position: relative; z-index: 2;">
                  <label for="petSelect" style="color: #ffffff; font-size: 16px; margin-bottom: 10px; display: block; font-weight: 600;">Choose a Pet:</label>
                  <select id="petSelect" style="width: 100%; padding: 15px 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; background: rgba(255, 255, 255, 0.95); color: #333; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                    <option value="">Loading pets...</option>
                  </select>
                </div>

                <div class="form-actions" style="text-align: center; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; position: relative; z-index: 2;">
                  <button id="loadPetsBtn" class="header-btn" onclick="loadPetsDropdown()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.4); padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; backdrop-filter: blur(10px);">
                    <i class="fas fa-sync-alt"></i> Load Pets
                  </button>
                  <button id="generateReportBtn" class="header-btn" onclick="generatePetReport()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);">
                    <i class="fas fa-file-medical"></i> Generate Medical Report
                  </button>
                  <button onclick="downloadSimplePDFReport()" id="pdfDownloadBtn" style="background: linear-gradient(135deg, #dc3545, #fd7e14); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(220, 53, 69, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(220, 53, 69, 0.4)'">
                    <i class="fas fa-download"></i> Download PDF
                  </button>
                </div>
              </div>

              <!-- Report Preview Section -->
              <div class="report-preview-section" style="background: #ffffff; border-radius: 20px; padding: 40px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 2px solid rgba(102, 126, 234, 0.1); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #667eea);"></div>

                <div class="section-title" style="color: #333; font-size: 22px; font-weight: 700; margin-bottom: 25px; display: flex; align-items: center; gap: 12px;">
                  <i class="fas fa-eye" style="color: #667eea; font-size: 24px;"></i>
                  Medical Report Preview
                </div>

                <div id="reportPreview" class="report-preview-content" style="min-height: 300px; padding: 40px; text-align: center; color: #999; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; border: 2px dashed #dee2e6; transition: all 0.3s ease;">
                  <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                    <i class="fas fa-file-medical" style="font-size: 64px; color: rgba(102, 126, 234, 0.3);"></i>
                    <div>
                      <h3 style="margin: 0 0 10px 0; color: #667eea; font-size: 20px;">No Report Selected</h3>
                      <p style="margin: 0; font-size: 16px; color: #666;">Select a pet and click "Generate Medical Report" to view their complete medical history here.</p>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 10px; border: 1px solid rgba(40, 167, 69, 0.2); max-width: 400px;">
                      <p style="margin: 0; font-size: 14px; color: #28a745; text-align: center;">
                        <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                        <strong>PDF Download Available:</strong> After generating a report, you'll see a prominent download button to save your pet's medical report as a PDF file.
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Quick Stats Section (shown after report generation) -->
              <div id="reportStats" class="report-stats-section" style="display: none; margin-top: 30px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; color: white;">
                  <h3 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-bar"></i> Medical Summary
                  </h3>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                      <div id="totalVisits" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">0</div>
                      <div style="font-size: 14px; opacity: 0.9;">Total Visits</div>
                    </div>
                    <div style="text-align: center;">
                      <div id="totalVaccinations" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">0</div>
                      <div style="font-size: 14px; opacity: 0.9;">Vaccinations</div>
                    </div>
                    <div style="text-align: center;">
                      <div id="lastVisit" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">-</div>
                      <div style="font-size: 14px; opacity: 0.9;">Last Visit</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title" style="color: #ffffff; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-cog" style="color: #ffffff;"></i> Settings
            </h2>
          </div>

          <!-- Settings Tab Navigation -->
          <div class="settings-tabs" style="background: #08355f; border-radius: 12px 12px 0 0; padding: 0; margin-bottom: 0; display: flex; overflow-x: auto; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative;">
            <button class="settings-tab active" onclick="showSettingsSection('profile')" style="color: white; border: none; padding: 15px 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; border-radius: 12px 12px 0 0; margin: 0; flex: 1; min-width: 120px; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;">
              <i class="fas fa-user"></i> Profile
            </button>
            <button class="settings-tab" onclick="showSettingsSection('password')" style="color: #ffffff; border: none; padding: 15px 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; border-radius: 0; margin: 0; flex: 1; min-width: 120px; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;">
              <i class="fas fa-lock"></i> Password
            </button>
            <button class="settings-tab" onclick="showSettingsSection('picture')" style="color: #ffffff; border: none; padding: 15px 25px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; border-radius: 0; margin: 0; flex: 1; min-width: 120px; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;">
              <i class="fas fa-camera"></i> Picture
            </button>
          </div>

          <!-- Settings Tab Content Container -->
          <div class="settings-content-container" style="background: #08355f; border-radius: 0 0 12px 12px; padding: 0; min-height: 400px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">

            <!-- Profile Information Settings -->
            <div id="profileSettings" class="settings-content active" style="padding: 30px;">
              <div class="settings-card" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.1); max-width: 100%;">
                <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                  <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-user" style="color: #5DADE2;"></i> Profile Information
                  </h3>
                </div>
                <form id="profileForm" class="settings-form">
                  <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                      <label for="firstName" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">First Name *</label>
                      <input type="text" id="firstName" name="first_name" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                    </div>
                    <div class="form-group">
                      <label for="lastName" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Last Name *</label>
                      <input type="text" id="lastName" name="last_name" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                    </div>
                  </div>
                  <div class="form-group" style="margin-bottom: 16px;">
                    <label for="email" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Email Address *</label>
                    <input type="email" id="email" name="email" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group" style="margin-bottom: 20px;">
                    <label for="phone" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Phone Number</label>
                    <input type="tel" id="phone" name="phone" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-actions" style="text-align: right;">
                    <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                      <i class="fas fa-save"></i> Update Profile
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Password Settings -->
            <div id="passwordSettings" class="settings-content" style="padding: 30px; display: none;">
              <div class="settings-card" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.1); max-width: 100%;">
                <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                  <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-lock" style="color: #5DADE2;"></i> Change Password
                  </h3>
                </div>
                <form id="passwordForm" class="settings-form">
                  <div class="form-group" style="margin-bottom: 16px;">
                    <label for="currentPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Current Password *</label>
                    <input type="password" id="currentPassword" name="current_password" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div class="form-group">
                      <label for="newPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">New Password *</label>
                      <input type="password" id="newPassword" name="new_password" required minlength="6" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                    </div>
                    <div class="form-group">
                      <label for="confirmPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Confirm New Password *</label>
                      <input type="password" id="confirmPassword" name="confirm_password" required minlength="6" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                    </div>
                  </div>
                  <div class="form-actions" style="text-align: right;">
                    <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                      <i class="fas fa-key"></i> Update Password
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Profile Picture Settings -->
            <div id="pictureSettings" class="settings-content" style="padding: 30px; display: none;">
              <div class="settings-card" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.1); max-width: 100%;">
                <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                  <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-camera" style="color: #5DADE2;"></i> Profile Picture
                  </h3>
                </div>
                <div class="profile-picture-section" style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: center;">
                  <div class="current-picture">
                    <img id="currentProfilePicture" src="../assets/images/logoo.jpg" alt="Profile Picture" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid rgba(255, 255, 255, 0.2);">
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; margin: 8px 0 0 0; text-align: center;">Current Picture</p>
                  </div>
                  <div class="upload-section">
                    <form id="pictureForm" class="settings-form">
                      <div class="form-group" style="margin-bottom: 16px;">
                        <label for="profilePictureInput" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block; font-weight: 500;">Choose New Picture</label>
                        <input type="file" id="profilePictureInput" accept="image/*" required style="width: 100%; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                      </div>
                      <div class="image-preview" style="margin-bottom: 16px;">
                        <img id="imagePreview" src="" alt="Preview" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255, 255, 255, 0.3); display: none;">
                      </div>
                      <div class="form-actions" style="display: flex; gap: 12px;">
                        <button type="button" class="btn-secondary" onclick="document.getElementById('profilePictureInput').click()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s ease;">
                          <i class="fas fa-folder-open"></i> Choose File
                        </button>
                        <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                          <i class="fas fa-upload"></i> Upload Picture
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Booking Modal for Client Dashboard -->
        <div id="clientBookingModal" class="modal" style="display: none;">
          <div class="modal-content booking-modal" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <h3 id="clientBookingModalTitle" style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-calendar-plus" style="color: #9BA9FF; font-size: 1.5rem;"></i>
                Book an Appointment
              </h3>
              <span class="close" onclick="closeClientBookingModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">

              <!-- Booking Form -->
              <form id="clientBookingForm">
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingService" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-stethoscope" style="color: #5DADE2; margin-right: 8px;"></i> Select Service *
                    </label>
                    <select id="clientBookingService" name="service_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Loading services...</option>
                    </select>
                    <button type="button" onclick="refreshClientServices()" title="Refresh services" style="background: #f39c12; color: white; border: none; padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 12px;">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="clientBookingPet" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-paw" style="color: #5DADE2; margin-right: 8px;"></i> Select Pet *
                    </label>
                    <select id="clientBookingPet" name="pet_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Loading pets...</option>
                    </select>
                    <button type="button" onclick="showClientAddPetForm()" title="Add a new pet" style="background: #4169e1; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-left: 10px;">
                      <i class="fas fa-plus"></i> Add New Pet
                    </button>
                  </div>
                </div>

                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingDate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-calendar" style="color: #5DADE2; margin-right: 8px;"></i> Appointment Date *
                    </label>
                    <input type="date" id="clientBookingDate" name="appointment_date" required min="" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>

                  <div class="form-group">
                    <label for="clientBookingTime" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-clock" style="color: #5DADE2; margin-right: 8px;"></i> Appointment Time *
                    </label>
                    <select id="clientBookingTime" name="appointment_time" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select date first</option>
                    </select>
                  </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="clientBookingNotes" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                    <i class="fas fa-sticky-note" style="color: #5DADE2; margin-right: 8px;"></i> Notes (Optional)
                  </label>
                  <textarea id="clientBookingNotes" name="notes" rows="3" placeholder="Any special instructions or concerns..." style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; resize: vertical; min-height: 80px;" title="Enter any special instructions or concerns"></textarea>
                </div>

                <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
                  <button type="button" class="btn-secondary" onclick="closeClientBookingModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                    <i class="fas fa-times"></i> CANCEL
                  </button>
                  <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                    <i class="fas fa-calendar-plus"></i> BOOK APPOINTMENT
                  </button>
                </div>
              </form>

              <!-- Add Pet Form (Hidden) -->
              <div id="clientAddPetForm" style="display: none; border-top: 1px solid rgba(255,215,0,0.3); padding-top: 20px; margin-top: 20px;">
                <h3 style="color: #ffd700; margin: 0 0 20px 0;">
                  <i class="fas fa-paw"></i> Add New Pet
                </h3>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
                    <input type="text" id="clientBookingPetName" placeholder="Enter pet name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
                    <select id="clientBookingPetSpecies" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Species</option>
                      <option value="Dog"> Dog</option>
                      <option value="Cat"> Cat</option>
                      <option value="Bird"> Bird</option>
                      <option value="Rabbit"> Rabbit</option>
                      <option value="Other"> Other</option>
                    </select>
                  </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
                    <input type="text" id="clientBookingPetBreed" placeholder="Enter breed (optional)" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
                    <input type="date" id="clientBookingPetBirthdate" max="" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
                    <select id="clientBookingPetGender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Gender</option>
                      <option value="Male"> Male</option>
                      <option value="Female"> Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
                    <input type="number" id="clientBookingPetWeight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="clientBookingPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
                  <input type="text" id="clientBookingPetColor" placeholder="Enter color (optional)" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                </div>
                <div style="margin-top: 15px; text-align: center;">
                  <button type="button" onclick="addClientPet()" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px;">
                    <i class="fas fa-plus"></i> Add Pet
                  </button>
                  <button type="button" onclick="hideClientAddPetForm()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">
                    <i class="fas fa-times"></i> Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>


        <!-- Orders Modal -->
        <div id="ordersModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 900px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <h3 style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-shopping-bag" style="color: #9BA9FF; font-size: 1.5rem;"></i>
                My Orders
              </h3>
              <span class="close" onclick="closeOrdersModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
              <div id="ordersModalContent">
                <div class="loading" style="text-align: center; padding: 40px;">
                  <div class="spinner"></div>
                  Loading orders...
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Staff Add Pet Modal - Commented out since this is client page -->
  <!--
  <div id="staffAddPetModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
      <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
        <h3 style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-paw" style="color: #9BA9FF; font-size: 1.5rem;"></i>
          Add New Pet (Staff)
        </h3>
        <span class="close" onclick="closeStaffAddPetModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
      </div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
        <form id="staffAddPetForm">
          <div class="form-group" style="margin-bottom: 20px;">
            <label for="staffPetOwner" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Owner *</label>
            <select id="staffPetOwner" name="owner_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
              <option value="">Select an owner</option>
            </select>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
              <input type="text" id="staffPetName" name="pet_name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter pet name">
            </div>
            <div class="form-group">
              <label for="staffPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
              <select id="staffPetSpecies" name="species" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                <option value="">Select Species</option>
                <option value="Dog"> Dog</option>
                <option value="Cat"> Cat</option>
                <option value="Bird"> Bird</option>
                <option value="Rabbit"> Rabbit</option>
                <option value="Other"> Other</option>
              </select>
            </div>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
              <input type="text" id="staffPetBreed" name="breed" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter breed (optional)">
            </div>
            <div class="form-group">
              <label for="staffPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
              <input type="date" id="staffPetBirthdate" name="birthdate" max="${new Date().toISOString().split('T')[0]}" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
            </div>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
              <select id="staffPetGender" name="gender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                <option value="">Select Gender</option>
                <option value="Male"> Male</option>
                <option value="Female"> Female</option>
              </select>
            </div>
            <div class="form-group">
              <label for="staffPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
              <input type="number" id="staffPetWeight" name="weight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
            </div>
          </div>

          <div class="form-group" style="margin-bottom: 20px;">
            <label for="staffPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
            <input type="text" id="staffPetColor" name="color" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter color (optional)">
          </div>

          <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
            <button type="button" class="btn-secondary" onclick="closeStaffAddPetModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">CANCEL</button>
            <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
              <i class="fas fa-plus" style="margin-right: 8px;"></i> ADD PET
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  -->

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="clientMobileOverlay" onclick="toggleClientMobileSidebar()"></div>


  <!-- Dashboard JavaScript -->
  <script src="../assets/js/dashboard.js"></script>
  <script src="../assets/js/modules/notifications.js"></script>
  <script src="../assets/js/client-dashboard.js"></script>
<script>
  // Store Management Variables
  let allProducts = [];
  let currentFilter = 'all';
  let currentUser = null;
  let isStaff = false;

  // Mobile sidebar toggle functionality
  function toggleClientMobileSidebar() {
    console.log(' toggleClientMobileSidebar called!');

    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('clientMobileOverlay');
    const toggleBtn = document.getElementById('clientMobileMenuToggle');

    console.log(' Client Elements found:', {
      sidebar: !!sidebar,
      overlay: !!overlay,
      toggleBtn: !!toggleBtn,
      sidebarClass: sidebar ? sidebar.className : 'not found',
      overlayClass: overlay ? overlay.className : 'not found'
    });

    if (sidebar && overlay && toggleBtn) {
      const isOpen = sidebar.classList.contains('mobile-open');
      console.log(' Client Sidebar is open:', isOpen);

      if (isOpen) {
        console.log(' Closing client sidebar...');
        // Close sidebar
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
        toggleBtn.setAttribute('aria-expanded', 'false');
        console.log(' Client sidebar closed');
      } else {
        console.log(' Opening client sidebar...');
        // Open sidebar
        sidebar.classList.add('mobile-open');
        overlay.classList.add('active');
        toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
        toggleBtn.setAttribute('aria-expanded', 'true');
        console.log(' Client sidebar opened');
      }
    } else {
      console.error(' Missing client elements:', {
        sidebar: !sidebar,
        overlay: !overlay,
        toggleBtn: !toggleBtn
      });
    }
  }

  // Alternative event listener for better mobile support
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('clientMobileMenuToggle');
    if (toggleBtn) {
      // Add touch event support for mobile devices
      toggleBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        toggleClientMobileSidebar();
      }, { passive: false });

      // Add keyboard support
      toggleBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleClientMobileSidebar();
        }
      });

      // Set initial ARIA attributes
      toggleBtn.setAttribute('aria-expanded', 'false');
      toggleBtn.setAttribute('aria-controls', 'sidebar');
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
    }
  });

  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('clientMobileOverlay');
    const toggleBtn = document.getElementById('clientMobileMenuToggle');

    if (window.innerWidth <= 768) {
      if (sidebar && overlay && toggleBtn) {
        if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
          sidebar.classList.remove('mobile-open');
          overlay.classList.remove('active');
          toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
          toggleBtn.setAttribute('aria-expanded', 'false');
        }
      }
    }
  });

  // Handle logout functionality
  async function handleLogout() {
    if (confirm('Are you sure you want to logout?')) {
      try {
        // Call logout API endpoint
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'logout' })
        });

        const result = await response.json();

        if (result.success) {
          window.location.href = '../index.html';
        } else {
          alert('Logout failed. Redirecting anyway...');
          window.location.href = '../index.html';
        }
      } catch (error) {
        console.error('Logout error:', error);
        alert('Logout failed. Redirecting anyway...');
        window.location.href = '../index.html';
      }
    }
  }

  // Store Management Functions
  async function checkUserAuthentication() {
    try {
      console.log(' Checking user authentication...');
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_user_info' })
      });

      console.log(' Auth response status:', response.status);
      const result = await response.json();
      console.log(' Authentication result:', result);

      if (result.success && result.data.logged_in) {
        currentUser = result.data.user;
        isStaff = currentUser.type === 'staff';
        console.log(' User authenticated:', currentUser);
        console.log(' User type:', currentUser.type);
        console.log(' Is staff:', isStaff);

        if (isStaff) {
          showStaffInterface();
        } else {
          showClientInterface();
        }
      } else {
        console.log(' Authentication failed:', result.message);
        showLoginRequired();
      }

      // Load products after determining user state
      loadProducts();
    } catch (error) {
      console.error(' Authentication check failed:', error);
      showLoginRequired();
      loadProducts(); // Still try to load products
    }
  }

  function showStaffInterface() {
    console.log(' Showing staff interface...');
    document.getElementById('staffPanel').style.display = 'block';
    document.getElementById('loginRequired').style.display = 'none';
    document.getElementById('categoryTabs').style.display = 'flex';

    // Refresh products to show staff controls
    loadProducts();
    console.log(' Staff interface shown successfully');
  }

  function showClientInterface() {
    document.getElementById('staffPanel').style.display = 'none';
    document.getElementById('loginRequired').style.display = 'none';
    document.getElementById('categoryTabs').style.display = 'flex';

    // Show cart button for clients
    const cartBtn = document.getElementById('cartBtn');
    if (cartBtn) {
      cartBtn.style.display = 'inline-block';
    }

    // Show My Orders button for clients
    const myOrdersBtn = document.getElementById('myOrdersBtn');
    if (myOrdersBtn) {
      myOrdersBtn.style.display = 'inline-block';
    }

    // Load and display cart count
    setTimeout(() => {
      updateCartCount();
    }, 500);

    // Initialize order status count for clients
    setTimeout(() => {
      initializeOrderStatusCount();
    }, 1500);
  }

  function showLoginRequired() {
    // Hide all other sections
    document.getElementById('staffPanel').style.display = 'none';
    document.getElementById('productsContainer').innerHTML = '';
    document.getElementById('categoryTabs').style.display = 'none';

    // Show login required message
    document.getElementById('loginRequired').style.display = 'block';

    // Hide cart button for non-logged in users
    const cartBtn = document.getElementById('cartBtn');
    if (cartBtn) {
      cartBtn.style.display = 'none';
    }

    // Hide My Orders button for non-logged in users
    const myOrdersBtn = document.getElementById('myOrdersBtn');
    if (myOrdersBtn) {
      myOrdersBtn.style.display = 'none';
    }

    console.log('Login required interface shown');
  }

  function redirectToLogin() {
    window.location.href = '../index.html'; // Assuming login page is index.html
  }

  function showLoginPromptModal() {
    const modal = document.getElementById('loginPromptModal');
    if (modal) {
      modal.classList.add('show');
    }
  }

  function closeLoginPromptModal() {
    const modal = document.getElementById('loginPromptModal');
    if (modal) {
      modal.classList.remove('show');
    }
  }

  function goBackToHomepage() {
    window.location.href = '../index.html';
  }

  function toggleCartDropdown() {
    const dropdown = document.getElementById('cartDropdown');
    const isVisible = dropdown.style.display === 'block';

    if (isVisible) {
      closeCartDropdown();
    } else {
      showCartDropdown();
    }
  }

  async function showCartDropdown() {
    const dropdown = document.getElementById('cartDropdown');
    const cartItems = document.getElementById('cartDropdownItems');
    const cartFooter = document.getElementById('cartDropdownFooter');

    try {
      // Load cart from backend
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_cart' })
      });

      const result = await response.json();

      if (result.success && result.data && result.data.length > 0) {
        const cart = result.data;
        const total = result.total;

        cartItems.innerHTML = `
          <div class="cart-items-list">
            ${cart.map(item => `
              <div class="cart-item-row">
                <div class="item-details">
                  <h4>${item.name}</h4>
                  <p>${parseFloat(item.price).toFixed(2)}  ${item.quantity}</p>
                </div>
                <div class="item-controls">
                  <div class="quantity-controls">
                    <button onclick="updateCartItemQuantity(${item.product_id}, ${item.quantity - 1})" class="qty-btn">-</button>
                    <span class="quantity">${item.quantity}</span>
                    <button onclick="updateCartItemQuantity(${item.product_id}, ${item.quantity + 1})" class="qty-btn">+</button>
                  </div>
                  <button onclick="removeFromCart(${item.product_id})" class="remove-btn">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        `;

        document.getElementById('cartDropdownTotal').textContent = total.toFixed(2);
        cartFooter.style.display = 'block';
      } else {
        cartItems.innerHTML = `
          <div class="empty-cart-message">
            <i class="fas fa-shopping-cart"></i>
            <p>Your cart is empty</p>
            <small>Add some products to your cart to see them here!</small>
          </div>
        `;
        cartFooter.style.display = 'none';
      }
    } catch (error) {
      console.error('Error loading cart:', error);
      cartItems.innerHTML = `
        <div class="empty-cart-message">
          <i class="fas fa-exclamation-triangle"></i>
          <p>Error loading cart</p>
          <small>Please try again later.</small>
        </div>
      `;
      cartFooter.style.display = 'none';
    }

    dropdown.style.display = 'block';
  }

  function closeCartDropdown() {
    document.getElementById('cartDropdown').style.display = 'none';
  }

  async function updateCartItemQuantity(productId, newQuantity) {
    if (newQuantity <= 0) {
      removeFromCart(productId);
      return;
    }

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'update_cart',
          product_id: productId,
          quantity: newQuantity
        })
      });

      const result = await response.json();

      if (result.success) {
        updateCartCount();
        showCartDropdown(); // Refresh dropdown
      } else {
        alert('Error: ' + result.message);
        showCartDropdown(); // Refresh to show current state
      }
    } catch (error) {
      console.error('Error updating cart:', error);
      alert('Failed to update cart item');
    }
  }

  async function removeFromCart(productId) {
    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'remove_from_cart',
          product_id: productId
        })
      });

      const result = await response.json();

      if (result.success) {
        updateCartCount();
      } else {
        alert('Error: ' + result.message);
        showCartDropdown(); // Refresh to show current state
      }
    } catch (error) {
      console.error('Error removing from cart:', error);
      alert('Failed to remove item from cart');
    }
  }

  // Checkout function - globally accessible
  window.proceedToCheckout = function() {
    console.log(' proceedToCheckout called');
    closeCartDropdown();
    showBuyNowModal().catch(error => {
      console.error('Error in proceedToCheckout:', error);
      alert('Error opening checkout. Please try again.');
    });
  };

  async function showBuyNowModal() {
    try {
      // Get cart from API
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_cart' })
      });

      const result = await response.json();

      if (result.success && result.data && result.data.length > 0) {
        const cart = result.data;
        const total = result.total;
        const totalItems = result.item_count;

        // Create and show buy now modal
        const modal = document.createElement('div');
        modal.className = 'modal buy-now-modal';
        modal.innerHTML = `
          <div class="modal-content buy-now-content">
            <div class="modal-header">
              <h3><i class="fas fa-credit-card"></i> Complete Your Purchase</h3>
              <span class="close" onclick="closeBuyNowModal()">&times;</span>
            </div>
            <div class="modal-body">
              <div class="order-summary">
                <h4>Order Summary</h4>
                <div class="summary-items">
                  ${cart.map(item => `
                    <div class="summary-item">
                      <div class="item-info">
                        <h5>${item.name}</h5>
                        <p>Quantity: ${item.quantity}  ${parseFloat(item.price).toFixed(2)}</p>
                      </div>
                      <div class="item-subtotal">
                        ${(item.price * item.quantity).toFixed(2)}
                      </div>
                    </div>
                  `).join('')}
                </div>
                <div class="summary-total">
                  <div class="total-row">
                    <span><strong>Total (${totalItems} items):</strong></span>
                    <span class="final-total"><strong>${total.toFixed(2)}</strong></span>
                  </div>
                </div>
              </div>

              <div class="payment-section">
                <h4><i class="fas fa-money-bill-wave"></i> Payment Method</h4>
                <div class="payment-options">
                  <label class="payment-option">
                    <input type="radio" name="payment_method" value="gcash" checked>
                    <div class="payment-info">
                      <i class="fab fa-google-wallet"></i>
                      <div>
                        <div class="payment-name">GCash</div>
                        <div class="payment-desc">Pay using GCash e-wallet</div>
                      </div>
                    </div>
                  </label>

                  <label class="payment-option">
                    <input type="radio" name="payment_method" value="bank">
                    <div class="payment-info">
                      <i class="fas fa-university"></i>
                      <div>
                        <div class="payment-name">Bank Transfer</div>
                        <div class="payment-desc">Direct bank transfer</div>
                      </div>
                    </div>
                  </label>

                  <label class="payment-option">
                    <input type="radio" name="payment_method" value="cash_on_visit">
                    <div class="payment-info">
                      <i class="fas fa-money-bill-alt"></i>
                      <div>
                        <div class="payment-name">Cash on Visit</div>
                        <div class="payment-desc">Pay cash when picking up</div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <div class="order-notes">
                <h4><i class="fas fa-sticky-note"></i> Order Notes (Optional)</h4>
                <textarea id="orderNotes" placeholder="Any special instructions or delivery notes..." rows="3"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button onclick="closeBuyNowModal()" class="btn-secondary">Cancel</button>
              <button onclick="processPayment()" class="btn-primary">
                <i class="fas fa-check"></i> Complete Purchase
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        console.log(' Buy now modal created and appended to body');
        setTimeout(() => {
          modal.classList.add('show');
          console.log(' Buy now modal show class added');
        }, 10);
      } else {
        alert('Your cart is empty');
      }
    } catch (error) {
      console.error('Error loading cart for checkout:', error);
      alert('Failed to load cart');
    }
  }

  function closeBuyNowModal() {
    console.log(' Closing buy now modal...');
    const modal = document.querySelector('.buy-now-modal');
    if (modal) {
      modal.classList.remove('show');
      setTimeout(() => {
        modal.remove();
        console.log(' Buy now modal removed from DOM');
      }, 300);
    } else {
      console.log(' Buy now modal not found');
    }
  }

  async function processPayment() {
    // Get payment method
    const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
    if (!selectedPayment) {
      alert('Please select a payment method');
      return;
    }

    const paymentMethod = selectedPayment.value;
    const orderNotes = document.getElementById('orderNotes').value;

    // Get cart items from API
    let cart, total;

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_cart' })
      });

      const result = await response.json();

      if (result.success && result.data && result.data.length > 0) {
        cart = result.data;
        total = result.total;
      } else {
        alert('Your cart is empty');
        return;
      }
    } catch (error) {
      console.error('Error loading cart:', error);
      alert('Failed to load cart');
      return;
    }

    try {
      // Show loading state
      const submitBtn = document.querySelector('.buy-now-modal .btn-primary');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      submitBtn.disabled = true;

      // Create order via API
      console.log(' Processing payment with cart data:', {
        itemCount: cart.length,
        total: total,
        paymentMethod: paymentMethod,
        items: cart.map(item => ({
          id: item.id,
          product_id: item.product_id,
          name: item.name,
          quantity: item.quantity,
          price: item.price
        }))
      });

      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'buy_cart',
          items: cart,
          total: total,
          payment_method: paymentMethod,
          notes: orderNotes
        })
      });

      const result = await response.json();

      if (result.success) {
        // Clear cart
        try {
          await fetch('../api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'clear_cart' })
          });
        } catch (clearError) {
          console.error('Error clearing cart:', clearError);
        }

        // Update cart count
        updateCartCount();

        // Close modal
        closeBuyNowModal();

        // Reload products to show updated stock levels
        loadProducts();

        // Show success message
        let successMessage = `Order placed successfully! Order ID: ${result.order_id}\n\nStock levels have been updated.`;

        if (result.skipped_items && result.skipped_items.length > 0) {
          successMessage += `\n\nNote: ${result.skipped_items.length} item(s) were not available and were skipped:\n`;
          result.skipped_items.forEach(item => {
            successMessage += ` ${item.product_name} (${item.reason})\n`;
          });
        }

        alert(successMessage);

        console.log('Order placed:', result);
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      console.error('Error processing payment:', error);
      alert('Failed to process payment');
    } finally {
      // Restore button
      const submitBtn = document.querySelector('.buy-now-modal .btn-primary');
      if (submitBtn) {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }
  }

  async function loadProducts() {
    const container = document.getElementById('productsContainer');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const noProducts = document.getElementById('noProducts');

    // Show loading
    loading.style.display = 'block';
    error.style.display = 'none';
    noProducts.style.display = 'none';
    container.innerHTML = '';

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_products' })
      });

      const data = await response.json();

      if (data.success) {
        allProducts = data.data;
        if (allProducts.length === 0) {
          console.log('No products from API, loading sample products');
          addSampleProducts();
        } else {
          displayProducts(allProducts);
          if (isStaff) {
            updateStoreOverview();
          }
        }
      } else {
        throw new Error(data.message || 'Failed to load products');
      }
    } catch (error) {
      console.error('Error loading products:', error);
      error.textContent = 'Failed to load products: ' + error.message;
      error.style.display = 'block';
      // Load sample products as fallback
      addSampleProducts();
    } finally {
      loading.style.display = 'none';
    }
  }

  function displayProducts(products) {
    const container = document.getElementById('productsContainer');
    const noProducts = document.getElementById('noProducts');

    if (!products || products.length === 0) {
      noProducts.style.display = 'block';
      container.innerHTML = '';
      return;
    }

    noProducts.style.display = 'none';

    try {
      container.innerHTML = products.map(product => `
        <div class="product-card" data-category="${product.category}" data-id="${product.id}">
          <div class="product-image-container">
            <img src="../${product.image || 'assets/images/logoo.jpg'}"
                 alt="${product.name}"
                 class="product-image"
                 onerror="handleImageError(this, '${product.image || 'assets/images/logoo.jpg'}')"
                 loading="lazy">
            ${!product.image ? '<div class="product-image-placeholder"><i class="fas fa-image"></i></div>' : ''}
          </div>
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-category">${product.category}</div>
            <p class="product-description">${product.description || 'No description available'}</p>
            <div class="product-details">
              <div class="product-price">${parseFloat(product.price).toFixed(2)}</div>
              <div class="product-stock">
                <span class="stock-badge ${getStockClass(product.stock)}">
                  ${product.stock > 0 ? `${product.stock} in stock` : 'Out of stock'}
                </span>
              </div>
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" ${product.stock <= 0 ? 'disabled' : ''} onclick="addToCart(${product.id}, '${product.name}')">
                ${product.stock <= 0 ? 'Out of Stock' : 'Add to Cart'}
              </button>
            </div>
          </div>
        </div>
      `).join('');
    } catch (error) {
      console.error('Error displaying products:', error);
      noProducts.style.display = 'block';
      container.innerHTML = '';
    }
  }

  function getStockClass(stock) {
    if (stock <= 0) return 'stock-out';
    if (stock <= 5) return 'stock-low';
    return 'stock-good';
  }

  function handleImageError(img, originalImage) {
    // Hide the broken image
    img.style.display = 'none';

    // Show placeholder if it exists
    const container = img.parentElement;
    const placeholder = container.querySelector('.product-image-placeholder');
    if (placeholder) {
      placeholder.style.display = 'flex';
    }

    // Try alternative image paths if original image failed
    if (originalImage && originalImage.trim() !== '') {
      // Try different possible paths
      const imagePaths = [
        originalImage,
        originalImage.replace(/\.(jpg|jpeg|png)$/i, '.jpg'),
        originalImage.replace(/\.(jpg|jpeg|png)$/i, '.png'),
        'assets/images/logoo.jpg'
      ];

      // Remove duplicates
      const uniquePaths = [...new Set(imagePaths)].filter(path => path && path.trim() !== '');

      let currentIndex = 0;

      function tryNextImage() {
        if (currentIndex >= uniquePaths.length) {
          // All paths failed, show placeholder
          img.style.display = 'none';
          if (placeholder) {
            placeholder.style.display = 'flex';
          }
          return;
        }

        const nextPath = '../' + uniquePaths[currentIndex];
        const testImg = new Image();

        testImg.onload = function() {
          // Success! Use this image
          img.src = nextPath;
          img.style.display = 'block';
          if (placeholder) {
            placeholder.style.display = 'none';
          }
        };

        testImg.onerror = function() {
          // Try next path
          currentIndex++;
          tryNextImage();
        };

        testImg.src = nextPath;
      }

      tryNextImage();
    }
  }

  function filterCategory(category) {
    console.log(' Category filter clicked:', category);
    currentFilter = category;

    // Update active category tab
    document.querySelectorAll('.category-tab').forEach(tab => {
      tab.classList.remove('active');
    });

    // Highlight the corresponding category tab
    if (category !== 'all') {
      const categoryTab = document.querySelector(`[onclick="filterCategory('${category}')"]`);
      if (categoryTab) {
        categoryTab.classList.add('active');
      }
    } else {
      const allTab = document.querySelector(`[onclick="filterCategory('all')"]`);
      if (allTab) {
        allTab.classList.add('active');
      }
    }

    // Show loading state
    const container = document.getElementById('productsContainer');
    if (container) {
      container.style.opacity = '0.5';
    }

    // Filter products
    let filteredProducts = allProducts;

    if (category !== 'all') {
      filteredProducts = allProducts.filter(product =>
        product.category && product.category.toLowerCase() === category.toLowerCase()
      );
      // If no products match the category, show all products
      if (filteredProducts.length === 0) {
        filteredProducts = allProducts;
      }
    }

    // Add small delay for better UX
    setTimeout(() => {
      displayProducts(filteredProducts);
      if (container) {
        container.style.opacity = '1';
      }
    }, 300);
  }

  async function addToCart(productId, productName) {
    console.log(' addToCart called with:', { productId, productName });
    console.log(' Current user:', currentUser);
    console.log(' Is staff:', isStaff);

    // Check if user is logged in
    if (!currentUser) {
      console.log(' User not logged in');
      showLoginPromptModal();
      return;
    }

    // Only clients can add to cart, staff should use management functions
    if (isStaff) {
      console.log(' Staff user trying to add to cart');
      alert('Staff users cannot add items to cart. Use Edit/Delete buttons to manage products.');
      return;
    }

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'add_to_cart',
          product_id: productId,
          quantity: 1
        })
      });

      const result = await response.json();
      console.log(' Add to cart response:', result);

      if (result.success) {
        // Update cart count display
        updateCartCount();

        // Show success message
        toast(`${productName} added to cart successfully!`, 'success');

        console.log(' Product successfully added to cart');
      } else {
        toast('Error: ' + result.message, 'error');
      }
    } catch (error) {
      console.error('Error adding to cart:', error);
      alert('Failed to add item to cart');
    }
  }

  async function updateCartCount() {
    console.log(' Updating cart count...');

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_cart' })
      });

      const result = await response.json();

      if (result.success) {
        const totalItems = result.item_count || 0;
        console.log(' Total items from backend:', totalItems);

        // Update cart count display
        const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
        console.log(' Found cart count elements:', cartCountElements.length);

        cartCountElements.forEach(element => {
          console.log(' Updating element:', element, 'to:', totalItems);
          element.textContent = totalItems;
        });

        // Show/hide cart icon based on item count
        const cartIcon = document.getElementById('cartIcon');
        if (cartIcon) {
          const displayStyle = totalItems > 0 ? 'block' : 'none';
          console.log(' Setting cart icon display:', displayStyle);
          cartIcon.style.display = displayStyle;
        }
      } else {
        console.log(' Error loading cart count:', result.message);
        // Set to 0 on error
        const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
        cartCountElements.forEach(element => {
          element.textContent = '0';
        });
        const cartIcon = document.getElementById('cartIcon');
        if (cartIcon) {
          cartIcon.style.display = 'none';
        }
      }
    } catch (error) {
      console.error(' Error updating cart count:', error);
      // Set to 0 on error
      const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
      cartCountElements.forEach(element => {
        element.textContent = '0';
      });
      const cartIcon = document.getElementById('cartIcon');
      if (cartIcon) {
        cartIcon.style.display = 'none';
      }
    }

    console.log(' Cart count update complete');
  }

  // Initialize form submission handlers when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    const addProductForm = document.getElementById('addProductForm');
    if (addProductForm) {
      addProductForm.addEventListener('submit', submitAddProduct);
    }

    const editProductForm = document.getElementById('editProductForm');
    if (editProductForm) {
      editProductForm.addEventListener('submit', submitEditProduct);
    }
  });

  // Staff Product Management Functions
  async function submitAddProduct(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const productData = {
      name: formData.get('name'),
      description: formData.get('description'),
      category: formData.get('category'),
      price: parseFloat(formData.get('price')),
      stock: parseInt(formData.get('stock'))
    };

    // Handle image upload
    const imageFile = document.getElementById('productImage').files[0];
    if (imageFile) {
      const imageBase64 = await fileToBase64(imageFile);
      productData.image_data = imageBase64;
      productData.image_name = imageFile.name;
    }

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'add_product', ...productData })
      });

      const result = await response.json();

      if (result.success) {
        alert('Product added successfully!');
        closeAddProductModal();
        loadProducts(); // Reload products
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      console.error('Error adding product:', error);
      alert('Failed to add product');
    }
  }

  async function editProduct(productId) {
    // Get product details
    const product = allProducts.find(p => p.id == productId);
    if (!product) {
      alert('Product not found');
      return;
    }

    // Populate edit modal with current product data
    document.getElementById('editProductId').value = product.id;
    document.getElementById('editProductName').value = product.name;
    document.getElementById('editProductDescription').value = product.description || '';
    document.getElementById('editProductCategory').value = product.category.toLowerCase();
    document.getElementById('editProductPrice').value = product.price;
    document.getElementById('editProductStock').value = product.stock;

    // Show edit modal
    document.getElementById('editProductModal').style.display = 'block';
  }

  async function deleteProduct(productId) {
    if (!confirm('Are you sure you want to delete this product?')) return;

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'delete_product', product_id: productId })
      });

      const result = await response.json();

      if (result.success) {
        alert('Product deleted successfully!');
        loadProducts(); // Reload products
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      console.error('Error deleting product:', error);
      alert('Failed to delete product');
    }
  }

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  // Edit Product Form Handler
  async function submitEditProduct(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const productData = {
      product_id: parseInt(formData.get('product_id')),
      name: formData.get('name'),
      description: formData.get('description'),
      category: formData.get('category'),
      price: parseFloat(formData.get('price')),
      stock: parseInt(formData.get('stock'))
    };

    // Handle image upload if provided
    const imageFile = document.getElementById('editProductImage').files[0];
    if (imageFile) {
      const imageBase64 = await fileToBase64(imageFile);
      productData.image_data = imageBase64;
      productData.image_name = imageFile.name;
    }

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'update_product', ...productData })
      });

      const result = await response.json();

      if (result.success) {
        alert('Product updated successfully!');
        closeEditProductModal();
        loadProducts(); // Reload products
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      console.error('Error updating product:', error);
      alert('Failed to update product');
    }
  }

  function showAddProductModal() {
    document.getElementById('addProductModal').style.display = 'block';
  }

  function closeAddProductModal() {
    document.getElementById('addProductModal').style.display = 'none';
    document.getElementById('addProductForm').reset();
  }

  function closeEditProductModal() {
    document.getElementById('editProductModal').style.display = 'none';
    document.getElementById('editProductForm').reset();
  }

  function showStaffOrderManagement() {
    console.log(' Manage Orders button clicked!');
    console.log(' Current user:', currentUser);
    console.log(' Current user type:', currentUser?.type);
    console.log(' Is staff:', isStaff);

    // Check if user is staff
    if (!currentUser || !isStaff) {
      console.log(' User is not staff or not logged in');
      console.log(' Current user object:', currentUser);
      console.log(' Is staff flag:', isStaff);
      alert('You must be logged in as staff to manage orders');
      return;
    }

    console.log(' Staff user detected, showing floating window');
    console.log(' User ID:', currentUser.id);
    console.log(' User name:', currentUser.name);
    // Show floating order management window
    showFloatingOrderWindow();
  }

  // Floating Order Window Functions
  function showFloatingOrderWindow() {
    const window = document.getElementById('floatingOrderWindow');
    const backdrop = document.getElementById('floatingBackdrop');

    if (window && backdrop) {
      window.classList.add('show');
      backdrop.classList.add('show');
      // Orders will be loaded on button click
    }
  }

  function closeFloatingOrderWindow() {
    const window = document.getElementById('floatingOrderWindow');
    const backdrop = document.getElementById('floatingBackdrop');

    if (window && backdrop) {
      window.classList.remove('show');
      backdrop.classList.remove('show');
    }
  }

  async function loadFloatingOrders() {
    try {
      console.log(' Loading floating orders...');
      const container = document.getElementById('floatingOrdersContainer');
      if (!container) {
        console.error(' Floating orders container not found');
        return;
      }

      // Show loading state
      container.innerHTML = `
        <div class="no-floating-orders">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading orders...</p>
          <small>Please wait while we fetch the latest orders.</small>
        </div>
      `;

      console.log(' Making API call to get_all_orders...');
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_all_orders' })
      });

      console.log(' Response status:', response.status);
      const result = await response.json();
      console.log(' API response:', result);

      if (result.success && result.data) {
        console.log(' Orders loaded successfully:', result.data.length, 'orders');
        displayFloatingOrders(result.data);
        updateFloatingOrderCount(result.data.length);
      } else {
        console.log(' No orders found or API error:', result.message);
        container.innerHTML = `
          <div class="no-floating-orders">
            <i class="fas fa-shopping-bag"></i>
            <p>No orders found</p>
            <small>No orders have been placed yet.</small>
          </div>
        `;
        updateFloatingOrderCount(0);
      }
    } catch (error) {
      console.error(' Error loading floating orders:', error);
      const container = document.getElementById('floatingOrdersContainer');
      if (container) {
        container.innerHTML = `
          <div class="no-floating-orders">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error loading orders</p>
            <small>Error: ${error.message}. Please try again later.</small>
          </div>
        `;
      }
      updateFloatingOrderCount(0);
    }
  }

  function displayFloatingOrders(orders) {
    const container = document.getElementById('floatingOrdersContainer');
    if (!container) return;

    if (orders.length === 0) {
      container.innerHTML = `
        <div class="no-floating-orders">
          <i class="fas fa-shopping-bag"></i>
          <p>No orders found</p>
          <small>No orders have been placed yet.</small>
        </div>
      `;
      updateFloatingOrderCount(0);
      return;
    }

    container.innerHTML = orders.map(order => createFloatingOrderCard(order)).join('');
    updateFloatingOrderCount(orders.length);
  }

  function createFloatingOrderCard(order) {
    const orderDate = new Date(order.order_date).toLocaleDateString();
    const orderTime = new Date(order.order_date).toLocaleTimeString();

    // Format payment method display
    const paymentMethodDisplay = {
      'gcash': 'GCash',
      'bank': 'Bank Transfer',
      'cash_on_visit': 'Cash on Visit'
    };

    const paymentMethod = paymentMethodDisplay[order.payment_method] || order.payment_method || 'Not specified';

    return `
      <div class="floating-order-card">
        <div class="floating-order-header-info">
          <div class="floating-order-info">
            <h4>Order #${order.id}</h4>
            <p>Customer: ${order.customer_name}</p>
            <p>Placed on ${orderDate} at ${orderTime}</p>
            <p>Payment: ${paymentMethod}</p>
          </div>
          <div class="floating-order-status status-${order.status.toLowerCase()}">
            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
          </div>
        </div>

        <div class="floating-order-items">
          ${order.items.map(item => `
            <div class="floating-order-item">
              <div class="item-details">
                <h5>${item.name}</h5>
                <p>${parseFloat(item.price).toFixed(2)}  ${item.quantity}</p>
              </div>
              <div class="item-subtotal">
                ${(item.price * item.quantity).toFixed(2)}
              </div>
            </div>
          `).join('')}
        </div>

        <div class="floating-order-summary">
          <div class="floating-order-total">
            <span>Total Amount:</span>
            <span>${parseFloat(order.total_amount).toFixed(2)}</span>
          </div>
        </div>

        <div class="floating-order-actions">
          <select onchange="updateFloatingOrderStatus(${order.id}, this.value)" class="floating-status-select">
            <option value="">Update Status</option>
            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
          </select>
        </div>
      </div>
    `;
  }

  function updateFloatingOrderCount(count) {
    const countElement = document.getElementById('floatingOrderCount');
    if (countElement) {
      countElement.textContent = `${count} Order${count !== 1 ? 's' : ''}`;
    }
  }

  async function updateFloatingOrderStatus(orderId, newStatus) {
    if (!newStatus) return;

    console.log(' Updating order status:', { orderId, newStatus });
    console.log(' Current user:', currentUser);
    console.log(' Is staff:', isStaff);

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'update_order_status',
          order_id: orderId,
          status: newStatus
        })
      });

      console.log(' API response status:', response.status);
      const result = await response.json();
      console.log(' API response:', result);

      if (result.success) {
        console.log(' Order status updated successfully');
        toast('Order status updated successfully!', 'success');
        loadFloatingOrders(); // Reload orders in floating window
        updateNotificationBadge(); // Update notification badge
      } else {
        console.error(' API error:', result.message);
        toast('Error: ' + result.message, 'error');
      }
    } catch (error) {
      console.error(' Network error updating order status:', error);
      toast('Failed to update order status: ' + error.message, 'error');
    }
  }

  async function loadStaffOrders() {
    try {
      const ordersList = document.getElementById('ordersList');
      if (!ordersList) return;

      // Show loading state
      ordersList.innerHTML = `
        <div class="no-orders">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading orders...</p>
          <small>Please wait while we fetch all orders.</small>
        </div>
      `;

      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_all_orders' })
      });

      const result = await response.json();

      if (result.success && result.data && result.data.length > 0) {
        displayStaffOrders(result.data);
      } else {
        ordersList.innerHTML = `
          <div class="no-orders">
            <i class="fas fa-shopping-bag"></i>
            <p>No orders found</p>
            <small>No orders have been placed yet.</small>
          </div>
        `;
      }
    } catch (error) {
      console.error('Error loading staff orders:', error);
      const ordersList = document.getElementById('ordersList');
      if (ordersList) {
        ordersList.innerHTML = `
          <div class="no-orders">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error loading orders</p>
            <small>Please try again later or contact support.</small>
          </div>
        `;
      }
    }
  }

  async function updateOrderStatusFromStore(orderId, newStatus) {
    if (!newStatus) return;

    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'update_order_status',
          order_id: orderId,
          status: newStatus
        })
      });

      const result = await response.json();

      if (result.success) {
        toast('Order status updated successfully!', 'success');
        loadStaffOrders(); // Reload orders in the window
      } else {
        toast('Error: ' + result.message, 'error');
      }
    } catch (error) {
      console.error('Error updating order status:', error);
      toast('Failed to update order status', 'error');
    }
  }

  // My Orders Functions - Make globally accessible
  window.showOrderStatus = function() {
    console.log(' showOrderStatus called');
    const modal = document.getElementById('orderStatusModal');
    const title = document.getElementById('orderModalTitle');

    console.log(' Modal found:', !!modal);
    console.log(' Title found:', !!title);
    console.log(' Current user:', currentUser);
    console.log(' Is staff:', isStaff);

    if (modal && title) {
      // Set title based on user type
      title.textContent = isStaff ? 'Staff Order Management' : 'My Orders';
      modal.style.display = 'flex';
      modal.classList.add('show');
      console.log(' Modal opened successfully');

      if (isStaff) {
        loadStaffOrders();
      } else {
        loadClientOrders();
      }
    } else {
      console.error(' Modal or title element not found');
      console.log('Available elements:', document.querySelectorAll('[id]'));
      alert('Modal not found. Please refresh the page.');
    }
  };

  // Close modal function - Make globally accessible
  window.closeOrderStatusModal = function() {
    console.log(' closeOrderStatusModal called');
    const modal = document.getElementById('orderStatusModal');
    if (modal) {
      modal.classList.remove('show');
      modal.style.display = 'none';
      console.log(' Modal closed successfully');
    } else {
      console.error(' Modal not found for closing');
    }
  };

  // Alias for better naming consistency
  function closeMyOrdersModal() {
    closeOrderStatusModal();
  }

  async function loadClientOrders() {
    try {
      const ordersList = document.getElementById('ordersList');
      if (!ordersList) return;

      // Show loading state
      ordersList.innerHTML = `
        <div class="no-orders">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading orders...</p>
          <small>Please wait while we fetch your order history.</small>
        </div>
      `;

      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_client_orders' })
      });

      const result = await response.json();

      if (result.success && result.data && result.data.length > 0) {
        displayClientOrders(result.data);
        updateOrderStatusCount(result.data.length);
      } else {
        ordersList.innerHTML = `
          <div class="no-orders">
            <i class="fas fa-receipt"></i>
            <p>No orders found</p>
            <small>You haven't placed any orders yet.</small>
          </div>
        `;
        updateOrderStatusCount(0);
      }
    } catch (error) {
      console.error('Error loading orders:', error);
      const ordersList = document.getElementById('ordersList');
      if (ordersList) {
        ordersList.innerHTML = `
          <div class="no-orders">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error loading orders</p>
            <small>Please try again later or contact support.</small>
          </div>
        `;
      }
      updateOrderStatusCount(0);
    }
  }

  function displayClientOrders(orders) {
    const ordersList = document.getElementById('ordersList');
    if (!ordersList) return;

    ordersList.innerHTML = orders.map(order => `
      <div class="order-card">
        <div class="order-header">
          <div class="order-info">
            <h4>Order #${order.id}</h4>
            <p>Placed on ${new Date(order.order_date).toLocaleDateString()}</p>
            <p class="order-date">${new Date(order.order_date).toLocaleTimeString()}</p>
          </div>
          <div class="order-status-badge status-${order.status.toLowerCase()}">
            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
          </div>
        </div>

        <div class="order-items">
          ${order.items.map(item => `
            <div class="order-item">
              <span class="item-name">${item.name}</span>
              <span class="item-quantity">Qty: ${item.quantity}</span>
            </div>
          `).join('')}
        </div>

        <div class="order-total">
          Total: ${parseFloat(order.total_amount).toFixed(2)}
        </div>
      </div>
    `).join('');
  }

  function displayStaffOrders(orders) {
    const ordersList = document.getElementById('ordersList');
    if (!ordersList) return;

    if (orders.length === 0) {
      ordersList.innerHTML = `
        <div class="no-orders">
          <i class="fas fa-shopping-bag"></i>
          <p>No orders found</p>
          <small>No orders have been placed yet.</small>
        </div>
      `;
      return;
    }

    ordersList.innerHTML = orders.map(order => createStaffOrderCard(order)).join('');
  }

  function createStaffOrderCard(order) {
    const orderDate = new Date(order.order_date).toLocaleDateString();
    const orderTime = new Date(order.order_date).toLocaleTimeString();

    // Format payment method display
    const paymentMethodDisplay = {
      'gcash': 'GCash',
      'bank': 'Bank Transfer',
      'cash_on_visit': 'Cash on Visit'
    };

    const paymentMethod = paymentMethodDisplay[order.payment_method] || order.payment_method || 'Not specified';

    return `
      <div class="order-card">
        <div class="order-header">
          <div class="order-info">
            <h4>Order #${order.id}</h4>
            <p>Customer: ${order.customer_name}</p>
            <p>Placed on ${orderDate} at ${orderTime}</p>
            <p>Payment: ${paymentMethod}</p>
          </div>
          <div class="order-status-badge status-${order.status.toLowerCase()}">
            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
          </div>
        </div>

        <div class="order-items">
          ${order.items.map(item => `
            <div class="order-item">
              <span class="item-name">${item.name}</span>
              <span class="item-quantity">${parseFloat(item.price).toFixed(2)}  ${item.quantity}</span>
            </div>
          `).join('')}
        </div>

        <div class="order-total">
          Total: ${parseFloat(order.total_amount).toFixed(2)}
        </div>

        <div class="order-actions" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
          <select onchange="updateOrderStatusFromStore(${order.id}, this.value)" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #1e40af; font-size: 14px;">
            <option value="">Update Status</option>
            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
          </select>
        </div>
      </div>
    `;
  }

  function updateOrderStatusCount(orderCount) {
    const countElement = document.getElementById('orderStatusCount');
    if (countElement) {
      countElement.textContent = orderCount > 0 ? orderCount : '0';
    }
  }

  function updateStoreOverview() {
    const totalProducts = allProducts.length;
    const totalValue = allProducts.reduce((sum, product) => sum + (parseFloat(product.price) * parseInt(product.stock)), 0);
    const lowStockItems = allProducts.filter(product => parseInt(product.stock) > 0 && parseInt(product.stock) < 10).length;
    const outOfStockItems = allProducts.filter(product => parseInt(product.stock) === 0).length;

    // Update overview cards
    const totalProductsEl = document.getElementById('totalProducts');
    const totalValueEl = document.getElementById('totalValue');
    const lowStockEl = document.getElementById('lowStockItems');
    const outOfStockEl = document.getElementById('outOfStockItems');

    if (totalProductsEl) totalProductsEl.textContent = totalProducts;
    if (totalValueEl) totalValueEl.textContent = '' + totalValue.toFixed(2);
    if (lowStockEl) lowStockEl.textContent = lowStockItems;
    if (outOfStockEl) outOfStockEl.textContent = outOfStockItems;

    console.log(' Store overview updated:', { totalProducts, totalValue, lowStockItems, outOfStockItems });
  }

  // Add some sample products if API fails (for demo purposes)
  function addSampleProducts() {
    const sampleProducts = [
      {
        id: 1,
        name: "Premium Dog Food",
        description: "High-quality dog food with balanced nutrition",
        category: "food",
        stock: 15,
        price: 25.99,
        image: "assets/images/products/product_1_1758624466.jpg"
      },
      {
        id: 2,
        name: "Cat Grooming Kit",
        description: "Complete grooming kit for cats",
        category: "grooming",
        stock: 8,
        price: 15.50,
        image: "assets/images/products/product_7_1758628396.jpg"
      },
      {
        id: 3,
        name: "Dog Collar",
        description: "Comfortable and stylish dog collar",
        category: "accessories",
        stock: 25,
        price: 12.99,
        image: "assets/images/products/product_8_1758629447.jpg"
      }
    ];

    allProducts = sampleProducts;
    displayProducts(sampleProducts);
    if (isStaff) {
      updateStoreOverview();
    }
  }

  // Toast notification function
  function toast(message, type = 'info') {
    // Remove existing toasts
    const existingToasts = document.querySelectorAll('.toast');
    existingToasts.forEach(toast => toast.remove());

    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
      <div class="toast-content">
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        <span>${message}</span>
      </div>
      <button onclick="this.parentElement.remove()" class="toast-close"></button>
    `;

    // Add to body
    document.body.appendChild(toast);

    // Show toast
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);

    // Auto remove after 3 seconds
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  // Initialize order status count for clients
  function initializeOrderStatusCount() {
    if (currentUser && !isStaff) {
      // Load orders count after a short delay to ensure authentication is complete
      setTimeout(() => {
        loadClientOrders();
      }, 1000);
    }
  }

  // Test function to verify modal functionality
  window.testMyOrdersModal = function() {
    console.log(' Testing My Orders modal...');
    const modal = document.getElementById('orderStatusModal');
    const button = document.querySelector('button[onclick*="showOrderStatus"]');

    console.log('Button found:', !!button);
    console.log('Modal found:', !!modal);

    if (button) {
      console.log('Button HTML:', button.outerHTML);
      console.log('Button visible:', button.offsetWidth > 0 && button.offsetHeight > 0);
    }

    if (modal) {
      console.log('Modal display:', modal.style.display);
      console.log('Modal class:', modal.className);
    }

    // Try to open modal directly
    if (modal) {
      modal.style.display = 'flex';
      modal.classList.add('show');
      console.log(' Modal opened via test function');
    } else {
      console.error(' Cannot test - modal not found');
    }
  };

  // Add keyboard support for floating window
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeFloatingOrderWindow();
      closeLoginPromptModal();
    }
  });

  // Close login prompt modal when clicking outside
  document.addEventListener('click', function(e) {
    const modal = document.getElementById('loginPromptModal');
    if (modal && modal.classList.contains('show')) {
      if (e.target === modal) {
        closeLoginPromptModal();
      }
    }
  });

  // Load products when page loads
  document.addEventListener('DOMContentLoaded', function() {
    checkUserAuthentication();

    // Initialize notification badge after a short delay
    setTimeout(() => {
      updateNotificationBadge();
    }, 2000);

    // Add event listener for view orders button
    const viewOrdersBtn = document.getElementById('viewOrdersBtn');
    if (viewOrdersBtn) {
      viewOrdersBtn.addEventListener('click', function() {
        loadFloatingOrders();
      });
    }
  });

  // Update notification badge function
  async function updateNotificationBadge() {
    try {
      const response = await fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_unread_count' })
      });

      const result = await response.json();

      if (result.success && result.data) {
        const unreadCount = parseInt(result.data.unread_count) || 0;

        // Update mobile menu toggle badge (if it exists)
        const mobileToggle = document.querySelector('.mobile-menu-toggle');
        if (mobileToggle) {
          let badge = mobileToggle.querySelector('.notification-badge');
          if (!badge) {
            badge = document.createElement('div');
            badge.className = 'notification-badge';
            mobileToggle.appendChild(badge);
          }

          if (unreadCount > 0) {
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            badge.style.display = 'flex';
          } else {
            badge.style.display = 'none';
          }
        }

        console.log(` Notification badge updated: ${unreadCount} unread notifications`);
      }
    } catch (error) {
      console.error('Error updating notification badge:', error);
    }
  }

    function showSection(sectionName) {
       // Hide all sections with fade out animation
       const sections = document.querySelectorAll('.content-section');
       sections.forEach(section => {
         if (section.style.display !== 'none') {
           section.style.opacity = '0';
           section.style.transform = 'translateY(20px)';
           setTimeout(() => {
             section.style.display = 'none';
             section.classList.add('hidden');
           }, 300); // Match CSS transition duration
         } else {
           section.classList.add('hidden');
         }
       });

       // Remove active class from all nav items
       const navItems = document.querySelectorAll('.nav-item');
       navItems.forEach(item => {
         item.classList.remove('active');
       });

       // Show selected section with smooth animation
       const targetSection = document.getElementById(sectionName + 'Section');
       if (targetSection) {
         targetSection.classList.remove('hidden');
         // Force reflow to ensure display change takes effect
         targetSection.offsetHeight;
         targetSection.style.display = 'block';

         // Animate in
         setTimeout(() => {
           targetSection.style.opacity = '1';
           targetSection.style.transform = 'translateY(0)';
         }, 50);

         // Load section-specific data
         if (sectionName === 'store' && window.dashboardInstance) {
           window.dashboardInstance.loadStoreSection();
         } else if (sectionName === 'appointments' && window.dashboardInstance) {
           window.dashboardInstance.loadAppointmentsSection();
         } else if (sectionName === 'pets' && window.dashboardInstance) {
           window.dashboardInstance.loadPetsSection();
         } else if (sectionName === 'reports') {
           initializeReportsSection();
         } else if (sectionName === 'settings') {
           initializeSettingsSection();
         } else if (sectionName === 'logout') {
           handleLogout();
           return;
         }
       }

       // Add active class to clicked nav item
       const activeNavItem = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
       if (activeNavItem) {
         activeNavItem.classList.add('active');
       }

       // Update page title
       const titles = {
         'dashboard': '<i class="fas fa-paw"></i> Welcome to Your Dashboard',
         'appointments': '<i class="fas fa-calendar-alt"></i> My Appointments',
         'pets': '<i class="fas fa-paw"></i> My Pets',
         'store': '<i class="fas fa-store"></i> Pet Store',
         'orders': '<i class="fas fa-shopping-bag"></i> My Orders',
         'reports': '<i class="fas fa-file-pdf"></i> Pet Reports',
         'settings': '<i class="fas fa-cog"></i> Settings'
       };

       const pageTitle = document.getElementById('pageTitle');
       if (pageTitle && titles[sectionName]) {
         pageTitle.innerHTML = titles[sectionName];
       }

       // Load products when store section is shown
       if (sectionName === 'store') {
         loadClientProducts();
       }

       // Load pets when pets section is shown
       if (sectionName === 'pets') {
         loadClientPets();
       }
     }


   // Staff Management Functions
   function showStaffInterface() {
     console.log(' Showing staff interface...');
     document.getElementById('staffPanel').style.display = 'block';
     document.getElementById('loginRequired').style.display = 'none';
     document.getElementById('filter-buttons').style.display = 'flex';

     // Refresh products to show staff controls
     loadProducts();
     console.log(' Staff interface shown successfully');
   }

   function showAddProductModal() {
     document.getElementById('addProductModal').style.display = 'block';
   }

   function closeAddProductModal() {
     document.getElementById('addProductModal').style.display = 'none';
     document.getElementById('addProductForm').reset();
   }

   function closeEditProductModal() {
     document.getElementById('editProductModal').style.display = 'none';
     document.getElementById('editProductForm').reset();
   }

   async function submitAddProduct(event) {
     event.preventDefault();

     const formData = new FormData(event.target);
     const productData = {
       name: formData.get('name'),
       description: formData.get('description'),
       category: formData.get('category'),
       price: parseFloat(formData.get('price')),
       stock: parseInt(formData.get('stock'))
     };

     // Handle image upload
     const imageFile = document.getElementById('productImage').files[0];
     if (imageFile) {
       const imageBase64 = await fileToBase64(imageFile);
       productData.image_data = imageBase64;
       productData.image_name = imageFile.name;
     }

     try {
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'add_product', ...productData })
       });

       const result = await response.json();

       if (result.success) {
         alert('Product added successfully!');
         closeAddProductModal();
         loadProducts(); // Reload products
       } else {
         alert('Error: ' + result.message);
       }
     } catch (error) {
       console.error('Error adding product:', error);
       alert('Failed to add product');
     }
   }

   async function editProduct(productId) {
     // Get product details
     const product = allProducts.find(p => p.id == productId);
     if (!product) {
       alert('Product not found');
       return;
     }

     // Populate edit modal with current product data
     document.getElementById('editProductId').value = product.id;
     document.getElementById('editProductName').value = product.name;
     document.getElementById('editProductDescription').value = product.description || '';
     document.getElementById('editProductCategory').value = product.category.toLowerCase();
     document.getElementById('editProductPrice').value = product.price;
     document.getElementById('editProductStock').value = product.stock;

     // Show edit modal
     document.getElementById('editProductModal').style.display = 'block';
   }

   async function deleteProduct(productId) {
     if (!confirm('Are you sure you want to delete this product?')) return;

     try {
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'delete_product', product_id: productId })
       });

       const result = await response.json();

       if (result.success) {
         alert('Product deleted successfully!');
         loadProducts(); // Reload products
       } else {
         alert('Error: ' + result.message);
       }
     } catch (error) {
       console.error('Error deleting product:', error);
       alert('Failed to delete product');
     }
   }

   function fileToBase64(file) {
     return new Promise((resolve, reject) => {
       const reader = new FileReader();
       reader.onload = () => resolve(reader.result);
       reader.onerror = reject;
       reader.readAsDataURL(file);
     });
   }

   // Edit Product Form Handler
   async function submitEditProduct(event) {
     event.preventDefault();

     const formData = new FormData(event.target);
     const productData = {
       product_id: parseInt(formData.get('product_id')),
       name: formData.get('name'),
       description: formData.get('description'),
       category: formData.get('category'),
       price: parseFloat(formData.get('price')),
       stock: parseInt(formData.get('stock'))
     };

     // Handle image upload if provided
     const imageFile = document.getElementById('editProductImage').files[0];
     if (imageFile) {
       const imageBase64 = await fileToBase64(imageFile);
       productData.image_data = imageBase64;
       productData.image_name = imageFile.name;
     }

     try {
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'update_product', ...productData })
       });

       const result = await response.json();

       if (result.success) {
         alert('Product updated successfully!');
         closeEditProductModal();
         loadProducts(); // Reload products
       } else {
         alert('Error: ' + result.message);
       }
     } catch (error) {
       console.error('Error updating product:', error);
       alert('Failed to update product');
     }
   }

   function showStaffOrderManagement() {
     console.log(' Manage Orders button clicked!');
     console.log(' Current user:', currentUser);
     console.log(' Current user type:', currentUser?.type);
     console.log(' Is staff:', isStaff);

     // Check if user is staff
     if (!currentUser || !isStaff) {
       console.log(' User is not staff or not logged in');
       console.log(' Current user object:', currentUser);
       console.log(' Is staff flag:', isStaff);
       alert('You must be logged in as staff to manage orders');
       return;
     }

     console.log(' Staff user detected, showing floating window');
     console.log(' User ID:', currentUser.id);
     console.log(' User name:', currentUser.name);
     // Show floating order management window
     showFloatingOrderWindow();
   }

   // Floating Order Window Functions
   function showFloatingOrderWindow() {
     const window = document.getElementById('floatingOrderWindow');
     const backdrop = document.getElementById('floatingBackdrop');

     if (window && backdrop) {
       window.classList.add('show');
       backdrop.classList.add('show');
       // Orders will be loaded on button click
     }
   }

   function closeFloatingOrderWindow() {
     const window = document.getElementById('floatingOrderWindow');
     const backdrop = document.getElementById('floatingBackdrop');

     if (window && backdrop) {
       window.classList.remove('show');
       backdrop.classList.remove('show');
     }
   }

   async function loadFloatingOrders() {
     try {
       console.log(' Loading floating orders...');
       const container = document.getElementById('floatingOrdersContainer');
       if (!container) {
         console.error(' Floating orders container not found');
         return;
       }

       // Show loading state
       container.innerHTML = `
         <div class="no-floating-orders">
           <i class="fas fa-spinner fa-spin"></i>
           <p>Loading orders...</p>
           <small>Please wait while we fetch the latest orders.</small>
         </div>
       `;

       console.log(' Making API call to get_all_orders...');
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'get_all_orders' })
       });

       console.log(' Response status:', response.status);
       const result = await response.json();
       console.log(' API response:', result);

       if (result.success && result.data) {
         console.log(' Orders loaded successfully:', result.data.length, 'orders');
         displayFloatingOrders(result.data);
         updateFloatingOrderCount(result.data.length);
       } else {
         console.log(' No orders found or API error:', result.message);
         container.innerHTML = `
           <div class="no-floating-orders">
             <i class="fas fa-shopping-bag"></i>
             <p>No orders found</p>
             <small>No orders have been placed yet.</small>
           </div>
         `;
         updateFloatingOrderCount(0);
       }
     } catch (error) {
       console.error(' Error loading floating orders:', error);
       const container = document.getElementById('floatingOrdersContainer');
       if (container) {
         container.innerHTML = `
           <div class="no-floating-orders">
             <i class="fas fa-exclamation-triangle"></i>
             <p>Error loading orders</p>
             <small>Error: ${error.message}. Please try again later.</small>
           </div>
         `;
       }
       updateFloatingOrderCount(0);
     }
   }

   function displayFloatingOrders(orders) {
     const container = document.getElementById('floatingOrdersContainer');
     if (!container) return;

     if (orders.length === 0) {
       container.innerHTML = `
         <div class="no-floating-orders">
           <i class="fas fa-shopping-bag"></i>
           <p>No orders found</p>
           <small>No orders have been placed yet.</small>
         </div>
       `;
       updateFloatingOrderCount(0);
       return;
     }

     container.innerHTML = orders.map(order => createFloatingOrderCard(order)).join('');
     updateFloatingOrderCount(orders.length);
   }

   function createFloatingOrderCard(order) {
     const orderDate = new Date(order.order_date).toLocaleDateString();
     const orderTime = new Date(order.order_date).toLocaleTimeString();

     // Format payment method display
     const paymentMethodDisplay = {
       'gcash': 'GCash',
       'bank': 'Bank Transfer',
       'cash_on_visit': 'Cash on Visit'
     };

     const paymentMethod = paymentMethodDisplay[order.payment_method] || order.payment_method || 'Not specified';

     return `
       <div class="floating-order-card">
         <div class="floating-order-header-info">
           <div class="floating-order-info">
             <h4>Order #${order.id}</h4>
             <p>Customer: ${order.customer_name}</p>
             <p>Placed on ${orderDate} at ${orderTime}</p>
             <p>Payment: ${paymentMethod}</p>
           </div>
           <div class="floating-order-status status-${order.status.toLowerCase()}">
             ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
           </div>
         </div>

         <div class="floating-order-items">
           ${order.items.map(item => `
             <div class="floating-order-item">
               <div class="item-details">
                 <h5>${item.name}</h5>
                 <p>${parseFloat(item.price).toFixed(2)}  ${item.quantity}</p>
               </div>
               <div class="item-subtotal">
                 ${(item.price * item.quantity).toFixed(2)}
               </div>
             </div>
           `).join('')}
         </div>

         <div class="floating-order-summary">
           <div class="floating-order-total">
             <span>Total Amount:</span>
             <span>${parseFloat(order.total_amount).toFixed(2)}</span>
           </div>
         </div>

         <div class="floating-order-actions">
           <select onchange="updateFloatingOrderStatus(${order.id}, this.value)" class="floating-status-select">
             <option value="">Update Status</option>
             <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
             <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
             <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
             <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
             <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
           </select>
         </div>
       </div>
     `;
   }

   function updateFloatingOrderCount(count) {
     const countElement = document.getElementById('floatingOrderCount');
     if (countElement) {
       countElement.textContent = `${count} Order${count !== 1 ? 's' : ''}`;
     }
   }

   async function updateFloatingOrderStatus(orderId, newStatus) {
     if (!newStatus) return;

     console.log(' Updating order status:', { orderId, newStatus });
     console.log(' Current user:', currentUser);
     console.log(' Is staff:', isStaff);

     try {
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           action: 'update_order_status',
           order_id: orderId,
           status: newStatus
         })
       });

       console.log(' API response status:', response.status);
       const result = await response.json();
       console.log(' API response:', result);

       if (result.success) {
         console.log(' Order status updated successfully');
         toast('Order status updated successfully!', 'success');
         loadFloatingOrders(); // Reload orders in floating window
         updateNotificationBadge(); // Update notification badge
       } else {
         console.error(' API error:', result.message);
         toast('Error: ' + result.message, 'error');
       }
     } catch (error) {
       console.error(' Network error updating order status:', error);
       toast('Failed to update order status: ' + error.message, 'error');
     }
   }

   async function loadStaffOrders() {
     try {
       const ordersList = document.getElementById('ordersList');
       if (!ordersList) return;

       // Show loading state
       ordersList.innerHTML = `
         <div class="no-orders">
           <i class="fas fa-spinner fa-spin"></i>
           <p>Loading orders...</p>
           <small>Please wait while we fetch all orders.</small>
         </div>
       `;

       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'get_all_orders' })
       });

       const result = await response.json();

       if (result.success && result.data && result.data.length > 0) {
         displayStaffOrders(result.data);
       } else {
         ordersList.innerHTML = `
           <div class="no-orders">
             <i class="fas fa-shopping-bag"></i>
             <p>No orders found</p>
             <small>No orders have been placed yet.</small>
           </div>
         `;
       }
     } catch (error) {
       console.error('Error loading staff orders:', error);
       const ordersList = document.getElementById('ordersList');
       if (ordersList) {
         ordersList.innerHTML = `
           <div class="no-orders">
             <i class="fas fa-exclamation-triangle"></i>
             <p>Error loading orders</p>
             <small>Please try again later or contact support.</small>
           </div>
         `;
       }
     }
   }

   async function updateOrderStatusFromStore(orderId, newStatus) {
     if (!newStatus) return;

     try {
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           action: 'update_order_status',
           order_id: orderId,
           status: newStatus
         })
       });

       const result = await response.json();

       if (result.success) {
         toast('Order status updated successfully!', 'success');
         loadStaffOrders(); // Reload orders in the window
       } else {
         toast('Error: ' + result.message, 'error');
       }
     } catch (error) {
       console.error('Error updating order status:', error);
       toast('Failed to update order status', 'error');
     }
   }

   // My Orders Functions
   function showOrderStatus() {
     const modal = document.getElementById('orderStatusModal');
     const title = document.getElementById('orderModalTitle');
     if (modal && title) {
       // Set title based on user type
       title.textContent = isStaff ? 'Staff Order Management' : 'My Orders';
       modal.classList.add('show');
       if (isStaff) {
         loadStaffOrders();
       } else {
         loadClientOrders();
       }
     }
   }

   function closeOrderStatusModal() {
     const modal = document.getElementById('orderStatusModal');
     if (modal) {
       modal.classList.remove('show');
     }
   }

   async function loadClientOrders() {
     try {
       const ordersList = document.getElementById('ordersList');
       if (!ordersList) return;

       // Show loading state
       ordersList.innerHTML = `
         <div class="no-orders">
           <i class="fas fa-spinner fa-spin"></i>
           <p>Loading orders...</p>
           <small>Please wait while we fetch your order history.</small>
         </div>
       `;

       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ action: 'get_client_orders' })
       });

       const result = await response.json();

       if (result.success && result.data && result.data.length > 0) {
         displayClientOrders(result.data);
         updateOrderStatusCount(result.data.length);
       } else {
         ordersList.innerHTML = `
           <div class="no-orders">
             <i class="fas fa-receipt"></i>
             <p>No orders found</p>
             <small>You haven't placed any orders yet.</small>
           </div>
         `;
         updateOrderStatusCount(0);
       }
     } catch (error) {
       console.error('Error loading orders:', error);
       const ordersList = document.getElementById('ordersList');
       if (ordersList) {
         ordersList.innerHTML = `
           <div class="no-orders">
             <i class="fas fa-exclamation-triangle"></i>
             <p>Error loading orders</p>
             <small>Please try again later or contact support.</small>
           </div>
         `;
       }
       updateOrderStatusCount(0);
     }
   }

   function displayClientOrders(orders) {
     const ordersList = document.getElementById('ordersList');
     if (!ordersList) return;

     ordersList.innerHTML = orders.map(order => `
       <div class="order-card">
         <div class="order-header">
           <div class="order-info">
             <h4>Order #${order.id}</h4>
             <p>Placed on ${new Date(order.order_date).toLocaleDateString()}</p>
             <p class="order-date">${new Date(order.order_date).toLocaleTimeString()}</p>
           </div>
           <div class="order-status-badge status-${order.status.toLowerCase()}">
             ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
           </div>
         </div>

         <div class="order-items">
           ${order.items.map(item => `
             <div class="order-item">
               <span class="item-name">${item.name}</span>
               <span class="item-quantity">Qty: ${item.quantity}</span>
             </div>
           `).join('')}
         </div>

         <div class="order-total">
           Total: ${parseFloat(order.total_amount).toFixed(2)}
         </div>
       </div>
     `).join('');
   }

   function displayStaffOrders(orders) {
     const ordersList = document.getElementById('ordersList');
     if (!ordersList) return;

     if (orders.length === 0) {
       ordersList.innerHTML = `
         <div class="no-orders">
           <i class="fas fa-shopping-bag"></i>
           <p>No orders found</p>
           <small>No orders have been placed yet.</small>
         </div>
       `;
       return;
     }

     ordersList.innerHTML = orders.map(order => createStaffOrderCard(order)).join('');
   }

   function createStaffOrderCard(order) {
     const orderDate = new Date(order.order_date).toLocaleDateString();
     const orderTime = new Date(order.order_date).toLocaleTimeString();

     // Format payment method display
     const paymentMethodDisplay = {
       'gcash': 'GCash',
       'bank': 'Bank Transfer',
       'cash_on_visit': 'Cash on Visit'
     };

     const paymentMethod = paymentMethodDisplay[order.payment_method] || order.payment_method || 'Not specified';

     return `
       <div class="order-card">
         <div class="order-header">
           <div class="order-info">
             <h4>Order #${order.id}</h4>
             <p>Customer: ${order.customer_name}</p>
             <p>Placed on ${orderDate} at ${orderTime}</p>
             <p>Payment: ${paymentMethod}</p>
           </div>
           <div class="order-status-badge status-${order.status.toLowerCase()}">
             ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
           </div>
         </div>

         <div class="order-items">
           ${order.items.map(item => `
             <div class="order-item">
               <span class="item-name">${item.name}</span>
               <span class="item-quantity">${parseFloat(item.price).toFixed(2)}  ${item.quantity}</span>
             </div>
           `).join('')}
         </div>

         <div class="order-total">
           Total: ${parseFloat(order.total_amount).toFixed(2)}
         </div>

         <div class="order-actions" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
           <select onchange="updateOrderStatusFromStore(${order.id}, this.value)" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #1e40af; font-size: 14px;">
             <option value="">Update Status</option>
             <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
             <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
             <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
             <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
             <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
           </select>
         </div>
       </div>
     `;
   }

   function updateOrderStatusCount(orderCount) {
     const countElement = document.getElementById('orderStatusCount');
     if (countElement) {
       countElement.textContent = orderCount > 0 ? orderCount : '0';
     }
   }

   function updateStoreOverview() {
     const totalProducts = allProducts.length;
     const totalValue = allProducts.reduce((sum, product) => sum + (parseFloat(product.price) * parseInt(product.stock)), 0);
     const lowStockItems = allProducts.filter(product => parseInt(product.stock) > 0 && parseInt(product.stock) < 10).length;
     const outOfStockItems = allProducts.filter(product => parseInt(product.stock) === 0).length;

     // Update overview cards
     const totalProductsEl = document.getElementById('totalProducts');
     const totalValueEl = document.getElementById('totalValue');
     const lowStockEl = document.getElementById('lowStockItems');
     const outOfStockEl = document.getElementById('outOfStockItems');

     if (totalProductsEl) totalProductsEl.textContent = totalProducts;
     if (totalValueEl) totalValueEl.textContent = '' + totalValue.toFixed(2);
     if (lowStockEl) lowStockEl.textContent = lowStockItems;
     if (outOfStockEl) outOfStockEl.textContent = outOfStockItems;

     console.log(' Store overview updated:', { totalProducts, totalValue, lowStockItems, outOfStockItems });
   }

   // Product Image Upload Functions
   function triggerImageUpload(productId) {
     // Create a hidden file input
     const fileInput = document.createElement('input');
     fileInput.type = 'file';
     fileInput.accept = 'image/*';
     fileInput.style.display = 'none';

     // Handle file selection
     fileInput.onchange = async function(event) {
       const file = event.target.files[0];
       if (file) {
         await uploadProductImage(productId, file);
       }
     };

     // Trigger file selection
     document.body.appendChild(fileInput);
     fileInput.click();
     document.body.removeChild(fileInput);
   }

   async function uploadProductImage(productId, file) {
     if (!file) return;

     // Show loading state
     const productCard = document.querySelector(`[data-id="${productId}"]`);
     const imageContainer = productCard.querySelector('.product-image-container');
     const originalCursor = imageContainer.style.cursor;
     imageContainer.style.cursor = 'wait';
     imageContainer.style.opacity = '0.7';

     try {
       // Convert file to base64
       const imageBase64 = await fileToBase64(file);

       // Upload image via API
       const response = await fetch('../api/vet_api.php', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           action: 'upload_product_image',
           product_id: productId,
           image_data: imageBase64,
           image_name: file.name
         })
       });

       const result = await response.json();

       if (result.success) {
         alert('Product image updated successfully!');
         loadProducts(); // Reload to show new image
       } else {
         alert('Error: ' + result.message);
       }
     } catch (error) {
       console.error('Error uploading image:', error);
       alert('Failed to upload image');
     } finally {
       // Restore cursor and opacity
       imageContainer.style.cursor = originalCursor;
       imageContainer.style.opacity = '1';
     }
   }

    // Load products for client store
    async function loadClientProducts() {
      const productsGrid = document.getElementById('storeProductsGrid');
      if (!productsGrid) return;

      try {
        productsGrid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading products...</div>';

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_products' })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();

        // Debug: Log the API response
        console.log('API Response:', result);

        if (result.success && result.data && Array.isArray(result.data)) {
          console.log('Products received:', result.data.length, 'products');
          allProducts = result.data;
          if (result.data.length === 0) {
            productsGrid.innerHTML = '<div class="loading"><p>No products available at the moment. Please check back later!</p></div>';
          } else {
            displayClientProducts(result.data);
            // Update store overview for staff
            if (isStaff) {
              updateStoreOverview();
            }
          }
        } else {
          const errorMessage = result.message || 'Failed to load products';
          console.error('API Error:', errorMessage);
          console.error('Full API response:', result);
          productsGrid.innerHTML = `<div class="loading"><p>Unable to load products: ${errorMessage}</p></div>`;
          // Load sample products as fallback
          addSampleProducts();
        }
      } catch (error) {
        console.error('Error loading products:', error);
        productsGrid.innerHTML = '<div class="loading"><p>Error loading products. Please try again later.</p></div>';
        // Load sample products as fallback
        addSampleProducts();
      }
    }

    // Add sample products as fallback
    function addSampleProducts() {
      const sampleProducts = [
        {
          id: 1,
          name: "Premium Dog Food",
          description: "High-quality dog food with balanced nutrition",
          category: "food",
          stock: 15,
          price: 25.99,
          image: "assets/images/products/product_1_1758624466.jpg"
        },
        {
          id: 2,
          name: "Cat Grooming Kit",
          description: "Complete grooming kit for cats",
          category: "grooming",
          stock: 8,
          price: 15.50,
          image: "assets/images/products/product_7_1758628396.jpg"
        },
        {
          id: 3,
          name: "Dog Collar",
          description: "Comfortable and stylish dog collar",
          category: "accessories",
          stock: 25,
          price: 12.99,
          image: "assets/images/products/product_8_1758629447.jpg"
        }
      ];

      allProducts = sampleProducts;
      displayClientProducts(sampleProducts);
      console.log('Sample products loaded as fallback');
    }

    // Filter products by category
    function filterProducts(category) {
      console.log(' Category filter clicked:', category);
      const productsGrid = document.getElementById('storeProductsGrid');
      if (!productsGrid) return;

      // Update active category tab
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Highlight the corresponding category tab
      const categoryTab = document.querySelector(`[data-category="${category}"]`);
      if (categoryTab) {
        categoryTab.classList.add('active');
      }

      // Show loading state
      productsGrid.style.opacity = '0.5';

      // Filter products
      let filteredProducts = allProducts;

      if (category !== 'all') {
        filteredProducts = allProducts.filter(product =>
          product.category && product.category.toLowerCase() === category.toLowerCase()
        );
        // If no products match the category, show all products
        if (filteredProducts.length === 0) {
          filteredProducts = allProducts;
        }
      }

      // Add small delay for better UX
      setTimeout(() => {
        displayClientProducts(filteredProducts);
        productsGrid.style.opacity = '1';
      }, 300);
    }

    function displayClientProducts(products) {
      const productsGrid = document.getElementById('storeProductsGrid');
      if (!productsGrid) return;

      if (!products || products.length === 0) {
        productsGrid.innerHTML = '<div class="loading"><p>No products available at the moment.</p></div>';
        return;
      }

      try {
        productsGrid.innerHTML = products.map(product => createClientProductCard(product)).join('');
      } catch (error) {
        console.error('Error displaying products:', error);
        productsGrid.innerHTML = '<div class="loading"><p>Error displaying products. Please try again.</p></div>';
      }
      // updateStoreOverview();
    }

    function updateStoreOverview() {
      const totalProducts = allProducts.length;
      const totalValue = allProducts.reduce((sum, product) => sum + (parseFloat(product.price) * parseInt(product.stock)), 0);
      const lowStockItems = allProducts.filter(product => parseInt(product.stock) > 0 && parseInt(product.stock) < 10).length;
      const outOfStockItems = allProducts.filter(product => parseInt(product.stock) === 0).length;

      // Update overview cards
      const totalProductsEl = document.getElementById('totalProducts');
      const totalValueEl = document.getElementById('totalValue');
      const lowStockEl = document.getElementById('lowStockItems');
      const outOfStockEl = document.getElementById('outOfStockItems');

      if (totalProductsEl) totalProductsEl.textContent = totalProducts;
      if (totalValueEl) totalValueEl.textContent = '' + totalValue.toFixed(2);
      if (lowStockEl) lowStockEl.textContent = lowStockItems;
      if (outOfStockEl) outOfStockEl.textContent = outOfStockItems;

      console.log(' Store overview updated:', { totalProducts, totalValue, lowStockItems, outOfStockItems });
    }

    function createClientProductCard(product) {
      // Handle image loading with better error handling
      let imageHtml = '';
      let placeholderHtml = '<div class="product-image-placeholder" style="display: flex;"><i class="fas fa-image"></i></div>';

      if (product.image && product.image.trim() !== '' && product.image !== null && product.image !== 'null') {
        // Debug: Log the image path to console
        console.log('Product image path:', product.image, 'for product:', product.name);

        // Try multiple possible image paths
        const imagePaths = [
          product.image, // Original path
          product.image.replace(/\.(jpg|jpeg|png)$/i, '.jpg'), // Try as .jpg
          product.image.replace(/\.(jpg|jpeg|png)$/i, '.png'), // Try as .png
        ];

        // Remove duplicates and empty paths
        const uniquePaths = [...new Set(imagePaths)].filter(path => path && path.trim() !== '');

        if (uniquePaths.length > 0) {
          // Try multiple path variations to ensure we find the correct one
          const possiblePaths = [];

          uniquePaths.forEach(path => {
            // Try with full prefix
            if (path.startsWith('assets/images/products/')) {
              possiblePaths.push('../' + path);
            } else {
              possiblePaths.push('../assets/images/products/' + path);
            }

            // Also try without the ../ prefix
            if (path.startsWith('assets/images/products/')) {
              possiblePaths.push(path);
            } else {
              possiblePaths.push('assets/images/products/' + path);
            }
          });

          // Remove duplicates
          const finalPaths = [...new Set(possiblePaths)];
          const correctPath = finalPaths[0];

          console.log(' Client Dashboard: Final image path for', product.name, ':', correctPath);
          console.log(' Client Dashboard: All possible paths:', finalPaths);

          imageHtml = `<img src="${correctPath}" alt="${product.name}"
            onload="const container = this.closest('.product-image'); if (container) { const placeholder = container.querySelector('.product-image-placeholder'); if (placeholder) placeholder.style.display = 'none'; }"
            onerror="tryNextImage(this, '${product.image}', '${finalPaths.join('|')}')"
            loading="lazy">`;

          // Show placeholder initially since image is loading
          placeholderHtml = '<div class="product-image-placeholder" style="display: flex;"><i class="fas fa-image"></i></div>';
        }
      } else {
        console.log('No image path for product:', product.name);
        // No image, show placeholder
        placeholderHtml = '<div class="product-image-placeholder" style="display: flex;"><i class="fas fa-image"></i></div>';
        imageHtml = '';
      }

      const stockClass = product.stock === 0 ? 'stock-out' : product.stock < 10 ? 'stock-low' : 'stock-good';
      const stockText = product.stock === 0 ? 'Out of Stock' : product.stock < 10 ? 'Low Stock' : 'In Stock';

      // Buttons - disabled if out of stock
      const buttons = product.stock === 0
        ? `<button class="add-to-cart-btn" disabled title="Out of Stock">
            Out of Stock
          </button>`
        : `<button class="add-to-cart-btn" onclick="addToCartWithFeedback(this, ${product.id}, '${product.name}', ${product.price})" title="Add to Cart - Opens cart automatically">
            <i class="fas fa-shopping-cart"></i> Add to Cart
          </button>`;

      const inStockClass = product.stock > 0 ? 'in-stock' : '';

      // Staff controls
      let staffControls = '';
      if (isStaff) {
        staffControls = `
          <div class="image-overlay">
            <i class="fas fa-camera"></i> Click to upload image
          </div>
        `;
        buttons += `
          <button class="edit-btn" onclick="editProduct(${product.id})">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="delete-btn" onclick="deleteProduct(${product.id})">
            <i class="fas fa-trash"></i> Delete
          </button>
        `;
      }

      const imageContainerClass = isStaff ? 'product-image-container staff-clickable' : 'product-image-container';
      const imageContainerOnclick = isStaff ? `onclick="triggerImageUpload(${product.id})"` : '';

      return `
        <div class="product-card ${inStockClass}">
          <div class="${imageContainerClass}" ${imageContainerOnclick}>
            ${imageHtml}
            ${placeholderHtml}
            ${staffControls}
          </div>
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-category">${product.category}</div>
            <p class="product-description">${product.description || 'No description available'}</p>
            <div class="product-details">
              <div class="product-price">${parseFloat(product.price).toFixed(2)}</div>
              <div class="product-stock">
                <span class="stock-badge ${stockClass}">${stockText} (${product.stock})</span>
              </div>
            </div>
            <div class="product-actions">
              ${buttons}
            </div>
          </div>
        </div>
      `;
    }

    // Cart functionality
    let cart = JSON.parse(localStorage.getItem('clientCart') || '[]');

    // Global variables for store management
    let currentCategoryFilter = 'all';

    // Function to try next image path when current one fails
    function tryNextImage(img, originalImage, pipeSeparatedPaths) {
      const imagePaths = pipeSeparatedPaths.split('|').filter(path => path && path.trim() !== '');

      // Debug: Log the attempt
      console.log('Trying next image for:', originalImage, 'Remaining paths:', imagePaths);

      // If no more paths to try, hide image and show placeholder
      if (imagePaths.length === 0) {
        console.log('No more paths to try, hiding image for:', originalImage);
        img.style.display = 'none';

        // Find and show placeholder
        const productImageContainer = img.closest('.product-image');
        if (productImageContainer) {
          const placeholder = productImageContainer.querySelector('.product-image-placeholder');
          if (placeholder) {
            placeholder.style.display = 'flex';
          }
        }
        return;
      }

      // Try multiple path variations for the first path
      const currentPath = imagePaths[0];
      const possiblePaths = [];

      // Try with full prefix
      if (currentPath.startsWith('assets/images/products/')) {
        possiblePaths.push('../' + currentPath);
      } else {
        possiblePaths.push('../assets/images/products/' + currentPath);
      }

      // Also try without the ../ prefix
      if (currentPath.startsWith('assets/images/products/')) {
        possiblePaths.push(currentPath);
      } else {
        possiblePaths.push('assets/images/products/' + currentPath);
      }

      const nextPath = possiblePaths[0];
      console.log('Trying path:', nextPath, 'for image:', originalImage);
      console.log('All possible paths for this attempt:', possiblePaths);

      img.src = nextPath;
      img.onerror = function() {
        // Remove the failed path and try again with remaining paths
        const remainingPaths = imagePaths.slice(1);
        if (remainingPaths.length > 0) {
          tryNextImage(img, originalImage, remainingPaths.join('|'));
        } else {
          // No more paths, hide image and show placeholder
          console.log('All paths failed for:', originalImage, 'hiding image');
          img.style.display = 'none';

          // Find and show placeholder
          const productImageContainer = img.closest('.product-image');
          if (productImageContainer) {
            const placeholder = productImageContainer.querySelector('.product-image-placeholder');
            if (placeholder) {
              placeholder.style.display = 'flex';
            }
          }
        }
      };
    }

    async function addToCart(productId, productName, price) {
      try {
        console.log(' Adding to cart:', { productId, productName, price });

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add_to_cart',
            product_id: productId,
            quantity: 1
          })
        });

        const result = await response.json();
        console.log(' Cart API response:', result);

        if (result.success) {
          console.log(' Item added to cart successfully');
          updateCartCount();
          toast(`${productName} added to cart!`, 'success');

          // Immediately show the cart modal with updated content
          setTimeout(() => {
            console.log(' Opening cart modal...');
            viewCart();
          }, 300); // Reduced delay for faster response
        } else {
          console.error(' Failed to add to cart:', result.message);
          toast('Error: ' + result.message, 'error');
        }
      } catch (error) {
        console.error(' Error adding to cart:', error);
        toast('Failed to add item to cart. Please try again.', 'error');
      }
    }

    // Enhanced add to cart function with visual feedback
    async function addToCartWithFeedback(buttonElement, productId, productName, price) {
      console.log(' Adding to cart with feedback:', { productId, productName, price });

      // Prevent multiple rapid clicks
      if (buttonElement.disabled) {
        console.log(' Button already processing, ignoring click');
        return;
      }

      // Show loading state on button
      const originalText = buttonElement.innerHTML;
      const originalDisabled = buttonElement.disabled;

      buttonElement.disabled = true;
      buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
      buttonElement.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';

      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add_to_cart',
            product_id: productId,
            quantity: 1
          })
        });

        const result = await response.json();
        console.log(' Cart API response:', result);

        if (result.success) {
          console.log(' Item added to cart successfully');

          // Update button to success state
          buttonElement.innerHTML = '<i class="fas fa-check"></i> Added!';
          buttonElement.style.background = 'linear-gradient(135deg, #4caf50, #45a049)';

          // Update cart count immediately
          updateCartCount();

          // Show success toast
          toast(`${productName} added to cart!`, 'success');

          // Reset button after a delay
          setTimeout(() => {
            buttonElement.innerHTML = originalText;
            buttonElement.disabled = originalDisabled;
            buttonElement.style.background = '';
          }, 2000);
        } else {
          console.error(' Failed to add to cart:', result.message);

          // Show error state
          buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
          buttonElement.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

          // Show error toast
          toast('Error: ' + result.message, 'error');

          // Reset button after error
          setTimeout(() => {
            buttonElement.innerHTML = originalText;
            buttonElement.disabled = originalDisabled;
            buttonElement.style.background = '';
          }, 2000);
        }
      } catch (error) {
        console.error(' Error adding to cart:', error);

        // Show error state
        buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
        buttonElement.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

        // Show error toast
        toast('Failed to add item to cart. Please try again.', 'error');

        // Reset button after error
        setTimeout(() => {
          buttonElement.innerHTML = originalText;
          buttonElement.disabled = originalDisabled;
          buttonElement.style.background = '';
        }, 2000);
      }
    }

    async function buyNow(productId, productName, price) {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add_to_cart',
            product_id: productId,
            quantity: 1
          })
        });

        const result = await response.json();

        if (result.success) {
          updateCartCount();
          toast(`${productName} added to order! Proceeding to checkout...`, 'success');

          // Proceed to checkout after a short delay
          setTimeout(() => {
            checkout();
          }, 1000);
        } else {
          toast('Error: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('Error adding to cart:', error);
        toast('Failed to add item to cart', 'error');
      }
    }

    async function buyNow(productId, productName, price) {
      // Check if user is logged in
      if (!currentUser) {
        showLoginPromptModal();
        return;
      }

      // Only clients can buy, staff should use management functions
      if (isStaff) {
        toast('Staff users cannot purchase items. Use Edit/Delete buttons to manage products.', 'error');
        return;
      }

      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add_to_cart',
            product_id: productId,
            quantity: 1
          })
        });

        const result = await response.json();

        if (result.success) {
          updateCartCount();
          toast(`${productName} added to order! Proceeding to checkout...`, 'success');

          // Proceed to checkout after a short delay
          setTimeout(() => {
            checkout();
          }, 1000);
        } else {
          toast('Error: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('Error adding to cart:', error);
        toast('Failed to add item to cart', 'error');
      }
    }

    async function updateCartCount() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_cart' })
        });

        const result = await response.json();

        if (result.success) {
          const totalItems = result.item_count || 0;

          const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
          cartCountElements.forEach(element => {
            element.textContent = totalItems;
          });

          // Update header cart icon
          const cartIcon = document.getElementById('cartIcon');
          if (cartIcon) {
            cartIcon.style.display = totalItems > 0 ? 'block' : 'none';
          }
        } else {
          const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
          cartCountElements.forEach(element => {
            element.textContent = '0';
          });

          const cartIcon = document.getElementById('cartIcon');
          if (cartIcon) {
            cartIcon.style.display = 'none';
          }
        }
      } catch (error) {
        console.error('Error updating cart count:', error);
        const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');
        cartCountElements.forEach(element => {
          element.textContent = '0';
        });

        const cartIcon = document.getElementById('cartIcon');
        if (cartIcon) {
          cartIcon.style.display = 'none';
        }
      }
    }





    function updateCartItemQuantityFromModal(productId, quantityValue) {
      // Use clientDashboard if available, otherwise use local cart
      const currentCart = window.clientDashboard ? window.clientDashboard.cart : cart;

      const newQuantity = parseInt(quantityValue, 10);

      if (isNaN(newQuantity) || newQuantity <= 0) {
        removeFromCartFromModal(productId);
        return;
      }

      if (newQuantity > 99) {
        toast('Maximum quantity is 99', 'warning');
        viewCart(); // Refresh to reset the input
        return;
      }

      const item = currentCart.find(item => item.id === productId);
      if (item) {
        item.quantity = newQuantity;

        // Update both cart systems
        if (window.clientDashboard) {
          window.clientDashboard.cart = currentCart;
          localStorage.setItem('clientCart', JSON.stringify(currentCart));
          window.clientDashboard.updateCartCount();
        } else {
          cart = currentCart;
          localStorage.setItem('clientCart', JSON.stringify(currentCart));
          updateCartCount();
        }

        viewCart(); // Refresh the cart modal
      }
    }

    function removeFromCartFromModal(productId) {
      // Use clientDashboard if available, otherwise use local cart
      let currentCart = window.clientDashboard ? window.clientDashboard.cart : cart;

      currentCart = currentCart.filter(item => item.id !== productId);

      // Update both cart systems
      if (window.clientDashboard) {
        window.clientDashboard.cart = currentCart;
        localStorage.setItem('clientCart', JSON.stringify(currentCart));
        window.clientDashboard.updateCartCount();
      } else {
        cart = currentCart;
        localStorage.setItem('clientCart', JSON.stringify(currentCart));
        updateCartCount();
      }

      viewCart(); // Refresh the cart modal
    }

    async function updateCartItemQuantityFromModal(productId, quantityValue) {
      const newQuantity = parseInt(quantityValue, 10);

      if (isNaN(newQuantity) || newQuantity <= 0) {
        removeFromCartFromModal(productId);
        return;
      }

      if (newQuantity > 99) {
        toast('Maximum quantity is 99', 'warning');
        viewCart(); // Refresh to reset the input
        return;
      }

      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'update_cart',
            product_id: productId,
            quantity: newQuantity
          })
        });

        const result = await response.json();

        if (result.success) {
          updateCartCount();
          viewCart(); // Refresh the cart modal
        } else {
          toast('Error: ' + result.message, 'error');
          viewCart(); // Refresh to show current state
        }
      } catch (error) {
        console.error('Error updating cart:', error);
        toast('Failed to update cart item', 'error');
      }
    }

    async function removeFromCartFromModal(productId) {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'remove_from_cart',
            product_id: productId
          })
        });

        const result = await response.json();

        if (result.success) {
          // Visual feedback: immediately remove the item from UI
          const cartItem = document.querySelector(`[data-product-id="${productId}"]`);
          if (cartItem) {
            cartItem.style.transition = 'all 0.3s ease';
            cartItem.style.opacity = '0';
            cartItem.style.transform = 'translateX(100%)';
            setTimeout(() => {
              cartItem.remove();
              // Check if cart is now empty
              const remainingItems = document.querySelectorAll('.cart-item');
              if (remainingItems.length === 0) {
                showEmptyCartStateInModal();
              } else {
                updateCartTotalInModal();
              }
            }, 300);
          }

          updateCartCount();
        } else {
          toast('Error: ' + result.message, 'error');
          viewCart(); // Refresh to show current state
        }
      } catch (error) {
        console.error('Error removing from cart:', error);
        toast('Failed to remove item from cart', 'error');
      }
    }

    function showEmptyCartStateInModal() {
      const cartItems = document.querySelector('.cart-items');
      const cartTotal = document.querySelector('.cart-total');
      const cartActions = document.querySelector('.cart-actions');

      if (cartItems) {
        cartItems.innerHTML = `
          <div class="empty-cart-message" style="text-align: center; padding: 40px 20px; color: #64748b;">
            <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px; display: block; color: #cbd5e1;"></i>
            <p style="margin: 0 0 5px 0; font-size: 16px;">Your cart is empty</p>
            <small style="color: #94a3b8; font-size: 12px;">Add some products to your cart to see them here!</small>
          </div>
        `;
      }
      if (cartTotal) cartTotal.style.display = 'none';
      if (cartActions) {
        cartActions.innerHTML = `
          <button onclick="this.closest('.modal').remove()" class="btn-secondary">Continue Shopping</button>
        `;
      }
    }

    function updateCartTotalInModal() {
      const cartItems = document.querySelectorAll('.cart-item');
      if (cartItems.length === 0) {
        showEmptyCartStateInModal();
        return;
      }

      // Recalculate total from visible items
      let total = 0;
      cartItems.forEach(item => {
        const priceElement = item.querySelector('p');
        const quantityInput = item.querySelector('input[type="number"]');

        if (priceElement && quantityInput) {
          const priceText = priceElement.textContent;
          const priceMatch = priceText.match(/([\d.]+)/);
          const quantity = parseInt(quantityInput.value);

          if (priceMatch) {
            const price = parseFloat(priceMatch[1]);
            total += price * quantity;
          }
        }
      });

      const totalElement = document.querySelector('.cart-total h3');
      if (totalElement) {
        totalElement.textContent = `Total: ${total.toFixed(2)}`;
      }
    }

    async function checkoutFromModal() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_cart' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.length > 0) {
          const orderData = {
            items: result.data,
            total: result.total
          };

          // Close the cart modal
          const cartModal = document.querySelector('.modal');
          if (cartModal) {
            cartModal.remove();
          }

          // Show payment modal using the dashboard instance
          if (window.clientDashboard) {
            window.clientDashboard.showPaymentModalForCart(orderData);
          } else {
            toast('Payment system is loading. Please try again in a moment.', 'info');
          }
        } else {
          toast('Your cart is empty', 'error');
        }
      } catch (error) {
        console.error('Error loading cart for checkout:', error);
        toast('Error loading cart', 'error');
      }
    }

    function showPaymentModalForCart(orderData) {
      // Remove existing payment modal if any
      const existingModal = document.querySelector('.buy-now-modal');
      if (existingModal) {
        existingModal.remove();
      }

      // Create payment modal similar to store.html
      const modal = document.createElement('div');
      modal.className = 'modal buy-now-modal';
      modal.innerHTML = `
        <div class="modal-content buy-now-content">
          <div class="modal-header">
            <h3><i class="fas fa-credit-card"></i> Complete Your Purchase</h3>
            <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
          </div>
          <div class="modal-body">
            <div class="order-summary">
              <h4>Order Summary</h4>
              <div class="summary-items">
                ${orderData.items.map(item => `
                  <div class="summary-item">
                    <div class="item-info">
                      <h5>${item.name}</h5>
                      <p>Quantity: ${item.quantity}  ${parseFloat(item.price).toFixed(2)}</p>
                    </div>
                    <div class="item-subtotal">
                      ${(item.price * item.quantity).toFixed(2)}
                    </div>
                  </div>
                `).join('')}
              </div>
              <div class="summary-total">
                <div class="total-row">
                  <span><strong>Total (${orderData.items.reduce((sum, item) => sum + item.quantity, 0)} items):</strong></span>
                  <span class="final-total"><strong>${orderData.total.toFixed(2)}</strong></span>
                </div>
              </div>
            </div>

            <div class="payment-section">
              <h4><i class="fas fa-money-bill-wave"></i> Payment Method</h4>
              <div class="payment-options">
                <label class="payment-option">
                  <input type="radio" name="payment_method" value="gcash" checked>
                  <div class="payment-info">
                    <i class="fab fa-google-wallet"></i>
                    <div>
                      <div class="payment-name">GCash</div>
                      <div class="payment-desc">Pay using GCash e-wallet</div>
                    </div>
                  </div>
                </label>

                <label class="payment-option">
                  <input type="radio" name="payment_method" value="bank">
                  <div class="payment-info">
                    <i class="fas fa-university"></i>
                    <div>
                      <div class="payment-name">Bank Transfer</div>
                      <div class="payment-desc">Direct bank transfer</div>
                    </div>
                  </div>
                </label>

                <label class="payment-option">
                  <input type="radio" name="payment_method" value="cash_on_visit">
                  <div class="payment-info">
                    <i class="fas fa-money-bill-alt"></i>
                    <div>
                      <div class="payment-name">Cash on Visit</div>
                      <div class="payment-desc">Pay cash when picking up</div>
                    </div>
                  </div>
                </label>
              </div>
            </div>

            <div class="order-notes">
              <h4><i class="fas fa-sticky-note"></i> Order Notes (Optional)</h4>
              <textarea name="order_notes" placeholder="Any special instructions or delivery notes..." rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button onclick="this.closest('.modal').remove()" class="btn-secondary">Cancel</button>
            <button onclick="processPayment()" class="btn-primary">
              <i class="fas fa-check"></i> Complete Purchase
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      modal.style.display = 'block';
    }

    async function processPayment() {
      // Get payment method
      const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
      if (!selectedPayment) {
        toast('Please select a payment method', 'error');
        return;
      }

      const paymentMethod = selectedPayment.value;
      const orderNotesElement = document.querySelector('.buy-now-modal textarea');
      const orderNotes = orderNotesElement ? orderNotesElement.value : '';

      // Get cart items from API
      let cart, total;

      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_cart' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.length > 0) {
          cart = result.data;
          total = result.total;
        } else {
          toast('Your cart is empty', 'error');
          return;
        }
      } catch (error) {
        console.error('Error loading cart:', error);
        toast('Failed to load cart', 'error');
        return;
      }

      // Show loading state
      const submitBtn = document.querySelector('.buy-now-modal .btn-primary');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      submitBtn.disabled = true;

      try {
        // Create order via API
        const orderResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'buy_cart',
            items: cart,
            total: total,
            payment_method: paymentMethod,
            notes: orderNotes
          })
        });

        const orderResult = await orderResponse.json();

        if (orderResult.success) {
          // Clear cart
          await fetch('../api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'clear_cart' })
          });

          // Update cart count
          updateCartCount();

          // Clear localStorage cart to prevent mismatch
          localStorage.removeItem('clientCart');

          // Close modal
          const modal = document.querySelector('.buy-now-modal');
          if (modal) {
            modal.style.display = 'none';
            setTimeout(() => modal.remove(), 300);
          }

          // Show success message
          toast(`Order placed successfully! Order ID: ${orderResult.order_id}`, 'success');

          console.log('Order placed:', orderResult);
        } else {
          toast('Error: ' + orderResult.message, 'error');
        }
      } catch (error) {
        console.error('Error processing payment:', error);
        toast('Failed to process payment', 'error');
      } finally {
        // Restore button
        if (submitBtn) {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      }
    }

    async function checkout() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_cart' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.length > 0) {
          const orderData = {
            items: result.data,
            total: result.total
          };

          // Show payment modal using the dashboard instance
          if (window.dashboardInstance) {
            window.dashboardInstance.showPaymentModalForCart(orderData);
          } else if (window.clientDashboard) {
            window.clientDashboard.showPaymentModalForCart(orderData);
          } else {
            toast('Payment system is loading. Please try again in a moment.', 'info');
          }

          // Close the cart modal
          const cartModal = document.querySelector('.modal');
          if (cartModal) {
            cartModal.remove();
          }
        } else {
          toast('Your cart is empty', 'error');
        }
      } catch (error) {
        console.error('Error loading cart for checkout:', error);
        toast('Error loading cart', 'error');
      }
    }

    // Toast notification function
    function toast(message, type = 'success') {
      const el = document.getElementById('toast');
      if (!el) return;

      const icons = {
        success: '',
        error: '',
        warning: '',
        info: ''
      };

      const icon = icons[type] || icons.info;
      el.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-message">${message}</span>`;
      el.className = `toast show ${type}`;

      setTimeout(() => {
        el.classList.remove('show');
        setTimeout(() => {
          el.className = 'toast';
          el.innerHTML = '';
        }, 400);
      }, 4000);
    }

    // Make toast function globally available
    window.toast = toast;

    // Client Add Pet Modal Functions
    function showAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadClientPetOwners();
      }
    }

    function closeClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // Clear form
        document.getElementById('clientAddPetForm').reset();
      }
    }

    async function loadClientPetOwners() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.user) {
          // Auto-populate with current user (no owner selection needed for client)
          console.log('Client pet form - owner auto-populated');
        }
      } catch (error) {
        console.error('Error loading client pet owners:', error);
      }
    }

    // Handle client add pet form submission
    document.getElementById('clientAddPetForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      // Prevent multiple submissions
      const submitBtn = e.target.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding Pet...';
      }

      const formData = new FormData(e.target);
      const petData = {
        action: 'add_pet',
        owner_id: formData.get('owner_id'),
        pet_name: formData.get('pet_name'),
        species: formData.get('species'),
        breed: formData.get('breed'),
        birthdate: formData.get('birthdate'),
        gender: formData.get('gender'),
        weight: formData.get('weight') ? parseFloat(formData.get('weight')) : null,
        color: formData.get('color')
      };

      // Handle image upload if provided
      const imageFile = formData.get('profile_image');
      if (imageFile && imageFile.size > 0) {
        // Convert image to base64
        const reader = new FileReader();
        reader.onload = async function(e) {
          const base64Data = e.target.result;

          // Store image data for later upload
          petData.profile_image_data = base64Data;
          petData.profile_image_name = imageFile.name;

          // Submit pet data first
          submitPetData(petData);
        };
        reader.readAsDataURL(imageFile);
      } else {
        submitPetData(petData);
      }

      async function submitPetData(petData) {
        try {
          const response = await fetch('../api/vet_api.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(petData)
          });

          const result = await response.json();

          if (result.success) {
            // If there's an image to upload, do it now with the pet ID
            if (petData.profile_image && petData.profile_image !== null) {
              try {
                const imageResponse = await fetch('../api/vet_api.php', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    action: 'upload_pet_profile_picture',
                    pet_id: result.pet_id,
                    image_data: petData.profile_image_data,
                    image_name: petData.profile_image_name
                  })
                });

                const imageResult = await imageResponse.json();
                if (imageResult.success) {
                  console.log('Pet image uploaded successfully');
                } else {
                  console.error('Failed to upload pet image:', imageResult.message);
                }
              } catch (imageError) {
                console.error('Error uploading pet image:', imageError);
              }
            }

            toast('Pet added successfully!', 'success');
            closeClientAddPetModal();
            // Reload pets to show the new pet
            setTimeout(() => {
              loadClientPets();
            }, 500); // Small delay to ensure database is updated
          } else {
            toast(result.message || 'Failed to add pet', 'error');
          }
        } catch (error) {
          console.error('Error adding pet:', error);
          toast('Failed to add pet. Please try again.', 'error');
        } finally {
          // Re-enable submit button
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-plus"></i> ADD PET';
          }
        }
      }
    });

    // Client Add Pet Modal Functions (consolidated)
    function showClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadClientPetOwnerInfo();
      }
    }

    function closeClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // Clear form
        const form = document.getElementById('clientAddPetForm');
        if (form) form.reset();
      }
    }

    async function loadClientPetOwnerInfo() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();
        if (result.success && result.data && result.data.user) {
          // Auto-populate owner info if needed
          console.log('Client owner info loaded for pet modal');
        }
      } catch (error) {
        console.error('Error loading client owner info:', error);
      }
    }

    // Check for appointments redirect and highlight Book New button
    function checkForAppointmentsRedirect() {
      // Check if URL contains appointments hash
      if (window.location.hash === '#appointments') {
        console.log(' Appointments redirect detected, navigating to appointments section...');

        // Navigate to appointments section
        showSection('appointments');

        // Highlight the Book New button for 3 seconds
        setTimeout(() => {
          const bookNewBtn = document.querySelector('.header-btn');
          if (bookNewBtn) {
            console.log(' Highlighting Book New button...');

            // Add highlight animation
            bookNewBtn.style.animation = 'highlightPulse 3s ease-in-out';
            bookNewBtn.style.boxShadow = '0 0 20px rgba(40, 167, 69, 0.8)';

            // Remove highlight after 3 seconds
            setTimeout(() => {
              bookNewBtn.style.animation = '';
              bookNewBtn.style.boxShadow = '';
              console.log(' Book New button highlight removed');
            }, 3000);

            console.log(' Book New button highlighted for 3 seconds');
          } else {
            console.warn(' Book New button not found for highlighting');
          }
        }, 500); // Small delay to ensure section is loaded
      }
    }

    // Initialize cart count and load orders on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateCartCount();

      // Check if we should navigate to appointments section and highlight Book New button
      checkForAppointmentsRedirect();

      // Load dashboard data if we're on the dashboard section
      if (document.getElementById('dashboardSection') && document.getElementById('dashboardSection').style.display === 'block') {
        loadClientDashboardData();
      }

      // Initialize notification badge
      updateNotificationBadge();

      // Add event listeners for category tabs
      const categoryTabs = document.querySelectorAll('.category-tab');
      categoryTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          filterProducts(category);
        });
      });

      // Add event listeners for staff product management forms
      const addProductForm = document.getElementById('addProductForm');
      if (addProductForm) {
        addProductForm.addEventListener('submit', submitAddProduct);
      }

      const editProductForm = document.getElementById('editProductForm');
      if (editProductForm) {
        editProductForm.addEventListener('submit', submitEditProduct);
      }

    });

    // Load client dashboard data
    async function loadClientDashboardData() {
      try {
        console.log('Loading client dashboard data...');

        // Load pets data
        const petsResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });
        const petsResult = await petsResponse.json();

        if (petsResult.success && petsResult.data) {
          const petsCount = petsResult.data.length;
          const petsCountElement = document.getElementById('clientPetsCount');
          if (petsCountElement) {
            petsCountElement.textContent = petsCount;
          }
          console.log('Pets count loaded:', petsCount);
        }

        // Load appointments data
        const appointmentsResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_appointments' })
        });
        const appointmentsResult = await appointmentsResponse.json();

        if (appointmentsResult.success && appointmentsResult.data) {
          const appointments = appointmentsResult.data;
          const today = new Date().toISOString().split('T')[0];

          // Count upcoming appointments (future dates)
          const upcomingCount = appointments.filter(apt =>
            apt.appointment_date >= today && apt.status !== 'cancelled'
          ).length;

          // Count completed appointments
          const completedCount = appointments.filter(apt =>
            apt.status === 'completed'
          ).length;

          // Update upcoming appointments count
          const upcomingElement = document.getElementById('upcomingAppointmentsCount');
          if (upcomingElement) {
            upcomingElement.textContent = upcomingCount;
          }

          // Update completed visits count
          const completedElement = document.getElementById('completedVisitsCount');
          if (completedElement) {
            completedElement.textContent = completedCount;
          }

          console.log('Appointments loaded - Upcoming:', upcomingCount, 'Completed:', completedCount);
        }

        // Cart items count is already handled by updateCartCount()

      } catch (error) {
        console.error('Error loading client dashboard data:', error);
      }
    }


    // Profile Form Submission Functionality for Client Dashboard
    function setupProfileForm() {
      const profileForm = document.getElementById('profileForm');

      if (profileForm) {
        profileForm.addEventListener('submit', async function(e) {
          e.preventDefault();

          // Get form data
          const formData = new FormData(profileForm);

          // Validate form data
          if (!validateProfileForm(formData)) {
            return;
          }

          try {
            const response = await fetch('../api/vet_api.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                action: 'update_profile',
                first_name: formData.get('first_name'),
                last_name: formData.get('last_name'),
                email: formData.get('email'),
                phone: formData.get('phone')
              })
            });

            const result = await response.json();

            if (result.success) {
              toast('Profile updated successfully!', 'success');

              // Update sidebar with new data
              if (result.user) {
                const clientName = document.getElementById('clientName');
                if (clientName) {
                  clientName.textContent = result.user.name;
                }
              }

              // Refresh user data
              await loadClientSettingsData();
            } else {
              toast(result.message || 'Failed to update profile', 'error');
            }
          } catch (error) {
            console.error('Profile update error:', error);
            toast('Failed to update profile. Please try again.', 'error');
          }
        });
      }
    }

    // Load client settings data
    async function loadClientSettingsData() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.user) {
          const user = result.data.user;

          // Populate settings forms with current data
          const firstNameInput = document.getElementById('firstName');
          const lastNameInput = document.getElementById('lastName');
          const emailInput = document.getElementById('email');
          const phoneInput = document.getElementById('phone');

          if (firstNameInput) firstNameInput.value = user.first_name || '';
          if (lastNameInput) lastNameInput.value = user.last_name || '';
          if (emailInput) emailInput.value = user.email || '';
          if (phoneInput) phoneInput.value = user.phone || '';

          // Update profile picture in settings section
          if (user.profile_picture) {
            const currentProfilePicture = document.getElementById('currentProfilePicture');
            if (currentProfilePicture) {
              const newSrc = '../' + user.profile_picture + '?t=' + Date.now();
              currentProfilePicture.src = newSrc;

              // Add error handling
              currentProfilePicture.onerror = function() {
                this.src = '../assets/images/logoo.jpg';
              };
            }
          }

          // Update email verification status
          updateEmailVerificationStatus(user);
        }
      } catch (error) {
        console.error('Failed to load client settings data:', error);
      }
    }

    // Update email verification status display
    function updateEmailVerificationStatus(user) {
      const statusDiv = document.getElementById('emailVerificationStatus');
      const verifyBtn = document.getElementById('verifyEmailBtn');
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (!statusDiv) return;

      // Check if user has verification token (not verified)
      if (user.email_verification_token && !user.email_verified_at) {
        // User has token but not verified
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-clock" style="color: #ffc107;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email verification pending</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            A verification email has been sent to <strong>${user.email}</strong>.
            Please check your inbox and click the verification link.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'none';
        if (resendBtn) resendBtn.style.display = 'flex';
      } else if (user.email_verified_at) {
        // User is verified
        const verifiedDate = new Date(user.email_verified_at).toLocaleDateString();
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-check-circle" style="color: #28a745;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email verified</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            Your email address has been verified on <strong>${verifiedDate}</strong>.
            You now have enhanced account security and password reset capabilities.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'none';
        if (resendBtn) resendBtn.style.display = 'none';
      } else {
        // User not verified and no token
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email not verified</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            Verify your email address for enhanced security and password reset functionality.
            This is optional but recommended.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'flex';
        if (resendBtn) resendBtn.style.display = 'none';
      }
    }

    // Verify user email function
    async function verifyUserEmail() {
      const verifyBtn = document.getElementById('verifyEmailBtn');
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (verifyBtn) {
        verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        verifyBtn.disabled = true;
      }

      try {
        // Get current user info
        const userResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const userResult = await userResponse.json();

        if (userResult.success && userResult.data && userResult.data.user) {
          const user = userResult.data.user;

          // Send verification email using SMTPJS
          if (typeof emailService !== 'undefined') {
            const emailResult = await emailService.sendVerificationEmail(user.email, user.first_name, 'new_verification');

            if (emailResult.success) {
              toast('Verification email sent successfully! Please check your inbox.', 'success');

              // Update status display
              updateEmailVerificationStatus(user);

              // Update button states
              if (verifyBtn) verifyBtn.style.display = 'none';
              if (resendBtn) resendBtn.style.display = 'flex';
            } else {
              toast('Email configuration may need setup. Please contact support if you continue having issues.', 'warning');
            }
          } else {
            toast('Email service not available. Please contact support for assistance.', 'error');
          }
        } else {
          toast('Unable to get user information. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error sending verification email:', error);
        toast('Error sending verification email. Please try again.', 'error');
      } finally {
        // Restore button state
        if (verifyBtn) {
          verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> Verify Email Address';
          verifyBtn.disabled = false;
        }
      }
    }

    // Resend verification email function
    async function resendVerificationEmail() {
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (resendBtn) {
        resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        resendBtn.disabled = true;
      }

      try {
        // Get current user info
        const userResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const userResult = await userResponse.json();

        if (userResult.success && userResult.data && userResult.data.user) {
          const user = userResult.data.user;

          // Send verification email using SMTPJS
          if (typeof emailService !== 'undefined') {
            const emailResult = await emailService.sendVerificationEmail(user.email, user.first_name, 'resend_verification');

            if (emailResult.success) {
              toast('Verification email sent successfully! Please check your inbox.', 'success');
            } else {
              toast('Email configuration may need setup. Please contact support if you continue having issues.', 'warning');
            }
          } else {
            toast('Email service not available. Please contact support for assistance.', 'error');
          }
        } else {
          toast('Unable to get user information. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error resending verification email:', error);
        toast('Error resending verification email. Please try again.', 'error');
      } finally {
        // Restore button state
        if (resendBtn) {
          resendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Resend Verification';
          resendBtn.disabled = false;
        }
      }
    }

    // Profile form validation
    function validateProfileForm(formData) {
      const firstName = formData.get('first_name');
      const lastName = formData.get('last_name');
      const email = formData.get('email');
      const phone = formData.get('phone');

      // Validate first name
      if (!firstName || firstName.trim().length < 2) {
        toast('First name must be at least 2 characters', 'error');
        return false;
      }

      // Validate last name
      if (!lastName || lastName.trim().length < 2) {
        toast('Last name must be at least 2 characters', 'error');
        return false;
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        toast('Please enter a valid email address', 'error');
        return false;
      }

      // Validate phone (optional)
      if (phone && phone.trim() !== '') {
        const phoneRegex = /^(?:\+63|63|0)?[9]\d{9}$|^(?:\+63|63|0)?[2]\d{7,8}$/;
        if (!phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''))) {
          toast('Please enter a valid Philippine phone number (e.g., 09123456789 or 028123456)', 'error');
          return false;
        }
      }

      return true;
    }

    // Profile Picture Upload Functionality for Client Dashboard
    function setupProfilePictureForm() {
      const pictureForm = document.getElementById('pictureForm');
      const fileInput = document.getElementById('profilePictureInput');
      const imagePreview = document.getElementById('imagePreview');
      const currentPicture = document.getElementById('currentProfilePicture');

      if (fileInput && imagePreview) {
        // Handle file selection
        fileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
              toast('Please select a valid image file', 'error');
              return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
              toast('Image size must be less than 5MB', 'error');
              return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
              imagePreview.src = e.target.result;
              imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
          }
        });
      }

      if (pictureForm) {
        pictureForm.addEventListener('submit', async function(e) {
          e.preventDefault();

          const fileInput = document.getElementById('profilePictureInput');
          if (!fileInput.files[0]) {
            toast('Please select an image file', 'error');
            return;
          }

          const file = fileInput.files[0];

          // Validate file type
          if (!file.type.startsWith('image/')) {
            toast('Please select a valid image file', 'error');
            return;
          }

          // Validate file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            toast('Image size must be less than 5MB', 'error');
            return;
          }

          try {
            // Convert file to base64
            const reader = new FileReader();
            reader.onload = async function(e) {
              const base64Data = e.target.result;

              const response = await fetch('../api/vet_api.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  action: 'upload_profile_picture',
                  image_data: base64Data,
                  image_name: file.name
                })
              });

              const result = await response.json();

              if (result.success) {
                toast('Profile picture updated successfully!', 'success');

                // Update current picture display in settings
                if (currentPicture && result.image_path) {
                  const fullImagePath = '../' + result.image_path;
                  console.log('Updating settings profile picture to:', fullImagePath);
                  currentPicture.src = fullImagePath + '?t=' + Date.now();

                  // Also update the settings section currentProfilePicture
                  const settingsProfilePicture = document.getElementById('currentProfilePicture');
                  if (settingsProfilePicture) {
                    settingsProfilePicture.src = fullImagePath + '?t=' + Date.now();
                    settingsProfilePicture.onerror = function() {
                      this.src = '../assets/images/logoo.jpg';
                    };
                  }
                }

                // Update sidebar avatar with delay to ensure file is fully written
                const clientAvatar = document.getElementById('clientAvatar');
                if (clientAvatar && result.image_path) {
                  setTimeout(() => {
                    const timestamp = Date.now() + Math.random(); // More unique cache buster
                    const fullImagePath = '../' + result.image_path;
                    console.log('Updating sidebar avatar to:', fullImagePath);
                    clientAvatar.src = fullImagePath + '?t=' + timestamp;

                    // Handle sidebar avatar load error with retry and format fallback
                    let retryCount = 0;
                    const basePath = '../' + result.image_path.replace(/\.(jpg|jpeg|png|gif|webp)$/i, '');

                    clientAvatar.onerror = function() {
                      retryCount++;
                      if (retryCount < 3) {
                        console.warn(`Retry ${retryCount} for sidebar avatar:`, fullImagePath);
                        // Try again with a new timestamp
                        const retrySrc = '../' + result.image_path + '?t=' + Date.now() + Math.random();
                        this.src = retrySrc;
                      } else if (retryCount === 3) {
                        console.warn('Trying alternative format (PNG) for sidebar avatar:', basePath + '.png');
                        // Try PNG format
                        this.src = basePath + '.png?t=' + Date.now() + Math.random();
                        retryCount++; // Increment to 4
                      } else if (retryCount === 4) {
                        console.warn('Trying alternative format (WebP) for sidebar avatar:', basePath + '.webp');
                        // Try WebP format
                        this.src = basePath + '.webp?t=' + Date.now() + Math.random();
                        retryCount++; // Increment to 5
                      } else {
                        console.warn('Failed to load sidebar avatar after all retries and formats, using fallback:', fullImagePath);
                        this.src = '../assets/images/logoo.jpg';
                      }
                    };

                    // Add load handler with validation
                    clientAvatar.onload = function() {
                      // Verify the image actually loaded by checking its dimensions
                      if (this.naturalWidth === 0 || this.naturalHeight === 0) {
                        console.warn('Sidebar avatar loaded but has invalid dimensions, retrying:', fullImagePath);
                        // Trigger error handler to retry
                        this.onerror();
                      } else {
                        console.log('Sidebar avatar loaded successfully:', fullImagePath, this.naturalWidth + 'x' + this.naturalHeight);
                      }
                    };
                  }, 500); // 500ms delay to ensure file is fully written
                }

                // Reset form
                imagePreview.style.display = 'none';
                fileInput.value = '';
              } else {
                toast(result.message || 'Failed to upload profile picture', 'error');
              }
            };

            reader.onerror = function() {
              toast('Error reading file', 'error');
            };

            reader.readAsDataURL(file);
          } catch (error) {
            console.error('Error uploading profile picture:', error);
            toast('Error uploading profile picture', 'error');
          }
        });
      }
    }

    // Initialize profile and picture functionality
    document.addEventListener('DOMContentLoaded', function() {
      setupProfileForm();
      setupProfilePictureForm();
      // Load settings data when settings section is shown
      if (document.getElementById('settingsSection') && !document.getElementById('settingsSection').classList.contains('hidden')) {
        loadClientSettingsData();
      }
    });










    // Global variables for pet reports
    let currentReportData = null;
    let selectedPetId = null;

    // Load pets for the dropdown when reports section is shown
    async function loadPetsDropdown() {
      console.log(' loadPetsDropdown called');

      try {
        console.log(' Fetching pets from API...');
        const response = await fetch('../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log(' Response status:', response.status);

        const result = await response.json();
        console.log(' API result:', result);

        if (result.success) {
          console.log(' API success, found', result.data.length, 'pets');
          const petSelect = document.getElementById('petSelect');

          if (!petSelect) {
            console.error(' Pet select element not found!');
            toast('Pet select element not found!', 'error');
            return;
          }

          console.log(' Pet select element found, clearing...');
          petSelect.innerHTML = '<option value="">Select a pet...</option>';
          console.log(' Cleared select, now adding', result.data.length, 'options');

          result.data.forEach((pet, index) => {
            console.log(` Adding pet ${index + 1}:`, pet.name, 'ID:', pet.id);
            const option = document.createElement('option');
            option.value = pet.id;
            option.textContent = `${pet.name} (${pet.species}) - Owner: ${pet.first_name} ${pet.last_name}`;
            console.log(' Created option:', option.value, option.textContent);

            const appendResult = petSelect.appendChild(option);
            console.log(' Appended option:', appendResult);
          });

          console.log(' Final select options count:', petSelect.options.length);
          console.log(' Pet dropdown populated successfully');

          // Show success message
          toast(`Loaded ${result.data.length} pets successfully!`, 'success');
        } else {
          console.error(' API failed:', result.message);
          toast('Failed to load pets: ' + result.message, 'error');
        }
      } catch (error) {
        console.error(' Error loading pets:', error);
        toast('Error loading pets: ' + error.message, 'error');
      }
    }

    // Generate pet report
    async function generatePetReport() {
      const petSelect = document.getElementById('petSelect');
      if (!petSelect) {
        console.error('Pet select element not found');
        if (typeof toast === 'function') {
          toast('Report form not loaded properly. Please refresh the page.', 'error');
        } else {
          alert('Report form not loaded properly. Please refresh the page.');
        }
        return;
      }

      const selectedPetId = petSelect.value;

      if (!selectedPetId) {
        if (typeof toast === 'function') {
          toast('Please select a pet first', 'warning');
        } else if (window.clientDashboard) {
          window.clientDashboard.toast('Please select a pet first', 'warning');
        } else {
          alert('Please select a pet first');
        }
        return;
      }

      try {
        const response = await fetch(`../api/pet_reports_api.php?action=get_pet_report&pet_id=${selectedPetId}`);
        const result = await response.json();

        if (result.success) {
          currentReportData = result.data;
          console.log(' Report data received:', result.data);
          console.log(' Medical history records:', result.data.medical_history ? result.data.medical_history.length : 0);
          displaySimpleReportPreview(result.data);
          if (typeof toast === 'function') {
            toast('Report generated successfully!', 'success');
          } else if (window.clientDashboard) {
            window.clientDashboard.toast('Report generated successfully!', 'success');
          } else {
            alert('Report generated successfully!');
          }
        } else {
          if (typeof toast === 'function') {
            toast('Error generating report: ' + result.message, 'error');
          } else if (window.clientDashboard) {
            window.clientDashboard.toast('Error generating report: ' + result.message, 'error');
          } else {
            alert('Error generating report: ' + result.message);
          }
        }
      } catch (error) {
        console.error('Error generating report:', error);
        if (typeof toast === 'function') {
          toast('Error generating report. Please try again.', 'error');
        } else if (window.clientDashboard) {
          window.clientDashboard.toast('Error generating report. Please try again.', 'error');
        } else {
          alert('Error generating report. Please try again.');
        }
      }
    }

    // Display simple report preview
    function displaySimpleReportPreview(data) {
      const reportPreview = document.getElementById('reportPreview');

      if (!reportPreview) return;

      const pet = data.pet;
      const owner = data.owner;

      console.log(' Report displayed for pet:', pet.name);

      reportPreview.innerHTML = `
        <div style="text-align: left; max-width: 500px; margin: 0 auto;">
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-paw" style="color: #667eea;"></i>
              Pet Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${pet.name}</div>
              <div><strong>Species:</strong> ${pet.species}</div>
              <div><strong>Breed:</strong> ${pet.breed || 'Not specified'}</div>
              <div><strong>Gender:</strong> ${pet.gender || 'Not specified'}</div>
              ${pet.weight ? `<div><strong>Weight:</strong> ${pet.weight} kg</div>` : ''}
              ${pet.color ? `<div><strong>Color:</strong> ${pet.color}</div>` : ''}
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-user" style="color: #667eea;"></i>
              Owner Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${owner.name}</div>
              <div><strong>Email:</strong> ${owner.email}</div>
              ${owner.phone ? `<div><strong>Phone:</strong> ${owner.phone}</div>` : ''}
              ${owner.address ? `<div><strong>Address:</strong> ${owner.address}</div>` : ''}
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-chart-bar" style="color: #667eea;"></i>
              Statistics
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Total Appointments:</strong> ${data.statistics.total_appointments}</div>
              <div><strong>Total Vaccinations:</strong> ${data.statistics.total_vaccinations}</div>
              <div><strong>Last Visit:</strong> ${data.statistics.last_visit ? new Date(data.statistics.last_visit).toLocaleDateString() : 'Never'}</div>
              <div><strong>Report Generated:</strong> ${new Date().toLocaleDateString()}</div>
            </div>
          </div>

          ${data.medical_history && data.medical_history.length > 0 ? `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-stethoscope" style="color: #667eea;"></i>
              Medical History
            </h3>
            <div style="margin-bottom: 20px; text-align: center;">
              <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600;">
                <i class="fas fa-file-medical"></i> Total Records: ${data.medical_history.length}
              </span>
            </div>

            <div class="medical-details">
              ${data.medical_history.slice(0, 3).map((record, index) => `
                <div style="margin: 15px 0; padding: 15px; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);">
                  <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e1e5e9;">
                    <h5 style="margin: 0 0 8px 0; color: #667eea; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                      <i class="fas fa-file-medical"></i> Medical Record #${index + 1}
                    </h5>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; font-size: 12px; color: #666;">
                      <div><i class="fas fa-calendar"></i> ${new Date(record.created_at).toLocaleDateString()}</div>
                      <div><i class="fas fa-user-md"></i> ${record.staff_name || 'Not recorded'}</div>
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #667eea;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-stethoscope"></i> Diagnosis
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.diagnosis ? record.diagnosis.replace(/\n/g, '<br>') : 'Not specified'}</div>
                    </div>

                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #28a745;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-thermometer-three-quarters"></i> Treatment
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.treatment ? record.treatment.replace(/\n/g, '<br>') : 'Not specified'}</div>
                    </div>

                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #ffc107;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-pills"></i> Medications
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.medications ? record.medications.replace(/\n/g, '<br>') : 'None prescribed'}</div>
                    </div>

                    ${record.follow_up_date ? `
                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #dc3545;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-calendar-check"></i> Follow-up Date
                      </div>
                      <div style="color: #555; line-height: 1.4;">${new Date(record.follow_up_date).toLocaleDateString()}</div>
                    </div>
                    ` : ''}

                    ${record.notes ? `
                    <div style="background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 4px solid #ffc107;">
                      <div style="font-weight: bold; color: #856404; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-sticky-note"></i> Clinical Notes
                      </div>
                      <div style="color: #856404; line-height: 1.4;">${record.notes.replace(/\n/g, '<br>')}</div>
                    </div>
                    ` : ''}

                    ${record.instructions ? `
                    <div style="background: #d1ecf1; padding: 10px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                      <div style="font-weight: bold; color: #0c5460; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-clipboard-list"></i> Instructions
                      </div>
                      <div style="color: #0c5460; line-height: 1.4;">${record.instructions.replace(/\n/g, '<br>')}</div>
                    </div>
                    ` : ''}
                  </div>
                </div>
              `).join('')}

              ${data.medical_history.length > 3 ? `
              <div style="text-align: center; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #667eea;">
                <i class="fas fa-ellipsis-h" style="color: #667eea; font-size: 18px; margin-bottom: 8px;"></i>
                <p style="margin: 0; color: #667eea; font-weight: 600; font-size: 12px;">... and ${data.medical_history.length - 3} more medical records available in full report</p>
              </div>
              ` : ''}
            </div>
          </div>
          ` : ''}

        </div>
      `;
    }

    // Download simple PDF report
    async function downloadSimplePDFReport() {
      if (!currentReportData) {
        toast('No report data available. Please generate a report first.', 'error');
        return;
      }

      console.log(' Starting PDF generation...');
      console.log(' Current report data:', currentReportData);
      console.log(' Medical history in report:', currentReportData.medical_history);

      try {
        // Show loading state
        const downloadBtn = document.getElementById('pdfDownloadBtn');
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
          downloadBtn.disabled = true;
        }

        // Load jsPDF library dynamically if not already loaded
        if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
          await loadJSPDFLibrary();
        }

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();

        const pet = currentReportData.pet;
        const owner = currentReportData.owner;

        // Header
        pdf.setFontSize(20);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Tattoo Veterinary Clinic', 105, 20, { align: 'center' });

        pdf.setFontSize(16);
        pdf.text('Pet Medical Report', 105, 30, { align: 'center' });

        // Clinic info
        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        pdf.text('Clinic Address: Your Clinic Address', 105, 40, { align: 'center' });
        pdf.text('Phone: 0917-519-4639 | Email: info@tattoovet.com', 105, 45, { align: 'center' });
        pdf.text(`Generated: ${new Date().toLocaleString()}`, 105, 50, { align: 'center' });

        let yPosition = 65;

        // Pet Information
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Pet Information', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const petInfo = [
          ['Name:', pet.name],
          ['Species:', pet.species],
          ['Breed:', pet.breed || 'Not specified'],
          ['Birthdate:', pet.birthdate ? new Date(pet.birthdate).toLocaleDateString() : 'Not specified'],
          ['Gender:', pet.gender || 'Not specified'],
          ['Weight:', pet.weight ? `${pet.weight} kg` : 'Weight not recorded'],
          ['Color:', pet.color || 'Not specified']
        ];

        if (pet.notes) {
          petInfo.push(['Notes:', pet.notes]);
        }

        petInfo.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Owner Information
        yPosition += 5;
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Owner Information', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const ownerInfo = [
          ['Name:', owner.name],
          ['Email:', owner.email],
          ['Phone:', owner.phone || 'Not provided'],
          ['Address:', owner.address || 'Not provided']
        ];

        ownerInfo.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Statistics
        yPosition += 5;
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Statistics', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const stats = [
          ['Total Appointments:', currentReportData.statistics.total_appointments.toString()],
          ['Total Vaccinations:', currentReportData.statistics.total_vaccinations.toString()],
          ['Last Visit:', currentReportData.statistics.last_visit ? new Date(currentReportData.statistics.last_visit).toLocaleDateString() : 'Never']
        ];

        stats.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Footer
        pdf.setFontSize(8);
        pdf.text(`Report generated: ${new Date().toLocaleString()}`, 20, 280);
        pdf.text('This report contains confidential medical information.', 20, 285);

        // Add Medical History to PDF
        let medicalYPosition = 280;
        console.log(' Adding medical history to PDF...');
        console.log(' Records to add:', currentReportData.medical_history ? currentReportData.medical_history.length : 0);

        if (currentReportData.medical_history && currentReportData.medical_history.length > 0) {
          console.log(' Medical history found, adding to PDF');
          pdf.setFontSize(14);
          pdf.setTextColor(40, 40, 40);
          pdf.text('Medical History', 20, medicalYPosition);
          medicalYPosition += 15;

          currentReportData.medical_history.forEach((record, index) => {
            // Check if we need a new page
            if (medicalYPosition > 250) {
              pdf.addPage();
              medicalYPosition = 30;
            }

            pdf.setFontSize(10);
            pdf.setTextColor(60, 60, 60);

            // Record header
            pdf.setFontSize(12);
            pdf.setTextColor(40, 40, 40);
            const recordTitle = `Visit #${index + 1} - ${new Date(record.created_at).toLocaleDateString()}`;
            pdf.text(recordTitle, 20, medicalYPosition);
            medicalYPosition += 10;

            // Record details
            pdf.setFontSize(9);
            pdf.setTextColor(80, 80, 80);

            if (record.diagnosis) {
              pdf.text(`Diagnosis: ${record.diagnosis}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.treatment) {
              pdf.text(`Treatment: ${record.treatment}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.medications) {
              pdf.text(`Medications: ${record.medications}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.staff_name) {
              pdf.text(`Veterinarian: ${record.staff_name}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            medicalYPosition += 5; // Space between records
          });
        }

        // Footer
        pdf.setFontSize(8);
        pdf.setTextColor(100, 100, 100);
        pdf.text(`Total Medical Records: ${currentReportData.medical_history ? currentReportData.medical_history.length : 0}`, 20, 280);
        pdf.text(`Report generated: ${new Date().toLocaleString()}`, 20, 285);

        // Download
        const filename = `pet_report_${pet.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(filename);

        // Restore button state
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download PDF';
          downloadBtn.disabled = false;
        }

        console.log(' PDF generation completed successfully');
        console.log(' PDF saved as:', filename);
        toast(`PDF downloaded successfully! Saved as: ${filename}`, 'success');
      } catch (error) {
        console.error(' Error generating PDF:', error);

        // Restore button state
        const downloadBtn = document.getElementById('pdfDownloadBtn');
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-download"></i> <span>Download PDF Report</span>';
          downloadBtn.disabled = false;
        }

        toast('Error generating PDF. Please try again.', 'error');

        // Offer fallback option
        if (confirm('Would you like to try downloading an HTML version instead?')) {
          downloadHTMLReport();
        }
      }
    }

    async function loadJSPDFLibrary() {
      return new Promise((resolve, reject) => {
        // Check if already loaded
        if (typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined') {
          resolve();
          return;
        }

        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = () => {
          // Wait a bit for the library to initialize
          setTimeout(() => {
            if (typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined') {
              resolve();
            } else {
              reject(new Error('jsPDF library failed to load properly'));
            }
          }, 100);
        };
        script.onerror = () => reject(new Error('Failed to load jsPDF library'));
        document.head.appendChild(script);
      });
    }


    // Fallback HTML report download
    function downloadHTMLReport() {
      if (!currentReportData) {
        toast('No report data available', 'error');
        return;
      }

      const pet = currentReportData.pet;
      const owner = currentReportData.owner;

      // Create HTML content for the report
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Pet Medical Report - ${pet.name}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
            .header { text-align: center; border-bottom: 3px solid #28a745; padding-bottom: 20px; margin-bottom: 30px; }
            .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
            .section h3 { color: #28a745; margin-top: 0; border-bottom: 2px solid #28a745; padding-bottom: 10px; }
            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
            .info-item { margin-bottom: 10px; }
            .info-label { font-weight: bold; color: #333; }
            .footer { margin-top: 50px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 20px; }
            @media print { body { margin: 20px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Tattoo Veterinary Clinic</h1>
            <h2>Pet Medical Report</h2>
            <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
          </div>

          <div class="section">
            <h3>Pet Information</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Name:</span> ${pet.name}</div>
              <div class="info-item"><span class="info-label">Species:</span> ${pet.species}</div>
              <div class="info-item"><span class="info-label">Breed:</span> ${pet.breed || 'Not specified'}</div>
              <div class="info-item"><span class="info-label">Gender:</span> ${pet.gender || 'Not specified'}</div>
              <div class="info-item"><span class="info-label">Weight:</span> ${pet.weight ? pet.weight + ' kg' : 'Not recorded'}</div>
              <div class="info-item"><span class="info-label">Color:</span> ${pet.color || 'Not specified'}</div>
            </div>
          </div>

          <div class="section">
            <h3>Owner Information</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Name:</span> ${owner.name}</div>
              <div class="info-item"><span class="info-label">Email:</span> ${owner.email}</div>
              <div class="info-item"><span class="info-label">Phone:</span> ${owner.phone || 'Not provided'}</div>
              <div class="info-item"><span class="info-label">Address:</span> ${owner.address || 'Not provided'}</div>
            </div>
          </div>

          <div class="section">
            <h3>Medical Summary</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Total Appointments:</span> ${currentReportData.statistics.total_appointments}</div>
              <div class="info-item"><span class="info-label">Total Vaccinations:</span> ${currentReportData.statistics.total_vaccinations}</div>
              <div class="info-item"><span class="info-label">Last Visit:</span> ${currentReportData.statistics.last_visit ? new Date(currentReportData.statistics.last_visit).toLocaleDateString() : 'Never'}</div>
            </div>
          </div>

          <div class="footer">
            <p><strong>Tattoo Veterinary Clinic</strong></p>
            <p>Phone: 0917-519-4639 | Email: info@tattoovet.com</p>
            <p>This report contains confidential medical information.</p>
          </div>
        </body>
        </html>
      `;

      // Create and download HTML file
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pet_report_${pet.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      toast('HTML report downloaded successfully!', 'success');
    }

    // Pet Management Functions for Client Dashboard
    async function loadClientPets() {
      const petsGrid = document.getElementById('petsGrid');
      if (!petsGrid) return;

      try {
        petsGrid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading pets...</div>';

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();

        if (result.success && result.data && Array.isArray(result.data)) {
          if (result.data.length === 0) {
            petsGrid.innerHTML = '<div class="loading"><p>You haven\'t registered any pets yet. Add your first pet to get started!</p></div>';
          } else {
            displayClientPets(result.data);
          }
        } else {
          const errorMessage = result.message || 'Failed to load pets';
          console.error('API Error:', errorMessage);
          petsGrid.innerHTML = `<div class="loading"><p>Unable to load pets: ${errorMessage}</p></div>`;
        }
      } catch (error) {
        console.error('Error loading pets:', error);
        petsGrid.innerHTML = '<div class="loading"><p>Error loading pets. Please try again later.</p></div>';
      }
    }

    function displayClientPets(pets) {
      const petsGrid = document.getElementById('petsGrid');
      if (!petsGrid) return;

      if (pets.length === 0) {
        petsGrid.innerHTML = '<div class="empty-state"><i class="fas fa-paw"></i><h3>No Pets Found</h3><p>You haven\'t registered any pets yet. Add your first pet to get started!</p></div>';
        return;
      }

      // Clear existing content
      petsGrid.innerHTML = '';

      // Create a document fragment for better performance
      const fragment = document.createDocumentFragment();

      pets.forEach((pet, index) => {
        const petCard = createClientPetCard(pet);
        if (petCard) {
          fragment.appendChild(petCard);
        }
      });

      // Append all cards at once
      petsGrid.appendChild(fragment);
    }

    function createClientPetCard(pet) {
      const card = document.createElement('div');
      card.className = 'pet-card';

      // Get species icon for the minimal design
      const speciesIcon = getSpeciesIcon(pet.species);

      // Format birthdate for display
      let birthdateDisplay = 'Not recorded';
      if (pet.birthdate) {
        const birthDate = new Date(pet.birthdate);
        birthdateDisplay = birthDate.toLocaleDateString();
      }

      // Format weight for display
      let weightDisplay = 'Not recorded';
      if (pet.weight) {
        weightDisplay = `${pet.weight} kg`;
      }

      // Get owner name
      let ownerName = 'Not specified';
      if (pet.first_name && pet.last_name) {
        ownerName = `${pet.first_name} ${pet.last_name}`;
      }

      // Handle pet image with fallback
      let imageHtml = '';
      let placeholderHtml = '<div class="pet-image-placeholder"><i class="fas fa-paw"></i></div>';

      if (pet.profile_image && pet.profile_image.trim() !== '' && pet.profile_image !== null && pet.profile_image !== 'null') {
        const imagePath = '../' + pet.profile_image + '?t=' + Date.now();
        imageHtml = `<img src="${imagePath}" alt="${pet.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" onload="this.style.display='block'; this.nextElementSibling.style.display='none';" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`;
        placeholderHtml = '<div class="pet-image-placeholder" style="display: none;"><i class="fas fa-paw"></i></div>';
      }

      card.innerHTML = `
        <div class="pet-image" style="width: 80px; height: 80px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px auto; overflow: hidden;">
          ${imageHtml}
          ${placeholderHtml}
        </div>
        <h3 class="pet-name">${pet.name}</h3>
        <p><strong>Species:</strong> ${pet.species}</p>
        <p><strong>Breed:</strong> ${pet.breed || 'Not specified'}</p>
        <p><strong>Birthdate:</strong> ${birthdateDisplay}</p>
        <p><strong>Gender:</strong> ${pet.gender || 'Not specified'}</p>
        <p><strong>Weight:</strong> ${weightDisplay}</p>
        <p><strong>Owner:</strong> ${ownerName}</p>
        <div class="pet-actions" style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;">
          <button class="action-btn edit" onclick="editClientPet('${pet.id}')" style="background: rgba(52, 152, 219, 0.2); border: 1px solid #3498db; color: #ffffff; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 4px;">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="action-btn delete" onclick="deleteClientPet('${pet.id}', '${pet.name}')" style="background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; color: #ffffff; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 4px;">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      `;

      return card;
    }

    function getSpeciesIcon(species) {
      const icons = {
        'dog': 'fas fa-dog',
        'cat': 'fas fa-cat',
        'bird': 'fas fa-dove',
        'rabbit': 'fas fa-paw',
        'hamster': 'fas fa-paw',
        'fish': 'fas fa-fish',
        'reptile': 'fas fa-paw',
        'other': 'fas fa-paw'
      };
      return icons[species.toLowerCase()] || 'fas fa-paw';
    }

    function viewClientPetDetails(petId) {
      // This will be implemented to show pet details modal
      toast('View pet details feature coming soon!', 'info');
      console.log('View pet details for ID:', petId);
    }

    function viewClientPetMedicalHistory(petId) {
      // This will be implemented to show pet medical history modal
      toast('Medical history feature coming soon!', 'info');
      console.log('View medical history for pet ID:', petId);
    }



    function deleteClientPet(petId, petName) {
      if (confirm(`Are you sure you want to delete ${petName}? This action cannot be undone.`)) {
        // Here you would implement the delete functionality
        toast(`Delete functionality for ${petName} will be implemented`, 'info');
        console.log('Delete pet ID:', petId, 'Name:', petName);
      }
    }

    function editClientPet(petId) {
      console.log('Edit pet called with ID:', petId);

      // Get pet data from the API
      fetch('../api/vet_api.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_pets' })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success && result.data) {
          const pet = result.data.find(p => p.id == petId);
          if (pet) {
            // Populate edit form
            document.getElementById('editPetId').value = pet.id;
            document.getElementById('editPetName').value = pet.name;
            document.getElementById('editPetSpecies').value = pet.species;
            document.getElementById('editPetBreed').value = pet.breed || '';
            document.getElementById('editPetBirthdate').value = pet.birthdate || '';
            document.getElementById('editPetGender').value = pet.gender || '';
            document.getElementById('editPetWeight').value = pet.weight || '';
            document.getElementById('editPetColor').value = pet.color || '';

            // Show current image if exists
            const currentImageDiv = document.getElementById('currentEditPetImage');
            if (pet.profile_image && pet.profile_image.trim() !== '' && pet.profile_image !== null && pet.profile_image !== 'null') {
              const imagePath = '../' + pet.profile_image;
              currentImageDiv.innerHTML = `<img src="${imagePath}" alt="${pet.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover; border: 2px solid rgba(255, 255, 255, 0.3);">`;
            } else {
              currentImageDiv.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">No image uploaded</p>';
            }

            // Show edit modal
            const modal = document.getElementById('clientEditPetModal');
            if (modal) {
              modal.style.display = 'flex';
              document.body.style.overflow = 'hidden';
            }
          } else {
            toast('Pet not found', 'error');
          }
        } else {
          toast('Failed to load pet data', 'error');
        }
      })
      .catch(error => {
        console.error('Error loading pet data:', error);
        toast('Failed to load pet data', 'error');
      });
    }

    function closeClientEditPetModal() {
      const modal = document.getElementById('clientEditPetModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // Clear form
        document.getElementById('clientEditPetForm').reset();
        document.getElementById('currentEditPetImage').innerHTML = '';
      }
    }

    // Handle edit pet form submission - this is already handled in the HTML form

    // Debug function to test API endpoints
    async function testPetAPI(petId) {
      console.log('=== TESTING PET API ENDPOINTS ===');
      console.log('Testing for pet ID:', petId);

      const endpoints = [
        { name: 'pet_reports_api.php GET', url: `../api/pet_reports_api.php?action=get_pet_details&pet_id=${petId}`, method: 'GET' },
        { name: 'vet_api.php POST', url: '../api/vet_api.php', method: 'POST', data: { action: 'get_pet_details', pet_id: petId } },
        { name: 'pet_reports_api.php POST', url: '../api/pet_reports_api.php', method: 'POST', data: { action: 'get_pet_details', pet_id: petId } }
      ];

      for (const endpoint of endpoints) {
        try {
          console.log(`\n--- Testing ${endpoint.name} ---`);

          let response;
          if (endpoint.method === 'POST') {
            response = await fetch(endpoint.url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(endpoint.data)
            });
          } else {
            response = await fetch(endpoint.url, {
              method: 'GET',
              headers: { 'Content-Type': 'application/json' }
            });
          }

          console.log('Response status:', response.status);
          console.log('Response headers:', Object.fromEntries(response.headers.entries()));

          const result = await response.json();
          console.log('Full response:', result);

          if (result.success && result.data) {
            console.log(' SUCCESS! Data structure:', result.data);
            if (result.data.pet) {
              console.log('Found nested pet data:', result.data.pet);
            }
          } else {
            console.log(' No success or no data');
          }

        } catch (error) {
          console.error(' Error:', error.message);
        }
      }

      console.log('=== API TEST COMPLETE ===');
    }

    // Add this to window for easy access from browser console
    window.testPetAPI = testPetAPI;

    // Test function for update API
    async function testUpdateAPI(petId, testData) {
      console.log('=== TESTING PET UPDATE API ===');
      console.log('Testing update for pet ID:', petId);
      console.log('Test data:', testData);

      const updateData = {
        action: 'update_pet',
        pet_id: petId,
        name: testData.name || 'Test Name',
        species: testData.species || 'dog',
        breed: testData.breed || 'Test Breed',
        birthdate: testData.birthdate || '2023-01-01',
        gender: testData.gender || 'male',
        color: testData.color || 'Test Color',
        notes: testData.notes || 'Test Notes'
      };

      try {
        console.log('Sending update request to: ../api/vet_api.php');
        console.log('Update data:', updateData);

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updateData)
        });

        console.log('Response status:', response.status);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));

        const result = await response.json();
        console.log('Update response:', result);

        if (result.success) {
          console.log(' UPDATE SUCCESS!');
        } else {
          console.log(' UPDATE FAILED:', result.message);
        }

        return result;

      } catch (error) {
        console.error(' UPDATE ERROR:', error);
        return { success: false, message: error.message };
      }
    }

    // Add to window for console access
    window.testUpdateAPI = testUpdateAPI;

    // Debug function to test pets API directly
    async function debugPetReports() {
      console.log('=== DEBUGGING PET REPORTS ===');

      try {
        // Check session first
        console.log('1. Checking session...');
        const sessionResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'check_session' })
        });
        const sessionResult = await sessionResponse.json();
        console.log('Session check result:', sessionResult);

        if (!sessionResult.success) {
          console.error(' Session check failed:', sessionResult.message);
          toast('Session check failed. Please refresh the page.', 'error');
          return;
        }

        console.log(' Session is valid, user type:', sessionResult.data.user_type);

        // Test pets API
        console.log('2. Testing pets API...');
        const petsResponse = await fetch('../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log('Pets API URL:', '../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log('Response status:', petsResponse.status);

        const petsResult = await petsResponse.json();
        console.log('Pets API full response:', petsResult);

        if (petsResult.success) {
          console.log(' Pets API success! Found', petsResult.data.length, 'pets');

          if (petsResult.data.length === 0) {
            console.log(' No pets found - this might be the issue');
            toast('No pets found in database for this user', 'warning');
          } else {
            console.log(' Pet details:');
            petsResult.data.forEach((pet, index) => {
              console.log(`  ${index + 1}. ${pet.name} (ID: ${pet.id}, Species: ${pet.species}, Owner: ${pet.first_name} ${pet.last_name})`);
            });

            // Check if pets belong to current user
            const currentUserPets = petsResult.data.filter(pet => pet.owner_id === sessionResult.data.user.id);
            console.log(' Pets belonging to current user:', currentUserPets.length);
          }
        } else {
          console.error(' Pets API failed:', petsResult.message);
          toast('Pets API failed: ' + petsResult.message, 'error');
        }

        // Test direct vet_api get_pets
        console.log('3. Testing vet_api get_pets...');
        const vetApiResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });
        const vetApiResult = await vetApiResponse.json();
        console.log('Vet API get_pets result:', vetApiResult);

        if (vetApiResult.success) {
          console.log(' Vet API get_pets success! Found', vetApiResult.data.length, 'pets');
        } else {
          console.error(' Vet API get_pets failed:', vetApiResult.message);
        }

      } catch (error) {
        console.error(' Debug error:', error);
        toast('Debug error: ' + error.message, 'error');
      }

      console.log('=== DEBUG COMPLETE ===');
    }

    // Add to window for console access
    window.debugPetReports = debugPetReports;
    window.loadPetsDropdown = loadPetsDropdown;
    window.testMyOrdersModal = testMyOrdersModal;

    // Test Medical Report Display function (for debugging)
    window.testMedicalReportDisplay = function() {
      console.log('=== TESTING MEDICAL REPORT DISPLAY ===');

      // Test data
      const testData = {
        pet: {
          name: 'Bogart',
          species: 'Dog',
          breed: 'Puspin',
          gender: 'Male',
          weight: '25',
          color: 'Blue'
        },
        owner: {
          name: 'John Cedrick Unida',
          email: 'unida99@gmail.com',
          phone: '09286077247',
          address: 'Not provided'
        },
        medical_history: [
          {
            created_at: '2025-10-15 09:00:00',
            staff_name: 'Dr. Smith',
            service_name: 'Vaccination',
            diagnosis: 'Routine health check',
            treatment: 'Annual vaccination administered',
            medications: 'DHPP vaccine, Rabies vaccine',
            notes: 'Patient was healthy and cooperative'
          }
        ],
        statistics: {
          total_appointments: 1,
          total_vaccinations: 1,
          total_medical_records: 1,
          last_visit: '2025-10-15'
        }
      };

      // Find the report preview element
      const reportPreview = document.getElementById('reportPreview');
      if (reportPreview) {
        console.log(' Found report preview element');

        // Generate HTML content
        let html = `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-paw" style="color: #667eea;"></i> Pet Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${testData.pet.name}</div>
              <div><strong>Species:</strong> ${testData.pet.species}</div>
              <div><strong>Breed:</strong> ${testData.pet.breed}</div>
              <div><strong>Gender:</strong> ${testData.pet.gender}</div>
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-stethoscope" style="color: #667eea;"></i> Medical Records
            </h3>
            <div style="margin-bottom: 15px; text-align: center;">
              <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
                Total Records: ${testData.medical_history.length}
              </span>
            </div>
        `;

        testData.medical_history.forEach((record, index) => {
          html += `
            <div style="margin: 15px 0; padding: 15px; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);">
              <div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #e1e5e9;">
                <h5 style="margin: 0 0 5px 0; color: #667eea; font-size: 14px;">
                  Visit #${index + 1} - ${new Date(record.created_at).toLocaleDateString()}
                </h5>
                <div style="font-size: 12px; color: #666;">
                  <strong>Staff:</strong> ${record.staff_name} | <strong>Service:</strong> ${record.service_name}
                </div>
              </div>

              <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #667eea;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Diagnosis</div>
                  <div style="color: #555; font-size: 12px;">${record.diagnosis}</div>
                </div>

                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #28a745;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Treatment</div>
                  <div style="color: #555; font-size: 12px;">${record.treatment}</div>
                </div>

                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #ffc107;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Medications</div>
                  <div style="color: #555; font-size: 12px;">${record.medications}</div>
                </div>
              </div>
            </div>
          `;
        });

        html += `</div>`;

        // Display the HTML
        reportPreview.innerHTML = html;
        console.log(' Medical report displayed with test data');

        return ' Medical report test completed successfully';
      } else {
        console.error(' Report preview element not found');
        return ' Report preview element not found';
      }
    };

    // Settings tab management functions
    function showSettingsSection(sectionName) {
      console.log(' Switching to settings section:', sectionName);

      // Hide all settings content sections
      const contentSections = document.querySelectorAll('.settings-content');
      contentSections.forEach(section => {
        section.style.display = 'none';
        section.classList.remove('active');
      });

      // Remove active class from all tab buttons
      const tabButtons = document.querySelectorAll('.settings-tab');
      tabButtons.forEach(tab => {
        tab.classList.remove('active');
      });

      // Show selected settings content section
      const targetContent = document.getElementById(sectionName + 'Settings');
      if (targetContent) {
        targetContent.style.display = 'block';
        targetContent.classList.add('active');
        console.log(' Settings content section shown:', sectionName);
      } else {
        console.error(' Settings content section not found:', sectionName + 'Settings');
      }

      // Add active class to clicked tab button
      const activeTab = document.querySelector(`[onclick="showSettingsSection('${sectionName}')"]`);
      if (activeTab) {
        activeTab.classList.add('active');
        console.log(' Settings tab activated:', sectionName);

        // Move the indicator
        moveSettingsIndicator(activeTab);
      } else {
        console.warn(' Settings tab button not found for:', sectionName);
      }
    }


    // Initialize settings section when settings page is shown
    function initializeSettingsSection() {
      console.log(' Initializing settings section...');

      // Show profile section by default
      showSettingsSection('profile');

      // Load settings data
      if (typeof loadClientSettingsData === 'function') {
        loadClientSettingsData();
      } else {
        console.warn(' loadClientSettingsData function not found');
      }
    }

    // Notification Badge Management for Client
    function updateNotificationBadge() {
      const mobileToggle = document.getElementById('clientMobileMenuToggle');
      if (!mobileToggle) return;

      // Remove existing badge
      const existingBadge = mobileToggle.querySelector('.notification-badge');
      if (existingBadge) {
        existingBadge.remove();
      }

      // Check for unread notifications
      getUnreadNotificationCount().then(count => {
        if (count > 0) {
          const badge = document.createElement('div');
          badge.className = 'notification-badge';
          badge.textContent = count > 99 ? '99+' : count;
          mobileToggle.appendChild(badge);
          console.log(` Client notification badge added: ${count} unread notifications`);
        }
      }).catch(error => {
        console.error('Error updating notification badge:', error);
      });
    }

    async function getUnreadNotificationCount() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_unread_count' })
        });

        const result = await response.json();

        if (result.success && result.data) {
          return parseInt(result.data.unread_count) || 0;
        }
        return 0;
      } catch (error) {
        console.error('Error checking notifications:', error);
        return 0;
      }
    }

    // Function to check current select element state
    function checkSelectState() {
      console.log('=== CHECKING SELECT ELEMENT STATE ===');
      const petSelect = document.getElementById('petSelect');

      if (!petSelect) {
        console.error(' Pet select element not found in DOM');
        return;
      }

      console.log(' Pet select element found');
      console.log(' Select properties:', {
        id: petSelect.id,
        tagName: petSelect.tagName,
        optionsCount: petSelect.options.length,
        selectedIndex: petSelect.selectedIndex,
        value: petSelect.value,
        disabled: petSelect.disabled
      });

      console.log(' Current options:');
      for (let i = 0; i < petSelect.options.length; i++) {
        const option = petSelect.options[i];
        console.log(`  ${i}: value="${option.value}" text="${option.textContent}"`);
      }

      console.log('=== SELECT STATE CHECK COMPLETE ===');
    }

    window.checkSelectState = checkSelectState;


    // Client-specific functions
    async function cancelAppointment(appointmentId) {
      if (!appointmentId) {
        toast('Invalid appointment ID', 'error');
        return;
      }

      // Confirm cancellation with user
      if (!confirm('Are you sure you want to cancel this appointment? This action cannot be undone.')) {
        return;
      }

      try {
        console.log('Client requesting appointment cancellation for ID:', appointmentId);

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'cancel_appointment',
            appointment_id: appointmentId
          })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('Cancellation response:', result);

        if (result.success) {
          toast('Appointment cancellation request submitted successfully! Staff will review and confirm.', 'success');

          // Update the appointment status in the UI
          updateAppointmentStatusInUI(appointmentId, 'cancelled');

          // Reload appointments to reflect the changes
          if (window.dashboardInstance && typeof window.dashboardInstance.loadAppointmentsSection === 'function') {
            window.dashboardInstance.loadAppointmentsSection();
          }
        } else {
          toast(result.message || 'Failed to cancel appointment', 'error');
        }
      } catch (error) {
        console.error('Error cancelling appointment:', error);
        toast('Error cancelling appointment. Please try again or contact the clinic staff.', 'error');
      }
    }

  </script>
</body>
</html>
