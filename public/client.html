<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard - Tattao Veterinary Clinic</title>
  <link rel="stylesheet" href="../assets/css/enhanced-style.css">
  <link rel="stylesheet" href="../assets/css/modern-dashboard.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <!-- SMTPJS for email sending -->
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="description" content="Client Dashboard - Tattao Veterinary Clinic Management System">
  <style>
    /* Enhanced pet card action button styling */
    .pet-card .action-btn {
      background: transparent;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      font-weight: 500;
      pointer-events: auto;
      z-index: 10;
      position: relative;
    }

    .pet-card .action-btn.edit {
      background: #3498db;
      color: white;
    }

    .pet-card .action-btn.delete {
      background: #e74c3c;
      color: white;
    }

    .pet-card .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Modal enhancements */
    .modal-content {
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      max-height: calc(90vh - 120px);
    }

    /* Custom scrollbar for webkit browsers */
    .modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }

    .modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Mobile responsive modal */
    @media (max-width: 768px) {
      .modal-content {
        max-height: 95vh;
        margin: 2.5vh 10px;
        border-radius: 12px;
      }

      .modal-body {
        max-height: calc(95vh - 140px);
        padding: 16px;
      }

      .form-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }

    /* Ensure pet cards are properly interactive */
    .pet-card {
      pointer-events: auto;
      position: relative;
      z-index: 1;
    }

    .pet-card * {
      pointer-events: auto;
    }

    .pet-card .pet-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 16px;
      pointer-events: auto;
    }

    .pet-card .pet-actions .action-btn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #ffffff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      font-weight: 500;
      min-width: 60px;
      justify-content: center;
    }

    .pet-card .pet-actions .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    .pet-card .pet-actions .action-btn.edit {
      background: rgba(52, 152, 219, 0.2);
      border-color: #3498db;
    }

    .pet-card .pet-actions .action-btn.edit:hover {
      background: rgba(52, 152, 219, 0.3);
    }

    .pet-card .pet-actions .action-btn.delete {
      background: rgba(231, 76, 60, 0.2);
      border-color: #e74c3c;
    }

    .pet-card .pet-actions .action-btn.delete:hover {
      background: rgba(231, 76, 60, 0.3);
    }

    /* Notification Badge for Mobile Menu Toggle */
    .mobile-menu-toggle {
      position: relative;
    }

    .mobile-menu-toggle .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      animation: pulse 2s infinite;
      z-index: 10;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
    }

    /* Pulse animation for Book New button highlight */
    @keyframes highlightPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        transform: scale(1.05);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }

    /* Pulse animation for Book New button highlight */
    @keyframes highlightPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        transform: scale(1.05);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }

    /* Status badge styling for client appointments */
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending {
      background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      color: white;
    }

    .status-confirmed {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .status-in-progress {
      background: linear-gradient(135deg, #17a2b8 0%, #007bff 100%);
      color: white;
    }

    .status-completed {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .status-cancelled {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
    }

    .status-requested {
      background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
      color: white;
    }

    .status-text {
      color: #6c757d;
      font-size: 12px;
      font-style: italic;
    }

    /* Medical Report Styles */
    .medical-report-container {
      max-width: 100%;
    }

    .report-section {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #667eea;
    }

    .report-section h3 {
      color: #333;
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .report-section h3 i {
      color: #667eea;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .info-item {
      display: flex;
      gap: 8px;
      padding: 8px 0;
    }

    .info-item .label {
      font-weight: 600;
      color: #555;
      min-width: 80px;
    }

    .info-item .value {
      color: #333;
    }

    .medical-record {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border: 2px solid #667eea;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .record-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(102, 126, 234, 0.2);
    }

    .record-header h4 {
      margin: 0 0 8px 0;
      color: #667eea;
      font-size: 16px;
    }

    .record-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #666;
    }

    .record-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .record-details {
      display: grid;
      gap: 12px;
    }

    .detail-item {
      background: #ffffff;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }

    .detail-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .detail-content {
      color: #555;
      line-height: 1.4;
    }

    .records-count {
      text-align: center;
      margin-bottom: 20px;
    }

    .badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border: 2px dashed rgba(102, 126, 234, 0.3);
    }

    .empty-state i {
      font-size: 48px;
      color: rgba(102, 126, 234, 0.3);
      margin-bottom: 16px;
    }

    .empty-state h4 {
      margin: 0 0 8px 0;
      color: #667eea;
      font-size: 18px;
    }

    .empty-state p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    .no-history {
      border-left-color: #ffc107;
    }

    .no-history h3 i {
      color: #ffc107;
    }
  </style>
   </head>
<body>
  <!-- Client Dashboard Container -->
  <div class="client-container">
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="profile-picture-container">
          <img src="../assets/images/logoo.jpg" alt="Profile" id="clientAvatar">
          <div class="profile-picture-overlay">
            <i class="fas fa-camera"></i>
            <input type="file" id="sidebarProfileInput" accept="image/*" style="display: none;">
          </div>
        </div>
        <h3 id="clientName">John Cedrick Unida</h3>
        <p id="clientEmail">Loading...</p>
      </div>
      
      <div class="sidebar-nav">
        <a href="#dashboard" class="nav-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
        </a>
        <a href="#appointments" class="nav-item" data-section="appointments">
          <i class="fas fa-calendar-alt"></i> <span>My Appointments</span>
        </a>
        <a href="#pets" class="nav-item" data-section="pets">
          <i class="fas fa-paw"></i> <span>My Pets</span>
        </a>
        <a href="#reports" class="nav-item" data-section="reports">
          <i class="fas fa-file-pdf"></i> <span>Pet Reports</span>
        </a>
        <a href="#settings" class="nav-item" data-section="settings">
          <i class="fas fa-cog"></i> <span>Settings</span>
        </a>
        <a href="#" class="nav-item" data-section="logout" onclick="handleLogout()">
          <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
        </a>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">

      <!-- Header Bar -->
      <header class="header-bar">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="clientMobileMenuToggle" onclick="toggleClientMobileSidebar()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="header-content" style="display: flex; justify-content: flex-start; align-items: center; width: 100%;">

          <!-- Left Group with Title, Search, Cart, and Back Button -->
          <div class="left-group" style="display: flex; align-items: center; gap: 20px;">
            <!-- Title -->
            <div class="header-title">
              <h1 id="pageTitle" style="color: #ffffff; font-size: 18px; margin: 0; font-weight: 600;"><i class="fas fa-paw" style="color: #ffffff; margin-right: 8px;"></i> Welcome to Your Dashboard</h1>
            </div>

            <!-- Search Container -->
            <div class="search-container">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Search for pet products, services..." />
            </div>


            <!-- Back to Home Button -->
            <button class="home-btn" onclick="window.location.href='../index.html'" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 8px 16px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px;">
              <i class="fas fa-home"></i> Back to Home
            </button>
          </div>
        </div>
     </header>

      <!-- Dashboard Content -->
      <div class="dashboard-content">
        
        <!-- Welcome Section -->
        <div class="welcome-section">
          <h2 class="welcome-title">
            <i class="fas fa-paw"></i> Welcome to Your Dashboard
          </h2>
          <p class="welcome-subtitle">Manage your pets, appointments, and more from one place</p>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboardSection" class="content-section" style="display: block;">
          <div class="section-header" style="margin-bottom: 20px;">
            <h2 class="section-title" style="color: #ffffff; font-size: 20px; margin: 0; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-tachometer-alt" style="color: #ffffff;"></i> Dashboard Overview
            </h2>
          </div>

          <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div class="dashboard-card" id="upcomingAppointments" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-calendar-alt" style="color: #ffffff; font-size: 16px;"></i> Upcoming Appointments
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="upcomingAppointmentsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Scheduled appointments</div>
            </div>

            <div class="dashboard-card" id="clientPets" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-paw" style="color: #ffffff; font-size: 16px;"></i> My Pets
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="clientPetsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Registered pets</div>
            </div>

            <div class="dashboard-card" id="cartItems" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-shopping-cart" style="color: #ffffff; font-size: 16px;"></i> Cart Items
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="cartItemsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Items in cart</div>
            </div>

            <div class="dashboard-card" id="completedVisits" style="background: #122d47; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div class="card-title" style="color: #ffffff; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 500;">
                <i class="fas fa-check-circle" style="color: #ffffff; font-size: 16px;"></i> Completed Visits
              </div>
              <div class="card-value" style="color: #ffffff; font-size: 36px; font-weight: bold; margin-bottom: 5px;" id="completedVisitsCount">0</div>
              <div class="card-subtitle" style="color: rgba(255, 255, 255, 0.8); font-size: 12px; font-weight: 400;">Total completed</div>
            </div>
          </div>
        </section>
        
        <!-- Appointments Section -->
        <section id="appointmentsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-calendar-alt"></i> My Appointments
            </h2>
            <button class="header-btn" onclick="clientDashboard.showBookingModal()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
              <i class="fas fa-plus"></i> Book New
            </button>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Pet</th>
                  <th>Service</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="appointmentsTableBody">
                <tr>
                  <td colspan="6" class="loading">
                    <div class="spinner"></div>
                    Loading appointments...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section id="petsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-paw"></i> My Pets
            </h2>
            <button class="header-btn" onclick="showAddPetModal()">
              <i class="fas fa-plus"></i> Add Pet
            </button>
          </div>
          <div id="petsGrid" class="pets-grid">
            <div class="loading">
              <div class="spinner"></div>
              Loading pets...
            </div>
          </div>
        </section>


        <!-- Add Pet Modal for Client - Simplified -->
        <div id="clientAddPetModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <h3 style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-paw" style="color: #9BA9FF; font-size: 1.5rem;"></i>
                Add New Pet
              </h3>
              <span class="close" onclick="closeClientAddPetModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
              <form id="clientAddPetForm">
                <!-- Pet Name and Species Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
                    <input type="text" id="clientAddPetName" name="pet_name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter pet name">
                  </div>
                  <div class="form-group">
                    <label for="clientPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
                    <select id="clientAddPetSpecies" name="species" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Species</option>
                      <option value="Dog">üê∂ Dog</option>
                      <option value="Cat">üê± Cat</option>
                      <option value="Bird">üê¶ Bird</option>
                      <option value="Rabbit">üê∞ Rabbit</option>
                      <option value="Other">üêæ Other</option>
                    </select>
                  </div>
                </div>

                <!-- Breed and Birthdate Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
                    <input type="text" id="clientAddPetBreed" name="breed" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter breed (optional)">
                  </div>
                  <div class="form-group">
                    <label for="clientAddPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
                    <input type="date" id="clientAddPetBirthdate" name="birthdate" max="${new Date().toISOString().split('T')[0]}" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>

                <!-- Gender and Weight Row -->
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientAddPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
                    <select id="clientAddPetGender" name="gender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Gender</option>
                      <option value="Male">‚ôÇÔ∏è Male</option>
                      <option value="Female">‚ôÄÔ∏è Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="clientAddPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
                    <input type="number" id="clientAddPetWeight" name="weight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>

                <!-- Color -->
                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="clientAddPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
                  <input type="text" id="clientAddPetColor" name="color" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter color (optional)">
                </div>

                <!-- Form Actions -->
                <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
                  <button type="button" class="btn-secondary" onclick="closeClientAddPetModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">CANCEL</button>
                  <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                    <i class="fas fa-plus" style="margin-right: 8px;"></i> ADD PET
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>




        <!-- Reports Section -->
        <section id="reportsSection" class="content-section" style="display: none;">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-file-pdf"></i> Pet Medical Reports
              </h2>
            </div>

            <!-- Pet Reports Interface -->
            <div class="pet-reports-container" style="max-width: 800px; margin: 0 auto; padding: 40px 20px;">
              <!-- Select Pet Section -->
              <div class="pet-select-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; transform: translate(30px, -30px);"></div>
                <div style="position: absolute; bottom: 0; left: 0; width: 150px; height: 150px; background: rgba(255, 255, 255, 0.05); border-radius: 50%; transform: translate(-50px, 50px);"></div>

                <div class="section-title" style="color: #ffffff; font-size: 24px; font-weight: 700; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; position: relative; z-index: 2;">
                  <i class="fas fa-stethoscope" style="color: #ffffff; font-size: 28px;"></i>
                  Select Pet for Medical Report
                </div>

                <div class="form-group" style="margin-bottom: 25px; position: relative; z-index: 2;">
                  <label for="petSelect" style="color: #ffffff; font-size: 16px; margin-bottom: 10px; display: block; font-weight: 600;">Choose a Pet:</label>
                  <select id="petSelect" style="width: 100%; padding: 15px 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; background: rgba(255, 255, 255, 0.95); color: #333; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                    <option value="">Loading pets...</option>
                  </select>
                </div>

                <div class="form-actions" style="text-align: center; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; position: relative; z-index: 2;">
                  <button id="loadPetsBtn" class="header-btn" onclick="loadPetsDropdown()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.4); padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; backdrop-filter: blur(10px);">
                    <i class="fas fa-sync-alt"></i> Load Pets
                  </button>
                  <button id="generateReportBtn" class="header-btn" onclick="generatePetReport()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);">
                    <i class="fas fa-file-medical"></i> Generate Medical Report
                  </button>
                  <button onclick="downloadSimplePDFReport()" id="pdfDownloadBtn" style="background: linear-gradient(135deg, #dc3545, #fd7e14); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(220, 53, 69, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(220, 53, 69, 0.4)'">
                    <i class="fas fa-download"></i> Download PDF
                  </button>
                </div>
              </div>

              <!-- Report Preview Section -->
              <div class="report-preview-section" style="background: #ffffff; border-radius: 20px; padding: 40px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 2px solid rgba(102, 126, 234, 0.1); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #667eea);"></div>

                <div class="section-title" style="color: #333; font-size: 22px; font-weight: 700; margin-bottom: 25px; display: flex; align-items: center; gap: 12px;">
                  <i class="fas fa-eye" style="color: #667eea; font-size: 24px;"></i>
                  Medical Report Preview
                </div>

                <div id="reportPreview" class="report-preview-content" style="min-height: 300px; padding: 40px; text-align: center; color: #999; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; border: 2px dashed #dee2e6; transition: all 0.3s ease;">
                  <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                    <i class="fas fa-file-medical" style="font-size: 64px; color: rgba(102, 126, 234, 0.3);"></i>
                    <div>
                      <h3 style="margin: 0 0 10px 0; color: #667eea; font-size: 20px;">No Report Selected</h3>
                      <p style="margin: 0; font-size: 16px; color: #666;">Select a pet and click "Generate Medical Report" to view their complete medical history here.</p>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 10px; border: 1px solid rgba(40, 167, 69, 0.2); max-width: 400px;">
                      <p style="margin: 0; font-size: 14px; color: #28a745; text-align: center;">
                        <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                        <strong>PDF Download Available:</strong> After generating a report, you'll see a prominent download button to save your pet's medical report as a PDF file.
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Quick Stats Section (shown after report generation) -->
              <div id="reportStats" class="report-stats-section" style="display: none; margin-top: 30px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; color: white;">
                  <h3 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-bar"></i> Medical Summary
                  </h3>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                      <div id="totalVisits" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">0</div>
                      <div style="font-size: 14px; opacity: 0.9;">Total Visits</div>
                    </div>
                    <div style="text-align: center;">
                      <div id="totalVaccinations" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">0</div>
                      <div style="font-size: 14px; opacity: 0.9;">Vaccinations</div>
                    </div>
                    <div style="text-align: center;">
                      <div id="lastVisit" style="font-size: 32px; font-weight: 800; margin-bottom: 5px;">-</div>
                      <div style="font-size: 14px; opacity: 0.9;">Last Visit</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </section>

        <section id="settingsSection" class="content-section" style="display: none;">
          <div class="section-header">
            <h2 class="section-title" style="color: #ffffff; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-cog" style="color: #ffffff;"></i> Settings
            </h2>
          </div>

          <div class="settings-container" style="display: grid; gap: 20px; max-width: 800px;">

            <!-- Profile Information Settings -->
            <div class="settings-card" style="background: #08355f; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                  <i class="fas fa-user" style="color: #5DADE2;"></i> Profile Information
                </h3>
              </div>
              <form id="profileForm" class="settings-form">
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="firstName" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">First Name *</label>
                    <input type="text" id="firstName" name="first_name" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="lastName" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Last Name *</label>
                    <input type="text" id="lastName" name="last_name" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-group" style="margin-bottom: 16px;">
                  <label for="email" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Email Address *</label>
                  <input type="email" id="email" name="email" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="phone" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Phone Number</label>
                  <input type="tel" id="phone" name="phone" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                </div>
                <div class="form-actions" style="text-align: right;">
                  <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                    <i class="fas fa-save"></i> Update Profile
                  </button>
                </div>
              </form>
            </div>

            <!-- Password Settings -->
            <div class="settings-card" style="background: #08355f; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                  <i class="fas fa-lock" style="color: #5DADE2;"></i> Change Password
                </h3>
              </div>
              <form id="passwordForm" class="settings-form">
                <div class="form-group" style="margin-bottom: 16px;">
                  <label for="currentPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Current Password *</label>
                  <input type="password" id="currentPassword" name="current_password" required style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                  <div class="form-group">
                    <label for="newPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">New Password *</label>
                    <input type="password" id="newPassword" name="new_password" required minlength="6" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="confirmPassword" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Confirm New Password *</label>
                    <input type="password" id="confirmPassword" name="confirm_password" required minlength="6" style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-actions" style="text-align: right;">
                  <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                    <i class="fas fa-key"></i> Update Password
                  </button>
                </div>
              </form>
            </div>

            <!-- Email Verification Settings -->
            <div class="settings-card" style="background: #08355f; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                  <i class="fas fa-envelope" style="color: #5DADE2;"></i> Email Verification
                </h3>
              </div>
              <div class="email-verification-section" style="margin-bottom: 20px;">
                <div id="emailVerificationStatus" style="margin-bottom: 20px; padding: 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.1);">
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <i class="fas fa-spinner fa-spin" style="color: #ffd700;"></i>
                    <span style="color: #ffffff; font-weight: 500;">Checking verification status...</span>
                  </div>
                </div>
                <div class="verification-actions" style="display: flex; gap: 12px; flex-wrap: wrap;">
                  <button id="verifyEmailBtn" onclick="verifyUserEmail()" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-check-circle"></i> Verify Email Address
                  </button>
                  <button id="resendVerificationBtn" onclick="resendVerificationEmail()" class="btn-secondary" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-paper-plane"></i> Resend Verification
                  </button>
                </div>
                <div class="verification-info" style="margin-top: 15px; padding: 12px; background: rgba(255, 215, 0, 0.1); border-radius: 6px; border-left: 3px solid #ffd700;">
                  <p style="color: rgba(255, 255, 255, 0.9); font-size: 13px; margin: 0; line-height: 1.4;">
                    <strong style="color: #ffd700;">Why verify your email?</strong><br>
                    Email verification enhances your account security and enables password reset functionality. It's optional but recommended for the best experience.
                  </p>
                </div>
              </div>
            </div>

            <!-- Profile Picture Settings -->
            <div class="settings-card" style="background: #08355f; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
              <div class="card-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: #ffffff; margin: 0; display: flex; align-items: center; gap: 10px;">
                  <i class="fas fa-camera" style="color: #5DADE2;"></i> Profile Picture
                </h3>
              </div>
              <div class="profile-picture-section" style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: center;">
                <div class="current-picture">
                  <img id="currentProfilePicture" src="../assets/images/logoo.jpg" alt="Profile Picture" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid rgba(255, 255, 255, 0.2);">
                  <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; margin: 8px 0 0 0; text-align: center;">Current Picture</p>
                </div>
                <div class="upload-section">
                  <form id="pictureForm" class="settings-form">
                    <div class="form-group" style="margin-bottom: 16px;">
                      <label for="profilePictureInput" style="color: #ffffff; font-size: 14px; margin-bottom: 6px; display: block;">Choose New Picture</label>
                      <input type="file" id="profilePictureInput" accept="image/*" required style="width: 100%; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                    </div>
                    <div class="image-preview" style="margin-bottom: 16px;">
                      <img id="imagePreview" src="" alt="Preview" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255, 255, 255, 0.3); display: none;">
                    </div>
                    <div class="form-actions" style="display: flex; gap: 12px;">
                      <button type="button" class="btn-secondary" onclick="document.getElementById('profilePictureInput').click()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-folder-open"></i> Choose File
                      </button>
                      <button type="submit" class="btn-primary" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-upload"></i> Upload Picture
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Booking Modal for Client Dashboard -->
        <div id="clientBookingModal" class="modal" style="display: none;">
          <div class="modal-content booking-modal" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <h3 id="clientBookingModalTitle" style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-calendar-plus" style="color: #9BA9FF; font-size: 1.5rem;"></i>
                Book an Appointment
              </h3>
              <span class="close" onclick="closeClientBookingModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">

              <!-- Booking Form -->
              <form id="clientBookingForm">
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingService" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-stethoscope" style="color: #5DADE2; margin-right: 8px;"></i> Select Service *
                    </label>
                    <select id="clientBookingService" name="service_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Loading services...</option>
                    </select>
                    <button type="button" onclick="refreshClientServices()" title="Refresh services" style="background: #f39c12; color: white; border: none; padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 12px;">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="clientBookingPet" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-paw" style="color: #5DADE2; margin-right: 8px;"></i> Select Pet *
                    </label>
                    <select id="clientBookingPet" name="pet_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Loading pets...</option>
                    </select>
                    <button type="button" onclick="showClientAddPetForm()" title="Add a new pet" style="background: #4169e1; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-left: 10px;">
                      <i class="fas fa-plus"></i> Add New Pet
                    </button>
                  </div>
                </div>

                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingDate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-calendar" style="color: #5DADE2; margin-right: 8px;"></i> Appointment Date *
                    </label>
                    <input type="date" id="clientBookingDate" name="appointment_date" required min="" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>

                  <div class="form-group">
                    <label for="clientBookingTime" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                      <i class="fas fa-clock" style="color: #5DADE2; margin-right: 8px;"></i> Appointment Time *
                    </label>
                    <select id="clientBookingTime" name="appointment_time" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select date first</option>
                    </select>
                  </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="clientBookingNotes" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">
                    <i class="fas fa-sticky-note" style="color: #5DADE2; margin-right: 8px;"></i> Notes (Optional)
                  </label>
                  <textarea id="clientBookingNotes" name="notes" rows="3" placeholder="Any special instructions or concerns..." style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; resize: vertical; min-height: 80px;" title="Enter any special instructions or concerns"></textarea>
                </div>

                <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
                  <button type="button" class="btn-secondary" onclick="closeClientBookingModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                    <i class="fas fa-times"></i> CANCEL
                  </button>
                  <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                    <i class="fas fa-calendar-plus"></i> BOOK APPOINTMENT
                  </button>
                </div>
              </form>

              <!-- Add Pet Form (Hidden) -->
              <div id="clientAddPetForm" style="display: none; border-top: 1px solid rgba(255,215,0,0.3); padding-top: 20px; margin-top: 20px;">
                <h3 style="color: #ffd700; margin: 0 0 20px 0;">
                  <i class="fas fa-paw"></i> Add New Pet
                </h3>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
                    <input type="text" id="clientBookingPetName" placeholder="Enter pet name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
                    <select id="clientBookingPetSpecies" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Species</option>
                      <option value="Dog">üê∂ Dog</option>
                      <option value="Cat">üê± Cat</option>
                      <option value="Bird">üê¶ Bird</option>
                      <option value="Rabbit">üê∞ Rabbit</option>
                      <option value="Other">üêæ Other</option>
                    </select>
                  </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
                    <input type="text" id="clientBookingPetBreed" placeholder="Enter breed (optional)" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
                    <input type="date" id="clientBookingPetBirthdate" max="" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group">
                    <label for="clientBookingPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
                    <select id="clientBookingPetGender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                      <option value="">Select Gender</option>
                      <option value="Male">‚ôÇÔ∏è Male</option>
                      <option value="Female">‚ôÄÔ∏è Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="clientBookingPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
                    <input type="number" id="clientBookingPetWeight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                  </div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                  <label for="clientBookingPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
                  <input type="text" id="clientBookingPetColor" placeholder="Enter color (optional)" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
                </div>
                <div style="margin-top: 15px; text-align: center;">
                  <button type="button" onclick="addClientPet()" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px;">
                    <i class="fas fa-plus"></i> Add Pet
                  </button>
                  <button type="button" onclick="hideClientAddPetForm()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">
                    <i class="fas fa-times"></i> Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Staff Add Pet Modal - Commented out since this is client page -->
  <!--
  <div id="staffAddPetModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; background: linear-gradient(145deg, #2E5BAA, #1E3F7A); border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
      <div class="modal-header" style="padding: 24px 24px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.1);">
        <h3 style="color: #B3B8FF; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-paw" style="color: #9BA9FF; font-size: 1.5rem;"></i>
          Add New Pet (Staff)
        </h3>
        <span class="close" onclick="closeStaffAddPetModal()" style="color: #ffffff; font-size: 28px; cursor: pointer; transition: color 0.2s ease;" onmouseover="this.style.color='#B3B8FF'" onmouseout="this.style.color='#ffffff'">&times;</span>
      </div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
        <form id="staffAddPetForm">
          <div class="form-group" style="margin-bottom: 20px;">
            <label for="staffPetOwner" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Owner *</label>
            <select id="staffPetOwner" name="owner_id" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
              <option value="">Select an owner</option>
            </select>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetName" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Pet Name *</label>
              <input type="text" id="staffPetName" name="pet_name" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter pet name">
            </div>
            <div class="form-group">
              <label for="staffPetSpecies" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Species *</label>
              <select id="staffPetSpecies" name="species" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                <option value="">Select Species</option>
                <option value="Dog">üê∂ Dog</option>
                <option value="Cat">üê± Cat</option>
                <option value="Bird">üê¶ Bird</option>
                <option value="Rabbit">üê∞ Rabbit</option>
                <option value="Other">üêæ Other</option>
              </select>
            </div>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetBreed" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Breed</label>
              <input type="text" id="staffPetBreed" name="breed" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter breed (optional)">
            </div>
            <div class="form-group">
              <label for="staffPetBirthdate" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Birthdate</label>
              <input type="date" id="staffPetBirthdate" name="birthdate" max="${new Date().toISOString().split('T')[0]}" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
            </div>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label for="staffPetGender" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Gender *</label>
              <select id="staffPetGender" name="gender" required style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px; cursor: pointer;">
                <option value="">Select Gender</option>
                <option value="Male">‚ôÇÔ∏è Male</option>
                <option value="Female">‚ôÄÔ∏è Female</option>
              </select>
            </div>
            <div class="form-group">
              <label for="staffPetWeight" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Weight (kg)</label>
              <input type="number" id="staffPetWeight" name="weight" step="0.1" min="0" placeholder="e.g., 5.5" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;">
            </div>
          </div>

          <div class="form-group" style="margin-bottom: 20px;">
            <label for="staffPetColor" style="color: #ffffff; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Color</label>
            <input type="text" id="staffPetColor" name="color" style="width: 100%; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 14px;" placeholder="Enter color (optional)">
          </div>

          <div class="form-actions" style="text-align: right; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 20px;">
            <button type="button" class="btn-secondary" onclick="closeStaffAddPetModal()" style="background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; margin-right: 12px; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">CANCEL</button>
            <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
              <i class="fas fa-plus" style="margin-right: 8px;"></i> ADD PET
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  -->

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="clientMobileOverlay" onclick="toggleClientMobileSidebar()"></div>


  <!-- Dashboard JavaScript -->
  <script src="../assets/js/dashboard.js"></script>
  <script src="../assets/js/modules/notifications.js"></script>
  <script src="../assets/js/client-dashboard.js"></script>
<script>
  // Mobile sidebar toggle functionality
  function toggleClientMobileSidebar() {
    console.log('üîß toggleClientMobileSidebar called!');

    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('clientMobileOverlay');
    const toggleBtn = document.getElementById('clientMobileMenuToggle');

    console.log('üì± Client Elements found:', {
      sidebar: !!sidebar,
      overlay: !!overlay,
      toggleBtn: !!toggleBtn,
      sidebarClass: sidebar ? sidebar.className : 'not found',
      overlayClass: overlay ? overlay.className : 'not found'
    });

    if (sidebar && overlay && toggleBtn) {
      const isOpen = sidebar.classList.contains('mobile-open');
      console.log('üîç Client Sidebar is open:', isOpen);

      if (isOpen) {
        console.log('üîí Closing client sidebar...');
        // Close sidebar
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
        toggleBtn.setAttribute('aria-expanded', 'false');
        console.log('‚úÖ Client sidebar closed');
      } else {
        console.log('üîì Opening client sidebar...');
        // Open sidebar
        sidebar.classList.add('mobile-open');
        overlay.classList.add('active');
        toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
        toggleBtn.setAttribute('aria-expanded', 'true');
        console.log('‚úÖ Client sidebar opened');
      }
    } else {
      console.error('‚ùå Missing client elements:', {
        sidebar: !sidebar,
        overlay: !overlay,
        toggleBtn: !toggleBtn
      });
    }
  }

  // Alternative event listener for better mobile support
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('clientMobileMenuToggle');
    if (toggleBtn) {
      // Add touch event support for mobile devices
      toggleBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        toggleClientMobileSidebar();
      }, { passive: false });

      // Add keyboard support
      toggleBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleClientMobileSidebar();
        }
      });

      // Set initial ARIA attributes
      toggleBtn.setAttribute('aria-expanded', 'false');
      toggleBtn.setAttribute('aria-controls', 'sidebar');
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
    }
  });

  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('clientMobileOverlay');
    const toggleBtn = document.getElementById('clientMobileMenuToggle');

    if (window.innerWidth <= 768) {
      if (sidebar && overlay && toggleBtn) {
        if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
          sidebar.classList.remove('mobile-open');
          overlay.classList.remove('active');
          toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
          toggleBtn.setAttribute('aria-expanded', 'false');
        }
      }
    }
  });

  // Handle logout functionality
  async function handleLogout() {
    if (confirm('Are you sure you want to logout?')) {
      try {
        // Call logout API endpoint
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'logout' })
        });

        const result = await response.json();

        if (result.success) {
          window.location.href = '../index.html';
        } else {
          alert('Logout failed. Redirecting anyway...');
          window.location.href = '../index.html';
        }
      } catch (error) {
        console.error('Logout error:', error);
        alert('Logout failed. Redirecting anyway...');
        window.location.href = '../index.html';
      }
    }
  }

    function showSection(sectionName) {
      // Hide all sections
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(section => {
        section.style.display = 'none';
        section.classList.add('hidden');
      });

      // Remove active class from all nav items
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.classList.remove('active');
      });

      // Show selected section
      const targetSection = document.getElementById(sectionName + 'Section');
      if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.remove('hidden');

        // Load section-specific data
        if (sectionName === 'store' && window.dashboardInstance) {
          window.dashboardInstance.loadStoreSection();
        } else if (sectionName === 'appointments' && window.dashboardInstance) {
          window.dashboardInstance.loadAppointmentsSection();
        } else if (sectionName === 'pets' && window.dashboardInstance) {
          window.dashboardInstance.loadPetsSection();
        } else if (sectionName === 'reports') {
          initializeReportsSection();
        } else if (sectionName === 'settings') {
          loadClientSettingsData();
        } else if (sectionName === 'logout') {
          handleLogout();
          return;
        }
      }

      // Add active class to clicked nav item
      const activeNavItem = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
      if (activeNavItem) {
        activeNavItem.classList.add('active');
      }

      // Update page title
      const titles = {
        'dashboard': '<i class="fas fa-paw"></i> Welcome to Your Dashboard',
        'appointments': '<i class="fas fa-calendar-alt"></i> My Appointments',
        'pets': '<i class="fas fa-paw"></i> My Pets',
        'reports': '<i class="fas fa-file-pdf"></i> Pet Reports',
        'store': '<i class="fas fa-store"></i> Pet Store',
        'settings': '<i class="fas fa-cog"></i> Settings'
      };

      const pageTitle = document.getElementById('pageTitle');
      if (pageTitle && titles[sectionName]) {
        pageTitle.innerHTML = titles[sectionName];
      }

      // Load products when store section is shown
      if (sectionName === 'store') {
        loadClientProducts();
      }

      // Load pets when pets section is shown
      if (sectionName === 'pets') {
        loadClientPets();
      }
    }

    // Load products for client store
    async function loadClientProducts() {
      const productsGrid = document.getElementById('clientProductsGrid');
      if (!productsGrid) return;

      try {
        productsGrid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading products...</div>';

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_products' })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();

        // Debug: Log the API response
        console.log('API Response:', result);

        if (result.success && result.data && Array.isArray(result.data)) {
          console.log('Products received:', result.data.length, 'products');
          if (result.data.length === 0) {
            productsGrid.innerHTML = '<div class="loading"><p>No products available at the moment. Please check back later!</p></div>';
          } else {
            displayClientProducts(result.data);
          }
        } else {
          const errorMessage = result.message || 'Failed to load products';
          console.error('API Error:', errorMessage);
          console.error('Full API response:', result);
          productsGrid.innerHTML = `<div class="loading"><p>Unable to load products: ${errorMessage}</p></div>`;
        }
      } catch (error) {
        console.error('Error loading products:', error);
        productsGrid.innerHTML = '<div class="loading"><p>Error loading products. Please try again later.</p></div>';
      }
    }

    function displayClientProducts(products) {
      const productsGrid = document.getElementById('clientProductsGrid');
      if (!productsGrid) return;

      if (products.length === 0) {
        productsGrid.innerHTML = '<div class="loading"><p>No products available at the moment.</p></div>';
        return;
      }

      productsGrid.innerHTML = products.map(product => createClientProductCard(product)).join('');
    }

    function createClientProductCard(product) {
      // Handle image loading with better error handling
      let imageHtml = '';
      let placeholderHtml = '<div class="product-image-placeholder"><i class="fas fa-image"></i></div>';

      if (product.image && product.image.trim() !== '' && product.image !== null && product.image !== 'null') {
        // Debug: Log the image path to console
        console.log('Product image path:', product.image, 'for product:', product.name);

        // Try multiple possible image paths
        const imagePaths = [
          product.image, // Original path
          product.image.replace(/\.(jpg|jpeg|png)$/i, '.jpg'), // Try as .jpg
          product.image.replace(/\.(jpg|jpeg|png)$/i, '.png'), // Try as .png
        ];

        // Remove duplicates and empty paths
        const uniquePaths = [...new Set(imagePaths)].filter(path => path && path.trim() !== '');

        if (uniquePaths.length > 0) {
          // Try multiple path variations to ensure we find the correct one
          const possiblePaths = [];

          uniquePaths.forEach(path => {
            // Try with full prefix
            if (path.startsWith('assets/images/products/')) {
              possiblePaths.push('../' + path);
            } else {
              possiblePaths.push('../assets/images/products/' + path);
            }

            // Also try without the ../ prefix
            if (path.startsWith('assets/images/products/')) {
              possiblePaths.push(path);
            } else {
              possiblePaths.push('assets/images/products/' + path);
            }
          });

          // Remove duplicates
          const finalPaths = [...new Set(possiblePaths)];
          const correctPath = finalPaths[0];

          console.log('üìÅ Client Dashboard: Final image path for', product.name, ':', correctPath);
          console.log('üîç Client Dashboard: All possible paths:', finalPaths);

          imageHtml = `<img src="${correctPath}" alt="${product.name}"
            onerror="tryNextImage(this, '${product.image}', '${finalPaths.join('|')}')"
            loading="lazy">`;
        }
      } else {
        console.log('No image path for product:', product.name);
      }

      const stockClass = product.stock === 0 ? 'stock-out' : product.stock < 10 ? 'stock-low' : 'stock-good';
      const stockText = product.stock === 0 ? 'Out of Stock' : product.stock < 10 ? 'Low Stock' : 'In Stock';

      // Add to Order button - disabled if out of stock
      const addToCartButton = product.stock === 0
        ? `<button class="action-btn add-to-cart" disabled title="Out of Stock">
            <i class="fas fa-shopping-cart"></i> Out of Stock
          </button>`
        : `<button class="action-btn add-to-cart" onclick="addToCart(${product.id}, '${product.name}', ${product.price})" title="Add to Order">
            <i class="fas fa-shopping-cart"></i> Add to Order
          </button>`;

      const inStockClass = product.stock > 0 ? 'in-stock' : '';

      return `
        <div class="product-card ${inStockClass}">
          <div class="product-image">
            ${imageHtml}
            ${imageHtml ? '' : placeholderHtml}
          </div>
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-category">${product.category}</div>
            <div class="product-description">${product.description || 'No description available'}</div>
            <div class="product-details">
              <div class="product-price">‚Ç±${parseFloat(product.price).toFixed(2)}</div>
              <div class="product-stock">
                <span class="stock-badge ${stockClass}">${stockText} (${product.stock})</span>
              </div>
            </div>
            <div class="product-actions">
              ${addToCartButton}
              <button class="action-btn buy-now" onclick="buyNow(${product.id}, '${product.name}', ${product.price})" title="Buy Now">
                <i class="fas fa-shopping-cart"></i> Buy Now
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Cart functionality
    let cart = JSON.parse(localStorage.getItem('clientCart') || '[]');

    // Function to try next image path when current one fails
    function tryNextImage(img, originalImage, pipeSeparatedPaths) {
      const imagePaths = pipeSeparatedPaths.split('|').filter(path => path && path.trim() !== '');

      // Debug: Log the attempt
      console.log('Trying next image for:', originalImage, 'Remaining paths:', imagePaths);

      // If no more paths to try, show placeholder
      if (imagePaths.length === 0) {
        console.log('No more paths to try, showing placeholder for:', originalImage);
        img.style.display = 'none';
        const placeholder = img.nextElementSibling;
        if (placeholder && placeholder.classList.contains('product-image-placeholder')) {
          placeholder.style.display = 'flex';
        }
        return;
      }

      // Try multiple path variations for the first path
      const currentPath = imagePaths[0];
      const possiblePaths = [];

      // Try with full prefix
      if (currentPath.startsWith('assets/images/products/')) {
        possiblePaths.push('../' + currentPath);
      } else {
        possiblePaths.push('../assets/images/products/' + currentPath);
      }

      // Also try without the ../ prefix
      if (currentPath.startsWith('assets/images/products/')) {
        possiblePaths.push(currentPath);
      } else {
        possiblePaths.push('assets/images/products/' + currentPath);
      }

      const nextPath = possiblePaths[0];
      console.log('Trying path:', nextPath, 'for image:', originalImage);
      console.log('All possible paths for this attempt:', possiblePaths);

      img.src = nextPath;
      img.onerror = function() {
        // Remove the failed path and try again with remaining paths
        const remainingPaths = imagePaths.slice(1);
        if (remainingPaths.length > 0) {
          tryNextImage(img, originalImage, remainingPaths.join('|'));
        } else {
          // No more paths, show placeholder
          console.log('All paths failed for:', originalImage, 'showing placeholder');
          img.style.display = 'none';
          const placeholder = img.nextElementSibling;
          if (placeholder && placeholder.classList.contains('product-image-placeholder')) {
            placeholder.style.display = 'flex';
          }
        }
      };
    }

    function addToCart(productId, productName, price) {
      // Check if product is already in cart
      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: productName,
          price: price,
          quantity: 1
        });
      }

      // Save to localStorage
      localStorage.setItem('clientCart', JSON.stringify(cart));

      // Update cart count
      updateCartCount();

      // Show success message
      showToast(`${productName} added to order!`, 'success');
    }

    function buyNow(productId, productName, price) {
      // Add item to cart with quantity 1
      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: productName,
          price: price,
          quantity: 1
        });
      }

      // Save to localStorage
      localStorage.setItem('clientCart', JSON.stringify(cart));

      // Update cart count
      updateCartCount();

      // Show success message and proceed to checkout
      showToast(`${productName} added to order! Proceeding to checkout...`, 'success');

      // Proceed to checkout after a short delay
      setTimeout(() => {
        checkout();
      }, 1000);
    }

    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const cartCountElements = document.querySelectorAll('#cartCount, .cart-count');

      cartCountElements.forEach(element => {
        element.textContent = totalItems;
      });

      // Update header cart icon
      const cartIcon = document.getElementById('cartIcon');
      if (cartIcon) {
        cartIcon.style.display = totalItems > 0 ? 'block' : 'none';
      }
    }

    function viewCart() {
      if (cart.length === 0) {
        showToast('Your cart is empty', 'info');
        return;
      }

      // Create cart modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3><i class="fas fa-shopping-cart"></i> Your Cart</h3>
            <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
          </div>
          <div class="modal-body">
            <div class="cart-items">
              ${cart.map(item => `
                <div class="cart-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #e1e5e9;">
                  <div>
                    <h4 style="margin: 0; font-size: 16px;">${item.name}</h4>
                    <p style="margin: 4px 0; color: #666;">‚Ç±${item.price.toFixed(2)} each</p>
                  </div>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <button onclick="updateCartItemQuantity(${item.id}, ${item.quantity - 1})" style="width: 24px; height: 24px; border: none; background: #f8f9fa; border-radius: 4px; cursor: pointer;">-</button>
                      <span style="min-width: 20px; text-align: center; font-weight: 500; color: #333; font-size: 16px;">${item.quantity}</span>
                      <button onclick="updateCartItemQuantity(${item.id}, ${item.quantity + 1})" style="width: 24px; height: 24px; border: none; background: #f8f9fa; border-radius: 4px; cursor: pointer;">+</button>
                    </div>
                    <button onclick="removeFromCart(${item.id})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
            <div class="cart-total" style="margin-top: 20px; padding-top: 16px; border-top: 2px solid #e1e5e9; text-align: right;">
              <h3 style="margin: 0; font-size: 18px;">
                Total: ‚Ç±${cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}
              </h3>
            </div>
            <div class="cart-actions" style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
              <button onclick="this.closest('.modal').remove()" class="btn-secondary">Continue Shopping</button>
              <button onclick="checkout()" class="btn-primary">
                <i class="fas fa-shopping-bag"></i> Buy Now
              </button>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      modal.style.display = 'block';
    }

    function updateCartItemQuantity(productId, newQuantity) {
      if (newQuantity <= 0) {
        removeFromCart(productId);
        return;
      }

      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity = newQuantity;
        localStorage.setItem('clientCart', JSON.stringify(cart));
        updateCartCount();
        viewCart(); // Refresh the cart modal
      }
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      localStorage.setItem('clientCart', JSON.stringify(cart));
      updateCartCount();
      viewCart(); // Refresh the cart modal
    }

    function checkout() {
      if (cart.length === 0) {
        showToast('Your cart is empty', 'error');
        return;
      }

      // Calculate total for the order
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      // Create order data for payment processing
      const orderData = {
        items: cart,
        total: total
      };

      // Show payment modal using the dashboard instance
      if (window.dashboardInstance) {
        window.dashboardInstance.showPaymentModalForCart(orderData);
        // Close the cart modal
        const cartModal = document.querySelector('.modal');
        if (cartModal) {
          cartModal.remove();
        }
      } else {
        // Fallback if dashboard instance is not available
        showToast('Payment system is loading. Please try again in a moment.', 'info');
        // Close the cart modal anyway
        const cartModal = document.querySelector('.modal');
        if (cartModal) {
          cartModal.remove();
        }
      }
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type} show`;
      toast.innerHTML = `
        <div class="toast-icon">
          ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
        </div>
        <div class="toast-message">${message}</div>
      `;

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Client Add Pet Modal Functions
    function showAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadClientPetOwners();
      }
    }

    function closeClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // Clear form
        document.getElementById('clientAddPetForm').reset();
      }
    }

    async function loadClientPetOwners() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.user) {
          // Auto-populate with current user (no owner selection needed for client)
          console.log('Client pet form - owner auto-populated');
        }
      } catch (error) {
        console.error('Error loading client pet owners:', error);
      }
    }

    // Handle client add pet form submission
    document.getElementById('clientAddPetForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      // Prevent multiple submissions
      const submitBtn = e.target.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding Pet...';
      }

      const formData = new FormData(e.target);
      const petData = {
        action: 'add_pet',
        owner_id: formData.get('owner_id'),
        pet_name: formData.get('pet_name'),
        species: formData.get('species'),
        breed: formData.get('breed'),
        birthdate: formData.get('birthdate'),
        gender: formData.get('gender'),
        weight: formData.get('weight') ? parseFloat(formData.get('weight')) : null,
        color: formData.get('color')
      };

      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(petData)
        });

        const result = await response.json();

        if (result.success) {
          showToast('Pet added successfully!', 'success');
          closeClientAddPetModal();
          // Reload pets to show the new pet
          setTimeout(() => {
            loadClientPets();
          }, 500); // Small delay to ensure database is updated
        } else {
          showToast(result.message || 'Failed to add pet', 'error');
        }
      } catch (error) {
        console.error('Error adding pet:', error);
        showToast('Failed to add pet. Please try again.', 'error');
      } finally {
        // Re-enable submit button
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-plus"></i> ADD PET';
        }
      }
    });

    // Client Add Pet Modal Functions (consolidated)
    function showClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        loadClientPetOwnerInfo();
      }
    }

    function closeClientAddPetModal() {
      const modal = document.getElementById('clientAddPetModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // Clear form
        const form = document.getElementById('clientAddPetForm');
        if (form) form.reset();
      }
    }

    async function loadClientPetOwnerInfo() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();
        if (result.success && result.data && result.data.user) {
          // Auto-populate owner info if needed
          console.log('Client owner info loaded for pet modal');
        }
      } catch (error) {
        console.error('Error loading client owner info:', error);
      }
    }

    // Check for appointments redirect and highlight Book New button
    function checkForAppointmentsRedirect() {
      // Check if URL contains appointments hash
      if (window.location.hash === '#appointments') {
        console.log('üîÑ Appointments redirect detected, navigating to appointments section...');

        // Navigate to appointments section
        showSection('appointments');

        // Highlight the Book New button for 3 seconds
        setTimeout(() => {
          const bookNewBtn = document.querySelector('.header-btn');
          if (bookNewBtn) {
            console.log('üéØ Highlighting Book New button...');

            // Add highlight animation
            bookNewBtn.style.animation = 'highlightPulse 3s ease-in-out';
            bookNewBtn.style.boxShadow = '0 0 20px rgba(40, 167, 69, 0.8)';

            // Remove highlight after 3 seconds
            setTimeout(() => {
              bookNewBtn.style.animation = '';
              bookNewBtn.style.boxShadow = '';
              console.log('‚úÖ Book New button highlight removed');
            }, 3000);

            console.log('‚úÖ Book New button highlighted for 3 seconds');
          } else {
            console.warn('‚ö†Ô∏è Book New button not found for highlighting');
          }
        }, 500); // Small delay to ensure section is loaded
      }
    }

    // Initialize cart count and load orders on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateCartCount();

      // Check if we should navigate to appointments section and highlight Book New button
      checkForAppointmentsRedirect();

      // Load dashboard data if we're on the dashboard section
      if (document.getElementById('dashboardSection') && document.getElementById('dashboardSection').style.display === 'block') {
        loadClientDashboardData();
      }

      // Initialize notification badge
      updateNotificationBadge();

    });

    // Load client dashboard data
    async function loadClientDashboardData() {
      try {
        console.log('Loading client dashboard data...');

        // Load pets data
        const petsResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });
        const petsResult = await petsResponse.json();

        if (petsResult.success && petsResult.data) {
          const petsCount = petsResult.data.length;
          const petsCountElement = document.getElementById('clientPetsCount');
          if (petsCountElement) {
            petsCountElement.textContent = petsCount;
          }
          console.log('Pets count loaded:', petsCount);
        }

        // Load appointments data
        const appointmentsResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_appointments' })
        });
        const appointmentsResult = await appointmentsResponse.json();

        if (appointmentsResult.success && appointmentsResult.data) {
          const appointments = appointmentsResult.data;
          const today = new Date().toISOString().split('T')[0];

          // Count upcoming appointments (future dates)
          const upcomingCount = appointments.filter(apt =>
            apt.appointment_date >= today && apt.status !== 'cancelled'
          ).length;

          // Count completed appointments
          const completedCount = appointments.filter(apt =>
            apt.status === 'completed'
          ).length;

          // Update upcoming appointments count
          const upcomingElement = document.getElementById('upcomingAppointmentsCount');
          if (upcomingElement) {
            upcomingElement.textContent = upcomingCount;
          }

          // Update completed visits count
          const completedElement = document.getElementById('completedVisitsCount');
          if (completedElement) {
            completedElement.textContent = completedCount;
          }

          console.log('Appointments loaded - Upcoming:', upcomingCount, 'Completed:', completedCount);
        }

        // Cart items count is already handled by updateCartCount()

      } catch (error) {
        console.error('Error loading client dashboard data:', error);
      }
    }


    // Profile Form Submission Functionality for Client Dashboard
    function setupProfileForm() {
      const profileForm = document.getElementById('profileForm');

      if (profileForm) {
        profileForm.addEventListener('submit', async function(e) {
          e.preventDefault();

          // Get form data
          const formData = new FormData(profileForm);

          // Validate form data
          if (!validateProfileForm(formData)) {
            return;
          }

          try {
            const response = await fetch('../api/vet_api.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                action: 'update_profile',
                first_name: formData.get('first_name'),
                last_name: formData.get('last_name'),
                email: formData.get('email'),
                phone: formData.get('phone')
              })
            });

            const result = await response.json();

            if (result.success) {
              showToast('Profile updated successfully!', 'success');

              // Update sidebar with new data
              if (result.user) {
                const clientName = document.getElementById('clientName');
                if (clientName) {
                  clientName.textContent = result.user.name;
                }
              }

              // Refresh user data
              await loadClientSettingsData();
            } else {
              showToast(result.message || 'Failed to update profile', 'error');
            }
          } catch (error) {
            console.error('Profile update error:', error);
            showToast('Failed to update profile. Please try again.', 'error');
          }
        });
      }
    }

    // Load client settings data
    async function loadClientSettingsData() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.user) {
          const user = result.data.user;

          // Populate settings forms with current data
          const firstNameInput = document.getElementById('firstName');
          const lastNameInput = document.getElementById('lastName');
          const emailInput = document.getElementById('email');
          const phoneInput = document.getElementById('phone');

          if (firstNameInput) firstNameInput.value = user.first_name || '';
          if (lastNameInput) lastNameInput.value = user.last_name || '';
          if (emailInput) emailInput.value = user.email || '';
          if (phoneInput) phoneInput.value = user.phone || '';

          // Update profile picture in settings section
          if (user.profile_picture) {
            const currentProfilePicture = document.getElementById('currentProfilePicture');
            if (currentProfilePicture) {
              const newSrc = '../' + user.profile_picture + '?t=' + Date.now();
              currentProfilePicture.src = newSrc;

              // Add error handling
              currentProfilePicture.onerror = function() {
                this.src = '../assets/images/logoo.jpg';
              };
            }
          }

          // Update email verification status
          updateEmailVerificationStatus(user);
        }
      } catch (error) {
        console.error('Failed to load client settings data:', error);
      }
    }

    // Update email verification status display
    function updateEmailVerificationStatus(user) {
      const statusDiv = document.getElementById('emailVerificationStatus');
      const verifyBtn = document.getElementById('verifyEmailBtn');
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (!statusDiv) return;

      // Check if user has verification token (not verified)
      if (user.email_verification_token && !user.email_verified_at) {
        // User has token but not verified
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-clock" style="color: #ffc107;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email verification pending</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            A verification email has been sent to <strong>${user.email}</strong>.
            Please check your inbox and click the verification link.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'none';
        if (resendBtn) resendBtn.style.display = 'flex';
      } else if (user.email_verified_at) {
        // User is verified
        const verifiedDate = new Date(user.email_verified_at).toLocaleDateString();
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-check-circle" style="color: #28a745;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email verified</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            Your email address has been verified on <strong>${verifiedDate}</strong>.
            You now have enhanced account security and password reset capabilities.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'none';
        if (resendBtn) resendBtn.style.display = 'none';
      } else {
        // User not verified and no token
        statusDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
            <span style="color: #ffffff; font-weight: 500;">Email not verified</span>
          </div>
          <p style="color: rgba(255, 255, 255, 0.8); font-size: 13px; margin: 0;">
            Verify your email address for enhanced security and password reset functionality.
            This is optional but recommended.
          </p>
        `;

        if (verifyBtn) verifyBtn.style.display = 'flex';
        if (resendBtn) resendBtn.style.display = 'none';
      }
    }

    // Verify user email function
    async function verifyUserEmail() {
      const verifyBtn = document.getElementById('verifyEmailBtn');
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (verifyBtn) {
        verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        verifyBtn.disabled = true;
      }

      try {
        // Get current user info
        const userResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const userResult = await userResponse.json();

        if (userResult.success && userResult.data && userResult.data.user) {
          const user = userResult.data.user;

          // Send verification email using SMTPJS
          if (typeof emailService !== 'undefined') {
            const emailResult = await emailService.sendVerificationEmail(user.email, user.first_name, 'new_verification');

            if (emailResult.success) {
              showToast('Verification email sent successfully! Please check your inbox.', 'success');

              // Update status display
              updateEmailVerificationStatus(user);

              // Update button states
              if (verifyBtn) verifyBtn.style.display = 'none';
              if (resendBtn) resendBtn.style.display = 'flex';
            } else {
              showToast('Email configuration may need setup. Please contact support if you continue having issues.', 'warning');
            }
          } else {
            showToast('Email service not available. Please contact support for assistance.', 'error');
          }
        } else {
          showToast('Unable to get user information. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error sending verification email:', error);
        showToast('Error sending verification email. Please try again.', 'error');
      } finally {
        // Restore button state
        if (verifyBtn) {
          verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> Verify Email Address';
          verifyBtn.disabled = false;
        }
      }
    }

    // Resend verification email function
    async function resendVerificationEmail() {
      const resendBtn = document.getElementById('resendVerificationBtn');

      if (resendBtn) {
        resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        resendBtn.disabled = true;
      }

      try {
        // Get current user info
        const userResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_user_info' })
        });

        const userResult = await userResponse.json();

        if (userResult.success && userResult.data && userResult.data.user) {
          const user = userResult.data.user;

          // Send verification email using SMTPJS
          if (typeof emailService !== 'undefined') {
            const emailResult = await emailService.sendVerificationEmail(user.email, user.first_name, 'resend_verification');

            if (emailResult.success) {
              showToast('Verification email sent successfully! Please check your inbox.', 'success');
            } else {
              showToast('Email configuration may need setup. Please contact support if you continue having issues.', 'warning');
            }
          } else {
            showToast('Email service not available. Please contact support for assistance.', 'error');
          }
        } else {
          showToast('Unable to get user information. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error resending verification email:', error);
        showToast('Error resending verification email. Please try again.', 'error');
      } finally {
        // Restore button state
        if (resendBtn) {
          resendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Resend Verification';
          resendBtn.disabled = false;
        }
      }
    }

    // Profile form validation
    function validateProfileForm(formData) {
      const firstName = formData.get('first_name');
      const lastName = formData.get('last_name');
      const email = formData.get('email');
      const phone = formData.get('phone');

      // Validate first name
      if (!firstName || firstName.trim().length < 2) {
        showToast('First name must be at least 2 characters', 'error');
        return false;
      }

      // Validate last name
      if (!lastName || lastName.trim().length < 2) {
        showToast('Last name must be at least 2 characters', 'error');
        return false;
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        showToast('Please enter a valid email address', 'error');
        return false;
      }

      // Validate phone (optional)
      if (phone && phone.trim() !== '') {
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        if (!phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''))) {
          showToast('Please enter a valid phone number', 'error');
          return false;
        }
      }

      return true;
    }

    // Profile Picture Upload Functionality for Client Dashboard
    function setupProfilePictureForm() {
      const pictureForm = document.getElementById('pictureForm');
      const fileInput = document.getElementById('profilePictureInput');
      const imagePreview = document.getElementById('imagePreview');
      const currentPicture = document.getElementById('currentProfilePicture');

      if (fileInput && imagePreview) {
        // Handle file selection
        fileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
              showToast('Please select a valid image file', 'error');
              return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
              showToast('Image size must be less than 5MB', 'error');
              return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
              imagePreview.src = e.target.result;
              imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
          }
        });
      }

      if (pictureForm) {
        pictureForm.addEventListener('submit', async function(e) {
          e.preventDefault();

          const fileInput = document.getElementById('profilePictureInput');
          if (!fileInput.files[0]) {
            showToast('Please select an image file', 'error');
            return;
          }

          const file = fileInput.files[0];

          // Validate file type
          if (!file.type.startsWith('image/')) {
            showToast('Please select a valid image file', 'error');
            return;
          }

          // Validate file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            showToast('Image size must be less than 5MB', 'error');
            return;
          }

          try {
            // Convert file to base64
            const reader = new FileReader();
            reader.onload = async function(e) {
              const base64Data = e.target.result;

              const response = await fetch('../api/vet_api.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  action: 'upload_profile_picture',
                  image_data: base64Data,
                  image_name: file.name
                })
              });

              const result = await response.json();

              if (result.success) {
                showToast('Profile picture updated successfully!', 'success');

                // Update current picture display in settings
                if (currentPicture && result.image_path) {
                  const fullImagePath = '../' + result.image_path;
                  console.log('Updating settings profile picture to:', fullImagePath);
                  currentPicture.src = fullImagePath + '?t=' + Date.now();

                  // Also update the settings section currentProfilePicture
                  const settingsProfilePicture = document.getElementById('currentProfilePicture');
                  if (settingsProfilePicture) {
                    settingsProfilePicture.src = fullImagePath + '?t=' + Date.now();
                    settingsProfilePicture.onerror = function() {
                      this.src = '../assets/images/logoo.jpg';
                    };
                  }
                }

                // Update sidebar avatar with delay to ensure file is fully written
                const clientAvatar = document.getElementById('clientAvatar');
                if (clientAvatar && result.image_path) {
                  setTimeout(() => {
                    const timestamp = Date.now() + Math.random(); // More unique cache buster
                    const fullImagePath = '../' + result.image_path;
                    console.log('Updating sidebar avatar to:', fullImagePath);
                    clientAvatar.src = fullImagePath + '?t=' + timestamp;

                    // Handle sidebar avatar load error with retry and format fallback
                    let retryCount = 0;
                    const basePath = '../' + result.image_path.replace(/\.(jpg|jpeg|png|gif|webp)$/i, '');

                    clientAvatar.onerror = function() {
                      retryCount++;
                      if (retryCount < 3) {
                        console.warn(`Retry ${retryCount} for sidebar avatar:`, fullImagePath);
                        // Try again with a new timestamp
                        const retrySrc = '../' + result.image_path + '?t=' + Date.now() + Math.random();
                        this.src = retrySrc;
                      } else if (retryCount === 3) {
                        console.warn('Trying alternative format (PNG) for sidebar avatar:', basePath + '.png');
                        // Try PNG format
                        this.src = basePath + '.png?t=' + Date.now() + Math.random();
                        retryCount++; // Increment to 4
                      } else if (retryCount === 4) {
                        console.warn('Trying alternative format (WebP) for sidebar avatar:', basePath + '.webp');
                        // Try WebP format
                        this.src = basePath + '.webp?t=' + Date.now() + Math.random();
                        retryCount++; // Increment to 5
                      } else {
                        console.warn('Failed to load sidebar avatar after all retries and formats, using fallback:', fullImagePath);
                        this.src = '../assets/images/logoo.jpg';
                      }
                    };

                    // Add load handler with validation
                    clientAvatar.onload = function() {
                      // Verify the image actually loaded by checking its dimensions
                      if (this.naturalWidth === 0 || this.naturalHeight === 0) {
                        console.warn('Sidebar avatar loaded but has invalid dimensions, retrying:', fullImagePath);
                        // Trigger error handler to retry
                        this.onerror();
                      } else {
                        console.log('Sidebar avatar loaded successfully:', fullImagePath, this.naturalWidth + 'x' + this.naturalHeight);
                      }
                    };
                  }, 500); // 500ms delay to ensure file is fully written
                }

                // Reset form
                imagePreview.style.display = 'none';
                fileInput.value = '';
              } else {
                showToast(result.message || 'Failed to upload profile picture', 'error');
              }
            };

            reader.onerror = function() {
              showToast('Error reading file', 'error');
            };

            reader.readAsDataURL(file);
          } catch (error) {
            console.error('Error uploading profile picture:', error);
            showToast('Error uploading profile picture', 'error');
          }
        });
      }
    }

    // Initialize profile and picture functionality
    document.addEventListener('DOMContentLoaded', function() {
      setupProfileForm();
      setupProfilePictureForm();
      // Load settings data when settings section is shown
      if (document.getElementById('settingsSection') && !document.getElementById('settingsSection').classList.contains('hidden')) {
        loadClientSettingsData();
      }
    });










    // Global variables for pet reports
    let currentReportData = null;
    let selectedPetId = null;

    // Load pets for the dropdown when reports section is shown
    async function loadPetsDropdown() {
      console.log('üîÑ loadPetsDropdown called');

      try {
        console.log('üì° Fetching pets from API...');
        const response = await fetch('../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log('üì° Response status:', response.status);

        const result = await response.json();
        console.log('üìä API result:', result);

        if (result.success) {
          console.log('‚úÖ API success, found', result.data.length, 'pets');
          const petSelect = document.getElementById('petSelect');

          if (!petSelect) {
            console.error('‚ùå Pet select element not found!');
            showToast('Pet select element not found!', 'error');
            return;
          }

          console.log('‚úÖ Pet select element found, clearing...');
          petSelect.innerHTML = '<option value="">Select a pet...</option>';
          console.log('üìù Cleared select, now adding', result.data.length, 'options');

          result.data.forEach((pet, index) => {
            console.log(`‚ûï Adding pet ${index + 1}:`, pet.name, 'ID:', pet.id);
            const option = document.createElement('option');
            option.value = pet.id;
            option.textContent = `${pet.name} (${pet.species}) - Owner: ${pet.first_name} ${pet.last_name}`;
            console.log('üìù Created option:', option.value, option.textContent);

            const appendResult = petSelect.appendChild(option);
            console.log('‚úÖ Appended option:', appendResult);
          });

          console.log('‚úÖ Final select options count:', petSelect.options.length);
          console.log('‚úÖ Pet dropdown populated successfully');

          // Show success message
          showToast(`Loaded ${result.data.length} pets successfully!`, 'success');
        } else {
          console.error('‚ùå API failed:', result.message);
          showToast('Failed to load pets: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('‚ùå Error loading pets:', error);
        showToast('Error loading pets: ' + error.message, 'error');
      }
    }

    // Generate pet report
    async function generatePetReport() {
      const petSelect = document.getElementById('petSelect');
      if (!petSelect) {
        console.error('Pet select element not found');
        if (typeof toast === 'function') {
          toast('Report form not loaded properly. Please refresh the page.', 'error');
        } else {
          alert('Report form not loaded properly. Please refresh the page.');
        }
        return;
      }

      const selectedPetId = petSelect.value;

      if (!selectedPetId) {
        if (typeof toast === 'function') {
          toast('Please select a pet first', 'warning');
        } else if (window.clientDashboard) {
          window.clientDashboard.showToast('Please select a pet first', 'warning');
        } else {
          alert('Please select a pet first');
        }
        return;
      }

      try {
        const response = await fetch(`../api/pet_reports_api.php?action=get_pet_report&pet_id=${selectedPetId}`);
        const result = await response.json();

        if (result.success) {
          currentReportData = result.data;
          console.log('üìã Report data received:', result.data);
          console.log('üè• Medical history records:', result.data.medical_history ? result.data.medical_history.length : 0);
          displaySimpleReportPreview(result.data);
          if (typeof toast === 'function') {
            toast('Report generated successfully!', 'success');
          } else if (window.clientDashboard) {
            window.clientDashboard.showToast('Report generated successfully!', 'success');
          } else {
            alert('Report generated successfully!');
          }
        } else {
          if (typeof toast === 'function') {
            toast('Error generating report: ' + result.message, 'error');
          } else if (window.clientDashboard) {
            window.clientDashboard.showToast('Error generating report: ' + result.message, 'error');
          } else {
            alert('Error generating report: ' + result.message);
          }
        }
      } catch (error) {
        console.error('Error generating report:', error);
        if (typeof toast === 'function') {
          toast('Error generating report. Please try again.', 'error');
        } else if (window.clientDashboard) {
          window.clientDashboard.showToast('Error generating report. Please try again.', 'error');
        } else {
          alert('Error generating report. Please try again.');
        }
      }
    }

    // Display simple report preview
    function displaySimpleReportPreview(data) {
      const reportPreview = document.getElementById('reportPreview');

      if (!reportPreview) return;

      const pet = data.pet;
      const owner = data.owner;

      console.log('‚úÖ Report displayed for pet:', pet.name);

      reportPreview.innerHTML = `
        <div style="text-align: left; max-width: 500px; margin: 0 auto;">
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-paw" style="color: #667eea;"></i>
              Pet Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${pet.name}</div>
              <div><strong>Species:</strong> ${pet.species}</div>
              <div><strong>Breed:</strong> ${pet.breed || 'Not specified'}</div>
              <div><strong>Gender:</strong> ${pet.gender || 'Not specified'}</div>
              ${pet.weight ? `<div><strong>Weight:</strong> ${pet.weight} kg</div>` : ''}
              ${pet.color ? `<div><strong>Color:</strong> ${pet.color}</div>` : ''}
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-user" style="color: #667eea;"></i>
              Owner Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${owner.name}</div>
              <div><strong>Email:</strong> ${owner.email}</div>
              ${owner.phone ? `<div><strong>Phone:</strong> ${owner.phone}</div>` : ''}
              ${owner.address ? `<div><strong>Address:</strong> ${owner.address}</div>` : ''}
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-chart-bar" style="color: #667eea;"></i>
              Statistics
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Total Appointments:</strong> ${data.statistics.total_appointments}</div>
              <div><strong>Total Vaccinations:</strong> ${data.statistics.total_vaccinations}</div>
              <div><strong>Last Visit:</strong> ${data.statistics.last_visit ? new Date(data.statistics.last_visit).toLocaleDateString() : 'Never'}</div>
              <div><strong>Report Generated:</strong> ${new Date().toLocaleDateString()}</div>
            </div>
          </div>

          ${data.medical_history && data.medical_history.length > 0 ? `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-stethoscope" style="color: #667eea;"></i>
              Medical History
            </h3>
            <div style="margin-bottom: 20px; text-align: center;">
              <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600;">
                <i class="fas fa-file-medical"></i> Total Records: ${data.medical_history.length}
              </span>
            </div>

            <div class="medical-details">
              ${data.medical_history.slice(0, 3).map((record, index) => `
                <div style="margin: 15px 0; padding: 15px; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);">
                  <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e1e5e9;">
                    <h5 style="margin: 0 0 8px 0; color: #667eea; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                      <i class="fas fa-file-medical"></i> Medical Record #${index + 1}
                    </h5>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; font-size: 12px; color: #666;">
                      <div><i class="fas fa-calendar"></i> ${new Date(record.created_at).toLocaleDateString()}</div>
                      <div><i class="fas fa-user-md"></i> ${record.staff_name || 'Not recorded'}</div>
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #667eea;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-stethoscope"></i> Diagnosis
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.diagnosis ? record.diagnosis.replace(/\n/g, '<br>') : 'Not specified'}</div>
                    </div>

                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #28a745;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-thermometer-three-quarters"></i> Treatment
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.treatment ? record.treatment.replace(/\n/g, '<br>') : 'Not specified'}</div>
                    </div>

                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #ffc107;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-pills"></i> Medications
                      </div>
                      <div style="color: #555; line-height: 1.4;">${record.medications ? record.medications.replace(/\n/g, '<br>') : 'None prescribed'}</div>
                    </div>

                    ${record.follow_up_date ? `
                    <div style="background: #ffffff; padding: 10px; border-radius: 8px; border-left: 4px solid #dc3545;">
                      <div style="font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-calendar-check"></i> Follow-up Date
                      </div>
                      <div style="color: #555; line-height: 1.4;">${new Date(record.follow_up_date).toLocaleDateString()}</div>
                    </div>
                    ` : ''}

                    ${record.notes ? `
                    <div style="background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 4px solid #ffc107;">
                      <div style="font-weight: bold; color: #856404; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-sticky-note"></i> Clinical Notes
                      </div>
                      <div style="color: #856404; line-height: 1.4;">${record.notes.replace(/\n/g, '<br>')}</div>
                    </div>
                    ` : ''}

                    ${record.instructions ? `
                    <div style="background: #d1ecf1; padding: 10px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                      <div style="font-weight: bold; color: #0c5460; margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-clipboard-list"></i> Instructions
                      </div>
                      <div style="color: #0c5460; line-height: 1.4;">${record.instructions.replace(/\n/g, '<br>')}</div>
                    </div>
                    ` : ''}
                  </div>
                </div>
              `).join('')}

              ${data.medical_history.length > 3 ? `
              <div style="text-align: center; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #667eea;">
                <i class="fas fa-ellipsis-h" style="color: #667eea; font-size: 18px; margin-bottom: 8px;"></i>
                <p style="margin: 0; color: #667eea; font-weight: 600; font-size: 12px;">... and ${data.medical_history.length - 3} more medical records available in full report</p>
              </div>
              ` : ''}
            </div>
          </div>
          ` : ''}

        </div>
      `;
    }

    // Download simple PDF report
    async function downloadSimplePDFReport() {
      if (!currentReportData) {
        showToast('No report data available. Please generate a report first.', 'error');
        return;
      }

      console.log('üîÑ Starting PDF generation...');
      console.log('üìã Current report data:', currentReportData);
      console.log('üè• Medical history in report:', currentReportData.medical_history);

      try {
        // Show loading state
        const downloadBtn = document.getElementById('pdfDownloadBtn');
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
          downloadBtn.disabled = true;
        }

        // Load jsPDF library dynamically if not already loaded
        if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
          await loadJSPDFLibrary();
        }

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();

        const pet = currentReportData.pet;
        const owner = currentReportData.owner;

        // Header
        pdf.setFontSize(20);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Tattoo Veterinary Clinic', 105, 20, { align: 'center' });

        pdf.setFontSize(16);
        pdf.text('Pet Medical Report', 105, 30, { align: 'center' });

        // Clinic info
        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        pdf.text('Clinic Address: Your Clinic Address', 105, 40, { align: 'center' });
        pdf.text('Phone: 0917-519-4639 | Email: info@tattoovet.com', 105, 45, { align: 'center' });
        pdf.text(`Generated: ${new Date().toLocaleString()}`, 105, 50, { align: 'center' });

        let yPosition = 65;

        // Pet Information
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Pet Information', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const petInfo = [
          ['Name:', pet.name],
          ['Species:', pet.species],
          ['Breed:', pet.breed || 'Not specified'],
          ['Birthdate:', pet.birthdate ? new Date(pet.birthdate).toLocaleDateString() : 'Not specified'],
          ['Gender:', pet.gender || 'Not specified'],
          ['Weight:', pet.weight ? `${pet.weight} kg` : 'Weight not recorded'],
          ['Color:', pet.color || 'Not specified']
        ];

        if (pet.notes) {
          petInfo.push(['Notes:', pet.notes]);
        }

        petInfo.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Owner Information
        yPosition += 5;
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Owner Information', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const ownerInfo = [
          ['Name:', owner.name],
          ['Email:', owner.email],
          ['Phone:', owner.phone || 'Not provided'],
          ['Address:', owner.address || 'Not provided']
        ];

        ownerInfo.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Statistics
        yPosition += 5;
        pdf.setFontSize(14);
        pdf.setTextColor(40, 40, 40);
        pdf.text('Statistics', 20, yPosition);
        yPosition += 10;

        pdf.setFontSize(10);
        pdf.setTextColor(60, 60, 60);

        const stats = [
          ['Total Appointments:', currentReportData.statistics.total_appointments.toString()],
          ['Total Vaccinations:', currentReportData.statistics.total_vaccinations.toString()],
          ['Last Visit:', currentReportData.statistics.last_visit ? new Date(currentReportData.statistics.last_visit).toLocaleDateString() : 'Never']
        ];

        stats.forEach(([label, value]) => {
          pdf.text(`${label} ${value}`, 20, yPosition);
          yPosition += 6;
        });

        // Footer
        pdf.setFontSize(8);
        pdf.text(`Report generated: ${new Date().toLocaleString()}`, 20, 280);
        pdf.text('This report contains confidential medical information.', 20, 285);

        // Add Medical History to PDF
        let medicalYPosition = 280;
        console.log('üìã Adding medical history to PDF...');
        console.log('üè• Records to add:', currentReportData.medical_history ? currentReportData.medical_history.length : 0);

        if (currentReportData.medical_history && currentReportData.medical_history.length > 0) {
          console.log('‚úÖ Medical history found, adding to PDF');
          pdf.setFontSize(14);
          pdf.setTextColor(40, 40, 40);
          pdf.text('Medical History', 20, medicalYPosition);
          medicalYPosition += 15;

          currentReportData.medical_history.forEach((record, index) => {
            // Check if we need a new page
            if (medicalYPosition > 250) {
              pdf.addPage();
              medicalYPosition = 30;
            }

            pdf.setFontSize(10);
            pdf.setTextColor(60, 60, 60);

            // Record header
            pdf.setFontSize(12);
            pdf.setTextColor(40, 40, 40);
            const recordTitle = `Visit #${index + 1} - ${new Date(record.created_at).toLocaleDateString()}`;
            pdf.text(recordTitle, 20, medicalYPosition);
            medicalYPosition += 10;

            // Record details
            pdf.setFontSize(9);
            pdf.setTextColor(80, 80, 80);

            if (record.diagnosis) {
              pdf.text(`Diagnosis: ${record.diagnosis}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.treatment) {
              pdf.text(`Treatment: ${record.treatment}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.medications) {
              pdf.text(`Medications: ${record.medications}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            if (record.staff_name) {
              pdf.text(`Veterinarian: ${record.staff_name}`, 25, medicalYPosition);
              medicalYPosition += 8;
            }

            medicalYPosition += 5; // Space between records
          });
        }

        // Footer
        pdf.setFontSize(8);
        pdf.setTextColor(100, 100, 100);
        pdf.text(`Total Medical Records: ${currentReportData.medical_history ? currentReportData.medical_history.length : 0}`, 20, 280);
        pdf.text(`Report generated: ${new Date().toLocaleString()}`, 20, 285);

        // Download
        const filename = `pet_report_${pet.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(filename);

        // Restore button state
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download PDF';
          downloadBtn.disabled = false;
        }

        console.log('‚úÖ PDF generation completed successfully');
        console.log('üìÑ PDF saved as:', filename);
        showToast(`PDF downloaded successfully! Saved as: ${filename}`, 'success');
      } catch (error) {
        console.error('‚ùå Error generating PDF:', error);

        // Restore button state
        const downloadBtn = document.getElementById('pdfDownloadBtn');
        if (downloadBtn) {
          downloadBtn.innerHTML = '<i class="fas fa-download"></i> <span>Download PDF Report</span>';
          downloadBtn.disabled = false;
        }

        showToast('Error generating PDF. Please try again.', 'error');

        // Offer fallback option
        if (confirm('Would you like to try downloading an HTML version instead?')) {
          downloadHTMLReport();
        }
      }
    }

    async function loadJSPDFLibrary() {
      return new Promise((resolve, reject) => {
        // Check if already loaded
        if (typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined') {
          resolve();
          return;
        }

        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = () => {
          // Wait a bit for the library to initialize
          setTimeout(() => {
            if (typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined') {
              resolve();
            } else {
              reject(new Error('jsPDF library failed to load properly'));
            }
          }, 100);
        };
        script.onerror = () => reject(new Error('Failed to load jsPDF library'));
        document.head.appendChild(script);
      });
    }


    // Fallback HTML report download
    function downloadHTMLReport() {
      if (!currentReportData) {
        showToast('No report data available', 'error');
        return;
      }

      const pet = currentReportData.pet;
      const owner = currentReportData.owner;

      // Create HTML content for the report
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Pet Medical Report - ${pet.name}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
            .header { text-align: center; border-bottom: 3px solid #28a745; padding-bottom: 20px; margin-bottom: 30px; }
            .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
            .section h3 { color: #28a745; margin-top: 0; border-bottom: 2px solid #28a745; padding-bottom: 10px; }
            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
            .info-item { margin-bottom: 10px; }
            .info-label { font-weight: bold; color: #333; }
            .footer { margin-top: 50px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 20px; }
            @media print { body { margin: 20px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Tattoo Veterinary Clinic</h1>
            <h2>Pet Medical Report</h2>
            <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
          </div>

          <div class="section">
            <h3>Pet Information</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Name:</span> ${pet.name}</div>
              <div class="info-item"><span class="info-label">Species:</span> ${pet.species}</div>
              <div class="info-item"><span class="info-label">Breed:</span> ${pet.breed || 'Not specified'}</div>
              <div class="info-item"><span class="info-label">Gender:</span> ${pet.gender || 'Not specified'}</div>
              <div class="info-item"><span class="info-label">Weight:</span> ${pet.weight ? pet.weight + ' kg' : 'Not recorded'}</div>
              <div class="info-item"><span class="info-label">Color:</span> ${pet.color || 'Not specified'}</div>
            </div>
          </div>

          <div class="section">
            <h3>Owner Information</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Name:</span> ${owner.name}</div>
              <div class="info-item"><span class="info-label">Email:</span> ${owner.email}</div>
              <div class="info-item"><span class="info-label">Phone:</span> ${owner.phone || 'Not provided'}</div>
              <div class="info-item"><span class="info-label">Address:</span> ${owner.address || 'Not provided'}</div>
            </div>
          </div>

          <div class="section">
            <h3>Medical Summary</h3>
            <div class="info-grid">
              <div class="info-item"><span class="info-label">Total Appointments:</span> ${currentReportData.statistics.total_appointments}</div>
              <div class="info-item"><span class="info-label">Total Vaccinations:</span> ${currentReportData.statistics.total_vaccinations}</div>
              <div class="info-item"><span class="info-label">Last Visit:</span> ${currentReportData.statistics.last_visit ? new Date(currentReportData.statistics.last_visit).toLocaleDateString() : 'Never'}</div>
            </div>
          </div>

          <div class="footer">
            <p><strong>Tattoo Veterinary Clinic</strong></p>
            <p>Phone: 0917-519-4639 | Email: info@tattoovet.com</p>
            <p>This report contains confidential medical information.</p>
          </div>
        </body>
        </html>
      `;

      // Create and download HTML file
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pet_report_${pet.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('HTML report downloaded successfully!', 'success');
    }

    // Pet Management Functions for Client Dashboard
    async function loadClientPets() {
      const petsGrid = document.getElementById('petsGrid');
      if (!petsGrid) return;

      try {
        petsGrid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading pets...</div>';

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();

        if (result.success && result.data && Array.isArray(result.data)) {
          if (result.data.length === 0) {
            petsGrid.innerHTML = '<div class="loading"><p>You haven\'t registered any pets yet. Add your first pet to get started!</p></div>';
          } else {
            displayClientPets(result.data);
          }
        } else {
          const errorMessage = result.message || 'Failed to load pets';
          console.error('API Error:', errorMessage);
          petsGrid.innerHTML = `<div class="loading"><p>Unable to load pets: ${errorMessage}</p></div>`;
        }
      } catch (error) {
        console.error('Error loading pets:', error);
        petsGrid.innerHTML = '<div class="loading"><p>Error loading pets. Please try again later.</p></div>';
      }
    }

    function displayClientPets(pets) {
      const petsGrid = document.getElementById('petsGrid');
      if (!petsGrid) return;

      if (pets.length === 0) {
        petsGrid.innerHTML = '<div class="empty-state"><i class="fas fa-paw"></i><h3>No Pets Found</h3><p>You haven\'t registered any pets yet. Add your first pet to get started!</p></div>';
        return;
      }

      // Clear existing content
      petsGrid.innerHTML = '';

      // Create a document fragment for better performance
      const fragment = document.createDocumentFragment();

      pets.forEach((pet, index) => {
        const petCard = createClientPetCard(pet);
        if (petCard) {
          fragment.appendChild(petCard);
        }
      });

      // Append all cards at once
      petsGrid.appendChild(fragment);
    }

    function createClientPetCard(pet) {
      const card = document.createElement('div');
      card.className = 'pet-card';

      // Get species icon for the minimal design
      const speciesIcon = getSpeciesIcon(pet.species);

      // Format birthdate for display
      let birthdateDisplay = 'Not recorded';
      if (pet.birthdate) {
        const birthDate = new Date(pet.birthdate);
        birthdateDisplay = birthDate.toLocaleDateString();
      }

      // Format weight for display
      let weightDisplay = 'Not recorded';
      if (pet.weight) {
        weightDisplay = `${pet.weight} kg`;
      }

      // Get owner name
      let ownerName = 'Not specified';
      if (pet.first_name && pet.last_name) {
        ownerName = `${pet.first_name} ${pet.last_name}`;
      }

      card.innerHTML = `
        <div class="pet-icon">
          <i class="${speciesIcon}"></i>
        </div>
        <h3 class="pet-name">${pet.name}</h3>
        <p><strong>Species:</strong> ${pet.species}</p>
        <p><strong>Breed:</strong> ${pet.breed || 'Not specified'}</p>
        <p><strong>Birthdate:</strong> ${birthdateDisplay}</p>
        <p><strong>Gender:</strong> ${pet.gender || 'Not specified'}</p>
        <p><strong>Weight:</strong> ${weightDisplay}</p>
        <p><strong>Owner:</strong> ${ownerName}</p>
      `;

      return card;
    }

    function getSpeciesIcon(species) {
      const icons = {
        'dog': 'fas fa-dog',
        'cat': 'fas fa-cat',
        'bird': 'fas fa-dove',
        'rabbit': 'fas fa-paw',
        'hamster': 'fas fa-paw',
        'fish': 'fas fa-fish',
        'reptile': 'fas fa-paw',
        'other': 'fas fa-paw'
      };
      return icons[species.toLowerCase()] || 'fas fa-paw';
    }

    function viewClientPetDetails(petId) {
      // This will be implemented to show pet details modal
      showToast('View pet details feature coming soon!', 'info');
      console.log('View pet details for ID:', petId);
    }

    function viewClientPetMedicalHistory(petId) {
      // This will be implemented to show pet medical history modal
      showToast('Medical history feature coming soon!', 'info');
      console.log('View medical history for pet ID:', petId);
    }



    function deleteClientPet(petId, petName) {
      if (confirm(`Are you sure you want to delete ${petName}? This action cannot be undone.`)) {
        // Here you would implement the delete functionality
        showToast(`Delete functionality for ${petName} will be implemented`, 'info');
        console.log('Delete pet ID:', petId, 'Name:', petName);
      }
    }

    // Debug function to test API endpoints
    async function testPetAPI(petId) {
      console.log('=== TESTING PET API ENDPOINTS ===');
      console.log('Testing for pet ID:', petId);

      const endpoints = [
        { name: 'pet_reports_api.php GET', url: `../api/pet_reports_api.php?action=get_pet_details&pet_id=${petId}`, method: 'GET' },
        { name: 'vet_api.php POST', url: '../api/vet_api.php', method: 'POST', data: { action: 'get_pet_details', pet_id: petId } },
        { name: 'pet_reports_api.php POST', url: '../api/pet_reports_api.php', method: 'POST', data: { action: 'get_pet_details', pet_id: petId } }
      ];

      for (const endpoint of endpoints) {
        try {
          console.log(`\n--- Testing ${endpoint.name} ---`);

          let response;
          if (endpoint.method === 'POST') {
            response = await fetch(endpoint.url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(endpoint.data)
            });
          } else {
            response = await fetch(endpoint.url, {
              method: 'GET',
              headers: { 'Content-Type': 'application/json' }
            });
          }

          console.log('Response status:', response.status);
          console.log('Response headers:', Object.fromEntries(response.headers.entries()));

          const result = await response.json();
          console.log('Full response:', result);

          if (result.success && result.data) {
            console.log('‚úÖ SUCCESS! Data structure:', result.data);
            if (result.data.pet) {
              console.log('Found nested pet data:', result.data.pet);
            }
          } else {
            console.log('‚ùå No success or no data');
          }

        } catch (error) {
          console.error('‚ùå Error:', error.message);
        }
      }

      console.log('=== API TEST COMPLETE ===');
    }

    // Add this to window for easy access from browser console
    window.testPetAPI = testPetAPI;

    // Test function for update API
    async function testUpdateAPI(petId, testData) {
      console.log('=== TESTING PET UPDATE API ===');
      console.log('Testing update for pet ID:', petId);
      console.log('Test data:', testData);

      const updateData = {
        action: 'update_pet',
        pet_id: petId,
        name: testData.name || 'Test Name',
        species: testData.species || 'dog',
        breed: testData.breed || 'Test Breed',
        birthdate: testData.birthdate || '2023-01-01',
        gender: testData.gender || 'male',
        color: testData.color || 'Test Color',
        notes: testData.notes || 'Test Notes'
      };

      try {
        console.log('Sending update request to: ../api/vet_api.php');
        console.log('Update data:', updateData);

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updateData)
        });

        console.log('Response status:', response.status);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));

        const result = await response.json();
        console.log('Update response:', result);

        if (result.success) {
          console.log('‚úÖ UPDATE SUCCESS!');
        } else {
          console.log('‚ùå UPDATE FAILED:', result.message);
        }

        return result;

      } catch (error) {
        console.error('‚ùå UPDATE ERROR:', error);
        return { success: false, message: error.message };
      }
    }

    // Add to window for console access
    window.testUpdateAPI = testUpdateAPI;

    // Debug function to test pets API directly
    async function debugPetReports() {
      console.log('=== DEBUGGING PET REPORTS ===');

      try {
        // Check session first
        console.log('1. Checking session...');
        const sessionResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'check_session' })
        });
        const sessionResult = await sessionResponse.json();
        console.log('Session check result:', sessionResult);

        if (!sessionResult.success) {
          console.error('‚ùå Session check failed:', sessionResult.message);
          toast('Session check failed. Please refresh the page.', 'error');
          return;
        }

        console.log('‚úÖ Session is valid, user type:', sessionResult.data.user_type);

        // Test pets API
        console.log('2. Testing pets API...');
        const petsResponse = await fetch('../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log('Pets API URL:', '../api/pet_reports_api.php?action=get_pet_list&limit=100');
        console.log('Response status:', petsResponse.status);

        const petsResult = await petsResponse.json();
        console.log('Pets API full response:', petsResult);

        if (petsResult.success) {
          console.log('‚úÖ Pets API success! Found', petsResult.data.length, 'pets');

          if (petsResult.data.length === 0) {
            console.log('‚ö†Ô∏è No pets found - this might be the issue');
            toast('No pets found in database for this user', 'warning');
          } else {
            console.log('üìã Pet details:');
            petsResult.data.forEach((pet, index) => {
              console.log(`  ${index + 1}. ${pet.name} (ID: ${pet.id}, Species: ${pet.species}, Owner: ${pet.first_name} ${pet.last_name})`);
            });

            // Check if pets belong to current user
            const currentUserPets = petsResult.data.filter(pet => pet.owner_id === sessionResult.data.user.id);
            console.log('‚úÖ Pets belonging to current user:', currentUserPets.length);
          }
        } else {
          console.error('‚ùå Pets API failed:', petsResult.message);
          toast('Pets API failed: ' + petsResult.message, 'error');
        }

        // Test direct vet_api get_pets
        console.log('3. Testing vet_api get_pets...');
        const vetApiResponse = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_pets' })
        });
        const vetApiResult = await vetApiResponse.json();
        console.log('Vet API get_pets result:', vetApiResult);

        if (vetApiResult.success) {
          console.log('‚úÖ Vet API get_pets success! Found', vetApiResult.data.length, 'pets');
        } else {
          console.error('‚ùå Vet API get_pets failed:', vetApiResult.message);
        }

      } catch (error) {
        console.error('‚ùå Debug error:', error);
        toast('Debug error: ' + error.message, 'error');
      }

      console.log('=== DEBUG COMPLETE ===');
    }

    // Add to window for console access
    window.debugPetReports = debugPetReports;
    window.loadPetsDropdown = loadPetsDropdown;

    // Test Medical Report Display function (for debugging)
    window.testMedicalReportDisplay = function() {
      console.log('=== TESTING MEDICAL REPORT DISPLAY ===');

      // Test data
      const testData = {
        pet: {
          name: 'Bogart',
          species: 'Dog',
          breed: 'Puspin',
          gender: 'Male',
          weight: '25',
          color: 'Blue'
        },
        owner: {
          name: 'John Cedrick Unida',
          email: 'unida99@gmail.com',
          phone: '09286077247',
          address: 'Not provided'
        },
        medical_history: [
          {
            created_at: '2025-10-15 09:00:00',
            staff_name: 'Dr. Smith',
            service_name: 'Vaccination',
            diagnosis: 'Routine health check',
            treatment: 'Annual vaccination administered',
            medications: 'DHPP vaccine, Rabies vaccine',
            notes: 'Patient was healthy and cooperative'
          }
        ],
        statistics: {
          total_appointments: 1,
          total_vaccinations: 1,
          total_medical_records: 1,
          last_visit: '2025-10-15'
        }
      };

      // Find the report preview element
      const reportPreview = document.getElementById('reportPreview');
      if (reportPreview) {
        console.log('‚úÖ Found report preview element');

        // Generate HTML content
        let html = `
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-paw" style="color: #667eea;"></i> Pet Information
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div><strong>Name:</strong> ${testData.pet.name}</div>
              <div><strong>Species:</strong> ${testData.pet.species}</div>
              <div><strong>Breed:</strong> ${testData.pet.breed}</div>
              <div><strong>Gender:</strong> ${testData.pet.gender}</div>
            </div>
          </div>

          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-stethoscope" style="color: #667eea;"></i> Medical Records
            </h3>
            <div style="margin-bottom: 15px; text-align: center;">
              <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
                Total Records: ${testData.medical_history.length}
              </span>
            </div>
        `;

        testData.medical_history.forEach((record, index) => {
          html += `
            <div style="margin: 15px 0; padding: 15px; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);">
              <div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #e1e5e9;">
                <h5 style="margin: 0 0 5px 0; color: #667eea; font-size: 14px;">
                  Visit #${index + 1} - ${new Date(record.created_at).toLocaleDateString()}
                </h5>
                <div style="font-size: 12px; color: #666;">
                  <strong>Staff:</strong> ${record.staff_name} | <strong>Service:</strong> ${record.service_name}
                </div>
              </div>

              <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #667eea;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Diagnosis</div>
                  <div style="color: #555; font-size: 12px;">${record.diagnosis}</div>
                </div>

                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #28a745;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Treatment</div>
                  <div style="color: #555; font-size: 12px;">${record.treatment}</div>
                </div>

                <div style="background: #ffffff; padding: 8px; border-radius: 6px; border-left: 3px solid #ffc107;">
                  <div style="font-weight: bold; color: #333; margin-bottom: 4px; font-size: 12px;">Medications</div>
                  <div style="color: #555; font-size: 12px;">${record.medications}</div>
                </div>
              </div>
            </div>
          `;
        });

        html += `</div>`;

        // Display the HTML
        reportPreview.innerHTML = html;
        console.log('‚úÖ Medical report displayed with test data');

        return '‚úÖ Medical report test completed successfully';
      } else {
        console.error('‚ùå Report preview element not found');
        return '‚ùå Report preview element not found';
      }
    };

    // Notification Badge Management for Client
    function updateNotificationBadge() {
      const mobileToggle = document.getElementById('clientMobileMenuToggle');
      if (!mobileToggle) return;

      // Remove existing badge
      const existingBadge = mobileToggle.querySelector('.notification-badge');
      if (existingBadge) {
        existingBadge.remove();
      }

      // Check for unread notifications
      getUnreadNotificationCount().then(count => {
        if (count > 0) {
          const badge = document.createElement('div');
          badge.className = 'notification-badge';
          badge.textContent = count > 99 ? '99+' : count;
          mobileToggle.appendChild(badge);
          console.log(`üîî Client notification badge added: ${count} unread notifications`);
        }
      }).catch(error => {
        console.error('Error updating notification badge:', error);
      });
    }

    async function getUnreadNotificationCount() {
      try {
        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_unread_count' })
        });

        const result = await response.json();

        if (result.success && result.data) {
          return parseInt(result.data.unread_count) || 0;
        }
        return 0;
      } catch (error) {
        console.error('Error checking notifications:', error);
        return 0;
      }
    }

    // Function to check current select element state
    function checkSelectState() {
      console.log('=== CHECKING SELECT ELEMENT STATE ===');
      const petSelect = document.getElementById('petSelect');

      if (!petSelect) {
        console.error('‚ùå Pet select element not found in DOM');
        return;
      }

      console.log('‚úÖ Pet select element found');
      console.log('üìä Select properties:', {
        id: petSelect.id,
        tagName: petSelect.tagName,
        optionsCount: petSelect.options.length,
        selectedIndex: petSelect.selectedIndex,
        value: petSelect.value,
        disabled: petSelect.disabled
      });

      console.log('üìã Current options:');
      for (let i = 0; i < petSelect.options.length; i++) {
        const option = petSelect.options[i];
        console.log(`  ${i}: value="${option.value}" text="${option.textContent}"`);
      }

      console.log('=== SELECT STATE CHECK COMPLETE ===');
    }

    window.checkSelectState = checkSelectState;


    // Client-specific functions
    async function cancelAppointment(appointmentId) {
      if (!appointmentId) {
        showToast('Invalid appointment ID', 'error');
        return;
      }

      // Confirm cancellation with user
      if (!confirm('Are you sure you want to cancel this appointment? This action cannot be undone.')) {
        return;
      }

      try {
        console.log('Client requesting appointment cancellation for ID:', appointmentId);

        const response = await fetch('../api/vet_api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'cancel_appointment',
            appointment_id: appointmentId
          })
        });

        if (!response.ok) {
          throw new Error(`Server returned ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('Cancellation response:', result);

        if (result.success) {
          showToast('Appointment cancellation request submitted successfully! Staff will review and confirm.', 'success');

          // Update the appointment status in the UI
          updateAppointmentStatusInUI(appointmentId, 'cancelled');

          // Reload appointments to reflect the changes
          if (window.dashboardInstance && typeof window.dashboardInstance.loadAppointmentsSection === 'function') {
            window.dashboardInstance.loadAppointmentsSection();
          }
        } else {
          showToast(result.message || 'Failed to cancel appointment', 'error');
        }
      } catch (error) {
        console.error('Error cancelling appointment:', error);
        showToast('Error cancelling appointment. Please try again or contact the clinic staff.', 'error');
      }
    }

  </script>
</body>
</html>
